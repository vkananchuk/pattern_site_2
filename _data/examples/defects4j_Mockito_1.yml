---
language: java
before_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: InvocationMatcher
        children: []
        pos: 762
        length: 17
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: private static final long serialVersionUID = -3047126096857467610L;
          children: []
          pos: 864
          length: 67
        - type: field_declaration
          fields:
            text: private final Invocation invocation;
          children: []
          pos: 936
          length: 36
        - type: field_declaration
          fields:
            text: private final List<Matcher> matchers;
          children: []
          pos: 977
          length: 37
        - type: constructor_declaration
          fields:
            text: |-
              public InvocationMatcher(Invocation invocation, List<Matcher> matchers) {
                      this.invocation = invocation;
                      if (matchers.isEmpty()) {
                          this.matchers = ArgumentsProcessor.argumentsToMatchers(invocation.getArguments());
                      } else {
                          this.matchers = matchers;
                      }
                  }
          children: []
          pos: 1020
          length: 311
        - type: constructor_declaration
          fields:
            text: |-
              public InvocationMatcher(Invocation invocation) {
                      this(invocation, Collections.<Matcher>emptyList());
                  }
          children: []
          pos: 1341
          length: 115
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getMethod
              children: []
              pos: 1476
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 1462
              length: 72
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return invocation.getMethod();
                children: []
                pos: 1498
                length: 30
              pos: 1488
              length: 46
          children: []
          pos: 1462
          length: 72
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getInvocation
              children: []
              pos: 1562
              length: 13
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 1544
              length: 73
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return this.invocation;
                children: []
                pos: 1588
                length: 23
              pos: 1578
              length: 39
          children: []
          pos: 1544
          length: 73
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getMatchers
              children: []
              pos: 1648
              length: 11
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 1627
              length: 72
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return this.matchers;
                children: []
                pos: 1672
                length: 21
              pos: 1662
              length: 37
          children: []
          pos: 1627
          length: 72
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: toString
              children: []
              pos: 1723
              length: 8
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 1709
              length: 96
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return new PrintSettings().print(matchers, invocation);
                children: []
                pos: 1744
                length: 55
              pos: 1734
              length: 71
          children: []
          pos: 1709
          length: 96
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: matches
              children: []
              pos: 1826
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Invocation actual
                children: []
                pos: 1834
                length: 17
              pos: 1811
              length: 226
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: |-
                    return invocation.getMock().equals(actual.getMock())
                                    && hasSameMethod(actual)
                                    && new ArgumentsComparator().argumentsMatch(this, actual);
                children: []
                pos: 1863
                length: 168
              pos: 1853
              length: 184
          children: []
          pos: 1811
          length: 226
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: safelyArgumentsMatch
              children: []
              pos: 2059
              length: 20
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Object[] actualArgs
                children: []
                pos: 2080
                length: 19
              pos: 2043
              length: 226
            body:
              type: block
              fields: {}
              children:
              - type: try_statement
                fields:
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return new ArgumentsComparator().argumentsMatch(this,
                          actualArgs);
                      children: []
                      pos: 2129
                      length: 66
                    pos: 2115
                    length: 90
                  excepts:
                    type: excepts
                    fields: {}
                    children:
                    - type: catch_clause
                      fields:
                        text: |-
                          catch (Throwable t) {
                                      return false;
                                  }
                      children: []
                      pos: 2206
                      length: 57
                    pos: 2111
                    length: 152
                children: []
                pos: 2111
                length: 152
              pos: 2101
              length: 168
          children: []
          pos: 2043
          length: 226
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: hasSimilarMethod
              children: []
              pos: 2431
              length: 16
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Invocation candidate
                children: []
                pos: 2448
                length: 20
              pos: 2416
              length: 750
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: String wantedMethodName = getMethod().getName();
                children: []
                pos: 2480
                length: 48
              - type: local_variable_declaration
                fields:
                  text: String currentMethodName = candidate.getMethod().getName();
                children: []
                pos: 2537
                length: 59
              - type: local_variable_declaration
                fields:
                  text: final boolean methodNameEquals = wantedMethodName.equals(currentMethodName);
                children: []
                pos: 2614
                length: 76
              - type: local_variable_declaration
                fields:
                  text: final boolean isUnverified = !candidate.isVerified();
                children: []
                pos: 2699
                length: 53
              - type: local_variable_declaration
                fields:
                  text: final boolean mockIsTheSame = getInvocation().getMock() ==
                    candidate.getMock();
                children: []
                pos: 2761
                length: 79
              - type: local_variable_declaration
                fields:
                  text: final boolean methodEquals = hasSameMethod(candidate);
                children: []
                pos: 2849
                length: 54
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: or
                        fields:
                          left:
                            type: or
                            fields:
                              left:
                                type: unary_expression
                                fields:
                                  text: "!methodNameEquals"
                                children: []
                                pos: 2917
                                length: 17
                              right:
                                type: unary_expression
                                fields:
                                  text: "!isUnverified"
                                children: []
                                pos: 2938
                                length: 13
                            children: []
                            pos: 2917
                            length: 34
                          right:
                            type: unary_expression
                            fields:
                              text: "!mockIsTheSame"
                            children: []
                            pos: 2955
                            length: 14
                        children: []
                        pos: 2917
                        length: 52
                    children: []
                    pos: 2916
                    length: 54
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return false;
                    children: []
                    pos: 2985
                    length: 13
                  pos: 2971
                  length: 37
                pos: 2913
                length: 95
              - type: local_variable_declaration
                fields:
                  text: final boolean overloadedButSameArgs = !methodEquals && safelyArgumentsMatch(candidate.getArguments());
                children: []
                pos: 3018
                length: 102
              - type: return_statement
                fields:
                  text: return !overloadedButSameArgs;
                children: []
                pos: 3130
                length: 30
              pos: 2470
              length: 696
          children: []
          pos: 2416
          length: 750
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: hasSameMethod
              children: []
              pos: 3187
              length: 13
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Invocation candidate
                children: []
                pos: 3201
                length: 20
              pos: 3172
              length: 836
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: Method m1 = invocation.getMethod();
                children: []
                pos: 3406
                length: 35
              - type: local_variable_declaration
                fields:
                  text: Method m2 = candidate.getMethod();
                children: []
                pos: 3450
                length: 34
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: and
                        fields:
                          left:
                            type: not_equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: m1.getName()
                                children: []
                                pos: 3506
                                length: 12
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 3522
                                length: 4
                            children: []
                            pos: 3506
                            length: 20
                          right:
                            type: method_invocation
                            fields:
                              text: m1.getName().equals(m2.getName())
                            children: []
                            pos: 3530
                            length: 33
                        children: []
                        pos: 3506
                        length: 57
                    children: []
                    pos: 3505
                    length: 59
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: Class[] params1 = m1.getParameterTypes();
                    children: []
                    pos: 3623
                    length: 41
                  - type: local_variable_declaration
                    fields:
                      text: Class[] params2 = m2.getParameterTypes();
                    children: []
                    pos: 3677
                    length: 41
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: equals
                            fields:
                              left:
                                type: field_access
                                fields:
                                  text: params1.length
                                children: []
                                pos: 3735
                                length: 14
                              right:
                                type: field_access
                                fields:
                                  text: params2.length
                                children: []
                                pos: 3753
                                length: 14
                            children: []
                            pos: 3735
                            length: 32
                        children: []
                        pos: 3734
                        length: 34
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: for_statement
                        fields:
                          text: |-
                            for (int i = 0; i < params1.length; i++) {
                                            if (params1[i] != params2[i])
                                                return false;
                                            }
                        children: []
                        pos: 3787
                        length: 140
                      - type: return_statement
                        fields:
                          text: return true;
                        children: []
                        pos: 3944
                        length: 12
                      pos: 3769
                      length: 201
                    pos: 3731
                    length: 239
                  pos: 3565
                  length: 415
                pos: 3502
                length: 478
              - type: return_statement
                fields:
                  text: return false;
                children: []
                pos: 3989
                length: 13
              pos: 3223
              length: 785
          children: []
          pos: 3172
          length: 836
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getLocation
              children: []
              pos: 4034
              length: 11
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 4018
              length: 78
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return invocation.getLocation();
                children: []
                pos: 4058
                length: 32
              pos: 4048
              length: 48
          children: []
          pos: 4018
          length: 78
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: captureArgumentsFrom
              children: []
              pos: 4114
              length: 20
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Invocation invocation
                children: []
                pos: 4135
                length: 21
              pos: 4102
              length: 2174
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: invocation.getMethod().isVarArgs()
                        children: []
                        pos: 4172
                        length: 34
                    children: []
                    pos: 4171
                    length: 36
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: int indexOfVararg = invocation.getRawArguments().length
                        - 1;
                    children: []
                    pos: 4222
                    length: 60
                  - type: for_statement
                    fields:
                      text: |-
                        for (int position = 0; position < indexOfVararg; position++) {
                                        Matcher m = matchers.get(position);
                                        if (m instanceof CapturesArguments) {
                                            ((CapturesArguments) m).captureFrom(invocation.getArgumentAt(position, Object.class));
                                        }
                                    }
                    children: []
                    pos: 4295
                    length: 307
                  - type: for_statement
                    fields:
                      text: |-
                        for (int position = indexOfVararg; position < matchers.size(); position++) {
                                        Matcher m = matchers.get(position);
                                        if (m instanceof CapturesArguments) {
                                            ((CapturesArguments) m).captureFrom(invocation.getRawArguments()[position - indexOfVararg]);
                                        }
                                    }
                    children: []
                    pos: 4615
                    length: 327
                  pos: 4208
                  length: 745
                pos: 4168
                length: 1124
              pos: 4158
              length: 2118
          children: []
          pos: 4102
          length: 2174
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: isVarargMatcher
              children: []
              pos: 6298
              length: 15
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Matcher matcher
                children: []
                pos: 6314
                length: 15
              pos: 6282
              length: 302
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: Matcher actualMatcher = matcher;
                children: []
                pos: 6341
                length: 32
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: instanceof_expression
                        fields:
                          text: actualMatcher instanceof MatcherDecorator
                        children: []
                        pos: 6386
                        length: 41
                    children: []
                    pos: 6385
                    length: 43
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: actualMatcher = ((MatcherDecorator) actualMatcher).getActualMatcher();
                    children: []
                    pos: 6443
                    length: 70
                  pos: 6429
                  length: 94
                pos: 6382
                length: 141
              - type: return_statement
                fields:
                  text: return actualMatcher instanceof VarargMatcher;
                children: []
                pos: 6532
                length: 46
              pos: 6331
              length: 253
          children: []
          pos: 6282
          length: 302
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: isVariableArgument
              children: []
              pos: 6606
              length: 18
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Invocation invocation
                children: []
                pos: 6625
                length: 21
              pos: 6590
              length: 346
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: |-
                    return invocation.getRawArguments().length - 1 == position
                                    && invocation.getRawArguments()[position] != null
                                    && invocation.getRawArguments()[position].getClass().isArray()
                                    && invocation.getMethod().isVarArgs();
                children: []
                pos: 6672
                length: 258
              pos: 6662
              length: 274
          children: []
          pos: 6590
          length: 346
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: createFrom
              children: []
              pos: 6980
              length: 10
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: List<Invocation> invocations
                children: []
                pos: 6991
                length: 28
              pos: 6942
              length: 289
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: LinkedList<InvocationMatcher> out = new LinkedList<InvocationMatcher>();
                children: []
                pos: 7031
                length: 72
              - type: enhanced_for_statement
                fields:
                  text: |-
                    for (Invocation i : invocations) {
                                out.add(new InvocationMatcher(i));
                            }
                children: []
                pos: 7113
                length: 91
              - type: return_statement
                fields:
                  text: return out;
                children: []
                pos: 7214
                length: 11
              pos: 7021
              length: 210
          children: []
          pos: 6942
          length: 289
        pos: 718
        length: 6515
    children: []
    pos: 718
    length: 6515
  pos: 0
  length: 7234
after_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: InvocationMatcher
        children: []
        pos: 762
        length: 17
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: private static final long serialVersionUID = -3047126096857467610L;
          children: []
          pos: 864
          length: 67
        - type: field_declaration
          fields:
            text: private final Invocation invocation;
          children: []
          pos: 936
          length: 36
        - type: field_declaration
          fields:
            text: private final List<Matcher> matchers;
          children: []
          pos: 977
          length: 37
        - type: constructor_declaration
          fields:
            text: |-
              public InvocationMatcher(Invocation invocation, List<Matcher> matchers) {
                      this.invocation = invocation;
                      if (matchers.isEmpty()) {
                          this.matchers = ArgumentsProcessor.argumentsToMatchers(invocation.getArguments());
                      } else {
                          this.matchers = matchers;
                      }
                  }
          children: []
          pos: 1020
          length: 311
        - type: constructor_declaration
          fields:
            text: |-
              public InvocationMatcher(Invocation invocation) {
                      this(invocation, Collections.<Matcher>emptyList());
                  }
          children: []
          pos: 1341
          length: 115
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getMethod
              children: []
              pos: 1476
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 1462
              length: 72
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return invocation.getMethod();
                children: []
                pos: 1498
                length: 30
              pos: 1488
              length: 46
          children: []
          pos: 1462
          length: 72
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getInvocation
              children: []
              pos: 1562
              length: 13
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 1544
              length: 73
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return this.invocation;
                children: []
                pos: 1588
                length: 23
              pos: 1578
              length: 39
          children: []
          pos: 1544
          length: 73
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getMatchers
              children: []
              pos: 1648
              length: 11
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 1627
              length: 72
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return this.matchers;
                children: []
                pos: 1672
                length: 21
              pos: 1662
              length: 37
          children: []
          pos: 1627
          length: 72
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: toString
              children: []
              pos: 1723
              length: 8
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 1709
              length: 96
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return new PrintSettings().print(matchers, invocation);
                children: []
                pos: 1744
                length: 55
              pos: 1734
              length: 71
          children: []
          pos: 1709
          length: 96
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: matches
              children: []
              pos: 1826
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Invocation actual
                children: []
                pos: 1834
                length: 17
              pos: 1811
              length: 226
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: |-
                    return invocation.getMock().equals(actual.getMock())
                                    && hasSameMethod(actual)
                                    && new ArgumentsComparator().argumentsMatch(this, actual);
                children: []
                pos: 1863
                length: 168
              pos: 1853
              length: 184
          children: []
          pos: 1811
          length: 226
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: safelyArgumentsMatch
              children: []
              pos: 2059
              length: 20
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Object[] actualArgs
                children: []
                pos: 2080
                length: 19
              pos: 2043
              length: 226
            body:
              type: block
              fields: {}
              children:
              - type: try_statement
                fields:
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return new ArgumentsComparator().argumentsMatch(this,
                          actualArgs);
                      children: []
                      pos: 2129
                      length: 66
                    pos: 2115
                    length: 90
                  excepts:
                    type: excepts
                    fields: {}
                    children:
                    - type: catch_clause
                      fields:
                        text: |-
                          catch (Throwable t) {
                                      return false;
                                  }
                      children: []
                      pos: 2206
                      length: 57
                    pos: 2111
                    length: 152
                children: []
                pos: 2111
                length: 152
              pos: 2101
              length: 168
          children: []
          pos: 2043
          length: 226
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: hasSimilarMethod
              children: []
              pos: 2431
              length: 16
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Invocation candidate
                children: []
                pos: 2448
                length: 20
              pos: 2416
              length: 750
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: String wantedMethodName = getMethod().getName();
                children: []
                pos: 2480
                length: 48
              - type: local_variable_declaration
                fields:
                  text: String currentMethodName = candidate.getMethod().getName();
                children: []
                pos: 2537
                length: 59
              - type: local_variable_declaration
                fields:
                  text: final boolean methodNameEquals = wantedMethodName.equals(currentMethodName);
                children: []
                pos: 2614
                length: 76
              - type: local_variable_declaration
                fields:
                  text: final boolean isUnverified = !candidate.isVerified();
                children: []
                pos: 2699
                length: 53
              - type: local_variable_declaration
                fields:
                  text: final boolean mockIsTheSame = getInvocation().getMock() ==
                    candidate.getMock();
                children: []
                pos: 2761
                length: 79
              - type: local_variable_declaration
                fields:
                  text: final boolean methodEquals = hasSameMethod(candidate);
                children: []
                pos: 2849
                length: 54
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: or
                        fields:
                          left:
                            type: or
                            fields:
                              left:
                                type: unary_expression
                                fields:
                                  text: "!methodNameEquals"
                                children: []
                                pos: 2917
                                length: 17
                              right:
                                type: unary_expression
                                fields:
                                  text: "!isUnverified"
                                children: []
                                pos: 2938
                                length: 13
                            children: []
                            pos: 2917
                            length: 34
                          right:
                            type: unary_expression
                            fields:
                              text: "!mockIsTheSame"
                            children: []
                            pos: 2955
                            length: 14
                        children: []
                        pos: 2917
                        length: 52
                    children: []
                    pos: 2916
                    length: 54
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return false;
                    children: []
                    pos: 2985
                    length: 13
                  pos: 2971
                  length: 37
                pos: 2913
                length: 95
              - type: local_variable_declaration
                fields:
                  text: final boolean overloadedButSameArgs = !methodEquals && safelyArgumentsMatch(candidate.getArguments());
                children: []
                pos: 3018
                length: 102
              - type: return_statement
                fields:
                  text: return !overloadedButSameArgs;
                children: []
                pos: 3130
                length: 30
              pos: 2470
              length: 696
          children: []
          pos: 2416
          length: 750
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: hasSameMethod
              children: []
              pos: 3187
              length: 13
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Invocation candidate
                children: []
                pos: 3201
                length: 20
              pos: 3172
              length: 836
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: Method m1 = invocation.getMethod();
                children: []
                pos: 3406
                length: 35
              - type: local_variable_declaration
                fields:
                  text: Method m2 = candidate.getMethod();
                children: []
                pos: 3450
                length: 34
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: and
                        fields:
                          left:
                            type: not_equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: m1.getName()
                                children: []
                                pos: 3506
                                length: 12
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 3522
                                length: 4
                            children: []
                            pos: 3506
                            length: 20
                          right:
                            type: method_invocation
                            fields:
                              text: m1.getName().equals(m2.getName())
                            children: []
                            pos: 3530
                            length: 33
                        children: []
                        pos: 3506
                        length: 57
                    children: []
                    pos: 3505
                    length: 59
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: Class[] params1 = m1.getParameterTypes();
                    children: []
                    pos: 3623
                    length: 41
                  - type: local_variable_declaration
                    fields:
                      text: Class[] params2 = m2.getParameterTypes();
                    children: []
                    pos: 3677
                    length: 41
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: equals
                            fields:
                              left:
                                type: field_access
                                fields:
                                  text: params1.length
                                children: []
                                pos: 3735
                                length: 14
                              right:
                                type: field_access
                                fields:
                                  text: params2.length
                                children: []
                                pos: 3753
                                length: 14
                            children: []
                            pos: 3735
                            length: 32
                        children: []
                        pos: 3734
                        length: 34
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: for_statement
                        fields:
                          text: |-
                            for (int i = 0; i < params1.length; i++) {
                                            if (params1[i] != params2[i])
                                                return false;
                                            }
                        children: []
                        pos: 3787
                        length: 140
                      - type: return_statement
                        fields:
                          text: return true;
                        children: []
                        pos: 3944
                        length: 12
                      pos: 3769
                      length: 201
                    pos: 3731
                    length: 239
                  pos: 3565
                  length: 415
                pos: 3502
                length: 478
              - type: return_statement
                fields:
                  text: return false;
                children: []
                pos: 3989
                length: 13
              pos: 3223
              length: 785
          children: []
          pos: 3172
          length: 836
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getLocation
              children: []
              pos: 4034
              length: 11
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 4018
              length: 78
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return invocation.getLocation();
                children: []
                pos: 4058
                length: 32
              pos: 4048
              length: 48
          children: []
          pos: 4018
          length: 78
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: captureArgumentsFrom
              children: []
              pos: 4114
              length: 20
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Invocation invocation
                children: []
                pos: 4135
                length: 21
              pos: 4102
              length: 1569
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: invocation.getMethod().isVarArgs()
                        children: []
                        pos: 4172
                        length: 34
                    children: []
                    pos: 4171
                    length: 36
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: int indexOfVararg = invocation.getRawArguments().length
                        - 1;
                    children: []
                    pos: 4222
                    length: 60
                  - type: throw_statement
                    fields:
                      text: throw new UnsupportedOperationException();
                    children: []
                    pos: 4295
                    length: 42
                  pos: 4208
                  length: 140
                pos: 4168
                length: 519
              pos: 4158
              length: 1513
          children: []
          pos: 4102
          length: 1569
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: isVarargMatcher
              children: []
              pos: 5693
              length: 15
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Matcher matcher
                children: []
                pos: 5709
                length: 15
              pos: 5677
              length: 302
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: Matcher actualMatcher = matcher;
                children: []
                pos: 5736
                length: 32
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: instanceof_expression
                        fields:
                          text: actualMatcher instanceof MatcherDecorator
                        children: []
                        pos: 5781
                        length: 41
                    children: []
                    pos: 5780
                    length: 43
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: actualMatcher = ((MatcherDecorator) actualMatcher).getActualMatcher();
                    children: []
                    pos: 5838
                    length: 70
                  pos: 5824
                  length: 94
                pos: 5777
                length: 141
              - type: return_statement
                fields:
                  text: return actualMatcher instanceof VarargMatcher;
                children: []
                pos: 5927
                length: 46
              pos: 5726
              length: 253
          children: []
          pos: 5677
          length: 302
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: isVariableArgument
              children: []
              pos: 6001
              length: 18
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Invocation invocation
                children: []
                pos: 6020
                length: 21
              pos: 5985
              length: 346
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: |-
                    return invocation.getRawArguments().length - 1 == position
                                    && invocation.getRawArguments()[position] != null
                                    && invocation.getRawArguments()[position].getClass().isArray()
                                    && invocation.getMethod().isVarArgs();
                children: []
                pos: 6067
                length: 258
              pos: 6057
              length: 274
          children: []
          pos: 5985
          length: 346
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: createFrom
              children: []
              pos: 6375
              length: 10
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: List<Invocation> invocations
                children: []
                pos: 6386
                length: 28
              pos: 6337
              length: 289
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: LinkedList<InvocationMatcher> out = new LinkedList<InvocationMatcher>();
                children: []
                pos: 6426
                length: 72
              - type: enhanced_for_statement
                fields:
                  text: |-
                    for (Invocation i : invocations) {
                                out.add(new InvocationMatcher(i));
                            }
                children: []
                pos: 6508
                length: 91
              - type: return_statement
                fields:
                  text: return out;
                children: []
                pos: 6609
                length: 11
              pos: 6416
              length: 210
          children: []
          pos: 6337
          length: 289
        pos: 718
        length: 5910
    children: []
    pos: 718
    length: 5910
  pos: 0
  length: 6629
text_diff: "--- before\n+++ after\n@@ -120,18 +120,7 @@\n     public void captureArgumentsFrom(Invocation
  invocation) {\n         if (invocation.getMethod().isVarArgs()) {\n             int
  indexOfVararg = invocation.getRawArguments().length - 1;\n-            for (int
  position = 0; position < indexOfVararg; position++) {\n-                Matcher
  m = matchers.get(position);\n-                if (m instanceof CapturesArguments)
  {\n-                    ((CapturesArguments) m).captureFrom(invocation.getArgumentAt(position,
  Object.class));\n-                }\n-            }\n-            for (int position
  = indexOfVararg; position < matchers.size(); position++) {\n-                Matcher
  m = matchers.get(position);\n-                if (m instanceof CapturesArguments)
  {\n-                    ((CapturesArguments) m).captureFrom(invocation.getRawArguments()[position
  - indexOfVararg]);\n-                }\n-            }\n+            throw new UnsupportedOperationException();\n
  \n         } else {\n             for (int position = 0; position < matchers.size();
  position++) {\n"
tree_diff: |+
  New cluster:
  ===
  insert-node
  ---
  throw_statement: throw new UnsupportedOperationException(); [4295,4337]
  to
  block [4208,4953]
  at 1
  ------------
  ===
  insert-node
  ---
  throw_statement: throw new UnsupportedOperationException(); [4295,4337]
  to
  block [4208,4953]
  at 1

  New cluster:
  ===
  delete-node
  ---
  for_statement: for (int position = 0; position < indexOfVararg; position++) {
                  Matcher m = matchers.get(position);
                  if (m instanceof CapturesArguments) {
                      ((CapturesArguments) m).captureFrom(invocation.getArgumentAt(position, Object.class));
                  }
              } [4295,4602]
  ===
  ------------
  ===
  delete-node
  ---
  for_statement: for (int position = 0; position < indexOfVararg; position++) {
                  Matcher m = matchers.get(position);
                  if (m instanceof CapturesArguments) {
                      ((CapturesArguments) m).captureFrom(invocation.getArgumentAt(position, Object.class));
                  }
              } [4295,4602]
  ===

  New cluster:
  ===
  delete-node
  ---
  for_statement: for (int position = indexOfVararg; position < matchers.size(); position++) {
                  Matcher m = matchers.get(position);
                  if (m instanceof CapturesArguments) {
                      ((CapturesArguments) m).captureFrom(invocation.getRawArguments()[position - indexOfVararg]);
                  }
              } [4615,4942]
  ===
  ------------
  ===
  delete-node
  ---
  for_statement: for (int position = indexOfVararg; position < matchers.size(); position++) {
                  Matcher m = matchers.get(position);
                  if (m instanceof CapturesArguments) {
                      ((CapturesArguments) m).captureFrom(invocation.getRawArguments()[position - indexOfVararg]);
                  }
              } [4615,4942]
  ===

...
