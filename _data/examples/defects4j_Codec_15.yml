---
language: java
before_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: Soundex
        children: []
        pos: 1290
        length: 7
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: public static final String US_ENGLISH_MAPPING_STRING = "01230120022455012623010202";
          children: []
          pos: 1707
          length: 84
        - type: field_declaration
          fields:
            text: private static final char[] US_ENGLISH_MAPPING = US_ENGLISH_MAPPING_STRING.toCharArray();
          children: []
          pos: 2003
          length: 89
        - type: field_declaration
          fields:
            text: public static final Soundex US_ENGLISH = new Soundex();
          children: []
          pos: 2221
          length: 55
        - type: field_declaration
          fields:
            text: |-
              @Deprecated
                  private int maxLength = 4;
          children: []
          pos: 2517
          length: 42
        - type: field_declaration
          fields:
            text: private final char[] soundexMapping;
          children: []
          pos: 2781
          length: 36
        - type: constructor_declaration
          fields:
            text: |-
              public Soundex() {
                      this.soundexMapping = US_ENGLISH_MAPPING;
                  }
          children: []
          pos: 2973
          length: 74
        - type: constructor_declaration
          fields:
            text: |-
              public Soundex(final char[] mapping) {
                      this.soundexMapping = new char[mapping.length];
                      System.arraycopy(mapping, 0, this.soundexMapping, 0, mapping.length);
                  }
          children: []
          pos: 3576
          length: 178
        - type: constructor_declaration
          fields:
            text: |-
              public Soundex(final String mapping) {
                      this.soundexMapping = mapping.toCharArray();
                  }
          children: []
          pos: 4135
          length: 97
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: difference
              children: []
              pos: 5154
              length: 10
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: final String s1
                children: []
                pos: 5165
                length: 15
              pos: 5143
              length: 141
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return SoundexUtils.difference(this, s1, s2);
                children: []
                pos: 5233
                length: 45
              pos: 5223
              length: 61
          children: []
          pos: 5143
          length: 141
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: encode
              children: []
              pos: 5987
              length: 6
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: final Object obj
                children: []
                pos: 5994
                length: 16
              pos: 5959
              length: 284
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: unary_expression
                        fields:
                          text: "!(obj instanceof String)"
                        children: []
                        pos: 6050
                        length: 24
                    children: []
                    pos: 6049
                    length: 26
                children:
                - type: block
                  fields: {}
                  children:
                  - type: throw_statement
                    fields:
                      text: throw new EncoderException("Parameter supplied to Soundex
                        encode is not of type java.lang.String");
                    children: []
                    pos: 6090
                    length: 99
                  pos: 6076
                  length: 123
                pos: 6046
                length: 153
              - type: return_statement
                fields:
                  text: return soundex((String) obj);
                children: []
                pos: 6208
                length: 29
              pos: 6036
              length: 207
          children: []
          pos: 5959
          length: 284
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: encode
              children: []
              pos: 6581
              length: 6
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: final String str
                children: []
                pos: 6588
                length: 16
              pos: 6553
              length: 89
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return soundex(str);
                children: []
                pos: 6616
                length: 20
              pos: 6606
              length: 36
          children: []
          pos: 6553
          length: 89
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getMappingCode
              children: []
              pos: 7146
              length: 14
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: final String str
                children: []
                pos: 7161
                length: 16
              pos: 7133
              length: 603
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: final char mappedChar = this.map(str.charAt(index));
                children: []
                pos: 7255
                length: 52
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: and
                        fields:
                          left:
                            type: greater_than
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: index
                                children: []
                                pos: 7345
                                length: 5
                              right:
                                type: decimal_integer_literal
                                fields:
                                  text: '1'
                                children: []
                                pos: 7353
                                length: 1
                            children: []
                            pos: 7345
                            length: 9
                          right:
                            type: not_equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: mappedChar
                                children: []
                                pos: 7358
                                length: 10
                              right:
                                type: character_literal
                                fields:
                                  text: "'0'"
                                children: []
                                pos: 7372
                                length: 3
                            children: []
                            pos: 7358
                            length: 17
                        children: []
                        pos: 7345
                        length: 30
                    children: []
                    pos: 7344
                    length: 32
                children:
                - type: block
                  fields: {}
                  children:
                  - type: for_statement
                    fields:
                      text: |-
                        for (int i=index-1 ; i>=0 ; i--) {
                                        final char prevChar = str.charAt(i);
                                        if (this.map(prevChar)==mappedChar) {
                                            return 0;
                                        }
                                        if ('H'!=prevChar && 'W'!=prevChar) {
                                            break;
                                        }
                                    }
                    children: []
                    pos: 7391
                    length: 302
                  pos: 7377
                  length: 326
                pos: 7341
                length: 362
              - type: return_statement
                fields:
                  text: return mappedChar;
                children: []
                pos: 7712
                length: 18
              pos: 7196
              length: 540
          children: []
          pos: 7133
          length: 603
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getMaxLength
              children: []
              pos: 7970
              length: 12
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 7943
              length: 80
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return this.maxLength;
                children: []
                pos: 7995
                length: 22
              pos: 7985
              length: 38
          children: []
          pos: 7943
          length: 80
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getSoundexMapping
              children: []
              pos: 8134
              length: 17
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 8119
              length: 78
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return this.soundexMapping;
                children: []
                pos: 8164
                length: 27
              pos: 8154
              length: 43
          children: []
          pos: 8119
          length: 78
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: map
              children: []
              pos: 8505
              length: 3
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: final char ch
                children: []
                pos: 8509
                length: 13
              pos: 8492
              length: 288
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: final int index = ch - 'A';
                children: []
                pos: 8534
                length: 27
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: or
                        fields:
                          left:
                            type: less_than
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: index
                                children: []
                                pos: 8574
                                length: 5
                              right:
                                type: decimal_integer_literal
                                fields:
                                  text: '0'
                                children: []
                                pos: 8582
                                length: 1
                            children: []
                            pos: 8574
                            length: 9
                          right:
                            type: greater_or_equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: index
                                children: []
                                pos: 8587
                                length: 5
                              right:
                                type: field_access
                                fields:
                                  text: this.getSoundexMapping().length
                                children: []
                                pos: 8596
                                length: 31
                            children: []
                            pos: 8587
                            length: 40
                        children: []
                        pos: 8574
                        length: 53
                    children: []
                    pos: 8573
                    length: 55
                children:
                - type: block
                  fields: {}
                  children:
                  - type: throw_statement
                    fields:
                      text: 'throw new IllegalArgumentException("The character is
                        not mapped: " + ch);'
                    children: []
                    pos: 8643
                    length: 73
                  pos: 8629
                  length: 97
                pos: 8570
                length: 156
              - type: return_statement
                fields:
                  text: return this.getSoundexMapping()[index];
                children: []
                pos: 8735
                length: 39
              pos: 8524
              length: 256
          children: []
          pos: 8492
          length: 288
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: setMaxLength
              children: []
              pos: 9045
              length: 12
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: final int maxLength
                children: []
                pos: 9058
                length: 19
              pos: 9017
              length: 105
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: this.maxLength = maxLength;
                children: []
                pos: 9089
                length: 27
              pos: 9079
              length: 43
          children: []
          pos: 9017
          length: 105
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: soundex
              children: []
              pos: 9460
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String str
                children: []
                pos: 9468
                length: 10
              pos: 9446
              length: 802
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: str
                            children: []
                            pos: 9494
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 9501
                            length: 4
                        children: []
                        pos: 9494
                        length: 11
                    children: []
                    pos: 9493
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return null;
                    children: []
                    pos: 9521
                    length: 12
                  pos: 9507
                  length: 36
                pos: 9490
                length: 53
              - type: expression_statement
                fields:
                  text: str = SoundexUtils.clean(str);
                children: []
                pos: 9552
                length: 30
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: method_invocation
                            fields:
                              text: str.length()
                            children: []
                            pos: 9595
                            length: 12
                          right:
                            type: decimal_integer_literal
                            fields:
                              text: '0'
                            children: []
                            pos: 9611
                            length: 1
                        children: []
                        pos: 9595
                        length: 17
                    children: []
                    pos: 9594
                    length: 19
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return str;
                    children: []
                    pos: 9628
                    length: 11
                  pos: 9614
                  length: 35
                pos: 9591
                length: 58
              - type: local_variable_declaration
                fields:
                  text: final char out[] = {'0', '0', '0', '0'};
                children: []
                pos: 9658
                length: 40
              - type: local_variable_declaration
                fields:
                  text: char last, mapped;
                children: []
                pos: 9707
                length: 18
              - type: local_variable_declaration
                fields:
                  text: int incount = 1, count = 1;
                children: []
                pos: 9734
                length: 27
              - type: expression_statement
                fields:
                  text: out[0] = str.charAt(0);
                children: []
                pos: 9770
                length: 23
              - type: expression_statement
                fields:
                  text: last = getMappingCode(str, 0);
                children: []
                pos: 9862
                length: 30
              - type: while_statement
                fields:
                  text: |-
                    while (incount < str.length() && count < out.length) {
                                mapped = getMappingCode(str, incount++);
                                if (mapped != 0) {
                                    if (mapped != '0' && mapped != last) {
                                        out[count++] = mapped;
                                    }
                                    last = mapped;
                                }
                            }
                children: []
                pos: 9901
                length: 309
              - type: return_statement
                fields:
                  text: return new String(out);
                children: []
                pos: 10219
                length: 23
              pos: 9480
              length: 768
          children: []
          pos: 9446
          length: 802
        pos: 1277
        length: 8974
    children: []
    pos: 1277
    length: 8974
  pos: 0
  length: 10252
after_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: Soundex
        children: []
        pos: 1290
        length: 7
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: public static final String US_ENGLISH_MAPPING_STRING = "01230120022455012623010202";
          children: []
          pos: 1707
          length: 84
        - type: field_declaration
          fields:
            text: private static final char[] US_ENGLISH_MAPPING = US_ENGLISH_MAPPING_STRING.toCharArray();
          children: []
          pos: 2003
          length: 89
        - type: field_declaration
          fields:
            text: public static final Soundex US_ENGLISH = new Soundex();
          children: []
          pos: 2221
          length: 55
        - type: field_declaration
          fields:
            text: |-
              @Deprecated
                  private int maxLength = 4;
          children: []
          pos: 2517
          length: 42
        - type: field_declaration
          fields:
            text: private final char[] soundexMapping;
          children: []
          pos: 2781
          length: 36
        - type: constructor_declaration
          fields:
            text: |-
              public Soundex() {
                      this.soundexMapping = US_ENGLISH_MAPPING;
                  }
          children: []
          pos: 2973
          length: 74
        - type: constructor_declaration
          fields:
            text: |-
              public Soundex(final char[] mapping) {
                      this.soundexMapping = new char[mapping.length];
                      System.arraycopy(mapping, 0, this.soundexMapping, 0, mapping.length);
                  }
          children: []
          pos: 3576
          length: 178
        - type: constructor_declaration
          fields:
            text: |-
              public Soundex(final String mapping) {
                      this.soundexMapping = mapping.toCharArray();
                  }
          children: []
          pos: 4135
          length: 97
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: difference
              children: []
              pos: 5154
              length: 10
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: final String s1
                children: []
                pos: 5165
                length: 15
              pos: 5143
              length: 141
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return SoundexUtils.difference(this, s1, s2);
                children: []
                pos: 5233
                length: 45
              pos: 5223
              length: 61
          children: []
          pos: 5143
          length: 141
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: encode
              children: []
              pos: 5987
              length: 6
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: final Object obj
                children: []
                pos: 5994
                length: 16
              pos: 5959
              length: 284
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: unary_expression
                        fields:
                          text: "!(obj instanceof String)"
                        children: []
                        pos: 6050
                        length: 24
                    children: []
                    pos: 6049
                    length: 26
                children:
                - type: block
                  fields: {}
                  children:
                  - type: throw_statement
                    fields:
                      text: throw new EncoderException("Parameter supplied to Soundex
                        encode is not of type java.lang.String");
                    children: []
                    pos: 6090
                    length: 99
                  pos: 6076
                  length: 123
                pos: 6046
                length: 153
              - type: return_statement
                fields:
                  text: return soundex((String) obj);
                children: []
                pos: 6208
                length: 29
              pos: 6036
              length: 207
          children: []
          pos: 5959
          length: 284
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: encode
              children: []
              pos: 6581
              length: 6
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: final String str
                children: []
                pos: 6588
                length: 16
              pos: 6553
              length: 89
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return soundex(str);
                children: []
                pos: 6616
                length: 20
              pos: 6606
              length: 36
          children: []
          pos: 6553
          length: 89
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getMappingCode
              children: []
              pos: 7146
              length: 14
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: final String str
                children: []
                pos: 7161
                length: 16
              pos: 7133
              length: 664
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: final char mappedChar = this.map(str.charAt(index));
                children: []
                pos: 7255
                length: 52
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: and
                        fields:
                          left:
                            type: greater_than
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: index
                                children: []
                                pos: 7345
                                length: 5
                              right:
                                type: decimal_integer_literal
                                fields:
                                  text: '1'
                                children: []
                                pos: 7353
                                length: 1
                            children: []
                            pos: 7345
                            length: 9
                          right:
                            type: not_equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: mappedChar
                                children: []
                                pos: 7358
                                length: 10
                              right:
                                type: character_literal
                                fields:
                                  text: "'0'"
                                children: []
                                pos: 7372
                                length: 3
                            children: []
                            pos: 7358
                            length: 17
                        children: []
                        pos: 7345
                        length: 30
                    children: []
                    pos: 7344
                    length: 32
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: final char hwChar = str.charAt(index - 1);
                    children: []
                    pos: 7391
                    length: 42
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: or
                            fields:
                              left:
                                type: equals
                                fields:
                                  left:
                                    type: character_literal
                                    fields:
                                      text: "'H'"
                                    children: []
                                    pos: 7450
                                    length: 3
                                  right:
                                    type: identifier
                                    fields:
                                      text: hwChar
                                    children: []
                                    pos: 7457
                                    length: 6
                                children: []
                                pos: 7450
                                length: 13
                              right:
                                type: equals
                                fields:
                                  left:
                                    type: character_literal
                                    fields:
                                      text: "'W'"
                                    children: []
                                    pos: 7467
                                    length: 3
                                  right:
                                    type: identifier
                                    fields:
                                      text: hwChar
                                    children: []
                                    pos: 7474
                                    length: 6
                                children: []
                                pos: 7467
                                length: 13
                            children: []
                            pos: 7450
                            length: 30
                        children: []
                        pos: 7449
                        length: 32
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: local_variable_declaration
                        fields:
                          text: final char preHWChar = str.charAt(index - 2);
                        children: []
                        pos: 7500
                        length: 45
                      - type: local_variable_declaration
                        fields:
                          text: final char firstCode = this.map(preHWChar);
                        children: []
                        pos: 7562
                        length: 43
                      - type: if_statement
                        fields:
                          condition:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: or
                                fields:
                                  left:
                                    type: or
                                    fields:
                                      left:
                                        type: equals
                                        fields:
                                          left:
                                            type: identifier
                                            fields:
                                              text: firstCode
                                            children: []
                                            pos: 7626
                                            length: 9
                                          right:
                                            type: identifier
                                            fields:
                                              text: mappedChar
                                            children: []
                                            pos: 7639
                                            length: 10
                                        children: []
                                        pos: 7626
                                        length: 23
                                      right:
                                        type: equals
                                        fields:
                                          left:
                                            type: character_literal
                                            fields:
                                              text: "'H'"
                                            children: []
                                            pos: 7653
                                            length: 3
                                          right:
                                            type: identifier
                                            fields:
                                              text: preHWChar
                                            children: []
                                            pos: 7660
                                            length: 9
                                        children: []
                                        pos: 7653
                                        length: 16
                                    children: []
                                    pos: 7626
                                    length: 43
                                  right:
                                    type: equals
                                    fields:
                                      left:
                                        type: character_literal
                                        fields:
                                          text: "'W'"
                                        children: []
                                        pos: 7673
                                        length: 3
                                      right:
                                        type: identifier
                                        fields:
                                          text: preHWChar
                                        children: []
                                        pos: 7680
                                        length: 9
                                    children: []
                                    pos: 7673
                                    length: 16
                                children: []
                                pos: 7626
                                length: 63
                            children: []
                            pos: 7625
                            length: 65
                        children:
                        - type: block
                          fields: {}
                          children:
                          - type: return_statement
                            fields:
                              text: return 0;
                            children: []
                            pos: 7713
                            length: 9
                          pos: 7691
                          length: 49
                        pos: 7622
                        length: 118
                      pos: 7482
                      length: 272
                    pos: 7446
                    length: 308
                  pos: 7377
                  length: 387
                pos: 7341
                length: 423
              - type: return_statement
                fields:
                  text: return mappedChar;
                children: []
                pos: 7773
                length: 18
              pos: 7196
              length: 601
          children: []
          pos: 7133
          length: 664
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getMaxLength
              children: []
              pos: 8031
              length: 12
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 8004
              length: 80
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return this.maxLength;
                children: []
                pos: 8056
                length: 22
              pos: 8046
              length: 38
          children: []
          pos: 8004
          length: 80
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getSoundexMapping
              children: []
              pos: 8195
              length: 17
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 8180
              length: 78
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return this.soundexMapping;
                children: []
                pos: 8225
                length: 27
              pos: 8215
              length: 43
          children: []
          pos: 8180
          length: 78
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: map
              children: []
              pos: 8566
              length: 3
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: final char ch
                children: []
                pos: 8570
                length: 13
              pos: 8553
              length: 288
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: final int index = ch - 'A';
                children: []
                pos: 8595
                length: 27
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: or
                        fields:
                          left:
                            type: less_than
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: index
                                children: []
                                pos: 8635
                                length: 5
                              right:
                                type: decimal_integer_literal
                                fields:
                                  text: '0'
                                children: []
                                pos: 8643
                                length: 1
                            children: []
                            pos: 8635
                            length: 9
                          right:
                            type: greater_or_equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: index
                                children: []
                                pos: 8648
                                length: 5
                              right:
                                type: field_access
                                fields:
                                  text: this.getSoundexMapping().length
                                children: []
                                pos: 8657
                                length: 31
                            children: []
                            pos: 8648
                            length: 40
                        children: []
                        pos: 8635
                        length: 53
                    children: []
                    pos: 8634
                    length: 55
                children:
                - type: block
                  fields: {}
                  children:
                  - type: throw_statement
                    fields:
                      text: 'throw new IllegalArgumentException("The character is
                        not mapped: " + ch);'
                    children: []
                    pos: 8704
                    length: 73
                  pos: 8690
                  length: 97
                pos: 8631
                length: 156
              - type: return_statement
                fields:
                  text: return this.getSoundexMapping()[index];
                children: []
                pos: 8796
                length: 39
              pos: 8585
              length: 256
          children: []
          pos: 8553
          length: 288
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: setMaxLength
              children: []
              pos: 9106
              length: 12
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: final int maxLength
                children: []
                pos: 9119
                length: 19
              pos: 9078
              length: 105
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: this.maxLength = maxLength;
                children: []
                pos: 9150
                length: 27
              pos: 9140
              length: 43
          children: []
          pos: 9078
          length: 105
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: soundex
              children: []
              pos: 9521
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String str
                children: []
                pos: 9529
                length: 10
              pos: 9507
              length: 802
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: str
                            children: []
                            pos: 9555
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 9562
                            length: 4
                        children: []
                        pos: 9555
                        length: 11
                    children: []
                    pos: 9554
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return null;
                    children: []
                    pos: 9582
                    length: 12
                  pos: 9568
                  length: 36
                pos: 9551
                length: 53
              - type: expression_statement
                fields:
                  text: str = SoundexUtils.clean(str);
                children: []
                pos: 9613
                length: 30
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: method_invocation
                            fields:
                              text: str.length()
                            children: []
                            pos: 9656
                            length: 12
                          right:
                            type: decimal_integer_literal
                            fields:
                              text: '0'
                            children: []
                            pos: 9672
                            length: 1
                        children: []
                        pos: 9656
                        length: 17
                    children: []
                    pos: 9655
                    length: 19
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return str;
                    children: []
                    pos: 9689
                    length: 11
                  pos: 9675
                  length: 35
                pos: 9652
                length: 58
              - type: local_variable_declaration
                fields:
                  text: final char out[] = {'0', '0', '0', '0'};
                children: []
                pos: 9719
                length: 40
              - type: local_variable_declaration
                fields:
                  text: char last, mapped;
                children: []
                pos: 9768
                length: 18
              - type: local_variable_declaration
                fields:
                  text: int incount = 1, count = 1;
                children: []
                pos: 9795
                length: 27
              - type: expression_statement
                fields:
                  text: out[0] = str.charAt(0);
                children: []
                pos: 9831
                length: 23
              - type: expression_statement
                fields:
                  text: last = getMappingCode(str, 0);
                children: []
                pos: 9923
                length: 30
              - type: while_statement
                fields:
                  text: |-
                    while (incount < str.length() && count < out.length) {
                                mapped = getMappingCode(str, incount++);
                                if (mapped != 0) {
                                    if (mapped != '0' && mapped != last) {
                                        out[count++] = mapped;
                                    }
                                    last = mapped;
                                }
                            }
                children: []
                pos: 9962
                length: 309
              - type: return_statement
                fields:
                  text: return new String(out);
                children: []
                pos: 10280
                length: 23
              pos: 9541
              length: 768
          children: []
          pos: 9507
          length: 802
        pos: 1277
        length: 9035
    children: []
    pos: 1277
    length: 9035
  pos: 0
  length: 10313
text_diff: |
  --- before
  +++ after
  @@ -185,14 +185,13 @@
           final char mappedChar = this.map(str.charAt(index));
           // HW rule check
           if (index > 1 && mappedChar != '0') {
  -            for (int i=index-1 ; i>=0 ; i--) {
  -                final char prevChar = str.charAt(i);
  -                if (this.map(prevChar)==mappedChar) {
  +            final char hwChar = str.charAt(index - 1);
  +            if ('H' == hwChar || 'W' == hwChar) {
  +                final char preHWChar = str.charAt(index - 2);
  +                final char firstCode = this.map(preHWChar);
  +                if (firstCode == mappedChar || 'H' == preHWChar || 'W' == preHWChar) {
                       return 0;
                   }
  -                if ('H'!=prevChar && 'W'!=prevChar) {
  -                    break;
  -                }
               }
           }
           return mappedChar;
tree_diff: |+
  New cluster:
  ===
  insert-node
  ---
  local_variable_declaration: final char hwChar = str.charAt(index - 1); [7391,7433]
  to
  block [7377,7703]
  at 0
  ------------
  ===
  insert-node
  ---
  local_variable_declaration: final char hwChar = str.charAt(index - 1); [7391,7433]
  to
  block [7377,7703]
  at 0

  New cluster:
  Unknown cluster type
  ------------
  ===
  insert-tree
  ---
  if_statement [7446,7754]
      parenthesized_expression [7449,7481]
          or [7450,7480]
              equals [7450,7463]
                  character_literal: 'H' [7450,7453]
                  identifier: hwChar [7457,7463]
              equals [7467,7480]
                  character_literal: 'W' [7467,7470]
                  identifier: hwChar [7474,7480]
      block [7482,7754]
          local_variable_declaration: final char preHWChar = str.charAt(index - 2); [7500,7545]
          local_variable_declaration: final char firstCode = this.map(preHWChar); [7562,7605]
          if_statement [7622,7740]
              parenthesized_expression [7625,7690]
                  or [7626,7689]
                      or [7626,7669]
                          equals [7626,7649]
                              identifier: firstCode [7626,7635]
                              identifier: mappedChar [7639,7649]
                          equals [7653,7669]
                              character_literal: 'H' [7653,7656]
                              identifier: preHWChar [7660,7669]
                      equals [7673,7689]
                          character_literal: 'W' [7673,7676]
                          identifier: preHWChar [7680,7689]
              block [7691,7740]
                  return_statement: return 0; [7713,7722]
  to
  block [7377,7703]
  at 1

  New cluster:
  ===
  delete-node
  ---
  for_statement: for (int i=index-1 ; i>=0 ; i--) {
                  final char prevChar = str.charAt(i);
                  if (this.map(prevChar)==mappedChar) {
                      return 0;
                  }
                  if ('H'!=prevChar && 'W'!=prevChar) {
                      break;
                  }
              } [7391,7693]
  ===
  ------------
  ===
  delete-node
  ---
  for_statement: for (int i=index-1 ; i>=0 ; i--) {
                  final char prevChar = str.charAt(i);
                  if (this.map(prevChar)==mappedChar) {
                      return 0;
                  }
                  if ('H'!=prevChar && 'W'!=prevChar) {
                      break;
                  }
              } [7391,7693]
  ===

...
