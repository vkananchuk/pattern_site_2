---
language: java
before_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: PosixParser
        children: []
        pos: 1182
        length: 11
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: private List tokens = new ArrayList();
          children: []
          pos: 1255
          length: 38
        - type: field_declaration
          fields:
            text: private boolean eatTheRest;
          children: []
          pos: 1348
          length: 27
        - type: field_declaration
          fields:
            text: private Option currentOption;
          children: []
          pos: 1422
          length: 29
        - type: field_declaration
          fields:
            text: private Options options;
          children: []
          pos: 1493
          length: 24
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: init
              children: []
              pos: 1745
              length: 4
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 1732
              length: 113
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: eatTheRest = false;
                children: []
                pos: 1766
                length: 19
              - type: expression_statement
                fields:
                  text: tokens.clear();
                children: []
                pos: 1794
                length: 15
              - type: expression_statement
                fields:
                  text: currentOption = null;
                children: []
                pos: 1818
                length: 21
              pos: 1756
              length: 89
          children: []
          pos: 1732
          length: 113
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: flatten
              children: []
              pos: 3997
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Options options
                children: []
                pos: 4005
                length: 15
              pos: 3978
              length: 1952
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: init();
                children: []
                pos: 4081
                length: 7
              - type: expression_statement
                fields:
                  text: this.options = options;
                children: []
                pos: 4097
                length: 23
              - type: local_variable_declaration
                fields:
                  text: Iterator iter = Arrays.asList(arguments).iterator();
                children: []
                pos: 4181
                length: 52
              - type: while_statement
                fields:
                  text: |-
                    while (iter.hasNext())
                            {
                                // get the next command line token
                                String token = (String) iter.next();

                                // handle long option --foo or --foo=bar
                                if (token.startsWith("--"))
                                {
                                    int pos = token.indexOf('=');
                                    String opt = pos == -1 ? token : token.substring(0, pos); // --foo

                                    if (!options.hasOption(opt) && stopAtNonOption)
                                    {
                                        process(token);
                                    }
                                    else
                                    {
                                        tokens.add(opt);
                                        if (pos != -1) {
                                            tokens.add(token.substring(pos + 1));
                                        }
                                    }
                                }

                                // single hyphen
                                else if ("-".equals(token))
                                {
                                    tokens.add(token);
                                }
                                else if (token.startsWith("-"))
                                {
                                    if (token.length() == 2)
                                    {
                                        processOptionToken(token, stopAtNonOption);
                                    }
                                    else if (options.hasOption(token))
                                    {
                                        tokens.add(token);
                                    }
                                    // requires bursting
                                    else
                                    {
                                        burstToken(token, stopAtNonOption);
                                    }
                                }
                                else if (stopAtNonOption)
                                {
                                    process(token);
                                }
                                else
                                {
                                    tokens.add(token);
                                }

                                gobble(iter);
                            }
                children: []
                pos: 4286
                length: 1568
              - type: return_statement
                fields:
                  text: return (String[]) tokens.toArray(new String[tokens.size()]);
                children: []
                pos: 5864
                length: 60
              pos: 4071
              length: 1859
          children: []
          pos: 3978
          length: 1952
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: gobble
              children: []
              pos: 6092
              length: 6
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Iterator iter
                children: []
                pos: 6099
                length: 13
              pos: 6079
              length: 194
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: identifier
                        fields:
                          text: eatTheRest
                        children: []
                        pos: 6132
                        length: 10
                    children: []
                    pos: 6131
                    length: 12
                children:
                - type: block
                  fields: {}
                  children:
                  - type: while_statement
                    fields:
                      text: |-
                        while (iter.hasNext())
                                    {
                                        tokens.add(iter.next());
                                    }
                    children: []
                    pos: 6166
                    length: 91
                  pos: 6152
                  length: 115
                pos: 6128
                length: 139
              pos: 6118
              length: 155
          children: []
          pos: 6079
          length: 194
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: process
              children: []
              pos: 6927
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String value
                children: []
                pos: 6935
                length: 12
              pos: 6914
              length: 502
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: and
                        fields:
                          left:
                            type: not_equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: currentOption
                                children: []
                                pos: 6967
                                length: 13
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 6984
                                length: 4
                            children: []
                            pos: 6967
                            length: 21
                          right:
                            type: method_invocation
                            fields:
                              text: currentOption.hasArg()
                            children: []
                            pos: 6992
                            length: 22
                        children: []
                        pos: 6967
                        length: 47
                    children: []
                    pos: 6966
                    length: 49
                children:
                - type: block
                  fields: {}
                  children:
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: method_invocation
                            fields:
                              text: currentOption.hasArg()
                            children: []
                            pos: 7042
                            length: 22
                        children: []
                        pos: 7041
                        length: 24
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: expression_statement
                        fields:
                          text: tokens.add(value);
                        children: []
                        pos: 7096
                        length: 18
                      - type: expression_statement
                        fields:
                          text: currentOption = null;
                        children: []
                        pos: 7131
                        length: 21
                      pos: 7078
                      length: 88
                    pos: 7038
                    length: 237
                  pos: 7024
                  length: 261
                pos: 6963
                length: 447
              pos: 6953
              length: 463
          children: []
          pos: 6914
          length: 502
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: processOptionToken
              children: []
              pos: 7964
              length: 18
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String token
                children: []
                pos: 7983
                length: 12
              pos: 7951
              length: 307
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: options.hasOption(token)
                        children: []
                        pos: 8040
                        length: 24
                    children: []
                    pos: 8039
                    length: 26
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: currentOption = options.getOption(token);
                    children: []
                    pos: 8088
                    length: 41
                  pos: 8074
                  length: 65
                pos: 8036
                length: 188
              - type: expression_statement
                fields:
                  text: tokens.add(token);
                children: []
                pos: 8234
                length: 18
              pos: 8026
              length: 232
          children: []
          pos: 7951
          length: 307
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: burstToken
              children: []
              pos: 9586
              length: 10
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String token
                children: []
                pos: 9597
                length: 12
              pos: 9571
              length: 796
            body:
              type: block
              fields: {}
              children:
              - type: for_statement
                fields:
                  text: |-
                    for (int i = 1; i < token.length(); i++)
                            {
                                String ch = String.valueOf(token.charAt(i));

                                if (options.hasOption(ch))
                                {
                                    tokens.add("-" + ch);
                                    currentOption = options.getOption(ch);

                                    if (currentOption.hasArg() && (token.length() != (i + 1)))
                                    {
                                        tokens.add(token.substring(i + 1));

                                        break;
                                    }
                                }
                                else if (stopAtNonOption)
                                {
                                    process(token.substring(i));
                                    break;
                                }
                                else
                                {
                                    tokens.add(token);
                                    break;
                                }
                            }
                children: []
                pos: 9650
                length: 711
              pos: 9640
              length: 727
          children: []
          pos: 9571
          length: 796
        pos: 1169
        length: 9200
    children: []
    pos: 1169
    length: 9200
  pos: 0
  length: 10370
after_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: PosixParser
        children: []
        pos: 1182
        length: 11
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: private List tokens = new ArrayList();
          children: []
          pos: 1255
          length: 38
        - type: field_declaration
          fields:
            text: private boolean eatTheRest;
          children: []
          pos: 1348
          length: 27
        - type: field_declaration
          fields:
            text: private Option currentOption;
          children: []
          pos: 1422
          length: 29
        - type: field_declaration
          fields:
            text: private Options options;
          children: []
          pos: 1493
          length: 24
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: init
              children: []
              pos: 1745
              length: 4
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 1732
              length: 113
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: eatTheRest = false;
                children: []
                pos: 1766
                length: 19
              - type: expression_statement
                fields:
                  text: tokens.clear();
                children: []
                pos: 1794
                length: 15
              - type: expression_statement
                fields:
                  text: currentOption = null;
                children: []
                pos: 1818
                length: 21
              pos: 1756
              length: 89
          children: []
          pos: 1732
          length: 113
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: flatten
              children: []
              pos: 3997
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Options options
                children: []
                pos: 4005
                length: 15
              pos: 3978
              length: 1810
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: init();
                children: []
                pos: 4081
                length: 7
              - type: expression_statement
                fields:
                  text: this.options = options;
                children: []
                pos: 4097
                length: 23
              - type: local_variable_declaration
                fields:
                  text: Iterator iter = Arrays.asList(arguments).iterator();
                children: []
                pos: 4181
                length: 52
              - type: while_statement
                fields:
                  text: |-
                    while (iter.hasNext())
                            {
                                // get the next command line token
                                String token = (String) iter.next();

                                // handle long option --foo or --foo=bar
                                if (token.startsWith("--"))
                                {
                                    if (token.indexOf('=') != -1)
                                    {
                                        tokens.add(token.substring(0, token.indexOf('=')));
                                        tokens.add(token.substring(token.indexOf('=') + 1, token.length()));
                                    }
                                    else
                                    {
                                        tokens.add(token);
                                    }
                                }

                                // single hyphen
                                else if ("-".equals(token))
                                {
                                    tokens.add(token);
                                }
                                else if (token.startsWith("-"))
                                {
                                    if (token.length() == 2)
                                    {
                                        processOptionToken(token, stopAtNonOption);
                                    }
                                    else if (options.hasOption(token))
                                    {
                                        tokens.add(token);
                                    }
                                    // requires bursting
                                    else
                                    {
                                        burstToken(token, stopAtNonOption);
                                    }
                                }
                                else if (stopAtNonOption)
                                {
                                    process(token);
                                }
                                else
                                {
                                    tokens.add(token);
                                }

                                gobble(iter);
                            }
                children: []
                pos: 4286
                length: 1426
              - type: return_statement
                fields:
                  text: return (String[]) tokens.toArray(new String[tokens.size()]);
                children: []
                pos: 5722
                length: 60
              pos: 4071
              length: 1717
          children: []
          pos: 3978
          length: 1810
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: gobble
              children: []
              pos: 5950
              length: 6
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Iterator iter
                children: []
                pos: 5957
                length: 13
              pos: 5937
              length: 194
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: identifier
                        fields:
                          text: eatTheRest
                        children: []
                        pos: 5990
                        length: 10
                    children: []
                    pos: 5989
                    length: 12
                children:
                - type: block
                  fields: {}
                  children:
                  - type: while_statement
                    fields:
                      text: |-
                        while (iter.hasNext())
                                    {
                                        tokens.add(iter.next());
                                    }
                    children: []
                    pos: 6024
                    length: 91
                  pos: 6010
                  length: 115
                pos: 5986
                length: 139
              pos: 5976
              length: 155
          children: []
          pos: 5937
          length: 194
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: process
              children: []
              pos: 6785
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String value
                children: []
                pos: 6793
                length: 12
              pos: 6772
              length: 502
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: and
                        fields:
                          left:
                            type: not_equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: currentOption
                                children: []
                                pos: 6825
                                length: 13
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 6842
                                length: 4
                            children: []
                            pos: 6825
                            length: 21
                          right:
                            type: method_invocation
                            fields:
                              text: currentOption.hasArg()
                            children: []
                            pos: 6850
                            length: 22
                        children: []
                        pos: 6825
                        length: 47
                    children: []
                    pos: 6824
                    length: 49
                children:
                - type: block
                  fields: {}
                  children:
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: method_invocation
                            fields:
                              text: currentOption.hasArg()
                            children: []
                            pos: 6900
                            length: 22
                        children: []
                        pos: 6899
                        length: 24
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: expression_statement
                        fields:
                          text: tokens.add(value);
                        children: []
                        pos: 6954
                        length: 18
                      - type: expression_statement
                        fields:
                          text: currentOption = null;
                        children: []
                        pos: 6989
                        length: 21
                      pos: 6936
                      length: 88
                    pos: 6896
                    length: 237
                  pos: 6882
                  length: 261
                pos: 6821
                length: 447
              pos: 6811
              length: 463
          children: []
          pos: 6772
          length: 502
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: processOptionToken
              children: []
              pos: 7822
              length: 18
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String token
                children: []
                pos: 7841
                length: 12
              pos: 7809
              length: 307
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: options.hasOption(token)
                        children: []
                        pos: 7898
                        length: 24
                    children: []
                    pos: 7897
                    length: 26
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: currentOption = options.getOption(token);
                    children: []
                    pos: 7946
                    length: 41
                  pos: 7932
                  length: 65
                pos: 7894
                length: 188
              - type: expression_statement
                fields:
                  text: tokens.add(token);
                children: []
                pos: 8092
                length: 18
              pos: 7884
              length: 232
          children: []
          pos: 7809
          length: 307
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: burstToken
              children: []
              pos: 9444
              length: 10
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String token
                children: []
                pos: 9455
                length: 12
              pos: 9429
              length: 796
            body:
              type: block
              fields: {}
              children:
              - type: for_statement
                fields:
                  text: |-
                    for (int i = 1; i < token.length(); i++)
                            {
                                String ch = String.valueOf(token.charAt(i));

                                if (options.hasOption(ch))
                                {
                                    tokens.add("-" + ch);
                                    currentOption = options.getOption(ch);

                                    if (currentOption.hasArg() && (token.length() != (i + 1)))
                                    {
                                        tokens.add(token.substring(i + 1));

                                        break;
                                    }
                                }
                                else if (stopAtNonOption)
                                {
                                    process(token.substring(i));
                                    break;
                                }
                                else
                                {
                                    tokens.add(token);
                                    break;
                                }
                            }
                children: []
                pos: 9508
                length: 711
              pos: 9498
              length: 727
          children: []
          pos: 9429
          length: 796
        pos: 1169
        length: 9058
    children: []
    pos: 1169
    length: 9058
  pos: 0
  length: 10228
text_diff: "--- before\n+++ after\n@@ -111,19 +111,14 @@\n             // handle long
  option --foo or --foo=bar\n             if (token.startsWith(\"--\"))\n             {\n-
  \               int pos = token.indexOf('=');\n-                String opt = pos
  == -1 ? token : token.substring(0, pos); // --foo\n-\n-                if (!options.hasOption(opt)
  && stopAtNonOption)\n+                if (token.indexOf('=') != -1)\n                 {\n-
  \                   process(token);\n+                    tokens.add(token.substring(0,
  token.indexOf('=')));\n+                    tokens.add(token.substring(token.indexOf('=')
  + 1, token.length()));\n                 }\n                 else\n                 {\n-
  \                   tokens.add(opt);\n-                    if (pos != -1) {\n-                        tokens.add(token.substring(pos
  + 1));\n-                    }\n+                    tokens.add(token);\n                 }\n
  \            }\n \n"
tree_diff: |+
  New cluster:
  UPDATE from while (iter.hasNext())
          {
              // get the next command line token
              String token = (String) iter.next();

              // handle long option --foo or --foo=bar
              if (token.startsWith("--"))
              {
                  int pos = token.indexOf('=');
                  String opt = pos == -1 ? token : token.substring(0, pos); // --foo

                  if (!options.hasOption(opt) && stopAtNonOption)
                  {
                      process(token);
                  }
                  else
                  {
                      tokens.add(opt);
                      if (pos != -1) {
                          tokens.add(token.substring(pos + 1));
                      }
                  }
              }

              // single hyphen
              else if ("-".equals(token))
              {
                  tokens.add(token);
              }
              else if (token.startsWith("-"))
              {
                  if (token.length() == 2)
                  {
                      processOptionToken(token, stopAtNonOption);
                  }
                  else if (options.hasOption(token))
                  {
                      tokens.add(token);
                  }
                  // requires bursting
                  else
                  {
                      burstToken(token, stopAtNonOption);
                  }
              }
              else if (stopAtNonOption)
              {
                  process(token);
              }
              else
              {
                  tokens.add(token);
              }

              gobble(iter);
          } to while (iter.hasNext())
          {
              // get the next command line token
              String token = (String) iter.next();

              // handle long option --foo or --foo=bar
              if (token.startsWith("--"))
              {
                  if (token.indexOf('=') != -1)
                  {
                      tokens.add(token.substring(0, token.indexOf('=')));
                      tokens.add(token.substring(token.indexOf('=') + 1, token.length()));
                  }
                  else
                  {
                      tokens.add(token);
                  }
              }

              // single hyphen
              else if ("-".equals(token))
              {
                  tokens.add(token);
              }
              else if (token.startsWith("-"))
              {
                  if (token.length() == 2)
                  {
                      processOptionToken(token, stopAtNonOption);
                  }
                  else if (options.hasOption(token))
                  {
                      tokens.add(token);
                  }
                  // requires bursting
                  else
                  {
                      burstToken(token, stopAtNonOption);
                  }
              }
              else if (stopAtNonOption)
              {
                  process(token);
              }
              else
              {
                  tokens.add(token);
              }

              gobble(iter);
          }
  ------------
  ===
  update-node
  ---
  while_statement: while (iter.hasNext())
          {
              // get the next command line token
              String token = (String) iter.next();

              // handle long option --foo or --foo=bar
              if (token.startsWith("--"))
              {
                  int pos = token.indexOf('=');
                  String opt = pos == -1 ? token : token.substring(0, pos); // --foo

                  if (!options.hasOption(opt) && stopAtNonOption)
                  {
                      process(token);
                  }
                  else
                  {
                      tokens.add(opt);
                      if (pos != -1) {
                          tokens.add(token.substring(pos + 1));
                      }
                  }
              }

              // single hyphen
              else if ("-".equals(token))
              {
                  tokens.add(token);
              }
              else if (token.startsWith("-"))
              {
                  if (token.length() == 2)
                  {
                      processOptionToken(token, stopAtNonOption);
                  }
                  else if (options.hasOption(token))
                  {
                      tokens.add(token);
                  }
                  // requires bursting
                  else
                  {
                      burstToken(token, stopAtNonOption);
                  }
              }
              else if (stopAtNonOption)
              {
                  process(token);
              }
              else
              {
                  tokens.add(token);
              }

              gobble(iter);
          } [4286,5854]
  replace while (iter.hasNext())
          {
              // get the next command line token
              String token = (String) iter.next();

              // handle long option --foo or --foo=bar
              if (token.startsWith("--"))
              {
                  int pos = token.indexOf('=');
                  String opt = pos == -1 ? token : token.substring(0, pos); // --foo

                  if (!options.hasOption(opt) && stopAtNonOption)
                  {
                      process(token);
                  }
                  else
                  {
                      tokens.add(opt);
                      if (pos != -1) {
                          tokens.add(token.substring(pos + 1));
                      }
                  }
              }

              // single hyphen
              else if ("-".equals(token))
              {
                  tokens.add(token);
              }
              else if (token.startsWith("-"))
              {
                  if (token.length() == 2)
                  {
                      processOptionToken(token, stopAtNonOption);
                  }
                  else if (options.hasOption(token))
                  {
                      tokens.add(token);
                  }
                  // requires bursting
                  else
                  {
                      burstToken(token, stopAtNonOption);
                  }
              }
              else if (stopAtNonOption)
              {
                  process(token);
              }
              else
              {
                  tokens.add(token);
              }

              gobble(iter);
          } by while (iter.hasNext())
          {
              // get the next command line token
              String token = (String) iter.next();

              // handle long option --foo or --foo=bar
              if (token.startsWith("--"))
              {
                  if (token.indexOf('=') != -1)
                  {
                      tokens.add(token.substring(0, token.indexOf('=')));
                      tokens.add(token.substring(token.indexOf('=') + 1, token.length()));
                  }
                  else
                  {
                      tokens.add(token);
                  }
              }

              // single hyphen
              else if ("-".equals(token))
              {
                  tokens.add(token);
              }
              else if (token.startsWith("-"))
              {
                  if (token.length() == 2)
                  {
                      processOptionToken(token, stopAtNonOption);
                  }
                  else if (options.hasOption(token))
                  {
                      tokens.add(token);
                  }
                  // requires bursting
                  else
                  {
                      burstToken(token, stopAtNonOption);
                  }
              }
              else if (stopAtNonOption)
              {
                  process(token);
              }
              else
              {
                  tokens.add(token);
              }

              gobble(iter);
          }

...
