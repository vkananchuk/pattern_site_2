---
language: java
before_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: ReturnsDeepStubs
        children: []
        pos: 1600
        length: 16
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: private static final long serialVersionUID = -7105341425736035847L;
          children: []
          pos: 1666
          length: 67
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: answer
              children: []
              pos: 1755
              length: 6
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: InvocationOnMock invocation
                children: []
                pos: 1762
                length: 27
              pos: 1741
              length: 504
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: "GenericMetadataSupport returnTypeGenericMetadata =\r\n                actualParameterizedType(invocation.getMock()).resolveGenericReturnType(invocation.getMethod());"
                children: []
                pos: 1819
                length: 163
              - type: local_variable_declaration
                fields:
                  text: Class<?> rawType = returnTypeGenericMetadata.rawType();
                children: []
                pos: 1994
                length: 55
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: unary_expression
                        fields:
                          text: "!mockitoCore().isTypeMockable(rawType)"
                        children: []
                        pos: 2063
                        length: 38
                    children: []
                    pos: 2062
                    length: 40
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return delegate().returnValueFor(rawType);
                    children: []
                    pos: 2118
                    length: 42
                  pos: 2103
                  length: 68
                pos: 2059
                length: 112
              - type: return_statement
                fields:
                  text: return deepStub(invocation, returnTypeGenericMetadata);
                children: []
                pos: 2183
                length: 55
              pos: 1808
              length: 437
          children: []
          pos: 1741
          length: 504
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: deepStub
              children: []
              pos: 2268
              length: 8
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: InvocationOnMock invocation
                children: []
                pos: 2277
                length: 27
              pos: 2253
              length: 886
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: InternalMockHandler<Object> handler = new MockUtil().getMockHandler(invocation.getMock());
                children: []
                pos: 2384
                length: 90
              - type: local_variable_declaration
                fields:
                  text: InvocationContainerImpl container = (InvocationContainerImpl)
                    handler.getInvocationContainer();
                children: []
                pos: 2484
                length: 95
              - type: enhanced_for_statement
                fields:
                  text: "for (StubbedInvocationMatcher stubbedInvocationMatcher :
                    container.getStubbedInvocations()) {\r\n            if (container.getInvocationForStubbing().matches(stubbedInvocationMatcher.getInvocation()))
                    {\r\n                return stubbedInvocationMatcher.answer(invocation);\r\n
                    \           }\r\n        }"
                children: []
                pos: 2639
                length: 295
              - type: return_statement
                fields:
                  text: "return recordDeepStubAnswer(\r\n                newDeepStubMock(returnTypeGenericMetadata,
                    invocation.getMock()),\r\n                container\r\n        );"
                children: []
                pos: 2982
                length: 150
              pos: 2373
              length: 766
          children: []
          pos: 2253
          length: 886
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: newDeepStubMock
              children: []
              pos: 3759
              length: 15
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: GenericMetadataSupport returnTypeGenericMetadata
                children: []
                pos: 3775
                length: 48
              pos: 3744
              length: 387
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: MockCreationSettings parentMockSettings = new MockUtil().getMockSettings(parentMock);
                children: []
                pos: 3855
                length: 85
              - type: return_statement
                fields:
                  text: "return mockitoCore().mock(\r\n                returnTypeGenericMetadata.rawType(),\r\n
                    \               withSettingsUsing(returnTypeGenericMetadata, parentMockSettings)\r\n
                    \       );"
                children: []
                pos: 3950
                length: 174
              pos: 3844
              length: 287
          children: []
          pos: 3744
          length: 387
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: withSettingsUsing
              children: []
              pos: 4160
              length: 17
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: GenericMetadataSupport returnTypeGenericMetadata
                children: []
                pos: 4178
                length: 48
              pos: 4139
              length: 530
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: "MockSettings mockSettings = returnTypeGenericMetadata.hasRawExtraInterfaces()
                    ?\r\n                withSettings().extraInterfaces(returnTypeGenericMetadata.rawExtraInterfaces())\r\n
                    \               : withSettings();"
                children: []
                pos: 4280
                length: 210
              - type: return_statement
                fields:
                  text: "return propagateSerializationSettings(mockSettings, parentMockSettings)\r\n
                    \               .defaultAnswer(returnsDeepStubsAnswerUsing(returnTypeGenericMetadata));"
                children: []
                pos: 4502
                length: 160
              pos: 4269
              length: 400
          children: []
          pos: 4139
          length: 530
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: propagateSerializationSettings
              children: []
              pos: 4698
              length: 30
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: MockSettings mockSettings
                children: []
                pos: 4729
                length: 25
              pos: 4677
              length: 213
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return mockSettings.serializable(parentMockSettings.getSerializableMode());
                children: []
                pos: 4808
                length: 75
              pos: 4797
              length: 93
          children: []
          pos: 4677
          length: 213
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: returnsDeepStubsAnswerUsing
              children: []
              pos: 4923
              length: 27
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: final GenericMetadataSupport returnTypeGenericMetadata
                children: []
                pos: 4951
                length: 54
              pos: 4898
              length: 203
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return new ReturnsDeepStubsSerializationFallback(returnTypeGenericMetadata);
                children: []
                pos: 5018
                length: 76
              pos: 5007
              length: 94
          children: []
          pos: 4898
          length: 203
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: recordDeepStubAnswer
              children: []
              pos: 5124
              length: 20
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: final Object mock
                children: []
                pos: 5145
                length: 17
              pos: 5109
              length: 205
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: container.addAnswer(new DeeplyStubbedAnswer(mock), false);
                children: []
                pos: 5227
                length: 58
              - type: return_statement
                fields:
                  text: return mock;
                children: []
                pos: 5295
                length: 12
              pos: 5216
              length: 98
          children: []
          pos: 5109
          length: 205
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: actualParameterizedType
              children: []
              pos: 5355
              length: 23
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Object mock
                children: []
                pos: 5379
                length: 11
              pos: 5322
              length: 273
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: CreationSettings mockSettings = (CreationSettings) new MockUtil().getMockHandler(mock).getMockSettings();
                children: []
                pos: 5403
                length: 105
              - type: return_statement
                fields:
                  text: return GenericMetadataSupport.inferFrom(mockSettings.getTypeToMock());
                children: []
                pos: 5518
                length: 70
              pos: 5392
              length: 203
          children: []
          pos: 5322
          length: 273
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: ReturnsDeepStubsSerializationFallback
              children: []
              pos: 5626
              length: 37
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: "@SuppressWarnings(\"serial\") // not gonna be serialized\r\n
                    \       private final GenericMetadataSupport returnTypeGenericMetadata;"
                children: []
                pos: 5724
                length: 127
              - type: constructor_declaration
                fields:
                  text: "public ReturnsDeepStubsSerializationFallback(GenericMetadataSupport
                    returnTypeGenericMetadata) {\r\n            this.returnTypeGenericMetadata
                    = returnTypeGenericMetadata;\r\n        }"
                children: []
                pos: 5863
                length: 180
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: actualParameterizedType
                    children: []
                    pos: 6107
                    length: 23
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Object mock
                      children: []
                      pos: 6131
                      length: 11
                    pos: 6055
                    length: 148
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return returnTypeGenericMetadata;
                      children: []
                      pos: 6159
                      length: 33
                    pos: 6144
                    length: 59
                children: []
                pos: 6055
                length: 148
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: writeReplace
                    children: []
                    pos: 6228
                    length: 12
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 6213
                    length: 109
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return Mockito.RETURNS_DEEP_STUBS;
                      children: []
                      pos: 6277
                      length: 34
                    pos: 6262
                    length: 60
                children: []
                pos: 6213
                length: 109
              pos: 5605
              length: 724
          children: []
          pos: 5605
          length: 724
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: DeeplyStubbedAnswer
              children: []
              pos: 6360
              length: 19
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: "@SuppressWarnings(\"serial\") // serialization will fail
                    with a nice message if mock not serializable\r\n        private
                    final Object mock;"
                children: []
                pos: 6431
                length: 135
              - type: constructor_declaration
                fields:
                  text: "DeeplyStubbedAnswer(Object mock) {\r\n            this.mock
                    = mock;\r\n        }"
                children: []
                pos: 6578
                length: 76
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: answer
                    children: []
                    pos: 6678
                    length: 6
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: InvocationOnMock invocation
                      children: []
                      pos: 6685
                      length: 27
                    pos: 6664
                    length: 105
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return mock;
                      children: []
                      pos: 6746
                      length: 12
                    pos: 6731
                    length: 38
                children: []
                pos: 6664
                length: 105
              pos: 6339
              length: 437
          children: []
          pos: 6339
          length: 437
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: mockitoCore
              children: []
              pos: 6813
              length: 11
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 6786
              length: 90
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return LazyHolder.MOCKITO_CORE;
                children: []
                pos: 6838
                length: 31
              pos: 6827
              length: 49
          children: []
          pos: 6786
          length: 90
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: delegate
              children: []
              pos: 6918
              length: 8
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 6884
              length: 90
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return LazyHolder.DELEGATE;
                children: []
                pos: 6940
                length: 27
              pos: 6929
              length: 45
          children: []
          pos: 6884
          length: 90
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: LazyHolder
              children: []
              pos: 7003
              length: 10
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: private static final MockitoCore MOCKITO_CORE = new MockitoCore();
                children: []
                pos: 7025
                length: 66
              - type: field_declaration
                fields:
                  text: private static final ReturnsEmptyValues DELEGATE = new ReturnsEmptyValues();
                children: []
                pos: 7101
                length: 76
              pos: 6982
              length: 202
          children: []
          pos: 6982
          length: 202
        pos: 1587
        length: 5600
    children: []
    pos: 1587
    length: 5600
  pos: 0
  length: 7189
after_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: ReturnsDeepStubs
        children: []
        pos: 1553
        length: 16
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: private static final long serialVersionUID = -7105341425736035847L;
          children: []
          pos: 1619
          length: 67
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: answer
              children: []
              pos: 1708
              length: 6
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: InvocationOnMock invocation
                children: []
                pos: 1715
                length: 27
              pos: 1694
              length: 504
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: "GenericMetadataSupport returnTypeGenericMetadata =\r\n                actualParameterizedType(invocation.getMock()).resolveGenericReturnType(invocation.getMethod());"
                children: []
                pos: 1772
                length: 163
              - type: local_variable_declaration
                fields:
                  text: Class<?> rawType = returnTypeGenericMetadata.rawType();
                children: []
                pos: 1947
                length: 55
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: unary_expression
                        fields:
                          text: "!mockitoCore().isTypeMockable(rawType)"
                        children: []
                        pos: 2016
                        length: 38
                    children: []
                    pos: 2015
                    length: 40
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return delegate().returnValueFor(rawType);
                    children: []
                    pos: 2071
                    length: 42
                  pos: 2056
                  length: 68
                pos: 2012
                length: 112
              - type: return_statement
                fields:
                  text: return deepStub(invocation, returnTypeGenericMetadata);
                children: []
                pos: 2136
                length: 55
              pos: 1761
              length: 437
          children: []
          pos: 1694
          length: 504
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: deepStub
              children: []
              pos: 2221
              length: 8
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: InvocationOnMock invocation
                children: []
                pos: 2230
                length: 27
              pos: 2206
              length: 864
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: InternalMockHandler<Object> handler = new MockUtil().getMockHandler(invocation.getMock());
                children: []
                pos: 2337
                length: 90
              - type: local_variable_declaration
                fields:
                  text: InvocationContainerImpl container = (InvocationContainerImpl)
                    handler.getInvocationContainer();
                children: []
                pos: 2437
                length: 95
              - type: enhanced_for_statement
                fields:
                  text: "for (StubbedInvocationMatcher stubbedInvocationMatcher :
                    container.getStubbedInvocations()) {\r\n            if (container.getInvocationForStubbing().matches(stubbedInvocationMatcher.getInvocation()))
                    {\r\n                return stubbedInvocationMatcher.answer(invocation);\r\n
                    \           }\r\n        }"
                children: []
                pos: 2592
                length: 295
              - type: return_statement
                fields:
                  text: "return recordDeepStubAnswer(\r\n                newDeepStubMock(returnTypeGenericMetadata),\r\n
                    \               container\r\n        );"
                children: []
                pos: 2935
                length: 128
              pos: 2326
              length: 744
          children: []
          pos: 2206
          length: 864
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: newDeepStubMock
              children: []
              pos: 3690
              length: 15
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: GenericMetadataSupport returnTypeGenericMetadata
                children: []
                pos: 3706
                length: 48
              pos: 3675
              length: 253
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: "return mockitoCore().mock(\r\n                returnTypeGenericMetadata.rawType(),\r\n
                    \               withSettingsUsing(returnTypeGenericMetadata)\r\n
                    \       );"
                children: []
                pos: 3767
                length: 154
              pos: 3756
              length: 172
          children: []
          pos: 3675
          length: 253
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: withSettingsUsing
              children: []
              pos: 3957
              length: 17
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: GenericMetadataSupport returnTypeGenericMetadata
                children: []
                pos: 3975
                length: 48
              pos: 3936
              length: 452
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: "MockSettings mockSettings = returnTypeGenericMetadata.hasRawExtraInterfaces()
                    ?\r\n                withSettings().extraInterfaces(returnTypeGenericMetadata.rawExtraInterfaces())\r\n
                    \               : withSettings();"
                children: []
                pos: 4036
                length: 210
              - type: return_statement
                fields:
                  text: "return mockSettings.serializable()\r\n                .defaultAnswer(returnsDeepStubsAnswerUsing(returnTypeGenericMetadata));"
                children: []
                pos: 4258
                length: 123
              pos: 4025
              length: 363
          children: []
          pos: 3936
          length: 452
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: returnsDeepStubsAnswerUsing
              children: []
              pos: 4423
              length: 27
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: final GenericMetadataSupport returnTypeGenericMetadata
                children: []
                pos: 4451
                length: 54
              pos: 4398
              length: 203
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return new ReturnsDeepStubsSerializationFallback(returnTypeGenericMetadata);
                children: []
                pos: 4518
                length: 76
              pos: 4507
              length: 94
          children: []
          pos: 4398
          length: 203
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: recordDeepStubAnswer
              children: []
              pos: 4624
              length: 20
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: final Object mock
                children: []
                pos: 4645
                length: 17
              pos: 4609
              length: 205
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: container.addAnswer(new DeeplyStubbedAnswer(mock), false);
                children: []
                pos: 4727
                length: 58
              - type: return_statement
                fields:
                  text: return mock;
                children: []
                pos: 4795
                length: 12
              pos: 4716
              length: 98
          children: []
          pos: 4609
          length: 205
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: actualParameterizedType
              children: []
              pos: 4855
              length: 23
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Object mock
                children: []
                pos: 4879
                length: 11
              pos: 4822
              length: 273
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: CreationSettings mockSettings = (CreationSettings) new MockUtil().getMockHandler(mock).getMockSettings();
                children: []
                pos: 4903
                length: 105
              - type: return_statement
                fields:
                  text: return GenericMetadataSupport.inferFrom(mockSettings.getTypeToMock());
                children: []
                pos: 5018
                length: 70
              pos: 4892
              length: 203
          children: []
          pos: 4822
          length: 273
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: ReturnsDeepStubsSerializationFallback
              children: []
              pos: 5126
              length: 37
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: "@SuppressWarnings(\"serial\") // not gonna be serialized\r\n
                    \       private final GenericMetadataSupport returnTypeGenericMetadata;"
                children: []
                pos: 5224
                length: 127
              - type: constructor_declaration
                fields:
                  text: "public ReturnsDeepStubsSerializationFallback(GenericMetadataSupport
                    returnTypeGenericMetadata) {\r\n            this.returnTypeGenericMetadata
                    = returnTypeGenericMetadata;\r\n        }"
                children: []
                pos: 5363
                length: 180
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: actualParameterizedType
                    children: []
                    pos: 5607
                    length: 23
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Object mock
                      children: []
                      pos: 5631
                      length: 11
                    pos: 5555
                    length: 148
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return returnTypeGenericMetadata;
                      children: []
                      pos: 5659
                      length: 33
                    pos: 5644
                    length: 59
                children: []
                pos: 5555
                length: 148
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: writeReplace
                    children: []
                    pos: 5728
                    length: 12
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 5713
                    length: 109
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return Mockito.RETURNS_DEEP_STUBS;
                      children: []
                      pos: 5777
                      length: 34
                    pos: 5762
                    length: 60
                children: []
                pos: 5713
                length: 109
              pos: 5105
              length: 724
          children: []
          pos: 5105
          length: 724
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: DeeplyStubbedAnswer
              children: []
              pos: 5860
              length: 19
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: "@SuppressWarnings(\"serial\") // serialization will fail
                    with a nice message if mock not serializable\r\n        private
                    final Object mock;"
                children: []
                pos: 5931
                length: 135
              - type: constructor_declaration
                fields:
                  text: "DeeplyStubbedAnswer(Object mock) {\r\n            this.mock
                    = mock;\r\n        }"
                children: []
                pos: 6078
                length: 76
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: answer
                    children: []
                    pos: 6178
                    length: 6
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: InvocationOnMock invocation
                      children: []
                      pos: 6185
                      length: 27
                    pos: 6164
                    length: 105
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return mock;
                      children: []
                      pos: 6246
                      length: 12
                    pos: 6231
                    length: 38
                children: []
                pos: 6164
                length: 105
              pos: 5839
              length: 437
          children: []
          pos: 5839
          length: 437
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: mockitoCore
              children: []
              pos: 6313
              length: 11
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 6286
              length: 90
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return LazyHolder.MOCKITO_CORE;
                children: []
                pos: 6338
                length: 31
              pos: 6327
              length: 49
          children: []
          pos: 6286
          length: 90
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: delegate
              children: []
              pos: 6418
              length: 8
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 6384
              length: 90
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return LazyHolder.DELEGATE;
                children: []
                pos: 6440
                length: 27
              pos: 6429
              length: 45
          children: []
          pos: 6384
          length: 90
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: LazyHolder
              children: []
              pos: 6503
              length: 10
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: private static final MockitoCore MOCKITO_CORE = new MockitoCore();
                children: []
                pos: 6525
                length: 66
              - type: field_declaration
                fields:
                  text: private static final ReturnsEmptyValues DELEGATE = new ReturnsEmptyValues();
                children: []
                pos: 6601
                length: 76
              pos: 6482
              length: 202
          children: []
          pos: 6482
          length: 202
        pos: 1540
        length: 5147
    children: []
    pos: 1540
    length: 5147
  pos: 0
  length: 6689
text_diff: "--- before\n+++ after\n@@ -14,7 +14,6 @@\n import org.mockito.internal.util.MockUtil;\r\n
  import org.mockito.internal.util.reflection.GenericMetadataSupport;\r\n import org.mockito.invocation.InvocationOnMock;\r\n-import
  org.mockito.mock.MockCreationSettings;\r\n import org.mockito.stubbing.Answer;\r\n
  \r\n import java.io.IOException;\r\n@@ -69,7 +68,7 @@\n \r\n         // record deep
  stub answer\r\n         return recordDeepStubAnswer(\r\n-                newDeepStubMock(returnTypeGenericMetadata,
  invocation.getMock()),\r\n+                newDeepStubMock(returnTypeGenericMetadata),\r\n
  \                container\r\n         );\r\n     }\r\n@@ -85,26 +84,22 @@\n      *
  @param parentMock The parent of the current deep stub mock.\r\n      * @return The
  mock\r\n      */\r\n-    private Object newDeepStubMock(GenericMetadataSupport returnTypeGenericMetadata,
  Object parentMock) {\r\n-        MockCreationSettings parentMockSettings = new MockUtil().getMockSettings(parentMock);\r\n+
  \   private Object newDeepStubMock(GenericMetadataSupport returnTypeGenericMetadata)
  {\r\n         return mockitoCore().mock(\r\n                 returnTypeGenericMetadata.rawType(),\r\n-
  \               withSettingsUsing(returnTypeGenericMetadata, parentMockSettings)\r\n+
  \               withSettingsUsing(returnTypeGenericMetadata)\r\n         );\r\n
  \    }\r\n \r\n-    private MockSettings withSettingsUsing(GenericMetadataSupport
  returnTypeGenericMetadata, MockCreationSettings parentMockSettings) {\r\n+    private
  MockSettings withSettingsUsing(GenericMetadataSupport returnTypeGenericMetadata)
  {\r\n         MockSettings mockSettings = returnTypeGenericMetadata.hasRawExtraInterfaces()
  ?\r\n                 withSettings().extraInterfaces(returnTypeGenericMetadata.rawExtraInterfaces())\r\n
  \                : withSettings();\r\n \r\n-        return propagateSerializationSettings(mockSettings,
  parentMockSettings)\r\n+        return mockSettings.serializable()\r\n                 .defaultAnswer(returnsDeepStubsAnswerUsing(returnTypeGenericMetadata));\r\n
  \    }\r\n \r\n-    private MockSettings propagateSerializationSettings(MockSettings
  mockSettings, MockCreationSettings parentMockSettings) {\r\n-        return mockSettings.serializable(parentMockSettings.getSerializableMode());\r\n-
  \   }\r\n \r\n     private ReturnsDeepStubs returnsDeepStubsAnswerUsing(final GenericMetadataSupport
  returnTypeGenericMetadata) {\r\n         return new ReturnsDeepStubsSerializationFallback(returnTypeGenericMetadata);\r\n"
tree_diff: "New cluster:\n===\ninsert-node\n---\nmethod_declaration [2206,3070]\nto\nclass_body
  [1587,7187]\nat 2\n------------\n===\ninsert-node\n---\nidentifier: deepStub [2221,2229]\nto\nmethod_declaration
  [2206,3070]\nat 0\n===\ninsert-node\n---\nmethod_declaration [2206,3070]\nto\nclass_body
  [1587,7187]\nat 2\n\nNew cluster:\nMOVE from method_declaration [2206,3070]\n------------\n===\nmove-tree\n---\nmethod_parameters
  [2253,3139]\n    formal_parameter: InvocationOnMock invocation [2277,2304]\nto\nmethod_declaration
  [2206,3070]\nat 1\n\nNew cluster:\nUnknown cluster type\n------------\n===\ninsert-tree\n---\nblock
  [2326,3070]\n    local_variable_declaration: InternalMockHandler<Object> handler
  = new MockUtil().getMockHandler(invocation.getMock()); [2337,2427]\n    local_variable_declaration:
  InvocationContainerImpl container = (InvocationContainerImpl) handler.getInvocationContainer();
  [2437,2532]\n    enhanced_for_statement: for (StubbedInvocationMatcher stubbedInvocationMatcher
  : container.getStubbedInvocations()) {\r\n            if (container.getInvocationForStubbing().matches(stubbedInvocationMatcher.getInvocation()))
  {\r\n                return stubbedInvocationMatcher.answer(invocation);\r\n            }\r\n
  \       } [2592,2887]\n    return_statement: return recordDeepStubAnswer(\r\n                newDeepStubMock(returnTypeGenericMetadata),\r\n
  \               container\r\n        ); [2935,3063]\nto\nmethod_declaration [2206,3070]\nat
  2\n\nNew cluster:\nUPDATE from return mockitoCore().mock(\r\n                returnTypeGenericMetadata.rawType(),\r\n
  \               withSettingsUsing(returnTypeGenericMetadata, parentMockSettings)\r\n
  \       ); to return mockitoCore().mock(\r\n                returnTypeGenericMetadata.rawType(),\r\n
  \               withSettingsUsing(returnTypeGenericMetadata)\r\n        );\n------------\n===\nupdate-node\n---\nreturn_statement:
  return mockitoCore().mock(\r\n                returnTypeGenericMetadata.rawType(),\r\n
  \               withSettingsUsing(returnTypeGenericMetadata, parentMockSettings)\r\n
  \       ); [3950,4124]\nreplace return mockitoCore().mock(\r\n                returnTypeGenericMetadata.rawType(),\r\n
  \               withSettingsUsing(returnTypeGenericMetadata, parentMockSettings)\r\n
  \       ); by return mockitoCore().mock(\r\n                returnTypeGenericMetadata.rawType(),\r\n
  \               withSettingsUsing(returnTypeGenericMetadata)\r\n        );\n\nNew
  cluster:\nUPDATE from return propagateSerializationSettings(mockSettings, parentMockSettings)\r\n
  \               .defaultAnswer(returnsDeepStubsAnswerUsing(returnTypeGenericMetadata));
  to return mockSettings.serializable()\r\n                .defaultAnswer(returnsDeepStubsAnswerUsing(returnTypeGenericMetadata));\n------------\n===\nupdate-node\n---\nreturn_statement:
  return propagateSerializationSettings(mockSettings, parentMockSettings)\r\n                .defaultAnswer(returnsDeepStubsAnswerUsing(returnTypeGenericMetadata));
  [4502,4662]\nreplace return propagateSerializationSettings(mockSettings, parentMockSettings)\r\n
  \               .defaultAnswer(returnsDeepStubsAnswerUsing(returnTypeGenericMetadata));
  by return mockSettings.serializable()\r\n                .defaultAnswer(returnsDeepStubsAnswerUsing(returnTypeGenericMetadata));\n\nNew
  cluster:\n===\ndelete-node\n---\nmethod_declaration [2253,3139]\n===\n------------\n===\ndelete-node\n---\nidentifier:
  deepStub [2268,2276]\n===\n===\ndelete-node\n---\nmethod_declaration [2253,3139]\n===\n\nNew
  cluster:\nUnknown cluster type\n------------\n===\ndelete-tree\n---\nblock [2373,3139]\n
  \   local_variable_declaration: InternalMockHandler<Object> handler = new MockUtil().getMockHandler(invocation.getMock());
  [2384,2474]\n    local_variable_declaration: InvocationContainerImpl container =
  (InvocationContainerImpl) handler.getInvocationContainer(); [2484,2579]\n    enhanced_for_statement:
  for (StubbedInvocationMatcher stubbedInvocationMatcher : container.getStubbedInvocations())
  {\r\n            if (container.getInvocationForStubbing().matches(stubbedInvocationMatcher.getInvocation()))
  {\r\n                return stubbedInvocationMatcher.answer(invocation);\r\n            }\r\n
  \       } [2639,2934]\n    return_statement: return recordDeepStubAnswer(\r\n                newDeepStubMock(returnTypeGenericMetadata,
  invocation.getMock()),\r\n                container\r\n        ); [2982,3132]\n\nNew
  cluster:\n===\ndelete-node\n---\nlocal_variable_declaration: MockCreationSettings
  parentMockSettings = new MockUtil().getMockSettings(parentMock); [3855,3940]\n===\n------------\n===\ndelete-node\n---\nlocal_variable_declaration:
  MockCreationSettings parentMockSettings = new MockUtil().getMockSettings(parentMock);
  [3855,3940]\n===\n\nNew cluster:\nUnknown cluster type\n------------\n===\ndelete-tree\n---\nmethod_declaration
  [4677,4890]\n    identifier: propagateSerializationSettings [4698,4728]\n    method_parameters
  [4677,4890]\n        formal_parameter: MockSettings mockSettings [4729,4754]\n    block
  [4797,4890]\n        return_statement: return mockSettings.serializable(parentMockSettings.getSerializableMode());
  [4808,4883]\n\n"
