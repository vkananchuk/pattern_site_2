---
language: java
before_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: ProcessClosurePrimitives
        children: []
        pos: 1213
        length: 24
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType NULL_ARGUMENT_ERROR = DiagnosticType.error(
                    "JSC_NULL_ARGUMENT_ERROR",
                    "method \"{0}\" called without an argument");
          children: []
          pos: 1305
          length: 156
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType INVALID_ARGUMENT_ERROR = DiagnosticType.error(
                    "JSC_INVALID_ARGUMENT_ERROR",
                    "method \"{0}\" called with a non-string argument");
          children: []
          pos: 1465
          length: 169
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType TOO_MANY_ARGUMENTS_ERROR = DiagnosticType.error(
                    "JSC_TOO_MANY_ARGUMENTS_ERROR",
                    "method \"{0}\" called with more than one argument");
          children: []
          pos: 1638
          length: 174
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType DUPLICATE_NAMESPACE_ERROR = DiagnosticType.error(
                    "JSC_DUPLICATE_NAMESPACE_ERROR",
                    "namespace \"{0}\" cannot be provided twice");
          children: []
          pos: 1816
          length: 169
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType FUNCTION_NAMESPACE_ERROR = DiagnosticType.error(
                    "JSC_FUNCTION_NAMESPACE_ERROR",
                    "\"{0}\" cannot be both provided and declared as a function");
          children: []
          pos: 1989
          length: 183
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType MISSING_PROVIDE_ERROR = DiagnosticType.error(
                    "JSC_MISSING_PROVIDE_ERROR",
                    "required \"{0}\" namespace never provided");
          children: []
          pos: 2176
          length: 160
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType LATE_PROVIDE_ERROR = DiagnosticType.error(
                    "JSC_LATE_PROVIDE_ERROR",
                    "required \"{0}\" namespace not provided yet");
          children: []
          pos: 2340
          length: 156
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType INVALID_PROVIDE_ERROR = DiagnosticType.error(
                    "JSC_INVALID_PROVIDE_ERROR",
                    "\"{0}\" is not a valid JS property name");
          children: []
          pos: 2500
          length: 158
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType XMODULE_REQUIRE_ERROR = DiagnosticType.warning(
                    "JSC_XMODULE_REQUIRE_ERROR",
                    "namespace \"{0}\" provided in module {1} " +
                    "but required in module {2}");
          children: []
          pos: 2662
          length: 199
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType NON_STRING_PASSED_TO_SET_CSS_NAME_MAPPING_ERROR =
                    DiagnosticType.error(
                        "JSC_NON_STRING_PASSED_TO_SET_CSS_NAME_MAPPING_ERROR",
                    "goog.setCssNameMapping only takes an object literal with string values");
          children: []
          pos: 2865
          length: 251
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType BASE_CLASS_ERROR = DiagnosticType.error(
                    "JSC_BASE_CLASS_ERROR",
                    "incorrect use of goog.base: {0}");
          children: []
          pos: 3120
          length: 140
        - type: field_declaration
          fields:
            text: static final String GOOG = "goog";
          children: []
          pos: 3300
          length: 34
        - type: field_declaration
          fields:
            text: private final AbstractCompiler compiler;
          children: []
          pos: 3338
          length: 40
        - type: field_declaration
          fields:
            text: private final JSModuleGraph moduleGraph;
          children: []
          pos: 3381
          length: 40
        - type: field_declaration
          fields:
            text: |-
              private final Map<String, ProvidedName> providedNames =
                    Maps.newTreeMap();
          children: []
          pos: 3492
          length: 80
        - type: field_declaration
          fields:
            text: |-
              private final List<UnrecognizedRequire> unrecognizedRequires =
                    Lists.newArrayList();
          children: []
          pos: 3576
          length: 90
        - type: field_declaration
          fields:
            text: private final Set<String> exportedVariables = Sets.newHashSet();
          children: []
          pos: 3669
          length: 64
        - type: field_declaration
          fields:
            text: private final CheckLevel requiresLevel;
          children: []
          pos: 3736
          length: 39
        - type: field_declaration
          fields:
            text: private final boolean rewriteNewDateGoogNow;
          children: []
          pos: 3778
          length: 44
        - type: constructor_declaration
          fields:
            text: |-
              ProcessClosurePrimitives(AbstractCompiler compiler,
                                         CheckLevel requiresLevel,
                                         boolean rewriteNewDateGoogNow) {
                  this.compiler = compiler;
                  this.moduleGraph = compiler.getModuleGraph();
                  this.requiresLevel = requiresLevel;
                  this.rewriteNewDateGoogNow = rewriteNewDateGoogNow;

                  // goog is special-cased because it is provided in Closure's base library.
                  providedNames.put(GOOG,
                      new ProvidedName(GOOG, null, null, false /* implicit */));
                }
          children: []
          pos: 3826
          length: 519
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getExportedVariableNames
              children: []
              pos: 4361
              length: 24
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 4349
              length: 74
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return exportedVariables;
                children: []
                pos: 4394
                length: 25
              pos: 4388
              length: 35
          children: []
          pos: 4349
          length: 74
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: process
              children: []
              pos: 4451
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Node externs
                children: []
                pos: 4459
                length: 12
              pos: 4427
              length: 768
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: new NodeTraversal(compiler, this).traverse(root);
                children: []
                pos: 4490
                length: 49
              - type: enhanced_for_statement
                fields:
                  text: |-
                    for (ProvidedName pn : providedNames.values()) {
                          pn.replace();
                        }
                children: []
                pos: 4545
                length: 74
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: requiresLevel.isOn()
                        children: []
                        pos: 4629
                        length: 20
                    children: []
                    pos: 4628
                    length: 22
                children:
                - type: block
                  fields: {}
                  children:
                  - type: enhanced_for_statement
                    fields:
                      text: |-
                        for (UnrecognizedRequire r : unrecognizedRequires) {
                                DiagnosticType error;
                                ProvidedName expectedName = providedNames.get(r.namespace);
                                if (expectedName != null && expectedName.firstNode != null) {
                                  // The namespace ended up getting provided after it was required.
                                  error = LATE_PROVIDE_ERROR;
                                } else {
                                  error = MISSING_PROVIDE_ERROR;
                                }

                                compiler.report(JSError.make(
                                    r.inputName, r.requireNode, requiresLevel, error, r.namespace));
                              }
                    children: []
                    pos: 4659
                    length: 526
                  pos: 4651
                  length: 540
                pos: 4625
                length: 566
              pos: 4484
              length: 711
          children: []
          pos: 4427
          length: 768
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: visit
              children: []
              pos: 5223
              length: 5
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 5229
                length: 15
              pos: 5199
              length: 3474
            body:
              type: block
              fields: {}
              children:
              - type: switch_expression
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: n.getType()
                        children: []
                        pos: 5281
                        length: 11
                    children: []
                    pos: 5280
                    length: 13
                  body:
                    type: switch_block
                    fields:
                      text: |-
                        {
                              case Token.CALL:
                                boolean isExpr = parent.getType() == Token.EXPR_RESULT;
                                Node left = n.getFirstChild();
                                if (left.getType() == Token.GETPROP) {
                                  Node name = left.getFirstChild();
                                  if (name.getType() == Token.NAME &&
                                      GOOG.equals(name.getString())) {
                                    // For the sake of simplicity, we report code changes
                                    // when we see a provides/requires, and don't worry about
                                    // reporting the change when we actually do the replacement.
                                    String methodName = name.getNext().getString();
                                    if ("base".equals(methodName)) {
                                      processBaseClassCall(t, n);
                                    } else if (!isExpr) {
                                      // All other methods must be called in an EXPR.
                                      break;
                                    } else if ("require".equals(methodName)) {
                                      processRequireCall(t, n, parent);
                                    } else if ("provide".equals(methodName)) {
                                      processProvideCall(t, n, parent);
                                    } else if ("exportSymbol".equals(methodName)) {
                                      Node arg = left.getNext();
                                      if (arg.getType() == Token.STRING) {
                                        int dot = arg.getString().indexOf('.');
                                        if (dot == -1) {
                                          exportedVariables.add(arg.getString());
                                        } else {
                                          exportedVariables.add(arg.getString().substring(0, dot));
                                        }
                                      }
                                    } else if ("addDependency".equals(methodName)) {
                                      CodingConvention convention = compiler.getCodingConvention();
                                      List<String> typeDecls =
                                          convention.identifyTypeDeclarationCall(n);
                                      if (typeDecls != null) {
                                        for (String typeDecl : typeDecls) {
                                          compiler.getTypeRegistry().forwardDeclareType(typeDecl);
                                        }
                                      }

                                      // We can't modify parent, so just create a node that will
                                      // get compiled out.
                                      parent.replaceChild(n, Node.newNumber(0));
                                      compiler.reportCodeChange();
                                    } else if ("setCssNameMapping".equals(methodName)) {
                                      processSetCssNameMapping(t, n, parent);
                                    }
                                  }
                                }
                                break;
                              case Token.ASSIGN:
                              case Token.NAME:
                                // If this is an assignment to a provided name, remove the provided
                                // object.
                                handleCandidateProvideDefinition(t, n, parent);
                                break;
                              case Token.FUNCTION:
                                // If this is a declaration of a provided named function, this is an
                                // error. Hosited functions will explode if the're provided.
                                if (t.inGlobalScope() &&
                                    !NodeUtil.isFunctionExpression(n)) {
                                  String name = n.getFirstChild().getString();
                                  ProvidedName pn = providedNames.get(name);
                                  if (pn != null) {
                                    compiler.report(t.makeError(n, FUNCTION_NAMESPACE_ERROR, name));
                                  }
                                }
                                break;

                              case Token.NEW:
                                trySimplifyNewDate(t, n, parent);
                                break;

                              case Token.GETPROP:
                                if (n.getFirstChild().getType() == Token.NAME &&
                                    parent.getType() != Token.CALL &&
                                    parent.getType() != Token.ASSIGN &&
                                    "goog.base".equals(n.getQualifiedName())) {
                                  reportBadBaseClassUse(t, n, "May only be called directly.");
                                }
                                break;
                            }
                    children: []
                    pos: 5294
                    length: 3375
                children: []
                pos: 5273
                length: 3396
              pos: 5267
              length: 3406
          children: []
          pos: 5199
          length: 3474
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: processRequireCall
              children: []
              pos: 8736
              length: 18
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 8755
                length: 15
              pos: 8723
              length: 1493
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: Node left = n.getFirstChild();
                children: []
                pos: 8799
                length: 30
              - type: local_variable_declaration
                fields:
                  text: Node arg = left.getNext();
                children: []
                pos: 8834
                length: 26
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: verifyArgument(t, left, arg)
                        children: []
                        pos: 8869
                        length: 28
                    children: []
                    pos: 8868
                    length: 30
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: String ns = arg.getString();
                    children: []
                    pos: 8907
                    length: 28
                  - type: local_variable_declaration
                    fields:
                      text: ProvidedName provided = providedNames.get(ns);
                    children: []
                    pos: 8942
                    length: 46
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: or
                            fields:
                              left:
                                type: equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: provided
                                    children: []
                                    pos: 8999
                                    length: 8
                                  right:
                                    type: null_literal
                                    fields: {}
                                    children: []
                                    pos: 9011
                                    length: 4
                                children: []
                                pos: 8999
                                length: 16
                              right:
                                type: unary_expression
                                fields:
                                  text: "!provided.isExplicitlyProvided()"
                                children: []
                                pos: 9019
                                length: 32
                            children: []
                            pos: 8999
                            length: 52
                        children: []
                        pos: 8998
                        length: 54
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: expression_statement
                        fields:
                          text: |-
                            unrecognizedRequires.add(
                                        new UnrecognizedRequire(n, ns, t.getSourceName()));
                        children: []
                        pos: 9063
                        length: 89
                      pos: 9053
                      length: 107
                    pos: 8995
                    length: 719
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: or
                            fields:
                              left:
                                type: not_equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: provided
                                    children: []
                                    pos: 10083
                                    length: 8
                                  right:
                                    type: null_literal
                                    fields: {}
                                    children: []
                                    pos: 10095
                                    length: 4
                                children: []
                                pos: 10083
                                length: 16
                              right:
                                type: method_invocation
                                fields:
                                  text: requiresLevel.isOn()
                                children: []
                                pos: 10103
                                length: 20
                            children: []
                            pos: 10083
                            length: 40
                        children: []
                        pos: 10082
                        length: 42
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: expression_statement
                        fields:
                          text: parent.detachFromParent();
                        children: []
                        pos: 10135
                        length: 26
                      - type: expression_statement
                        fields:
                          text: compiler.reportCodeChange();
                        children: []
                        pos: 10170
                        length: 28
                      pos: 10125
                      length: 81
                    pos: 10079
                    length: 127
                  pos: 8899
                  length: 1313
                pos: 8865
                length: 1347
              pos: 8793
              length: 1423
          children: []
          pos: 8723
          length: 1493
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: processProvideCall
              children: []
              pos: 10279
              length: 18
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 10298
                length: 15
              pos: 10266
              length: 755
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: Node left = n.getFirstChild();
                children: []
                pos: 10342
                length: 30
              - type: local_variable_declaration
                fields:
                  text: Node arg = left.getNext();
                children: []
                pos: 10377
                length: 26
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: verifyProvide(t, left, arg)
                        children: []
                        pos: 10412
                        length: 27
                    children: []
                    pos: 10411
                    length: 29
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: String ns = arg.getString();
                    children: []
                    pos: 10449
                    length: 28
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: method_invocation
                            fields:
                              text: providedNames.containsKey(ns)
                            children: []
                            pos: 10488
                            length: 29
                        children: []
                        pos: 10487
                        length: 31
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: local_variable_declaration
                        fields:
                          text: ProvidedName previouslyProvided = providedNames.get(ns);
                        children: []
                        pos: 10529
                        length: 56
                      - type: if_statement
                        fields:
                          condition:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: unary_expression
                                fields:
                                  text: "!previouslyProvided.isExplicitlyProvided()"
                                children: []
                                pos: 10598
                                length: 42
                            children: []
                            pos: 10597
                            length: 44
                        children:
                        - type: block
                          fields: {}
                          children:
                          - type: expression_statement
                            fields:
                              text: previouslyProvided.addProvide(parent, t.getModule(),
                                true);
                            children: []
                            pos: 10654
                            length: 59
                          pos: 10642
                          length: 81
                        pos: 10594
                        length: 235
                      pos: 10519
                      length: 318
                    pos: 10484
                    length: 527
                  pos: 10441
                  length: 576
                pos: 10408
                length: 609
              pos: 10336
              length: 685
          children: []
          pos: 10266
          length: 755
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: handleCandidateProvideDefinition
              children: []
              pos: 11112
              length: 32
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 11152
                length: 15
              pos: 11099
              length: 742
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: t.inGlobalScope()
                        children: []
                        pos: 11200
                        length: 17
                    children: []
                    pos: 11199
                    length: 19
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: String name = null;
                    children: []
                    pos: 11227
                    length: 19
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: and
                            fields:
                              left:
                                type: equals
                                fields:
                                  left:
                                    type: method_invocation
                                    fields:
                                      text: n.getType()
                                    children: []
                                    pos: 11257
                                    length: 11
                                  right:
                                    type: field_access
                                    fields:
                                      text: Token.NAME
                                    children: []
                                    pos: 11272
                                    length: 10
                                children: []
                                pos: 11257
                                length: 25
                              right:
                                type: equals
                                fields:
                                  left:
                                    type: method_invocation
                                    fields:
                                      text: parent.getType()
                                    children: []
                                    pos: 11286
                                    length: 16
                                  right:
                                    type: field_access
                                    fields:
                                      text: Token.VAR
                                    children: []
                                    pos: 11306
                                    length: 9
                                children: []
                                pos: 11286
                                length: 29
                            children: []
                            pos: 11257
                            length: 58
                        children: []
                        pos: 11256
                        length: 60
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: expression_statement
                        fields:
                          text: name = n.getString();
                        children: []
                        pos: 11327
                        length: 21
                      pos: 11317
                      length: 39
                    pos: 11253
                    length: 255
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: not_equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: name
                                children: []
                                pos: 11520
                                length: 4
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 11528
                                length: 4
                            children: []
                            pos: 11520
                            length: 12
                        children: []
                        pos: 11519
                        length: 14
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: if_statement
                        fields:
                          condition:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: method_invocation
                                fields:
                                  text: parent.getBooleanProp(Node.IS_NAMESPACE)
                                children: []
                                pos: 11548
                                length: 40
                            children: []
                            pos: 11547
                            length: 42
                        children:
                        - type: block
                          fields: {}
                          children:
                          - type: expression_statement
                            fields:
                              text: processProvideFromPreviousPass(t, name, parent);
                            children: []
                            pos: 11602
                            length: 48
                          pos: 11590
                          length: 70
                        pos: 11544
                        length: 279
                      pos: 11534
                      length: 297
                    pos: 11516
                    length: 315
                  pos: 11219
                  length: 618
                pos: 11196
                length: 641
              pos: 11190
              length: 651
          children: []
          pos: 11099
          length: 742
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: processBaseClassCall
              children: []
              pos: 11906
              length: 20
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 11927
                length: 15
              pos: 11893
              length: 3597
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: Node callee = n.getFirstChild();
                children: []
                pos: 12823
                length: 32
              - type: local_variable_declaration
                fields:
                  text: Node thisArg = callee.getNext();
                children: []
                pos: 12860
                length: 32
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: or
                        fields:
                          left:
                            type: equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: thisArg
                                children: []
                                pos: 12901
                                length: 7
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 12912
                                length: 4
                            children: []
                            pos: 12901
                            length: 15
                          right:
                            type: not_equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: thisArg.getType()
                                children: []
                                pos: 12920
                                length: 17
                              right:
                                type: field_access
                                fields:
                                  text: Token.THIS
                                children: []
                                pos: 12941
                                length: 10
                            children: []
                            pos: 12920
                            length: 31
                        children: []
                        pos: 12901
                        length: 50
                    children: []
                    pos: 12900
                    length: 52
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: reportBadBaseClassUse(t, n, "First argument must be 'this'.");
                    children: []
                    pos: 12961
                    length: 62
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 13030
                    length: 7
                  pos: 12953
                  length: 90
                pos: 12897
                length: 146
              - type: local_variable_declaration
                fields:
                  text: Node enclosingFnNameNode = getEnclosingDeclNameNode(t);
                children: []
                pos: 13049
                length: 55
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: enclosingFnNameNode
                            children: []
                            pos: 13113
                            length: 19
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 13136
                            length: 4
                        children: []
                        pos: 13113
                        length: 27
                    children: []
                    pos: 13112
                    length: 29
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: reportBadBaseClassUse(t, n, "Could not find enclosing
                        method.");
                    children: []
                    pos: 13150
                    length: 64
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 13221
                    length: 7
                  pos: 13142
                  length: 92
                pos: 13109
                length: 125
              - type: local_variable_declaration
                fields:
                  text: String enclosingQname = enclosingFnNameNode.getQualifiedName();
                children: []
                pos: 13240
                length: 63
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: method_invocation
                            fields:
                              text: enclosingQname.indexOf(".prototype.")
                            children: []
                            pos: 13312
                            length: 37
                          right:
                            type: unary_expression
                            fields:
                              text: "-1"
                            children: []
                            pos: 13353
                            length: 2
                        children: []
                        pos: 13312
                        length: 43
                    children: []
                    pos: 13311
                    length: 45
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: Node enclosingParent = enclosingFnNameNode.getParent();
                    children: []
                    pos: 13395
                    length: 55
                  - type: local_variable_declaration
                    fields:
                      text: |-
                        Node maybeInheritsExpr = (enclosingParent.getType() == Token.ASSIGN ?
                                  enclosingParent.getParent() : enclosingParent).getNext();
                    children: []
                    pos: 13457
                    length: 137
                  - type: local_variable_declaration
                    fields:
                      text: Node baseClassNode = null;
                    children: []
                    pos: 13601
                    length: 26
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: and
                            fields:
                              left:
                                type: and
                                fields:
                                  left:
                                    type: not_equals
                                    fields:
                                      left:
                                        type: identifier
                                        fields:
                                          text: maybeInheritsExpr
                                        children: []
                                        pos: 13638
                                        length: 17
                                      right:
                                        type: null_literal
                                        fields: {}
                                        children: []
                                        pos: 13659
                                        length: 4
                                    children: []
                                    pos: 13638
                                    length: 25
                                  right:
                                    type: equals
                                    fields:
                                      left:
                                        type: method_invocation
                                        fields:
                                          text: maybeInheritsExpr.getType()
                                        children: []
                                        pos: 13677
                                        length: 27
                                      right:
                                        type: field_access
                                        fields:
                                          text: Token.EXPR_RESULT
                                        children: []
                                        pos: 13708
                                        length: 17
                                    children: []
                                    pos: 13677
                                    length: 48
                                children: []
                                pos: 13638
                                length: 87
                              right:
                                type: equals
                                fields:
                                  left:
                                    type: method_invocation
                                    fields:
                                      text: maybeInheritsExpr.getFirstChild().getType()
                                    children: []
                                    pos: 13739
                                    length: 43
                                  right:
                                    type: field_access
                                    fields:
                                      text: Token.CALL
                                    children: []
                                    pos: 13786
                                    length: 10
                                children: []
                                pos: 13739
                                length: 57
                            children: []
                            pos: 13638
                            length: 158
                        children: []
                        pos: 13637
                        length: 160
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: local_variable_declaration
                        fields:
                          text: Node callNode = maybeInheritsExpr.getFirstChild();
                        children: []
                        pos: 13808
                        length: 50
                      - type: if_statement
                        fields:
                          condition:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: and
                                fields:
                                  left:
                                    type: method_invocation
                                    fields:
                                      text: |-
                                        "goog.inherits".equals(
                                                        callNode.getFirstChild().getQualifiedName())
                                    children: []
                                    pos: 13871
                                    length: 84
                                  right:
                                    type: method_invocation
                                    fields:
                                      text: callNode.getLastChild().isQualifiedName()
                                    children: []
                                    pos: 13971
                                    length: 41
                                children: []
                                pos: 13871
                                length: 141
                            children: []
                            pos: 13870
                            length: 143
                        children:
                        - type: block
                          fields: {}
                          children:
                          - type: expression_statement
                            fields:
                              text: baseClassNode = callNode.getLastChild();
                            children: []
                            pos: 14026
                            length: 40
                          pos: 14014
                          length: 62
                        pos: 13867
                        length: 209
                      pos: 13798
                      length: 286
                    pos: 13634
                    length: 450
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: baseClassNode
                                children: []
                                pos: 14096
                                length: 13
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 14113
                                length: 4
                            children: []
                            pos: 14096
                            length: 21
                        children: []
                        pos: 14095
                        length: 23
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: expression_statement
                        fields:
                          text: |-
                            reportBadBaseClassUse(
                                        t, n, "Could not find goog.inherits for base class");
                        children: []
                        pos: 14129
                        length: 88
                      - type: return_statement
                        fields:
                          text: return;
                        children: []
                        pos: 14226
                        length: 7
                      pos: 14119
                      length: 122
                    pos: 14092
                    length: 149
                  - type: expression_statement
                    fields:
                      text: |-
                        n.replaceChild(
                                  callee,
                                  NodeUtil.newQualifiedNameNode(
                                    String.format("%s.call", baseClassNode.getQualifiedName()),
                                    callee, "goog.base"));
                    children: []
                    pos: 14276
                    length: 181
                  - type: expression_statement
                    fields:
                      text: compiler.reportCodeChange();
                    children: []
                    pos: 14464
                    length: 28
                  pos: 13357
                  length: 1141
                pos: 13308
                length: 2178
              pos: 11952
              length: 3538
          children: []
          pos: 11893
          length: 3597
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getEnclosingDeclNameNode
              children: []
              pos: 15630
              length: 24
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 15655
                length: 15
              pos: 15617
              length: 697
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: Node scopeRoot = t.getScopeRoot();
                children: []
                pos: 15678
                length: 34
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: NodeUtil.isFunctionDeclaration(scopeRoot)
                        children: []
                        pos: 15721
                        length: 41
                    children: []
                    pos: 15720
                    length: 43
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return scopeRoot.getFirstChild();
                    children: []
                    pos: 15800
                    length: 33
                  pos: 15764
                  length: 75
                pos: 15717
                length: 575
              - type: return_statement
                fields:
                  text: return null;
                children: []
                pos: 16298
                length: 12
              pos: 15672
              length: 642
          children: []
          pos: 15617
          length: 697
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: reportBadBaseClassUse
              children: []
              pos: 16390
              length: 21
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 16419
                length: 15
              pos: 16377
              length: 162
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: compiler.report(t.makeError(n, BASE_CLASS_ERROR, extraMessage));
                children: []
                pos: 16471
                length: 64
              pos: 16465
              length: 74
          children: []
          pos: 16377
          length: 162
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: processProvideFromPreviousPass
              children: []
              pos: 16755
              length: 30
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 16793
                length: 15
              pos: 16742
              length: 993
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: unary_expression
                        fields:
                          text: "!providedNames.containsKey(name)"
                        children: []
                        pos: 16846
                        length: 32
                    children: []
                    pos: 16845
                    length: 34
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: Node expr = new Node(Token.EXPR_RESULT);
                    children: []
                    pos: 17033
                    length: 40
                  - type: expression_statement
                    fields:
                      text: expr.copyInformationFromForTree(parent);
                    children: []
                    pos: 17080
                    length: 40
                  - type: expression_statement
                    fields:
                      text: parent.getParent().addChildBefore(expr, parent);
                    children: []
                    pos: 17127
                    length: 48
                  - type: expression_statement
                    fields:
                      text: compiler.reportCodeChange();
                    children: []
                    pos: 17182
                    length: 28
                  - type: local_variable_declaration
                    fields:
                      text: JSModule module = t.getModule();
                    children: []
                    pos: 17218
                    length: 32
                  - type: expression_statement
                    fields:
                      text: registerAnyProvidedPrefixes(name, expr, module);
                    children: []
                    pos: 17257
                    length: 48
                  - type: local_variable_declaration
                    fields:
                      text: ProvidedName provided = new ProvidedName(name, expr, module,
                        true);
                    children: []
                    pos: 17313
                    length: 67
                  - type: expression_statement
                    fields:
                      text: providedNames.put(name, provided);
                    children: []
                    pos: 17387
                    length: 34
                  - type: expression_statement
                    fields:
                      text: provided.addDefinition(parent, module);
                    children: []
                    pos: 17428
                    length: 39
                  pos: 16880
                  length: 593
                pos: 16842
                length: 889
              pos: 16836
              length: 899
          children: []
          pos: 16742
          length: 993
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: processSetCssNameMapping
              children: []
              pos: 18086
              length: 24
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 18111
                length: 15
              pos: 18073
              length: 1560
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: Node left = n.getFirstChild();
                children: []
                pos: 18155
                length: 30
              - type: local_variable_declaration
                fields:
                  text: Node arg = left.getNext();
                children: []
                pos: 18190
                length: 26
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: verifyArgument(t, left, arg, Token.OBJECTLIT)
                        children: []
                        pos: 18225
                        length: 45
                    children: []
                    pos: 18224
                    length: 47
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: final Map<String, String> cssNames = Maps.newHashMap();
                    children: []
                    pos: 18405
                    length: 55
                  - type: local_variable_declaration
                    fields:
                      text: JSError error = null;
                    children: []
                    pos: 18467
                    length: 21
                  - type: for_statement
                    fields:
                      text: |-
                        for (Node key = arg.getFirstChild(); key != null;
                                  key = key.getNext().getNext()) {
                                Node value = key.getNext();
                                if (key.getType() != Token.STRING
                                    || value == null
                                    || value.getType() != Token.STRING) {
                                  error = t.makeError(n,
                                      NON_STRING_PASSED_TO_SET_CSS_NAME_MAPPING_ERROR);
                                }
                                if (error != null) {
                                  compiler.report(error);
                                  break;
                                }
                                cssNames.put(key.getString(), value.getString());
                              }
                    children: []
                    pos: 18495
                    length: 512
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: error
                                children: []
                                pos: 19180
                                length: 5
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 19189
                                length: 4
                            children: []
                            pos: 19180
                            length: 13
                        children: []
                        pos: 19179
                        length: 15
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: local_variable_declaration
                        fields:
                          text: |-
                            CssRenamingMap cssRenamingMap = new CssRenamingMap() {
                                      public String get(String value) {
                                        if (cssNames.containsKey(value)) {
                                          return cssNames.get(value);
                                        } else {
                                          return value;
                                        }
                                      }
                                    };
                        children: []
                        pos: 19205
                        length: 273
                      - type: expression_statement
                        fields:
                          text: compiler.setCssRenamingMap(cssRenamingMap);
                        children: []
                        pos: 19487
                        length: 43
                      - type: expression_statement
                        fields:
                          text: parent.getParent().removeChild(parent);
                        children: []
                        pos: 19539
                        length: 39
                      - type: expression_statement
                        fields:
                          text: compiler.reportCodeChange();
                        children: []
                        pos: 19587
                        length: 28
                      pos: 19195
                      length: 428
                    pos: 19176
                    length: 447
                  pos: 18272
                  length: 1357
                pos: 18221
                length: 1408
              pos: 18149
              length: 1484
          children: []
          pos: 18073
          length: 1560
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: trySimplifyNewDate
              children: []
              pos: 19723
              length: 18
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 19742
                length: 15
              pos: 19710
              length: 769
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: unary_expression
                        fields:
                          text: "!rewriteNewDateGoogNow"
                        children: []
                        pos: 19790
                        length: 22
                    children: []
                    pos: 19789
                    length: 24
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 19822
                    length: 7
                  pos: 19814
                  length: 21
                pos: 19786
                length: 49
              - type: expression_statement
                fields:
                  text: Preconditions.checkArgument(n.getType() == Token.NEW);
                children: []
                pos: 19840
                length: 54
              - type: local_variable_declaration
                fields:
                  text: Node date = n.getFirstChild();
                children: []
                pos: 19899
                length: 30
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: or
                        fields:
                          left:
                            type: unary_expression
                            fields:
                              text: "!NodeUtil.isName(date)"
                            children: []
                            pos: 19938
                            length: 22
                          right:
                            type: unary_expression
                            fields:
                              text: '!"Date".equals(date.getString())'
                            children: []
                            pos: 19964
                            length: 32
                        children: []
                        pos: 19938
                        length: 58
                    children: []
                    pos: 19937
                    length: 60
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 20006
                    length: 7
                  pos: 19998
                  length: 21
                pos: 19934
                length: 85
              - type: local_variable_declaration
                fields:
                  text: Node callGoogNow = date.getNext();
                children: []
                pos: 20024
                length: 34
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: or
                        fields:
                          left:
                            type: or
                            fields:
                              left:
                                type: equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: callGoogNow
                                    children: []
                                    pos: 20067
                                    length: 11
                                  right:
                                    type: null_literal
                                    fields: {}
                                    children: []
                                    pos: 20082
                                    length: 4
                                children: []
                                pos: 20067
                                length: 19
                              right:
                                type: unary_expression
                                fields:
                                  text: "!NodeUtil.isCall(callGoogNow)"
                                children: []
                                pos: 20090
                                length: 29
                            children: []
                            pos: 20067
                            length: 52
                          right:
                            type: not_equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: callGoogNow.getNext()
                                children: []
                                pos: 20131
                                length: 21
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 20156
                                length: 4
                            children: []
                            pos: 20131
                            length: 29
                        children: []
                        pos: 20067
                        length: 93
                    children: []
                    pos: 20066
                    length: 95
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 20170
                    length: 7
                  pos: 20162
                  length: 21
                pos: 20063
                length: 120
              - type: local_variable_declaration
                fields:
                  text: Node googNow = callGoogNow.getFirstChild();
                children: []
                pos: 20188
                length: 43
              - type: local_variable_declaration
                fields:
                  text: String googNowQName = googNow.getQualifiedName();
                children: []
                pos: 20236
                length: 49
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: or
                        fields:
                          left:
                            type: or
                            fields:
                              left:
                                type: equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: googNowQName
                                    children: []
                                    pos: 20294
                                    length: 12
                                  right:
                                    type: null_literal
                                    fields: {}
                                    children: []
                                    pos: 20310
                                    length: 4
                                children: []
                                pos: 20294
                                length: 20
                              right:
                                type: unary_expression
                                fields:
                                  text: '!"goog.now".equals(googNowQName)'
                                children: []
                                pos: 20318
                                length: 32
                            children: []
                            pos: 20294
                            length: 56
                          right:
                            type: not_equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: googNow.getNext()
                                children: []
                                pos: 20362
                                length: 17
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 20383
                                length: 4
                            children: []
                            pos: 20362
                            length: 25
                        children: []
                        pos: 20294
                        length: 93
                    children: []
                    pos: 20293
                    length: 95
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 20397
                    length: 7
                  pos: 20389
                  length: 21
                pos: 20290
                length: 120
              - type: expression_statement
                fields:
                  text: n.removeChild(callGoogNow);
                children: []
                pos: 20415
                length: 27
              - type: expression_statement
                fields:
                  text: compiler.reportCodeChange();
                children: []
                pos: 20447
                length: 28
              pos: 19780
              length: 699
          children: []
          pos: 19710
          length: 769
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: verifyProvide
              children: []
              pos: 20771
              length: 13
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 20785
                length: 15
              pos: 20755
              length: 382
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: unary_expression
                        fields:
                          text: "!verifyArgument(t, methodName, arg)"
                        children: []
                        pos: 20839
                        length: 35
                    children: []
                    pos: 20838
                    length: 37
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return false;
                    children: []
                    pos: 20884
                    length: 13
                  pos: 20876
                  length: 27
                pos: 20835
                length: 68
              - type: enhanced_for_statement
                fields:
                  text: |-
                    for (String part : arg.getString().split("\\.")) {
                          if (!NodeUtil.isValidPropertyName(part)) {
                            compiler.report(t.makeError(arg, INVALID_PROVIDE_ERROR, part));
                            return false;
                          }
                        }
                children: []
                pos: 20909
                length: 207
              - type: return_statement
                fields:
                  text: return true;
                children: []
                pos: 21121
                length: 12
              pos: 20829
              length: 308
          children: []
          pos: 20755
          length: 382
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: verifyArgument
              children: []
              pos: 21360
              length: 14
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 21375
                length: 15
              pos: 21344
              length: 141
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return verifyArgument(t, methodName, arg, Token.STRING);
                children: []
                pos: 21425
                length: 56
              pos: 21419
              length: 66
          children: []
          pos: 21344
          length: 141
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: verifyArgument
              children: []
              pos: 21712
              length: 14
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 21727
                length: 15
              pos: 21696
              length: 574
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: DiagnosticType diagnostic = null;
                children: []
                pos: 21800
                length: 33
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: arg
                            children: []
                            pos: 21842
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 21849
                            length: 4
                        children: []
                        pos: 21842
                        length: 11
                    children: []
                    pos: 21841
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: diagnostic = NULL_ARGUMENT_ERROR;
                    children: []
                    pos: 21863
                    length: 33
                  pos: 21855
                  length: 47
                pos: 21838
                length: 239
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: diagnostic
                            children: []
                            pos: 22086
                            length: 10
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 22100
                            length: 4
                        children: []
                        pos: 22086
                        length: 18
                    children: []
                    pos: 22085
                    length: 20
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: |-
                        compiler.report(
                                  t.makeError(methodName,
                                      diagnostic, methodName.getQualifiedName()));
                    children: []
                    pos: 22114
                    length: 109
                  - type: return_statement
                    fields:
                      text: return false;
                    children: []
                    pos: 22230
                    length: 13
                  pos: 22106
                  length: 143
                pos: 22082
                length: 167
              - type: return_statement
                fields:
                  text: return true;
                children: []
                pos: 22254
                length: 12
              pos: 21794
              length: 476
          children: []
          pos: 21696
          length: 574
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: registerAnyProvidedPrefixes
              children: []
              pos: 22634
              length: 27
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String ns
                children: []
                pos: 22669
                length: 9
              pos: 22621
              length: 532
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: int pos = ns.indexOf('.');
                children: []
                pos: 22714
                length: 26
              - type: while_statement
                fields:
                  text: |-
                    while (pos != -1) {
                          String prefixNs = ns.substring(0, pos);
                          pos = ns.indexOf('.', pos + 1);
                          if (providedNames.containsKey(prefixNs)) {
                            providedNames.get(prefixNs).addProvide(
                                node, module, false /* implicit */);
                          } else {
                            providedNames.put(
                                prefixNs,
                                new ProvidedName(prefixNs, node, module, false /* implicit */));
                          }
                        }
                children: []
                pos: 22745
                length: 404
              pos: 22708
              length: 445
          children: []
          pos: 22621
          length: 532
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: ProvidedName
              children: []
              pos: 23344
              length: 12
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: private final String namespace;
                children: []
                pos: 23363
                length: 31
              - type: field_declaration
                fields:
                  text: private final Node firstNode;
                children: []
                pos: 23493
                length: 29
              - type: field_declaration
                fields:
                  text: private final JSModule firstModule;
                children: []
                pos: 23527
                length: 35
              - type: field_declaration
                fields:
                  text: private Node explicitNode = null;
                children: []
                pos: 23696
                length: 33
              - type: field_declaration
                fields:
                  text: private JSModule explicitModule = null;
                children: []
                pos: 23734
                length: 39
              - type: field_declaration
                fields:
                  text: private Node candidateDefinition = null;
                children: []
                pos: 23812
                length: 40
              - type: field_declaration
                fields:
                  text: private JSModule minimumModule = null;
                children: []
                pos: 23915
                length: 38
              - type: field_declaration
                fields:
                  text: private Node replacementNode = null;
                children: []
                pos: 23995
                length: 36
              - type: constructor_declaration
                fields:
                  text: |-
                    ProvidedName(String namespace, Node node, JSModule module,
                            boolean explicit) {
                          Preconditions.checkArgument(
                              node == null /* The base case */ ||
                              NodeUtil.isExpressionNode(node));
                          this.namespace = namespace;
                          this.firstNode = node;
                          this.firstModule = module;

                          addProvide(node, module, explicit);
                        }
                children: []
                pos: 24037
                length: 356
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: addProvide
                    children: []
                    pos: 24464
                    length: 10
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node node
                      children: []
                      pos: 24475
                      length: 9
                    pos: 24459
                    length: 322
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: identifier
                              fields:
                                text: explicit
                              children: []
                              pos: 24533
                              length: 8
                          children: []
                          pos: 24532
                          length: 10
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: expression_statement
                          fields:
                            text: Preconditions.checkState(explicitNode == null);
                          children: []
                          pos: 24553
                          length: 47
                        - type: expression_statement
                          fields:
                            text: Preconditions.checkArgument(NodeUtil.isExpressionNode(node));
                          children: []
                          pos: 24609
                          length: 61
                        - type: expression_statement
                          fields:
                            text: explicitNode = node;
                          children: []
                          pos: 24679
                          length: 20
                        - type: expression_statement
                          fields:
                            text: explicitModule = module;
                          children: []
                          pos: 24708
                          length: 24
                        pos: 24543
                        length: 197
                      pos: 24529
                      length: 211
                    - type: expression_statement
                      fields:
                        text: updateMinimumModule(module);
                      children: []
                      pos: 24747
                      length: 28
                    pos: 24521
                    length: 260
                children: []
                pos: 24459
                length: 322
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: isExplicitlyProvided
                    children: []
                    pos: 24795
                    length: 20
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 24787
                    length: 73
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return explicitNode != null;
                      children: []
                      pos: 24826
                      length: 28
                    pos: 24818
                    length: 42
                children: []
                pos: 24787
                length: 73
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: addDefinition
                    children: []
                    pos: 25151
                    length: 13
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node node
                      children: []
                      pos: 25165
                      length: 9
                    pos: 25146
                    length: 470
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: expression_statement
                      fields:
                        text: |-
                          Preconditions.checkArgument(NodeUtil.isExpressionNode(node) || // assign
                                                            NodeUtil.isFunction(node) ||
                                                            NodeUtil.isVar(node));
                      children: []
                      pos: 25201
                      length: 192
                    - type: expression_statement
                      fields:
                        text: Preconditions.checkArgument(explicitNode != node);
                      children: []
                      pos: 25400
                      length: 50
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: or
                              fields:
                                left:
                                  type: parenthesized_expression
                                  fields:
                                    expression:
                                      type: equals
                                      fields:
                                        left:
                                          type: identifier
                                          fields:
                                            text: candidateDefinition
                                          children: []
                                          pos: 25462
                                          length: 19
                                        right:
                                          type: null_literal
                                          fields: {}
                                          children: []
                                          pos: 25485
                                          length: 4
                                      children: []
                                      pos: 25462
                                      length: 27
                                  children: []
                                  pos: 25461
                                  length: 29
                                right:
                                  type: unary_expression
                                  fields:
                                    text: "!NodeUtil.isExpressionNode(node)"
                                  children: []
                                  pos: 25494
                                  length: 32
                              children: []
                              pos: 25461
                              length: 65
                          children: []
                          pos: 25460
                          length: 67
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: expression_statement
                          fields:
                            text: candidateDefinition = node;
                          children: []
                          pos: 25538
                          length: 27
                        - type: expression_statement
                          fields:
                            text: updateMinimumModule(module);
                          children: []
                          pos: 25574
                          length: 28
                        pos: 25528
                        length: 82
                      pos: 25457
                      length: 153
                    pos: 25193
                    length: 423
                children: []
                pos: 25146
                length: 470
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: updateMinimumModule
                    children: []
                    pos: 25635
                    length: 19
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: JSModule newModule
                      children: []
                      pos: 25655
                      length: 18
                    pos: 25622
                    length: 529
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: equals
                              fields:
                                left:
                                  type: identifier
                                  fields:
                                    text: minimumModule
                                  children: []
                                  pos: 25687
                                  length: 13
                                right:
                                  type: null_literal
                                  fields: {}
                                  children: []
                                  pos: 25704
                                  length: 4
                              children: []
                              pos: 25687
                              length: 21
                          children: []
                          pos: 25686
                          length: 23
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: expression_statement
                          fields:
                            text: minimumModule = newModule;
                          children: []
                          pos: 25720
                          length: 26
                        pos: 25710
                        length: 44
                      pos: 25683
                      length: 462
                    pos: 25675
                    length: 476
                children: []
                pos: 25622
                length: 529
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: replace
                    children: []
                    pos: 26416
                    length: 7
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 26411
                    length: 2699
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: equals
                              fields:
                                left:
                                  type: identifier
                                  fields:
                                    text: firstNode
                                  children: []
                                  pos: 26438
                                  length: 9
                                right:
                                  type: null_literal
                                  fields: {}
                                  children: []
                                  pos: 26451
                                  length: 4
                              children: []
                              pos: 26438
                              length: 17
                          children: []
                          pos: 26437
                          length: 19
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: expression_statement
                          fields:
                            text: replacementNode = candidateDefinition;
                          children: []
                          pos: 26514
                          length: 38
                        - type: return_statement
                          fields:
                            text: return;
                          children: []
                          pos: 26561
                          length: 7
                        pos: 26457
                        length: 119
                      pos: 26434
                      length: 142
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: and
                              fields:
                                left:
                                  type: not_equals
                                  fields:
                                    left:
                                      type: identifier
                                      fields:
                                        text: candidateDefinition
                                      children: []
                                      pos: 26695
                                      length: 19
                                    right:
                                      type: null_literal
                                      fields: {}
                                      children: []
                                      pos: 26718
                                      length: 4
                                  children: []
                                  pos: 26695
                                  length: 27
                                right:
                                  type: not_equals
                                  fields:
                                    left:
                                      type: identifier
                                      fields:
                                        text: explicitNode
                                      children: []
                                      pos: 26726
                                      length: 12
                                    right:
                                      type: null_literal
                                      fields: {}
                                      children: []
                                      pos: 26742
                                      length: 4
                                  children: []
                                  pos: 26726
                                  length: 20
                              children: []
                              pos: 26695
                              length: 51
                          children: []
                          pos: 26694
                          length: 53
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: expression_statement
                          fields:
                            text: explicitNode.detachFromParent();
                          children: []
                          pos: 26758
                          length: 32
                        - type: expression_statement
                          fields:
                            text: compiler.reportCodeChange();
                          children: []
                          pos: 26799
                          length: 28
                        - type: expression_statement
                          fields:
                            text: replacementNode = candidateDefinition;
                          children: []
                          pos: 26878
                          length: 38
                        - type: if_statement
                          fields:
                            condition:
                              type: parenthesized_expression
                              fields:
                                expression:
                                  type: method_invocation
                                  fields:
                                    text: NodeUtil.isExpressionNode(candidateDefinition)
                                  children: []
                                  pos: 26929
                                  length: 46
                              children: []
                              pos: 26928
                              length: 48
                          children:
                          - type: block
                            fields: {}
                            children:
                            - type: expression_statement
                              fields:
                                text: candidateDefinition.putBooleanProp(Node.IS_NAMESPACE,
                                  true);
                              children: []
                              pos: 26989
                              length: 60
                            - type: local_variable_declaration
                              fields:
                                text: Node assignNode = candidateDefinition.getFirstChild();
                              children: []
                              pos: 27060
                              length: 54
                            - type: local_variable_declaration
                              fields:
                                text: Node nameNode = assignNode.getFirstChild();
                              children: []
                              pos: 27125
                              length: 43
                            - type: if_statement
                              fields:
                                condition:
                                  type: parenthesized_expression
                                  fields:
                                    expression:
                                      type: equals
                                      fields:
                                        left:
                                          type: method_invocation
                                          fields:
                                            text: nameNode.getType()
                                          children: []
                                          pos: 27183
                                          length: 18
                                        right:
                                          type: field_access
                                          fields:
                                            text: Token.NAME
                                          children: []
                                          pos: 27205
                                          length: 10
                                      children: []
                                      pos: 27183
                                      length: 32
                                  children: []
                                  pos: 27182
                                  length: 34
                              children:
                              - type: block
                                fields: {}
                                children:
                                - type: local_variable_declaration
                                  fields:
                                    text: Node valueNode = nameNode.getNext();
                                  children: []
                                  pos: 27296
                                  length: 36
                                - type: expression_statement
                                  fields:
                                    text: assignNode.removeChild(nameNode);
                                  children: []
                                  pos: 27345
                                  length: 33
                                - type: expression_statement
                                  fields:
                                    text: assignNode.removeChild(valueNode);
                                  children: []
                                  pos: 27391
                                  length: 34
                                - type: expression_statement
                                  fields:
                                    text: nameNode.addChildToFront(valueNode);
                                  children: []
                                  pos: 27438
                                  length: 36
                                - type: local_variable_declaration
                                  fields:
                                    text: Node varNode = new Node(Token.VAR, nameNode);
                                  children: []
                                  pos: 27487
                                  length: 45
                                - type: expression_statement
                                  fields:
                                    text: varNode.copyInformationFrom(candidateDefinition);
                                  children: []
                                  pos: 27545
                                  length: 49
                                - type: expression_statement
                                  fields:
                                    text: |-
                                      candidateDefinition.getParent().replaceChild(
                                                      candidateDefinition, varNode);
                                  children: []
                                  pos: 27607
                                  length: 92
                                - type: expression_statement
                                  fields:
                                    text: nameNode.setJSDocInfo(assignNode.getJSDocInfo());
                                  children: []
                                  pos: 27712
                                  length: 49
                                - type: expression_statement
                                  fields:
                                    text: compiler.reportCodeChange();
                                  children: []
                                  pos: 27774
                                  length: 28
                                - type: expression_statement
                                  fields:
                                    text: replacementNode = varNode;
                                  children: []
                                  pos: 27815
                                  length: 26
                                pos: 27217
                                length: 636
                              pos: 27179
                              length: 674
                            pos: 26977
                            length: 886
                          pos: 26925
                          length: 938
                        pos: 26748
                        length: 1123
                      pos: 26691
                      length: 2413
                    pos: 26426
                    length: 2684
                children: []
                pos: 26411
                length: 2699
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: createDeclarationNode
                    children: []
                    pos: 29237
                    length: 21
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 29224
                    length: 224
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: equals
                              fields:
                                left:
                                  type: method_invocation
                                  fields:
                                    text: namespace.indexOf('.')
                                  children: []
                                  pos: 29273
                                  length: 22
                                right:
                                  type: unary_expression
                                  fields:
                                    text: "-1"
                                  children: []
                                  pos: 29299
                                  length: 2
                              children: []
                              pos: 29273
                              length: 28
                          children: []
                          pos: 29272
                          length: 30
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return makeVarDeclNode(namespace, firstNode);
                          children: []
                          pos: 29313
                          length: 45
                        pos: 29303
                        length: 63
                      pos: 29269
                      length: 173
                    pos: 29261
                    length: 187
                children: []
                pos: 29224
                length: 224
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: makeVarDeclNode
                    children: []
                    pos: 29728
                    length: 15
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: String namespace
                      children: []
                      pos: 29744
                      length: 16
                    pos: 29715
                    length: 609
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: Node name = Node.newString(Token.NAME, namespace);
                      children: []
                      pos: 29787
                      length: 50
                    - type: expression_statement
                      fields:
                        text: name.addChildToFront(createNamespaceLiteral());
                      children: []
                      pos: 29844
                      length: 47
                    - type: local_variable_declaration
                      fields:
                        text: Node decl = new Node(Token.VAR, name);
                      children: []
                      pos: 29899
                      length: 38
                    - type: expression_statement
                      fields:
                        text: decl.putBooleanProp(Node.IS_NAMESPACE, true);
                      children: []
                      pos: 29944
                      length: 45
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: method_invocation
                              fields:
                                text: compiler.getCodingConvention().isConstant(namespace)
                              children: []
                              pos: 30064
                              length: 52
                          children: []
                          pos: 30063
                          length: 54
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: expression_statement
                          fields:
                            text: name.putBooleanProp(Node.IS_CONSTANT_NAME, true);
                          children: []
                          pos: 30128
                          length: 49
                        pos: 30118
                        length: 67
                      pos: 30060
                      length: 125
                    - type: expression_statement
                      fields:
                        text: Preconditions.checkState(isNamespacePlaceholder(decl));
                      children: []
                      pos: 30193
                      length: 55
                    - type: expression_statement
                      fields:
                        text: decl.copyInformationFromForTree(sourceNode);
                      children: []
                      pos: 30255
                      length: 44
                    - type: return_statement
                      fields:
                        text: return decl;
                      children: []
                      pos: 30306
                      length: 12
                    pos: 29779
                    length: 545
                children: []
                pos: 29715
                length: 609
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: createNamespaceLiteral
                    children: []
                    pos: 30538
                    length: 22
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 30525
                    length: 204
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: Node objlit = new Node(Token.OBJECTLIT);
                      children: []
                      pos: 30571
                      length: 40
                    - type: expression_statement
                      fields:
                        text: |-
                          objlit.setJSType(
                                    compiler.getTypeRegistry().createAnonymousObjectType());
                      children: []
                      pos: 30618
                      length: 84
                    - type: return_statement
                      fields:
                        text: return objlit;
                      children: []
                      pos: 30709
                      length: 14
                    pos: 30563
                    length: 166
                children: []
                pos: 30525
                length: 204
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: makeAssignmentExprNode
                    children: []
                    pos: 30970
                    length: 22
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: String namespace
                      children: []
                      pos: 30993
                      length: 16
                    pos: 30957
                    length: 444
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: |-
                          Node decl = new Node(Token.EXPR_RESULT,
                                    new Node(Token.ASSIGN,
                                        NodeUtil.newQualifiedNameNode(namespace, node, namespace),
                                        createNamespaceLiteral()));
                      children: []
                      pos: 31030
                      length: 187
                    - type: expression_statement
                      fields:
                        text: decl.putBooleanProp(Node.IS_NAMESPACE, true);
                      children: []
                      pos: 31224
                      length: 45
                    - type: expression_statement
                      fields:
                        text: Preconditions.checkState(isNamespacePlaceholder(decl));
                      children: []
                      pos: 31276
                      length: 55
                    - type: expression_statement
                      fields:
                        text: decl.copyInformationFromForTree(node);
                      children: []
                      pos: 31338
                      length: 38
                    - type: return_statement
                      fields:
                        text: return decl;
                      children: []
                      pos: 31383
                      length: 12
                    pos: 31022
                    length: 379
                children: []
                pos: 30957
                length: 444
              pos: 23330
              length: 8075
          children: []
          pos: 23330
          length: 8075
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: isNamespacePlaceholder
              children: []
              pos: 31500
              length: 22
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Node n
                children: []
                pos: 31523
                length: 6
              pos: 31477
              length: 500
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: unary_expression
                        fields:
                          text: "!n.getBooleanProp(Node.IS_NAMESPACE)"
                        children: []
                        pos: 31541
                        length: 36
                    children: []
                    pos: 31540
                    length: 38
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return false;
                    children: []
                    pos: 31587
                    length: 13
                  pos: 31579
                  length: 27
                pos: 31537
                length: 69
              - type: local_variable_declaration
                fields:
                  text: Node value = null;
                children: []
                pos: 31612
                length: 18
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: method_invocation
                            fields:
                              text: n.getType()
                            children: []
                            pos: 31639
                            length: 11
                          right:
                            type: field_access
                            fields:
                              text: Token.EXPR_RESULT
                            children: []
                            pos: 31654
                            length: 17
                        children: []
                        pos: 31639
                        length: 32
                    children: []
                    pos: 31638
                    length: 34
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: Node assign = n.getFirstChild();
                    children: []
                    pos: 31681
                    length: 32
                  - type: expression_statement
                    fields:
                      text: value = assign.getLastChild();
                    children: []
                    pos: 31720
                    length: 30
                  pos: 31673
                  length: 83
                pos: 31635
                length: 237
              - type: return_statement
                fields:
                  text: |-
                    return value != null
                          && value.getType() == Token.OBJECTLIT
                          && !value.hasChildren();
                children: []
                pos: 31878
                length: 95
              pos: 31531
              length: 446
          children: []
          pos: 31477
          length: 500
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: UnrecognizedRequire
              children: []
              pos: 32164
              length: 19
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: final Node requireNode;
                children: []
                pos: 32190
                length: 23
              - type: field_declaration
                fields:
                  text: final String namespace;
                children: []
                pos: 32218
                length: 23
              - type: field_declaration
                fields:
                  text: final String inputName;
                children: []
                pos: 32246
                length: 23
              - type: constructor_declaration
                fields:
                  text: |-
                    UnrecognizedRequire(Node requireNode, String namespace, String inputName) {
                          this.requireNode = requireNode;
                          this.namespace = namespace;
                          this.inputName = inputName;
                        }
                children: []
                pos: 32275
                length: 187
              pos: 32150
              length: 316
          children: []
          pos: 32150
          length: 316
        pos: 1207
        length: 31261
    children: []
    pos: 1207
    length: 31261
  pos: 0
  length: 32469
after_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: ProcessClosurePrimitives
        children: []
        pos: 1213
        length: 24
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType NULL_ARGUMENT_ERROR = DiagnosticType.error(
                    "JSC_NULL_ARGUMENT_ERROR",
                    "method \"{0}\" called without an argument");
          children: []
          pos: 1305
          length: 156
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType INVALID_ARGUMENT_ERROR = DiagnosticType.error(
                    "JSC_INVALID_ARGUMENT_ERROR",
                    "method \"{0}\" called with a non-string argument");
          children: []
          pos: 1465
          length: 169
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType TOO_MANY_ARGUMENTS_ERROR = DiagnosticType.error(
                    "JSC_TOO_MANY_ARGUMENTS_ERROR",
                    "method \"{0}\" called with more than one argument");
          children: []
          pos: 1638
          length: 174
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType DUPLICATE_NAMESPACE_ERROR = DiagnosticType.error(
                    "JSC_DUPLICATE_NAMESPACE_ERROR",
                    "namespace \"{0}\" cannot be provided twice");
          children: []
          pos: 1816
          length: 169
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType FUNCTION_NAMESPACE_ERROR = DiagnosticType.error(
                    "JSC_FUNCTION_NAMESPACE_ERROR",
                    "\"{0}\" cannot be both provided and declared as a function");
          children: []
          pos: 1989
          length: 183
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType MISSING_PROVIDE_ERROR = DiagnosticType.error(
                    "JSC_MISSING_PROVIDE_ERROR",
                    "required \"{0}\" namespace never provided");
          children: []
          pos: 2176
          length: 160
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType LATE_PROVIDE_ERROR = DiagnosticType.error(
                    "JSC_LATE_PROVIDE_ERROR",
                    "required \"{0}\" namespace not provided yet");
          children: []
          pos: 2340
          length: 156
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType INVALID_PROVIDE_ERROR = DiagnosticType.error(
                    "JSC_INVALID_PROVIDE_ERROR",
                    "\"{0}\" is not a valid JS property name");
          children: []
          pos: 2500
          length: 158
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType XMODULE_REQUIRE_ERROR = DiagnosticType.warning(
                    "JSC_XMODULE_REQUIRE_ERROR",
                    "namespace \"{0}\" provided in module {1} " +
                    "but required in module {2}");
          children: []
          pos: 2662
          length: 199
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType NON_STRING_PASSED_TO_SET_CSS_NAME_MAPPING_ERROR =
                    DiagnosticType.error(
                        "JSC_NON_STRING_PASSED_TO_SET_CSS_NAME_MAPPING_ERROR",
                    "goog.setCssNameMapping only takes an object literal with string values");
          children: []
          pos: 2865
          length: 251
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType BASE_CLASS_ERROR = DiagnosticType.error(
                    "JSC_BASE_CLASS_ERROR",
                    "incorrect use of goog.base: {0}");
          children: []
          pos: 3120
          length: 140
        - type: field_declaration
          fields:
            text: static final String GOOG = "goog";
          children: []
          pos: 3300
          length: 34
        - type: field_declaration
          fields:
            text: private final AbstractCompiler compiler;
          children: []
          pos: 3338
          length: 40
        - type: field_declaration
          fields:
            text: private final JSModuleGraph moduleGraph;
          children: []
          pos: 3381
          length: 40
        - type: field_declaration
          fields:
            text: |-
              private final Map<String, ProvidedName> providedNames =
                    Maps.newTreeMap();
          children: []
          pos: 3492
          length: 80
        - type: field_declaration
          fields:
            text: |-
              private final List<UnrecognizedRequire> unrecognizedRequires =
                    Lists.newArrayList();
          children: []
          pos: 3576
          length: 90
        - type: field_declaration
          fields:
            text: private final Set<String> exportedVariables = Sets.newHashSet();
          children: []
          pos: 3669
          length: 64
        - type: field_declaration
          fields:
            text: private final CheckLevel requiresLevel;
          children: []
          pos: 3736
          length: 39
        - type: field_declaration
          fields:
            text: private final boolean rewriteNewDateGoogNow;
          children: []
          pos: 3778
          length: 44
        - type: constructor_declaration
          fields:
            text: |-
              ProcessClosurePrimitives(AbstractCompiler compiler,
                                         CheckLevel requiresLevel,
                                         boolean rewriteNewDateGoogNow) {
                  this.compiler = compiler;
                  this.moduleGraph = compiler.getModuleGraph();
                  this.requiresLevel = requiresLevel;
                  this.rewriteNewDateGoogNow = rewriteNewDateGoogNow;

                  // goog is special-cased because it is provided in Closure's base library.
                  providedNames.put(GOOG,
                      new ProvidedName(GOOG, null, null, false /* implicit */));
                }
          children: []
          pos: 3826
          length: 519
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getExportedVariableNames
              children: []
              pos: 4361
              length: 24
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 4349
              length: 74
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return exportedVariables;
                children: []
                pos: 4394
                length: 25
              pos: 4388
              length: 35
          children: []
          pos: 4349
          length: 74
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: process
              children: []
              pos: 4451
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Node externs
                children: []
                pos: 4459
                length: 12
              pos: 4427
              length: 768
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: new NodeTraversal(compiler, this).traverse(root);
                children: []
                pos: 4490
                length: 49
              - type: enhanced_for_statement
                fields:
                  text: |-
                    for (ProvidedName pn : providedNames.values()) {
                          pn.replace();
                        }
                children: []
                pos: 4545
                length: 74
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: requiresLevel.isOn()
                        children: []
                        pos: 4629
                        length: 20
                    children: []
                    pos: 4628
                    length: 22
                children:
                - type: block
                  fields: {}
                  children:
                  - type: enhanced_for_statement
                    fields:
                      text: |-
                        for (UnrecognizedRequire r : unrecognizedRequires) {
                                DiagnosticType error;
                                ProvidedName expectedName = providedNames.get(r.namespace);
                                if (expectedName != null && expectedName.firstNode != null) {
                                  // The namespace ended up getting provided after it was required.
                                  error = LATE_PROVIDE_ERROR;
                                } else {
                                  error = MISSING_PROVIDE_ERROR;
                                }

                                compiler.report(JSError.make(
                                    r.inputName, r.requireNode, requiresLevel, error, r.namespace));
                              }
                    children: []
                    pos: 4659
                    length: 526
                  pos: 4651
                  length: 540
                pos: 4625
                length: 566
              pos: 4484
              length: 711
          children: []
          pos: 4427
          length: 768
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: visit
              children: []
              pos: 5223
              length: 5
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 5229
                length: 15
              pos: 5199
              length: 3474
            body:
              type: block
              fields: {}
              children:
              - type: switch_expression
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: n.getType()
                        children: []
                        pos: 5281
                        length: 11
                    children: []
                    pos: 5280
                    length: 13
                  body:
                    type: switch_block
                    fields:
                      text: |-
                        {
                              case Token.CALL:
                                boolean isExpr = parent.getType() == Token.EXPR_RESULT;
                                Node left = n.getFirstChild();
                                if (left.getType() == Token.GETPROP) {
                                  Node name = left.getFirstChild();
                                  if (name.getType() == Token.NAME &&
                                      GOOG.equals(name.getString())) {
                                    // For the sake of simplicity, we report code changes
                                    // when we see a provides/requires, and don't worry about
                                    // reporting the change when we actually do the replacement.
                                    String methodName = name.getNext().getString();
                                    if ("base".equals(methodName)) {
                                      processBaseClassCall(t, n);
                                    } else if (!isExpr) {
                                      // All other methods must be called in an EXPR.
                                      break;
                                    } else if ("require".equals(methodName)) {
                                      processRequireCall(t, n, parent);
                                    } else if ("provide".equals(methodName)) {
                                      processProvideCall(t, n, parent);
                                    } else if ("exportSymbol".equals(methodName)) {
                                      Node arg = left.getNext();
                                      if (arg.getType() == Token.STRING) {
                                        int dot = arg.getString().indexOf('.');
                                        if (dot == -1) {
                                          exportedVariables.add(arg.getString());
                                        } else {
                                          exportedVariables.add(arg.getString().substring(0, dot));
                                        }
                                      }
                                    } else if ("addDependency".equals(methodName)) {
                                      CodingConvention convention = compiler.getCodingConvention();
                                      List<String> typeDecls =
                                          convention.identifyTypeDeclarationCall(n);
                                      if (typeDecls != null) {
                                        for (String typeDecl : typeDecls) {
                                          compiler.getTypeRegistry().forwardDeclareType(typeDecl);
                                        }
                                      }

                                      // We can't modify parent, so just create a node that will
                                      // get compiled out.
                                      parent.replaceChild(n, Node.newNumber(0));
                                      compiler.reportCodeChange();
                                    } else if ("setCssNameMapping".equals(methodName)) {
                                      processSetCssNameMapping(t, n, parent);
                                    }
                                  }
                                }
                                break;
                              case Token.ASSIGN:
                              case Token.NAME:
                                // If this is an assignment to a provided name, remove the provided
                                // object.
                                handleCandidateProvideDefinition(t, n, parent);
                                break;
                              case Token.FUNCTION:
                                // If this is a declaration of a provided named function, this is an
                                // error. Hosited functions will explode if the're provided.
                                if (t.inGlobalScope() &&
                                    !NodeUtil.isFunctionExpression(n)) {
                                  String name = n.getFirstChild().getString();
                                  ProvidedName pn = providedNames.get(name);
                                  if (pn != null) {
                                    compiler.report(t.makeError(n, FUNCTION_NAMESPACE_ERROR, name));
                                  }
                                }
                                break;

                              case Token.NEW:
                                trySimplifyNewDate(t, n, parent);
                                break;

                              case Token.GETPROP:
                                if (n.getFirstChild().getType() == Token.NAME &&
                                    parent.getType() != Token.CALL &&
                                    parent.getType() != Token.ASSIGN &&
                                    "goog.base".equals(n.getQualifiedName())) {
                                  reportBadBaseClassUse(t, n, "May only be called directly.");
                                }
                                break;
                            }
                    children: []
                    pos: 5294
                    length: 3375
                children: []
                pos: 5273
                length: 3396
              pos: 5267
              length: 3406
          children: []
          pos: 5199
          length: 3474
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: processRequireCall
              children: []
              pos: 8736
              length: 18
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 8755
                length: 15
              pos: 8723
              length: 1493
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: Node left = n.getFirstChild();
                children: []
                pos: 8799
                length: 30
              - type: local_variable_declaration
                fields:
                  text: Node arg = left.getNext();
                children: []
                pos: 8834
                length: 26
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: verifyArgument(t, left, arg)
                        children: []
                        pos: 8869
                        length: 28
                    children: []
                    pos: 8868
                    length: 30
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: String ns = arg.getString();
                    children: []
                    pos: 8907
                    length: 28
                  - type: local_variable_declaration
                    fields:
                      text: ProvidedName provided = providedNames.get(ns);
                    children: []
                    pos: 8942
                    length: 46
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: or
                            fields:
                              left:
                                type: equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: provided
                                    children: []
                                    pos: 8999
                                    length: 8
                                  right:
                                    type: null_literal
                                    fields: {}
                                    children: []
                                    pos: 9011
                                    length: 4
                                children: []
                                pos: 8999
                                length: 16
                              right:
                                type: unary_expression
                                fields:
                                  text: "!provided.isExplicitlyProvided()"
                                children: []
                                pos: 9019
                                length: 32
                            children: []
                            pos: 8999
                            length: 52
                        children: []
                        pos: 8998
                        length: 54
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: expression_statement
                        fields:
                          text: |-
                            unrecognizedRequires.add(
                                        new UnrecognizedRequire(n, ns, t.getSourceName()));
                        children: []
                        pos: 9063
                        length: 89
                      pos: 9053
                      length: 107
                    pos: 8995
                    length: 719
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: or
                            fields:
                              left:
                                type: not_equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: provided
                                    children: []
                                    pos: 10083
                                    length: 8
                                  right:
                                    type: null_literal
                                    fields: {}
                                    children: []
                                    pos: 10095
                                    length: 4
                                children: []
                                pos: 10083
                                length: 16
                              right:
                                type: method_invocation
                                fields:
                                  text: requiresLevel.isOn()
                                children: []
                                pos: 10103
                                length: 20
                            children: []
                            pos: 10083
                            length: 40
                        children: []
                        pos: 10082
                        length: 42
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: expression_statement
                        fields:
                          text: parent.detachFromParent();
                        children: []
                        pos: 10135
                        length: 26
                      - type: expression_statement
                        fields:
                          text: compiler.reportCodeChange();
                        children: []
                        pos: 10170
                        length: 28
                      pos: 10125
                      length: 81
                    pos: 10079
                    length: 127
                  pos: 8899
                  length: 1313
                pos: 8865
                length: 1347
              pos: 8793
              length: 1423
          children: []
          pos: 8723
          length: 1493
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: processProvideCall
              children: []
              pos: 10279
              length: 18
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 10298
                length: 15
              pos: 10266
              length: 755
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: Node left = n.getFirstChild();
                children: []
                pos: 10342
                length: 30
              - type: local_variable_declaration
                fields:
                  text: Node arg = left.getNext();
                children: []
                pos: 10377
                length: 26
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: verifyProvide(t, left, arg)
                        children: []
                        pos: 10412
                        length: 27
                    children: []
                    pos: 10411
                    length: 29
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: String ns = arg.getString();
                    children: []
                    pos: 10449
                    length: 28
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: method_invocation
                            fields:
                              text: providedNames.containsKey(ns)
                            children: []
                            pos: 10488
                            length: 29
                        children: []
                        pos: 10487
                        length: 31
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: local_variable_declaration
                        fields:
                          text: ProvidedName previouslyProvided = providedNames.get(ns);
                        children: []
                        pos: 10529
                        length: 56
                      - type: if_statement
                        fields:
                          condition:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: unary_expression
                                fields:
                                  text: "!previouslyProvided.isExplicitlyProvided()"
                                children: []
                                pos: 10598
                                length: 42
                            children: []
                            pos: 10597
                            length: 44
                        children:
                        - type: block
                          fields: {}
                          children:
                          - type: expression_statement
                            fields:
                              text: previouslyProvided.addProvide(parent, t.getModule(),
                                true);
                            children: []
                            pos: 10654
                            length: 59
                          pos: 10642
                          length: 81
                        pos: 10594
                        length: 235
                      pos: 10519
                      length: 318
                    pos: 10484
                    length: 527
                  pos: 10441
                  length: 576
                pos: 10408
                length: 609
              pos: 10336
              length: 685
          children: []
          pos: 10266
          length: 755
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: handleCandidateProvideDefinition
              children: []
              pos: 11112
              length: 32
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 11152
                length: 15
              pos: 11099
              length: 742
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: t.inGlobalScope()
                        children: []
                        pos: 11200
                        length: 17
                    children: []
                    pos: 11199
                    length: 19
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: String name = null;
                    children: []
                    pos: 11227
                    length: 19
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: and
                            fields:
                              left:
                                type: equals
                                fields:
                                  left:
                                    type: method_invocation
                                    fields:
                                      text: n.getType()
                                    children: []
                                    pos: 11257
                                    length: 11
                                  right:
                                    type: field_access
                                    fields:
                                      text: Token.NAME
                                    children: []
                                    pos: 11272
                                    length: 10
                                children: []
                                pos: 11257
                                length: 25
                              right:
                                type: equals
                                fields:
                                  left:
                                    type: method_invocation
                                    fields:
                                      text: parent.getType()
                                    children: []
                                    pos: 11286
                                    length: 16
                                  right:
                                    type: field_access
                                    fields:
                                      text: Token.VAR
                                    children: []
                                    pos: 11306
                                    length: 9
                                children: []
                                pos: 11286
                                length: 29
                            children: []
                            pos: 11257
                            length: 58
                        children: []
                        pos: 11256
                        length: 60
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: expression_statement
                        fields:
                          text: name = n.getString();
                        children: []
                        pos: 11327
                        length: 21
                      pos: 11317
                      length: 39
                    pos: 11253
                    length: 255
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: not_equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: name
                                children: []
                                pos: 11520
                                length: 4
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 11528
                                length: 4
                            children: []
                            pos: 11520
                            length: 12
                        children: []
                        pos: 11519
                        length: 14
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: if_statement
                        fields:
                          condition:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: method_invocation
                                fields:
                                  text: parent.getBooleanProp(Node.IS_NAMESPACE)
                                children: []
                                pos: 11548
                                length: 40
                            children: []
                            pos: 11547
                            length: 42
                        children:
                        - type: block
                          fields: {}
                          children:
                          - type: expression_statement
                            fields:
                              text: processProvideFromPreviousPass(t, name, parent);
                            children: []
                            pos: 11602
                            length: 48
                          pos: 11590
                          length: 70
                        pos: 11544
                        length: 279
                      pos: 11534
                      length: 297
                    pos: 11516
                    length: 315
                  pos: 11219
                  length: 618
                pos: 11196
                length: 641
              pos: 11190
              length: 651
          children: []
          pos: 11099
          length: 742
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: processBaseClassCall
              children: []
              pos: 11906
              length: 20
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 11927
                length: 15
              pos: 11893
              length: 3597
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: Node callee = n.getFirstChild();
                children: []
                pos: 12823
                length: 32
              - type: local_variable_declaration
                fields:
                  text: Node thisArg = callee.getNext();
                children: []
                pos: 12860
                length: 32
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: or
                        fields:
                          left:
                            type: equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: thisArg
                                children: []
                                pos: 12901
                                length: 7
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 12912
                                length: 4
                            children: []
                            pos: 12901
                            length: 15
                          right:
                            type: not_equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: thisArg.getType()
                                children: []
                                pos: 12920
                                length: 17
                              right:
                                type: field_access
                                fields:
                                  text: Token.THIS
                                children: []
                                pos: 12941
                                length: 10
                            children: []
                            pos: 12920
                            length: 31
                        children: []
                        pos: 12901
                        length: 50
                    children: []
                    pos: 12900
                    length: 52
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: reportBadBaseClassUse(t, n, "First argument must be 'this'.");
                    children: []
                    pos: 12961
                    length: 62
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 13030
                    length: 7
                  pos: 12953
                  length: 90
                pos: 12897
                length: 146
              - type: local_variable_declaration
                fields:
                  text: Node enclosingFnNameNode = getEnclosingDeclNameNode(t);
                children: []
                pos: 13049
                length: 55
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: enclosingFnNameNode
                            children: []
                            pos: 13113
                            length: 19
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 13136
                            length: 4
                        children: []
                        pos: 13113
                        length: 27
                    children: []
                    pos: 13112
                    length: 29
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: reportBadBaseClassUse(t, n, "Could not find enclosing
                        method.");
                    children: []
                    pos: 13150
                    length: 64
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 13221
                    length: 7
                  pos: 13142
                  length: 92
                pos: 13109
                length: 125
              - type: local_variable_declaration
                fields:
                  text: String enclosingQname = enclosingFnNameNode.getQualifiedName();
                children: []
                pos: 13240
                length: 63
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: method_invocation
                            fields:
                              text: enclosingQname.indexOf(".prototype.")
                            children: []
                            pos: 13312
                            length: 37
                          right:
                            type: unary_expression
                            fields:
                              text: "-1"
                            children: []
                            pos: 13353
                            length: 2
                        children: []
                        pos: 13312
                        length: 43
                    children: []
                    pos: 13311
                    length: 45
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: Node enclosingParent = enclosingFnNameNode.getParent();
                    children: []
                    pos: 13395
                    length: 55
                  - type: local_variable_declaration
                    fields:
                      text: |-
                        Node maybeInheritsExpr = (enclosingParent.getType() == Token.ASSIGN ?
                                  enclosingParent.getParent() : enclosingParent).getNext();
                    children: []
                    pos: 13457
                    length: 137
                  - type: local_variable_declaration
                    fields:
                      text: Node baseClassNode = null;
                    children: []
                    pos: 13601
                    length: 26
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: and
                            fields:
                              left:
                                type: and
                                fields:
                                  left:
                                    type: not_equals
                                    fields:
                                      left:
                                        type: identifier
                                        fields:
                                          text: maybeInheritsExpr
                                        children: []
                                        pos: 13638
                                        length: 17
                                      right:
                                        type: null_literal
                                        fields: {}
                                        children: []
                                        pos: 13659
                                        length: 4
                                    children: []
                                    pos: 13638
                                    length: 25
                                  right:
                                    type: equals
                                    fields:
                                      left:
                                        type: method_invocation
                                        fields:
                                          text: maybeInheritsExpr.getType()
                                        children: []
                                        pos: 13677
                                        length: 27
                                      right:
                                        type: field_access
                                        fields:
                                          text: Token.EXPR_RESULT
                                        children: []
                                        pos: 13708
                                        length: 17
                                    children: []
                                    pos: 13677
                                    length: 48
                                children: []
                                pos: 13638
                                length: 87
                              right:
                                type: equals
                                fields:
                                  left:
                                    type: method_invocation
                                    fields:
                                      text: maybeInheritsExpr.getFirstChild().getType()
                                    children: []
                                    pos: 13739
                                    length: 43
                                  right:
                                    type: field_access
                                    fields:
                                      text: Token.CALL
                                    children: []
                                    pos: 13786
                                    length: 10
                                children: []
                                pos: 13739
                                length: 57
                            children: []
                            pos: 13638
                            length: 158
                        children: []
                        pos: 13637
                        length: 160
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: local_variable_declaration
                        fields:
                          text: Node callNode = maybeInheritsExpr.getFirstChild();
                        children: []
                        pos: 13808
                        length: 50
                      - type: if_statement
                        fields:
                          condition:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: and
                                fields:
                                  left:
                                    type: method_invocation
                                    fields:
                                      text: |-
                                        "goog.inherits".equals(
                                                        callNode.getFirstChild().getQualifiedName())
                                    children: []
                                    pos: 13871
                                    length: 84
                                  right:
                                    type: method_invocation
                                    fields:
                                      text: callNode.getLastChild().isQualifiedName()
                                    children: []
                                    pos: 13971
                                    length: 41
                                children: []
                                pos: 13871
                                length: 141
                            children: []
                            pos: 13870
                            length: 143
                        children:
                        - type: block
                          fields: {}
                          children:
                          - type: expression_statement
                            fields:
                              text: baseClassNode = callNode.getLastChild();
                            children: []
                            pos: 14026
                            length: 40
                          pos: 14014
                          length: 62
                        pos: 13867
                        length: 209
                      pos: 13798
                      length: 286
                    pos: 13634
                    length: 450
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: baseClassNode
                                children: []
                                pos: 14096
                                length: 13
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 14113
                                length: 4
                            children: []
                            pos: 14096
                            length: 21
                        children: []
                        pos: 14095
                        length: 23
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: expression_statement
                        fields:
                          text: |-
                            reportBadBaseClassUse(
                                        t, n, "Could not find goog.inherits for base class");
                        children: []
                        pos: 14129
                        length: 88
                      - type: return_statement
                        fields:
                          text: return;
                        children: []
                        pos: 14226
                        length: 7
                      pos: 14119
                      length: 122
                    pos: 14092
                    length: 149
                  - type: expression_statement
                    fields:
                      text: |-
                        n.replaceChild(
                                  callee,
                                  NodeUtil.newQualifiedNameNode(
                                    String.format("%s.call", baseClassNode.getQualifiedName()),
                                    callee, "goog.base"));
                    children: []
                    pos: 14276
                    length: 181
                  - type: expression_statement
                    fields:
                      text: compiler.reportCodeChange();
                    children: []
                    pos: 14464
                    length: 28
                  pos: 13357
                  length: 1141
                pos: 13308
                length: 2178
              pos: 11952
              length: 3538
          children: []
          pos: 11893
          length: 3597
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getEnclosingDeclNameNode
              children: []
              pos: 15630
              length: 24
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 15655
                length: 15
              pos: 15617
              length: 697
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: Node scopeRoot = t.getScopeRoot();
                children: []
                pos: 15678
                length: 34
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: NodeUtil.isFunctionDeclaration(scopeRoot)
                        children: []
                        pos: 15721
                        length: 41
                    children: []
                    pos: 15720
                    length: 43
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return scopeRoot.getFirstChild();
                    children: []
                    pos: 15800
                    length: 33
                  pos: 15764
                  length: 75
                pos: 15717
                length: 575
              - type: return_statement
                fields:
                  text: return null;
                children: []
                pos: 16298
                length: 12
              pos: 15672
              length: 642
          children: []
          pos: 15617
          length: 697
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: reportBadBaseClassUse
              children: []
              pos: 16390
              length: 21
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 16419
                length: 15
              pos: 16377
              length: 162
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: compiler.report(t.makeError(n, BASE_CLASS_ERROR, extraMessage));
                children: []
                pos: 16471
                length: 64
              pos: 16465
              length: 74
          children: []
          pos: 16377
          length: 162
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: processProvideFromPreviousPass
              children: []
              pos: 16755
              length: 30
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 16793
                length: 15
              pos: 16742
              length: 993
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: unary_expression
                        fields:
                          text: "!providedNames.containsKey(name)"
                        children: []
                        pos: 16846
                        length: 32
                    children: []
                    pos: 16845
                    length: 34
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: Node expr = new Node(Token.EXPR_RESULT);
                    children: []
                    pos: 17033
                    length: 40
                  - type: expression_statement
                    fields:
                      text: expr.copyInformationFromForTree(parent);
                    children: []
                    pos: 17080
                    length: 40
                  - type: expression_statement
                    fields:
                      text: parent.getParent().addChildBefore(expr, parent);
                    children: []
                    pos: 17127
                    length: 48
                  - type: expression_statement
                    fields:
                      text: compiler.reportCodeChange();
                    children: []
                    pos: 17182
                    length: 28
                  - type: local_variable_declaration
                    fields:
                      text: JSModule module = t.getModule();
                    children: []
                    pos: 17218
                    length: 32
                  - type: expression_statement
                    fields:
                      text: registerAnyProvidedPrefixes(name, expr, module);
                    children: []
                    pos: 17257
                    length: 48
                  - type: local_variable_declaration
                    fields:
                      text: ProvidedName provided = new ProvidedName(name, expr, module,
                        true);
                    children: []
                    pos: 17313
                    length: 67
                  - type: expression_statement
                    fields:
                      text: providedNames.put(name, provided);
                    children: []
                    pos: 17387
                    length: 34
                  - type: expression_statement
                    fields:
                      text: provided.addDefinition(parent, module);
                    children: []
                    pos: 17428
                    length: 39
                  pos: 16880
                  length: 593
                pos: 16842
                length: 889
              pos: 16836
              length: 899
          children: []
          pos: 16742
          length: 993
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: processSetCssNameMapping
              children: []
              pos: 18086
              length: 24
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 18111
                length: 15
              pos: 18073
              length: 1560
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: Node left = n.getFirstChild();
                children: []
                pos: 18155
                length: 30
              - type: local_variable_declaration
                fields:
                  text: Node arg = left.getNext();
                children: []
                pos: 18190
                length: 26
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: verifyArgument(t, left, arg, Token.OBJECTLIT)
                        children: []
                        pos: 18225
                        length: 45
                    children: []
                    pos: 18224
                    length: 47
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: final Map<String, String> cssNames = Maps.newHashMap();
                    children: []
                    pos: 18405
                    length: 55
                  - type: local_variable_declaration
                    fields:
                      text: JSError error = null;
                    children: []
                    pos: 18467
                    length: 21
                  - type: for_statement
                    fields:
                      text: |-
                        for (Node key = arg.getFirstChild(); key != null;
                                  key = key.getNext().getNext()) {
                                Node value = key.getNext();
                                if (key.getType() != Token.STRING
                                    || value == null
                                    || value.getType() != Token.STRING) {
                                  error = t.makeError(n,
                                      NON_STRING_PASSED_TO_SET_CSS_NAME_MAPPING_ERROR);
                                }
                                if (error != null) {
                                  compiler.report(error);
                                  break;
                                }
                                cssNames.put(key.getString(), value.getString());
                              }
                    children: []
                    pos: 18495
                    length: 512
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: error
                                children: []
                                pos: 19180
                                length: 5
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 19189
                                length: 4
                            children: []
                            pos: 19180
                            length: 13
                        children: []
                        pos: 19179
                        length: 15
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: local_variable_declaration
                        fields:
                          text: |-
                            CssRenamingMap cssRenamingMap = new CssRenamingMap() {
                                      public String get(String value) {
                                        if (cssNames.containsKey(value)) {
                                          return cssNames.get(value);
                                        } else {
                                          return value;
                                        }
                                      }
                                    };
                        children: []
                        pos: 19205
                        length: 273
                      - type: expression_statement
                        fields:
                          text: compiler.setCssRenamingMap(cssRenamingMap);
                        children: []
                        pos: 19487
                        length: 43
                      - type: expression_statement
                        fields:
                          text: parent.getParent().removeChild(parent);
                        children: []
                        pos: 19539
                        length: 39
                      - type: expression_statement
                        fields:
                          text: compiler.reportCodeChange();
                        children: []
                        pos: 19587
                        length: 28
                      pos: 19195
                      length: 428
                    pos: 19176
                    length: 447
                  pos: 18272
                  length: 1357
                pos: 18221
                length: 1408
              pos: 18149
              length: 1484
          children: []
          pos: 18073
          length: 1560
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: trySimplifyNewDate
              children: []
              pos: 19723
              length: 18
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 19742
                length: 15
              pos: 19710
              length: 769
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: unary_expression
                        fields:
                          text: "!rewriteNewDateGoogNow"
                        children: []
                        pos: 19790
                        length: 22
                    children: []
                    pos: 19789
                    length: 24
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 19822
                    length: 7
                  pos: 19814
                  length: 21
                pos: 19786
                length: 49
              - type: expression_statement
                fields:
                  text: Preconditions.checkArgument(n.getType() == Token.NEW);
                children: []
                pos: 19840
                length: 54
              - type: local_variable_declaration
                fields:
                  text: Node date = n.getFirstChild();
                children: []
                pos: 19899
                length: 30
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: or
                        fields:
                          left:
                            type: unary_expression
                            fields:
                              text: "!NodeUtil.isName(date)"
                            children: []
                            pos: 19938
                            length: 22
                          right:
                            type: unary_expression
                            fields:
                              text: '!"Date".equals(date.getString())'
                            children: []
                            pos: 19964
                            length: 32
                        children: []
                        pos: 19938
                        length: 58
                    children: []
                    pos: 19937
                    length: 60
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 20006
                    length: 7
                  pos: 19998
                  length: 21
                pos: 19934
                length: 85
              - type: local_variable_declaration
                fields:
                  text: Node callGoogNow = date.getNext();
                children: []
                pos: 20024
                length: 34
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: or
                        fields:
                          left:
                            type: or
                            fields:
                              left:
                                type: equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: callGoogNow
                                    children: []
                                    pos: 20067
                                    length: 11
                                  right:
                                    type: null_literal
                                    fields: {}
                                    children: []
                                    pos: 20082
                                    length: 4
                                children: []
                                pos: 20067
                                length: 19
                              right:
                                type: unary_expression
                                fields:
                                  text: "!NodeUtil.isCall(callGoogNow)"
                                children: []
                                pos: 20090
                                length: 29
                            children: []
                            pos: 20067
                            length: 52
                          right:
                            type: not_equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: callGoogNow.getNext()
                                children: []
                                pos: 20131
                                length: 21
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 20156
                                length: 4
                            children: []
                            pos: 20131
                            length: 29
                        children: []
                        pos: 20067
                        length: 93
                    children: []
                    pos: 20066
                    length: 95
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 20170
                    length: 7
                  pos: 20162
                  length: 21
                pos: 20063
                length: 120
              - type: local_variable_declaration
                fields:
                  text: Node googNow = callGoogNow.getFirstChild();
                children: []
                pos: 20188
                length: 43
              - type: local_variable_declaration
                fields:
                  text: String googNowQName = googNow.getQualifiedName();
                children: []
                pos: 20236
                length: 49
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: or
                        fields:
                          left:
                            type: or
                            fields:
                              left:
                                type: equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: googNowQName
                                    children: []
                                    pos: 20294
                                    length: 12
                                  right:
                                    type: null_literal
                                    fields: {}
                                    children: []
                                    pos: 20310
                                    length: 4
                                children: []
                                pos: 20294
                                length: 20
                              right:
                                type: unary_expression
                                fields:
                                  text: '!"goog.now".equals(googNowQName)'
                                children: []
                                pos: 20318
                                length: 32
                            children: []
                            pos: 20294
                            length: 56
                          right:
                            type: not_equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: googNow.getNext()
                                children: []
                                pos: 20362
                                length: 17
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 20383
                                length: 4
                            children: []
                            pos: 20362
                            length: 25
                        children: []
                        pos: 20294
                        length: 93
                    children: []
                    pos: 20293
                    length: 95
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 20397
                    length: 7
                  pos: 20389
                  length: 21
                pos: 20290
                length: 120
              - type: expression_statement
                fields:
                  text: n.removeChild(callGoogNow);
                children: []
                pos: 20415
                length: 27
              - type: expression_statement
                fields:
                  text: compiler.reportCodeChange();
                children: []
                pos: 20447
                length: 28
              pos: 19780
              length: 699
          children: []
          pos: 19710
          length: 769
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: verifyProvide
              children: []
              pos: 20771
              length: 13
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 20785
                length: 15
              pos: 20755
              length: 382
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: unary_expression
                        fields:
                          text: "!verifyArgument(t, methodName, arg)"
                        children: []
                        pos: 20839
                        length: 35
                    children: []
                    pos: 20838
                    length: 37
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return false;
                    children: []
                    pos: 20884
                    length: 13
                  pos: 20876
                  length: 27
                pos: 20835
                length: 68
              - type: enhanced_for_statement
                fields:
                  text: |-
                    for (String part : arg.getString().split("\\.")) {
                          if (!NodeUtil.isValidPropertyName(part)) {
                            compiler.report(t.makeError(arg, INVALID_PROVIDE_ERROR, part));
                            return false;
                          }
                        }
                children: []
                pos: 20909
                length: 207
              - type: return_statement
                fields:
                  text: return true;
                children: []
                pos: 21121
                length: 12
              pos: 20829
              length: 308
          children: []
          pos: 20755
          length: 382
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: verifyArgument
              children: []
              pos: 21360
              length: 14
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 21375
                length: 15
              pos: 21344
              length: 141
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return verifyArgument(t, methodName, arg, Token.STRING);
                children: []
                pos: 21425
                length: 56
              pos: 21419
              length: 66
          children: []
          pos: 21344
          length: 141
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: verifyArgument
              children: []
              pos: 21712
              length: 14
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 21727
                length: 15
              pos: 21696
              length: 574
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: DiagnosticType diagnostic = null;
                children: []
                pos: 21800
                length: 33
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: arg
                            children: []
                            pos: 21842
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 21849
                            length: 4
                        children: []
                        pos: 21842
                        length: 11
                    children: []
                    pos: 21841
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: diagnostic = NULL_ARGUMENT_ERROR;
                    children: []
                    pos: 21863
                    length: 33
                  pos: 21855
                  length: 47
                pos: 21838
                length: 239
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: diagnostic
                            children: []
                            pos: 22086
                            length: 10
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 22100
                            length: 4
                        children: []
                        pos: 22086
                        length: 18
                    children: []
                    pos: 22085
                    length: 20
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: |-
                        compiler.report(
                                  t.makeError(methodName,
                                      diagnostic, methodName.getQualifiedName()));
                    children: []
                    pos: 22114
                    length: 109
                  - type: return_statement
                    fields:
                      text: return false;
                    children: []
                    pos: 22230
                    length: 13
                  pos: 22106
                  length: 143
                pos: 22082
                length: 167
              - type: return_statement
                fields:
                  text: return true;
                children: []
                pos: 22254
                length: 12
              pos: 21794
              length: 476
          children: []
          pos: 21696
          length: 574
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: registerAnyProvidedPrefixes
              children: []
              pos: 22634
              length: 27
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String ns
                children: []
                pos: 22669
                length: 9
              pos: 22621
              length: 532
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: int pos = ns.indexOf('.');
                children: []
                pos: 22714
                length: 26
              - type: while_statement
                fields:
                  text: |-
                    while (pos != -1) {
                          String prefixNs = ns.substring(0, pos);
                          pos = ns.indexOf('.', pos + 1);
                          if (providedNames.containsKey(prefixNs)) {
                            providedNames.get(prefixNs).addProvide(
                                node, module, false /* implicit */);
                          } else {
                            providedNames.put(
                                prefixNs,
                                new ProvidedName(prefixNs, node, module, false /* implicit */));
                          }
                        }
                children: []
                pos: 22745
                length: 404
              pos: 22708
              length: 445
          children: []
          pos: 22621
          length: 532
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: ProvidedName
              children: []
              pos: 23344
              length: 12
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: private final String namespace;
                children: []
                pos: 23363
                length: 31
              - type: field_declaration
                fields:
                  text: private final Node firstNode;
                children: []
                pos: 23493
                length: 29
              - type: field_declaration
                fields:
                  text: private final JSModule firstModule;
                children: []
                pos: 23527
                length: 35
              - type: field_declaration
                fields:
                  text: private Node explicitNode = null;
                children: []
                pos: 23696
                length: 33
              - type: field_declaration
                fields:
                  text: private JSModule explicitModule = null;
                children: []
                pos: 23734
                length: 39
              - type: field_declaration
                fields:
                  text: private Node candidateDefinition = null;
                children: []
                pos: 23812
                length: 40
              - type: field_declaration
                fields:
                  text: private JSModule minimumModule = null;
                children: []
                pos: 23915
                length: 38
              - type: field_declaration
                fields:
                  text: private Node replacementNode = null;
                children: []
                pos: 23995
                length: 36
              - type: constructor_declaration
                fields:
                  text: |-
                    ProvidedName(String namespace, Node node, JSModule module,
                            boolean explicit) {
                          Preconditions.checkArgument(
                              node == null /* The base case */ ||
                              NodeUtil.isExpressionNode(node));
                          this.namespace = namespace;
                          this.firstNode = node;
                          this.firstModule = module;

                          addProvide(node, module, explicit);
                        }
                children: []
                pos: 24037
                length: 356
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: addProvide
                    children: []
                    pos: 24464
                    length: 10
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node node
                      children: []
                      pos: 24475
                      length: 9
                    pos: 24459
                    length: 322
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: identifier
                              fields:
                                text: explicit
                              children: []
                              pos: 24533
                              length: 8
                          children: []
                          pos: 24532
                          length: 10
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: expression_statement
                          fields:
                            text: Preconditions.checkState(explicitNode == null);
                          children: []
                          pos: 24553
                          length: 47
                        - type: expression_statement
                          fields:
                            text: Preconditions.checkArgument(NodeUtil.isExpressionNode(node));
                          children: []
                          pos: 24609
                          length: 61
                        - type: expression_statement
                          fields:
                            text: explicitNode = node;
                          children: []
                          pos: 24679
                          length: 20
                        - type: expression_statement
                          fields:
                            text: explicitModule = module;
                          children: []
                          pos: 24708
                          length: 24
                        pos: 24543
                        length: 197
                      pos: 24529
                      length: 211
                    - type: expression_statement
                      fields:
                        text: updateMinimumModule(module);
                      children: []
                      pos: 24747
                      length: 28
                    pos: 24521
                    length: 260
                children: []
                pos: 24459
                length: 322
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: isExplicitlyProvided
                    children: []
                    pos: 24795
                    length: 20
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 24787
                    length: 73
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return explicitNode != null;
                      children: []
                      pos: 24826
                      length: 28
                    pos: 24818
                    length: 42
                children: []
                pos: 24787
                length: 73
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: addDefinition
                    children: []
                    pos: 25151
                    length: 13
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node node
                      children: []
                      pos: 25165
                      length: 9
                    pos: 25146
                    length: 470
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: expression_statement
                      fields:
                        text: |-
                          Preconditions.checkArgument(NodeUtil.isExpressionNode(node) || // assign
                                                            NodeUtil.isFunction(node) ||
                                                            NodeUtil.isVar(node));
                      children: []
                      pos: 25201
                      length: 192
                    - type: expression_statement
                      fields:
                        text: Preconditions.checkArgument(explicitNode != node);
                      children: []
                      pos: 25400
                      length: 50
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: or
                              fields:
                                left:
                                  type: parenthesized_expression
                                  fields:
                                    expression:
                                      type: equals
                                      fields:
                                        left:
                                          type: identifier
                                          fields:
                                            text: candidateDefinition
                                          children: []
                                          pos: 25462
                                          length: 19
                                        right:
                                          type: null_literal
                                          fields: {}
                                          children: []
                                          pos: 25485
                                          length: 4
                                      children: []
                                      pos: 25462
                                      length: 27
                                  children: []
                                  pos: 25461
                                  length: 29
                                right:
                                  type: unary_expression
                                  fields:
                                    text: "!NodeUtil.isExpressionNode(node)"
                                  children: []
                                  pos: 25494
                                  length: 32
                              children: []
                              pos: 25461
                              length: 65
                          children: []
                          pos: 25460
                          length: 67
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: expression_statement
                          fields:
                            text: candidateDefinition = node;
                          children: []
                          pos: 25538
                          length: 27
                        - type: expression_statement
                          fields:
                            text: updateMinimumModule(module);
                          children: []
                          pos: 25574
                          length: 28
                        pos: 25528
                        length: 82
                      pos: 25457
                      length: 153
                    pos: 25193
                    length: 423
                children: []
                pos: 25146
                length: 470
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: updateMinimumModule
                    children: []
                    pos: 25635
                    length: 19
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: JSModule newModule
                      children: []
                      pos: 25655
                      length: 18
                    pos: 25622
                    length: 529
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: equals
                              fields:
                                left:
                                  type: identifier
                                  fields:
                                    text: minimumModule
                                  children: []
                                  pos: 25687
                                  length: 13
                                right:
                                  type: null_literal
                                  fields: {}
                                  children: []
                                  pos: 25704
                                  length: 4
                              children: []
                              pos: 25687
                              length: 21
                          children: []
                          pos: 25686
                          length: 23
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: expression_statement
                          fields:
                            text: minimumModule = newModule;
                          children: []
                          pos: 25720
                          length: 26
                        pos: 25710
                        length: 44
                      pos: 25683
                      length: 462
                    pos: 25675
                    length: 476
                children: []
                pos: 25622
                length: 529
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: replace
                    children: []
                    pos: 26416
                    length: 7
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 26411
                    length: 2695
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: equals
                              fields:
                                left:
                                  type: identifier
                                  fields:
                                    text: firstNode
                                  children: []
                                  pos: 26438
                                  length: 9
                                right:
                                  type: null_literal
                                  fields: {}
                                  children: []
                                  pos: 26451
                                  length: 4
                              children: []
                              pos: 26438
                              length: 17
                          children: []
                          pos: 26437
                          length: 19
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: expression_statement
                          fields:
                            text: replacementNode = candidateDefinition;
                          children: []
                          pos: 26514
                          length: 38
                        - type: return_statement
                          fields:
                            text: return;
                          children: []
                          pos: 26561
                          length: 7
                        pos: 26457
                        length: 119
                      pos: 26434
                      length: 142
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: and
                              fields:
                                left:
                                  type: not_equals
                                  fields:
                                    left:
                                      type: identifier
                                      fields:
                                        text: candidateDefinition
                                      children: []
                                      pos: 26695
                                      length: 19
                                    right:
                                      type: null_literal
                                      fields: {}
                                      children: []
                                      pos: 26718
                                      length: 4
                                  children: []
                                  pos: 26695
                                  length: 27
                                right:
                                  type: not_equals
                                  fields:
                                    left:
                                      type: identifier
                                      fields:
                                        text: explicitNode
                                      children: []
                                      pos: 26726
                                      length: 12
                                    right:
                                      type: null_literal
                                      fields: {}
                                      children: []
                                      pos: 26742
                                      length: 4
                                  children: []
                                  pos: 26726
                                  length: 20
                              children: []
                              pos: 26695
                              length: 51
                          children: []
                          pos: 26694
                          length: 53
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: expression_statement
                          fields:
                            text: explicitNode.detachFromParent();
                          children: []
                          pos: 26758
                          length: 32
                        - type: expression_statement
                          fields:
                            text: compiler.reportCodeChange();
                          children: []
                          pos: 26799
                          length: 28
                        - type: expression_statement
                          fields:
                            text: replacementNode = candidateDefinition;
                          children: []
                          pos: 26878
                          length: 38
                        - type: if_statement
                          fields:
                            condition:
                              type: parenthesized_expression
                              fields:
                                expression:
                                  type: method_invocation
                                  fields:
                                    text: NodeUtil.isExpressionNode(candidateDefinition)
                                  children: []
                                  pos: 26929
                                  length: 46
                              children: []
                              pos: 26928
                              length: 48
                          children:
                          - type: block
                            fields: {}
                            children:
                            - type: expression_statement
                              fields:
                                text: candidateDefinition.putBooleanProp(Node.IS_NAMESPACE,
                                  true);
                              children: []
                              pos: 26989
                              length: 60
                            - type: local_variable_declaration
                              fields:
                                text: Node assignNode = candidateDefinition.getFirstChild();
                              children: []
                              pos: 27060
                              length: 54
                            - type: local_variable_declaration
                              fields:
                                text: Node nameNode = assignNode.getFirstChild();
                              children: []
                              pos: 27125
                              length: 43
                            - type: if_statement
                              fields:
                                condition:
                                  type: parenthesized_expression
                                  fields:
                                    expression:
                                      type: equals
                                      fields:
                                        left:
                                          type: method_invocation
                                          fields:
                                            text: nameNode.getType()
                                          children: []
                                          pos: 27183
                                          length: 18
                                        right:
                                          type: field_access
                                          fields:
                                            text: Token.NAME
                                          children: []
                                          pos: 27205
                                          length: 10
                                      children: []
                                      pos: 27183
                                      length: 32
                                  children: []
                                  pos: 27182
                                  length: 34
                              children:
                              - type: block
                                fields: {}
                                children:
                                - type: local_variable_declaration
                                  fields:
                                    text: Node valueNode = nameNode.getNext();
                                  children: []
                                  pos: 27296
                                  length: 36
                                - type: expression_statement
                                  fields:
                                    text: assignNode.removeChild(nameNode);
                                  children: []
                                  pos: 27345
                                  length: 33
                                - type: expression_statement
                                  fields:
                                    text: assignNode.removeChild(valueNode);
                                  children: []
                                  pos: 27391
                                  length: 34
                                - type: expression_statement
                                  fields:
                                    text: nameNode.addChildToFront(valueNode);
                                  children: []
                                  pos: 27438
                                  length: 36
                                - type: local_variable_declaration
                                  fields:
                                    text: Node varNode = new Node(Token.VAR, nameNode);
                                  children: []
                                  pos: 27487
                                  length: 45
                                - type: expression_statement
                                  fields:
                                    text: varNode.copyInformationFrom(candidateDefinition);
                                  children: []
                                  pos: 27545
                                  length: 49
                                - type: expression_statement
                                  fields:
                                    text: |-
                                      candidateDefinition.getParent().replaceChild(
                                                      candidateDefinition, varNode);
                                  children: []
                                  pos: 27607
                                  length: 92
                                - type: expression_statement
                                  fields:
                                    text: nameNode.setJSDocInfo(assignNode.getJSDocInfo());
                                  children: []
                                  pos: 27712
                                  length: 49
                                - type: expression_statement
                                  fields:
                                    text: compiler.reportCodeChange();
                                  children: []
                                  pos: 27774
                                  length: 28
                                - type: expression_statement
                                  fields:
                                    text: replacementNode = varNode;
                                  children: []
                                  pos: 27815
                                  length: 26
                                pos: 27217
                                length: 636
                              pos: 27179
                              length: 674
                            pos: 26977
                            length: 886
                          pos: 26925
                          length: 938
                        pos: 26748
                        length: 1123
                      pos: 26691
                      length: 2409
                    pos: 26426
                    length: 2680
                children: []
                pos: 26411
                length: 2695
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: createDeclarationNode
                    children: []
                    pos: 29233
                    length: 21
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 29220
                    length: 224
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: equals
                              fields:
                                left:
                                  type: method_invocation
                                  fields:
                                    text: namespace.indexOf('.')
                                  children: []
                                  pos: 29269
                                  length: 22
                                right:
                                  type: unary_expression
                                  fields:
                                    text: "-1"
                                  children: []
                                  pos: 29295
                                  length: 2
                              children: []
                              pos: 29269
                              length: 28
                          children: []
                          pos: 29268
                          length: 30
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return makeVarDeclNode(namespace, firstNode);
                          children: []
                          pos: 29309
                          length: 45
                        pos: 29299
                        length: 63
                      pos: 29265
                      length: 173
                    pos: 29257
                    length: 187
                children: []
                pos: 29220
                length: 224
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: makeVarDeclNode
                    children: []
                    pos: 29724
                    length: 15
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: String namespace
                      children: []
                      pos: 29740
                      length: 16
                    pos: 29711
                    length: 609
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: Node name = Node.newString(Token.NAME, namespace);
                      children: []
                      pos: 29783
                      length: 50
                    - type: expression_statement
                      fields:
                        text: name.addChildToFront(createNamespaceLiteral());
                      children: []
                      pos: 29840
                      length: 47
                    - type: local_variable_declaration
                      fields:
                        text: Node decl = new Node(Token.VAR, name);
                      children: []
                      pos: 29895
                      length: 38
                    - type: expression_statement
                      fields:
                        text: decl.putBooleanProp(Node.IS_NAMESPACE, true);
                      children: []
                      pos: 29940
                      length: 45
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: method_invocation
                              fields:
                                text: compiler.getCodingConvention().isConstant(namespace)
                              children: []
                              pos: 30060
                              length: 52
                          children: []
                          pos: 30059
                          length: 54
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: expression_statement
                          fields:
                            text: name.putBooleanProp(Node.IS_CONSTANT_NAME, true);
                          children: []
                          pos: 30124
                          length: 49
                        pos: 30114
                        length: 67
                      pos: 30056
                      length: 125
                    - type: expression_statement
                      fields:
                        text: Preconditions.checkState(isNamespacePlaceholder(decl));
                      children: []
                      pos: 30189
                      length: 55
                    - type: expression_statement
                      fields:
                        text: decl.copyInformationFromForTree(sourceNode);
                      children: []
                      pos: 30251
                      length: 44
                    - type: return_statement
                      fields:
                        text: return decl;
                      children: []
                      pos: 30302
                      length: 12
                    pos: 29775
                    length: 545
                children: []
                pos: 29711
                length: 609
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: createNamespaceLiteral
                    children: []
                    pos: 30534
                    length: 22
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 30521
                    length: 204
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: Node objlit = new Node(Token.OBJECTLIT);
                      children: []
                      pos: 30567
                      length: 40
                    - type: expression_statement
                      fields:
                        text: |-
                          objlit.setJSType(
                                    compiler.getTypeRegistry().createAnonymousObjectType());
                      children: []
                      pos: 30614
                      length: 84
                    - type: return_statement
                      fields:
                        text: return objlit;
                      children: []
                      pos: 30705
                      length: 14
                    pos: 30559
                    length: 166
                children: []
                pos: 30521
                length: 204
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: makeAssignmentExprNode
                    children: []
                    pos: 30966
                    length: 22
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: String namespace
                      children: []
                      pos: 30989
                      length: 16
                    pos: 30953
                    length: 444
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: |-
                          Node decl = new Node(Token.EXPR_RESULT,
                                    new Node(Token.ASSIGN,
                                        NodeUtil.newQualifiedNameNode(namespace, node, namespace),
                                        createNamespaceLiteral()));
                      children: []
                      pos: 31026
                      length: 187
                    - type: expression_statement
                      fields:
                        text: decl.putBooleanProp(Node.IS_NAMESPACE, true);
                      children: []
                      pos: 31220
                      length: 45
                    - type: expression_statement
                      fields:
                        text: Preconditions.checkState(isNamespacePlaceholder(decl));
                      children: []
                      pos: 31272
                      length: 55
                    - type: expression_statement
                      fields:
                        text: decl.copyInformationFromForTree(node);
                      children: []
                      pos: 31334
                      length: 38
                    - type: return_statement
                      fields:
                        text: return decl;
                      children: []
                      pos: 31379
                      length: 12
                    pos: 31018
                    length: 379
                children: []
                pos: 30953
                length: 444
              pos: 23330
              length: 8071
          children: []
          pos: 23330
          length: 8071
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: isNamespacePlaceholder
              children: []
              pos: 31496
              length: 22
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Node n
                children: []
                pos: 31519
                length: 6
              pos: 31473
              length: 500
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: unary_expression
                        fields:
                          text: "!n.getBooleanProp(Node.IS_NAMESPACE)"
                        children: []
                        pos: 31537
                        length: 36
                    children: []
                    pos: 31536
                    length: 38
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return false;
                    children: []
                    pos: 31583
                    length: 13
                  pos: 31575
                  length: 27
                pos: 31533
                length: 69
              - type: local_variable_declaration
                fields:
                  text: Node value = null;
                children: []
                pos: 31608
                length: 18
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: method_invocation
                            fields:
                              text: n.getType()
                            children: []
                            pos: 31635
                            length: 11
                          right:
                            type: field_access
                            fields:
                              text: Token.EXPR_RESULT
                            children: []
                            pos: 31650
                            length: 17
                        children: []
                        pos: 31635
                        length: 32
                    children: []
                    pos: 31634
                    length: 34
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: Node assign = n.getFirstChild();
                    children: []
                    pos: 31677
                    length: 32
                  - type: expression_statement
                    fields:
                      text: value = assign.getLastChild();
                    children: []
                    pos: 31716
                    length: 30
                  pos: 31669
                  length: 83
                pos: 31631
                length: 237
              - type: return_statement
                fields:
                  text: |-
                    return value != null
                          && value.getType() == Token.OBJECTLIT
                          && !value.hasChildren();
                children: []
                pos: 31874
                length: 95
              pos: 31527
              length: 446
          children: []
          pos: 31473
          length: 500
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: UnrecognizedRequire
              children: []
              pos: 32160
              length: 19
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: final Node requireNode;
                children: []
                pos: 32186
                length: 23
              - type: field_declaration
                fields:
                  text: final String namespace;
                children: []
                pos: 32214
                length: 23
              - type: field_declaration
                fields:
                  text: final String inputName;
                children: []
                pos: 32242
                length: 23
              - type: constructor_declaration
                fields:
                  text: |-
                    UnrecognizedRequire(Node requireNode, String namespace, String inputName) {
                          this.requireNode = requireNode;
                          this.namespace = namespace;
                          this.inputName = inputName;
                        }
                children: []
                pos: 32271
                length: 187
              pos: 32146
              length: 316
          children: []
          pos: 32146
          length: 316
        pos: 1207
        length: 31257
    children: []
    pos: 1207
    length: 31257
  pos: 0
  length: 32465
text_diff: |
  --- before
  +++ after
  @@ -786,7 +786,7 @@
           } else {
             // In this case, the name was implicitly provided by two independent
             // modules. We need to move this code up to a common module.
  -          int indexOfDot = namespace.lastIndexOf('.');
  +          int indexOfDot = namespace.indexOf('.');
             if (indexOfDot == -1) {
               // Any old place is fine.
               compiler.getNodeForCodeInsertion(minimumModule)
tree_diff: ''
