---
language: java
before_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: StringUtil
        children: []
        pos: 269
        length: 10
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: |-
              static final String[] padding = {"", " ", "  ", "   ", "    ", "     ", "      ", "       ", "        ",
                      "         ", "          ", "           ", "            ", "             ", "              ", "               ",
                      "                ", "                 ", "                  ", "                   ", "                    "};
          children: []
          pos: 319
          length: 343
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: join
              children: []
              pos: 886
              length: 4
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Collection strings
                children: []
                pos: 891
                length: 18
              pos: 865
              length: 111
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return join(strings.iterator(), sep);
                children: []
                pos: 933
                length: 37
              pos: 923
              length: 53
          children: []
          pos: 865
          length: 111
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: join
              children: []
              pos: 1198
              length: 4
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Iterator strings
                children: []
                pos: 1203
                length: 16
              pos: 1177
              length: 462
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: unary_expression
                        fields:
                          text: "!strings.hasNext()"
                        children: []
                        pos: 1247
                        length: 18
                    children: []
                    pos: 1246
                    length: 20
                children:
                - type: return_statement
                  fields:
                    text: return "";
                  children: []
                  pos: 1279
                  length: 10
                pos: 1243
                length: 46
              - type: local_variable_declaration
                fields:
                  text: String start = strings.next().toString();
                children: []
                pos: 1299
                length: 41
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: unary_expression
                        fields:
                          text: "!strings.hasNext()"
                        children: []
                        pos: 1353
                        length: 18
                    children: []
                    pos: 1352
                    length: 20
                children:
                - type: return_statement
                  fields:
                    text: return start;
                  children: []
                  pos: 1412
                  length: 13
                pos: 1349
                length: 76
              - type: local_variable_declaration
                fields:
                  text: StringBuilder sb = new StringBuilder(64).append(start);
                children: []
                pos: 1435
                length: 55
              - type: while_statement
                fields:
                  text: |-
                    while (strings.hasNext()) {
                                sb.append(sep);
                                sb.append(strings.next());
                            }
                children: []
                pos: 1499
                length: 104
              - type: return_statement
                fields:
                  text: return sb.toString();
                children: []
                pos: 1612
                length: 21
              pos: 1233
              length: 406
          children: []
          pos: 1177
          length: 462
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: join
              children: []
              pos: 1859
              length: 4
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String[] strings
                children: []
                pos: 1864
                length: 16
              pos: 1838
              length: 113
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return join(Arrays.asList(strings), sep);
                children: []
                pos: 1904
                length: 41
              pos: 1894
              length: 57
          children: []
          pos: 1838
          length: 113
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: padding
              children: []
              pos: 2109
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: int width
                children: []
                pos: 2117
                length: 9
              pos: 2088
              length: 351
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: less_than
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: width
                            children: []
                            pos: 2142
                            length: 5
                          right:
                            type: decimal_integer_literal
                            fields:
                              text: '0'
                            children: []
                            pos: 2150
                            length: 1
                        children: []
                        pos: 2142
                        length: 9
                    children: []
                    pos: 2141
                    length: 11
                children:
                - type: throw_statement
                  fields:
                    text: throw new IllegalArgumentException("width must be > 0");
                  children: []
                  pos: 2165
                  length: 56
                pos: 2138
                length: 83
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: less_than
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: width
                            children: []
                            pos: 2235
                            length: 5
                          right:
                            type: field_access
                            fields:
                              text: padding.length
                            children: []
                            pos: 2243
                            length: 14
                        children: []
                        pos: 2235
                        length: 22
                    children: []
                    pos: 2234
                    length: 24
                children:
                - type: return_statement
                  fields:
                    text: return padding[width];
                  children: []
                  pos: 2271
                  length: 22
                pos: 2231
                length: 62
              - type: local_variable_declaration
                fields:
                  text: char[] out = new char[width];
                children: []
                pos: 2302
                length: 29
              - type: for_statement
                fields:
                  text: |-
                    for (int i = 0; i < width; i++)
                                out[i] = ' ';
                children: []
                pos: 2340
                length: 57
              - type: return_statement
                fields:
                  text: return String.valueOf(out);
                children: []
                pos: 2406
                length: 27
              pos: 2128
              length: 311
          children: []
          pos: 2088
          length: 351
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: isBlank
              children: []
              pos: 2641
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String string
                children: []
                pos: 2649
                length: 13
              pos: 2619
              length: 327
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: or
                        fields:
                          left:
                            type: equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: string
                                children: []
                                pos: 2678
                                length: 6
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 2688
                                length: 4
                            children: []
                            pos: 2678
                            length: 14
                          right:
                            type: equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: string.length()
                                children: []
                                pos: 2696
                                length: 15
                              right:
                                type: decimal_integer_literal
                                fields:
                                  text: '0'
                                children: []
                                pos: 2715
                                length: 1
                            children: []
                            pos: 2696
                            length: 20
                        children: []
                        pos: 2678
                        length: 38
                    children: []
                    pos: 2677
                    length: 40
                children:
                - type: return_statement
                  fields:
                    text: return true;
                  children: []
                  pos: 2730
                  length: 12
                pos: 2674
                length: 68
              - type: local_variable_declaration
                fields:
                  text: int l = string.length();
                children: []
                pos: 2752
                length: 24
              - type: for_statement
                fields:
                  text: |-
                    for (int i = 0; i < l; i++) {
                                if (!StringUtil.isWhitespace(string.codePointAt(i)))
                                    return false;
                            }
                children: []
                pos: 2785
                length: 134
              - type: return_statement
                fields:
                  text: return true;
                children: []
                pos: 2928
                length: 12
              pos: 2664
              length: 282
          children: []
          pos: 2619
          length: 327
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: isNumeric
              children: []
              pos: 3191
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String string
                children: []
                pos: 3201
                length: 13
              pos: 3169
              length: 324
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: or
                        fields:
                          left:
                            type: equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: string
                                children: []
                                pos: 3230
                                length: 6
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 3240
                                length: 4
                            children: []
                            pos: 3230
                            length: 14
                          right:
                            type: equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: string.length()
                                children: []
                                pos: 3248
                                length: 15
                              right:
                                type: decimal_integer_literal
                                fields:
                                  text: '0'
                                children: []
                                pos: 3267
                                length: 1
                            children: []
                            pos: 3248
                            length: 20
                        children: []
                        pos: 3230
                        length: 38
                    children: []
                    pos: 3229
                    length: 40
                children:
                - type: return_statement
                  fields:
                    text: return false;
                  children: []
                  pos: 3282
                  length: 13
                pos: 3226
                length: 69
              - type: local_variable_declaration
                fields:
                  text: int l = string.length();
                children: []
                pos: 3305
                length: 24
              - type: for_statement
                fields:
                  text: |-
                    for (int i = 0; i < l; i++) {
                                if (!Character.isDigit(string.codePointAt(i)))
                                    return false;
                            }
                children: []
                pos: 3338
                length: 128
              - type: return_statement
                fields:
                  text: return true;
                children: []
                pos: 3475
                length: 12
              pos: 3216
              length: 277
          children: []
          pos: 3169
          length: 324
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: isWhitespace
              children: []
              pos: 3772
              length: 12
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: int c
                children: []
                pos: 3785
                length: 5
              pos: 3750
              length: 125
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return c == ' ' || c == '\t' || c == '\n' || c == '\f' ||
                    c == '\r';
                children: []
                pos: 3801
                length: 68
              pos: 3791
              length: 84
          children: []
          pos: 3750
          length: 125
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: isActuallyWhitespace
              children: []
              pos: 4125
              length: 20
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: int c
                children: []
                pos: 4146
                length: 5
              pos: 4103
              length: 222
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return c == ' ' || c == '\t' || c == '\n' || c == '\f' ||
                    c == '\r' || c == 160;
                children: []
                pos: 4162
                length: 80
              pos: 4152
              length: 173
          children: []
          pos: 4103
          length: 222
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: isInvisibleChar
              children: []
              pos: 4353
              length: 15
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: int c
                children: []
                pos: 4369
                length: 5
              pos: 4331
              length: 208
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return Character.getType(c) == 16 && (c == 8203 || c == 8204
                    || c == 8205 || c == 173);
                children: []
                pos: 4386
                length: 87
              pos: 4376
              length: 163
          children: []
          pos: 4331
          length: 208
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: normaliseWhitespace
              children: []
              pos: 4830
              length: 19
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String string
                children: []
                pos: 4850
                length: 13
              pos: 4809
              length: 203
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: StringBuilder sb = StringUtil.stringBuilder();
                children: []
                pos: 4875
                length: 46
              - type: expression_statement
                fields:
                  text: appendNormalisedWhitespace(sb, string, false);
                children: []
                pos: 4930
                length: 46
              - type: return_statement
                fields:
                  text: return sb.toString();
                children: []
                pos: 4985
                length: 21
              pos: 4865
              length: 147
          children: []
          pos: 4809
          length: 203
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: appendNormalisedWhitespace
              children: []
              pos: 5326
              length: 26
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: StringBuilder accum
                children: []
                pos: 5353
                length: 19
              pos: 5307
              length: 762
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: boolean lastWasWhite = false;
                children: []
                pos: 5421
                length: 29
              - type: local_variable_declaration
                fields:
                  text: boolean reachedNonWhite = false;
                children: []
                pos: 5459
                length: 32
              - type: local_variable_declaration
                fields:
                  text: int len = string.length();
                children: []
                pos: 5501
                length: 26
              - type: local_variable_declaration
                fields:
                  text: int c;
                children: []
                pos: 5536
                length: 6
              - type: for_statement
                fields:
                  text: |-
                    for (int i = 0; i < len; i+= Character.charCount(c)) {
                                c = string.codePointAt(i);
                                if (isActuallyWhitespace(c)) {
                                    if ((stripLeading && !reachedNonWhite) || lastWasWhite)
                                        continue;
                                    accum.append(' ');
                                    lastWasWhite = true;
                                }
                                else if (!isInvisibleChar(c)) {
                                    accum.appendCodePoint(c);
                                    lastWasWhite = false;
                                    reachedNonWhite = true;
                                }
                            }
                children: []
                pos: 5551
                length: 512
              pos: 5411
              length: 658
          children: []
          pos: 5307
          length: 762
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: in
              children: []
              pos: 6097
              length: 2
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: final String needle
                children: []
                pos: 6100
                length: 19
              pos: 6075
              length: 261
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: final int len = haystack.length;
                children: []
                pos: 6157
                length: 32
              - type: for_statement
                fields:
                  text: |-
                    for (int i = 0; i < len; i++) {
                                if (haystack[i].equals(needle))
                                return true;
                            }
                children: []
                pos: 6198
                length: 110
              - type: return_statement
                fields:
                  text: return false;
                children: []
                pos: 6317
                length: 13
              pos: 6147
              length: 189
          children: []
          pos: 6075
          length: 261
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: inSorted
              children: []
              pos: 6364
              length: 8
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String needle
                children: []
                pos: 6373
                length: 13
              pos: 6342
              length: 131
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return Arrays.binarySearch(haystack, needle) >= 0;
                children: []
                pos: 6417
                length: 50
              pos: 6407
              length: 66
          children: []
          pos: 6342
          length: 131
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: resolve
              children: []
              pos: 6881
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: URL base
                children: []
                pos: 6889
                length: 8
              pos: 6863
              length: 594
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: relUrl.startsWith("?")
                        children: []
                        pos: 7066
                        length: 22
                    children: []
                    pos: 7065
                    length: 24
                children:
                - type: expression_statement
                  fields:
                    text: relUrl = base.getPath() + relUrl;
                  children: []
                  pos: 7102
                  length: 33
                pos: 7062
                length: 73
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: and
                        fields:
                          left:
                            type: equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: relUrl.indexOf('.')
                                children: []
                                pos: 7238
                                length: 19
                              right:
                                type: decimal_integer_literal
                                fields:
                                  text: '0'
                                children: []
                                pos: 7261
                                length: 1
                            children: []
                            pos: 7238
                            length: 24
                          right:
                            type: not_equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: base.getFile().indexOf('/')
                                children: []
                                pos: 7266
                                length: 27
                              right:
                                type: decimal_integer_literal
                                fields:
                                  text: '0'
                                children: []
                                pos: 7297
                                length: 1
                            children: []
                            pos: 7266
                            length: 32
                        children: []
                        pos: 7238
                        length: 60
                    children: []
                    pos: 7237
                    length: 62
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: base = new URL(base.getProtocol(), base.getHost(), base.getPort(),
                        "/" + base.getFile());
                    children: []
                    pos: 7314
                    length: 89
                  pos: 7300
                  length: 113
                pos: 7234
                length: 179
              - type: return_statement
                fields:
                  text: return new URL(base, relUrl);
                children: []
                pos: 7422
                length: 29
              pos: 6943
              length: 514
          children: []
          pos: 6863
          length: 594
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: resolve
              children: []
              pos: 7844
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: final String baseUrl
                children: []
                pos: 7852
                length: 20
              pos: 7823
              length: 556
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: URL base;
                children: []
                pos: 7905
                length: 9
              - type: try_statement
                fields:
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: try_statement
                      fields:
                        body:
                          type: block
                          fields: {}
                          children:
                          - type: expression_statement
                            fields:
                              text: base = new URL(baseUrl);
                            children: []
                            pos: 7963
                            length: 24
                          pos: 7945
                          length: 56
                        excepts:
                          type: excepts
                          fields: {}
                          children:
                          - type: catch_clause
                            fields:
                              text: |-
                                catch (MalformedURLException e) {
                                                // the base is unsuitable, but the attribute/rel may be abs on its own, so try that
                                                URL abs = new URL(relUrl);
                                                return abs.toExternalForm();
                                            }
                            children: []
                            pos: 8002
                            length: 235
                          pos: 7941
                          length: 296
                      children: []
                      pos: 7941
                      length: 296
                    - type: return_statement
                      fields:
                        text: return resolve(base, relUrl).toExternalForm();
                      children: []
                      pos: 8250
                      length: 46
                    pos: 7927
                    length: 379
                  excepts:
                    type: excepts
                    fields: {}
                    children:
                    - type: catch_clause
                      fields:
                        text: |-
                          catch (MalformedURLException e) {
                                      return "";
                                  }
                      children: []
                      pos: 8307
                      length: 66
                    pos: 7923
                    length: 450
                children: []
                pos: 7923
                length: 450
              pos: 7895
              length: 484
          children: []
          pos: 7823
          length: 556
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: stringBuilder
              children: []
              pos: 8694
              length: 13
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 8666
              length: 324
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: StringBuilder sb = stringLocal.get();
                children: []
                pos: 8720
                length: 37
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: greater_than
                        fields:
                          left:
                            type: method_invocation
                            fields:
                              text: sb.length()
                            children: []
                            pos: 8770
                            length: 11
                          right:
                            type: identifier
                            fields:
                              text: MaxCachedBuilderSize
                            children: []
                            pos: 8784
                            length: 20
                        children: []
                        pos: 8770
                        length: 34
                    children: []
                    pos: 8769
                    length: 36
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: sb = new StringBuilder(MaxCachedBuilderSize);
                    children: []
                    pos: 8820
                    length: 45
                  - type: expression_statement
                    fields:
                      text: stringLocal.set(sb);
                    children: []
                    pos: 8878
                    length: 20
                  pos: 8806
                  length: 102
                pos: 8766
                length: 198
              - type: return_statement
                fields:
                  text: return sb;
                children: []
                pos: 8973
                length: 10
              pos: 8710
              length: 280
          children: []
          pos: 8666
          length: 324
        - type: field_declaration
          fields:
            text: private static final int MaxCachedBuilderSize = 8 * 1024;
          children: []
          pos: 8996
          length: 57
        - type: field_declaration
          fields:
            text: |-
              private static final ThreadLocal<StringBuilder> stringLocal = new ThreadLocal<StringBuilder>(){
                      @Override
                      protected StringBuilder initialValue() {
                          return new StringBuilder(MaxCachedBuilderSize);
                      }
                  };
          children: []
          pos: 9058
          length: 239
        pos: 250
        length: 9051
    children: []
    pos: 250
    length: 9051
  pos: 0
  length: 9302
after_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: StringUtil
        children: []
        pos: 269
        length: 10
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: |-
              static final String[] padding = {"", " ", "  ", "   ", "    ", "     ", "      ", "       ", "        ",
                      "         ", "          ", "           ", "            ", "             ", "              ", "               ",
                      "                ", "                 ", "                  ", "                   ", "                    "};
          children: []
          pos: 319
          length: 343
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: join
              children: []
              pos: 886
              length: 4
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Collection strings
                children: []
                pos: 891
                length: 18
              pos: 865
              length: 111
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return join(strings.iterator(), sep);
                children: []
                pos: 933
                length: 37
              pos: 923
              length: 53
          children: []
          pos: 865
          length: 111
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: join
              children: []
              pos: 1198
              length: 4
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Iterator strings
                children: []
                pos: 1203
                length: 16
              pos: 1177
              length: 462
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: unary_expression
                        fields:
                          text: "!strings.hasNext()"
                        children: []
                        pos: 1247
                        length: 18
                    children: []
                    pos: 1246
                    length: 20
                children:
                - type: return_statement
                  fields:
                    text: return "";
                  children: []
                  pos: 1279
                  length: 10
                pos: 1243
                length: 46
              - type: local_variable_declaration
                fields:
                  text: String start = strings.next().toString();
                children: []
                pos: 1299
                length: 41
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: unary_expression
                        fields:
                          text: "!strings.hasNext()"
                        children: []
                        pos: 1353
                        length: 18
                    children: []
                    pos: 1352
                    length: 20
                children:
                - type: return_statement
                  fields:
                    text: return start;
                  children: []
                  pos: 1412
                  length: 13
                pos: 1349
                length: 76
              - type: local_variable_declaration
                fields:
                  text: StringBuilder sb = new StringBuilder(64).append(start);
                children: []
                pos: 1435
                length: 55
              - type: while_statement
                fields:
                  text: |-
                    while (strings.hasNext()) {
                                sb.append(sep);
                                sb.append(strings.next());
                            }
                children: []
                pos: 1499
                length: 104
              - type: return_statement
                fields:
                  text: return sb.toString();
                children: []
                pos: 1612
                length: 21
              pos: 1233
              length: 406
          children: []
          pos: 1177
          length: 462
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: join
              children: []
              pos: 1859
              length: 4
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String[] strings
                children: []
                pos: 1864
                length: 16
              pos: 1838
              length: 113
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return join(Arrays.asList(strings), sep);
                children: []
                pos: 1904
                length: 41
              pos: 1894
              length: 57
          children: []
          pos: 1838
          length: 113
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: padding
              children: []
              pos: 2109
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: int width
                children: []
                pos: 2117
                length: 9
              pos: 2088
              length: 351
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: less_than
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: width
                            children: []
                            pos: 2142
                            length: 5
                          right:
                            type: decimal_integer_literal
                            fields:
                              text: '0'
                            children: []
                            pos: 2150
                            length: 1
                        children: []
                        pos: 2142
                        length: 9
                    children: []
                    pos: 2141
                    length: 11
                children:
                - type: throw_statement
                  fields:
                    text: throw new IllegalArgumentException("width must be > 0");
                  children: []
                  pos: 2165
                  length: 56
                pos: 2138
                length: 83
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: less_than
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: width
                            children: []
                            pos: 2235
                            length: 5
                          right:
                            type: field_access
                            fields:
                              text: padding.length
                            children: []
                            pos: 2243
                            length: 14
                        children: []
                        pos: 2235
                        length: 22
                    children: []
                    pos: 2234
                    length: 24
                children:
                - type: return_statement
                  fields:
                    text: return padding[width];
                  children: []
                  pos: 2271
                  length: 22
                pos: 2231
                length: 62
              - type: local_variable_declaration
                fields:
                  text: char[] out = new char[width];
                children: []
                pos: 2302
                length: 29
              - type: for_statement
                fields:
                  text: |-
                    for (int i = 0; i < width; i++)
                                out[i] = ' ';
                children: []
                pos: 2340
                length: 57
              - type: return_statement
                fields:
                  text: return String.valueOf(out);
                children: []
                pos: 2406
                length: 27
              pos: 2128
              length: 311
          children: []
          pos: 2088
          length: 351
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: isBlank
              children: []
              pos: 2641
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String string
                children: []
                pos: 2649
                length: 13
              pos: 2619
              length: 327
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: or
                        fields:
                          left:
                            type: equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: string
                                children: []
                                pos: 2678
                                length: 6
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 2688
                                length: 4
                            children: []
                            pos: 2678
                            length: 14
                          right:
                            type: equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: string.length()
                                children: []
                                pos: 2696
                                length: 15
                              right:
                                type: decimal_integer_literal
                                fields:
                                  text: '0'
                                children: []
                                pos: 2715
                                length: 1
                            children: []
                            pos: 2696
                            length: 20
                        children: []
                        pos: 2678
                        length: 38
                    children: []
                    pos: 2677
                    length: 40
                children:
                - type: return_statement
                  fields:
                    text: return true;
                  children: []
                  pos: 2730
                  length: 12
                pos: 2674
                length: 68
              - type: local_variable_declaration
                fields:
                  text: int l = string.length();
                children: []
                pos: 2752
                length: 24
              - type: for_statement
                fields:
                  text: |-
                    for (int i = 0; i < l; i++) {
                                if (!StringUtil.isWhitespace(string.codePointAt(i)))
                                    return false;
                            }
                children: []
                pos: 2785
                length: 134
              - type: return_statement
                fields:
                  text: return true;
                children: []
                pos: 2928
                length: 12
              pos: 2664
              length: 282
          children: []
          pos: 2619
          length: 327
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: isNumeric
              children: []
              pos: 3191
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String string
                children: []
                pos: 3201
                length: 13
              pos: 3169
              length: 324
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: or
                        fields:
                          left:
                            type: equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: string
                                children: []
                                pos: 3230
                                length: 6
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 3240
                                length: 4
                            children: []
                            pos: 3230
                            length: 14
                          right:
                            type: equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: string.length()
                                children: []
                                pos: 3248
                                length: 15
                              right:
                                type: decimal_integer_literal
                                fields:
                                  text: '0'
                                children: []
                                pos: 3267
                                length: 1
                            children: []
                            pos: 3248
                            length: 20
                        children: []
                        pos: 3230
                        length: 38
                    children: []
                    pos: 3229
                    length: 40
                children:
                - type: return_statement
                  fields:
                    text: return false;
                  children: []
                  pos: 3282
                  length: 13
                pos: 3226
                length: 69
              - type: local_variable_declaration
                fields:
                  text: int l = string.length();
                children: []
                pos: 3305
                length: 24
              - type: for_statement
                fields:
                  text: |-
                    for (int i = 0; i < l; i++) {
                                if (!Character.isDigit(string.codePointAt(i)))
                                    return false;
                            }
                children: []
                pos: 3338
                length: 128
              - type: return_statement
                fields:
                  text: return true;
                children: []
                pos: 3475
                length: 12
              pos: 3216
              length: 277
          children: []
          pos: 3169
          length: 324
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: isWhitespace
              children: []
              pos: 3772
              length: 12
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: int c
                children: []
                pos: 3785
                length: 5
              pos: 3750
              length: 125
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return c == ' ' || c == '\t' || c == '\n' || c == '\f' ||
                    c == '\r';
                children: []
                pos: 3801
                length: 68
              pos: 3791
              length: 84
          children: []
          pos: 3750
          length: 125
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: isActuallyWhitespace
              children: []
              pos: 4125
              length: 20
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: int c
                children: []
                pos: 4146
                length: 5
              pos: 4103
              length: 222
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return c == ' ' || c == '\t' || c == '\n' || c == '\f' ||
                    c == '\r' || c == 160;
                children: []
                pos: 4162
                length: 80
              pos: 4152
              length: 173
          children: []
          pos: 4103
          length: 222
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: normaliseWhitespace
              children: []
              pos: 4677
              length: 19
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String string
                children: []
                pos: 4697
                length: 13
              pos: 4656
              length: 203
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: StringBuilder sb = StringUtil.stringBuilder();
                children: []
                pos: 4722
                length: 46
              - type: expression_statement
                fields:
                  text: appendNormalisedWhitespace(sb, string, false);
                children: []
                pos: 4777
                length: 46
              - type: return_statement
                fields:
                  text: return sb.toString();
                children: []
                pos: 4832
                length: 21
              pos: 4712
              length: 147
          children: []
          pos: 4656
          length: 203
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: appendNormalisedWhitespace
              children: []
              pos: 5173
              length: 26
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: StringBuilder accum
                children: []
                pos: 5200
                length: 19
              pos: 5154
              length: 737
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: boolean lastWasWhite = false;
                children: []
                pos: 5268
                length: 29
              - type: local_variable_declaration
                fields:
                  text: boolean reachedNonWhite = false;
                children: []
                pos: 5306
                length: 32
              - type: local_variable_declaration
                fields:
                  text: int len = string.length();
                children: []
                pos: 5348
                length: 26
              - type: local_variable_declaration
                fields:
                  text: int c;
                children: []
                pos: 5383
                length: 6
              - type: for_statement
                fields:
                  text: |-
                    for (int i = 0; i < len; i+= Character.charCount(c)) {
                                c = string.codePointAt(i);
                                if (isActuallyWhitespace(c)) {
                                    if ((stripLeading && !reachedNonWhite) || lastWasWhite)
                                        continue;
                                    accum.append(' ');
                                    lastWasWhite = true;
                                }
                                else {
                                    accum.appendCodePoint(c);
                                    lastWasWhite = false;
                                    reachedNonWhite = true;
                                }
                            }
                children: []
                pos: 5398
                length: 487
              pos: 5258
              length: 633
          children: []
          pos: 5154
          length: 737
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: in
              children: []
              pos: 5919
              length: 2
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: final String needle
                children: []
                pos: 5922
                length: 19
              pos: 5897
              length: 261
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: final int len = haystack.length;
                children: []
                pos: 5979
                length: 32
              - type: for_statement
                fields:
                  text: |-
                    for (int i = 0; i < len; i++) {
                                if (haystack[i].equals(needle))
                                return true;
                            }
                children: []
                pos: 6020
                length: 110
              - type: return_statement
                fields:
                  text: return false;
                children: []
                pos: 6139
                length: 13
              pos: 5969
              length: 189
          children: []
          pos: 5897
          length: 261
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: inSorted
              children: []
              pos: 6186
              length: 8
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String needle
                children: []
                pos: 6195
                length: 13
              pos: 6164
              length: 131
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return Arrays.binarySearch(haystack, needle) >= 0;
                children: []
                pos: 6239
                length: 50
              pos: 6229
              length: 66
          children: []
          pos: 6164
          length: 131
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: resolve
              children: []
              pos: 6703
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: URL base
                children: []
                pos: 6711
                length: 8
              pos: 6685
              length: 594
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: relUrl.startsWith("?")
                        children: []
                        pos: 6888
                        length: 22
                    children: []
                    pos: 6887
                    length: 24
                children:
                - type: expression_statement
                  fields:
                    text: relUrl = base.getPath() + relUrl;
                  children: []
                  pos: 6924
                  length: 33
                pos: 6884
                length: 73
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: and
                        fields:
                          left:
                            type: equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: relUrl.indexOf('.')
                                children: []
                                pos: 7060
                                length: 19
                              right:
                                type: decimal_integer_literal
                                fields:
                                  text: '0'
                                children: []
                                pos: 7083
                                length: 1
                            children: []
                            pos: 7060
                            length: 24
                          right:
                            type: not_equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: base.getFile().indexOf('/')
                                children: []
                                pos: 7088
                                length: 27
                              right:
                                type: decimal_integer_literal
                                fields:
                                  text: '0'
                                children: []
                                pos: 7119
                                length: 1
                            children: []
                            pos: 7088
                            length: 32
                        children: []
                        pos: 7060
                        length: 60
                    children: []
                    pos: 7059
                    length: 62
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: base = new URL(base.getProtocol(), base.getHost(), base.getPort(),
                        "/" + base.getFile());
                    children: []
                    pos: 7136
                    length: 89
                  pos: 7122
                  length: 113
                pos: 7056
                length: 179
              - type: return_statement
                fields:
                  text: return new URL(base, relUrl);
                children: []
                pos: 7244
                length: 29
              pos: 6765
              length: 514
          children: []
          pos: 6685
          length: 594
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: resolve
              children: []
              pos: 7666
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: final String baseUrl
                children: []
                pos: 7674
                length: 20
              pos: 7645
              length: 556
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: URL base;
                children: []
                pos: 7727
                length: 9
              - type: try_statement
                fields:
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: try_statement
                      fields:
                        body:
                          type: block
                          fields: {}
                          children:
                          - type: expression_statement
                            fields:
                              text: base = new URL(baseUrl);
                            children: []
                            pos: 7785
                            length: 24
                          pos: 7767
                          length: 56
                        excepts:
                          type: excepts
                          fields: {}
                          children:
                          - type: catch_clause
                            fields:
                              text: |-
                                catch (MalformedURLException e) {
                                                // the base is unsuitable, but the attribute/rel may be abs on its own, so try that
                                                URL abs = new URL(relUrl);
                                                return abs.toExternalForm();
                                            }
                            children: []
                            pos: 7824
                            length: 235
                          pos: 7763
                          length: 296
                      children: []
                      pos: 7763
                      length: 296
                    - type: return_statement
                      fields:
                        text: return resolve(base, relUrl).toExternalForm();
                      children: []
                      pos: 8072
                      length: 46
                    pos: 7749
                    length: 379
                  excepts:
                    type: excepts
                    fields: {}
                    children:
                    - type: catch_clause
                      fields:
                        text: |-
                          catch (MalformedURLException e) {
                                      return "";
                                  }
                      children: []
                      pos: 8129
                      length: 66
                    pos: 7745
                    length: 450
                children: []
                pos: 7745
                length: 450
              pos: 7717
              length: 484
          children: []
          pos: 7645
          length: 556
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: stringBuilder
              children: []
              pos: 8516
              length: 13
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 8488
              length: 324
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: StringBuilder sb = stringLocal.get();
                children: []
                pos: 8542
                length: 37
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: greater_than
                        fields:
                          left:
                            type: method_invocation
                            fields:
                              text: sb.length()
                            children: []
                            pos: 8592
                            length: 11
                          right:
                            type: identifier
                            fields:
                              text: MaxCachedBuilderSize
                            children: []
                            pos: 8606
                            length: 20
                        children: []
                        pos: 8592
                        length: 34
                    children: []
                    pos: 8591
                    length: 36
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: sb = new StringBuilder(MaxCachedBuilderSize);
                    children: []
                    pos: 8642
                    length: 45
                  - type: expression_statement
                    fields:
                      text: stringLocal.set(sb);
                    children: []
                    pos: 8700
                    length: 20
                  pos: 8628
                  length: 102
                pos: 8588
                length: 198
              - type: return_statement
                fields:
                  text: return sb;
                children: []
                pos: 8795
                length: 10
              pos: 8532
              length: 280
          children: []
          pos: 8488
          length: 324
        - type: field_declaration
          fields:
            text: private static final int MaxCachedBuilderSize = 8 * 1024;
          children: []
          pos: 8818
          length: 57
        - type: field_declaration
          fields:
            text: |-
              private static final ThreadLocal<StringBuilder> stringLocal = new ThreadLocal<StringBuilder>(){
                      @Override
                      protected StringBuilder initialValue() {
                          return new StringBuilder(MaxCachedBuilderSize);
                      }
                  };
          children: []
          pos: 8880
          length: 239
        pos: 250
        length: 8873
    children: []
    pos: 250
    length: 8873
  pos: 0
  length: 9124
text_diff: "--- before\n+++ after\n@@ -128,10 +128,7 @@\n         // 160 is &nbsp;
  (non-breaking space). Not in the spec but expected.\n     }\n \n-    public static
  boolean isInvisibleChar(int c) {\n-        return Character.getType(c) == 16 &&
  (c == 8203 || c == 8204 || c == 8205 || c == 173);\n         // zero width sp, zw
  non join, zw join, soft hyphen\n-    }\n \n     /**\n      * Normalise the whitespace
  within this string; multiple spaces collapse to a single, and all whitespace characters\n@@
  -165,7 +162,7 @@\n                 accum.append(' ');\n                 lastWasWhite
  = true;\n             }\n-            else if (!isInvisibleChar(c)) {\n+            else
  {\n                 accum.appendCodePoint(c);\n                 lastWasWhite = false;\n
  \                reachedNonWhite = true;\n"
tree_diff: |+
  New cluster:
  ===
  insert-node
  ---
  method_declaration [5154,5891]
  to
  class_body [250,9301]
  at 11
  ------------
  ===
  insert-node
  ---
  identifier: appendNormalisedWhitespace [5173,5199]
  to
  method_declaration [5154,5891]
  at 0
  ===
  insert-node
  ---
  method_declaration [5154,5891]
  to
  class_body [250,9301]
  at 11

  New cluster:
  MOVE from method_declaration [5154,5891]
  ------------
  ===
  move-tree
  ---
  method_parameters [5307,6069]
      formal_parameter: StringBuilder accum [5353,5372]
  to
  method_declaration [5154,5891]
  at 1

  New cluster:
  Unknown cluster type
  ------------
  ===
  insert-tree
  ---
  block [5258,5891]
      local_variable_declaration: boolean lastWasWhite = false; [5268,5297]
      local_variable_declaration: boolean reachedNonWhite = false; [5306,5338]
      local_variable_declaration: int len = string.length(); [5348,5374]
      local_variable_declaration: int c; [5383,5389]
      for_statement: for (int i = 0; i < len; i+= Character.charCount(c)) {
              c = string.codePointAt(i);
              if (isActuallyWhitespace(c)) {
                  if ((stripLeading && !reachedNonWhite) || lastWasWhite)
                      continue;
                  accum.append(' ');
                  lastWasWhite = true;
              }
              else {
                  accum.appendCodePoint(c);
                  lastWasWhite = false;
                  reachedNonWhite = true;
              }
          } [5398,5885]
  to
  method_declaration [5154,5891]
  at 2

  New cluster:
  Unknown cluster type
  ------------
  ===
  delete-tree
  ---
  method_declaration [4331,4539]
      identifier: isInvisibleChar [4353,4368]
      method_parameters [4331,4539]
          formal_parameter: int c [4369,4374]
      block [4376,4539]
          return_statement: return Character.getType(c) == 16 && (c == 8203 || c == 8204 || c == 8205 || c == 173); [4386,4473]

  New cluster:
  ===
  delete-node
  ---
  method_declaration [5307,6069]
  ===
  ------------
  ===
  delete-node
  ---
  identifier: appendNormalisedWhitespace [5326,5352]
  ===
  ===
  delete-node
  ---
  method_declaration [5307,6069]
  ===

  New cluster:
  Unknown cluster type
  ------------
  ===
  delete-tree
  ---
  block [5411,6069]
      local_variable_declaration: boolean lastWasWhite = false; [5421,5450]
      local_variable_declaration: boolean reachedNonWhite = false; [5459,5491]
      local_variable_declaration: int len = string.length(); [5501,5527]
      local_variable_declaration: int c; [5536,5542]
      for_statement: for (int i = 0; i < len; i+= Character.charCount(c)) {
              c = string.codePointAt(i);
              if (isActuallyWhitespace(c)) {
                  if ((stripLeading && !reachedNonWhite) || lastWasWhite)
                      continue;
                  accum.append(' ');
                  lastWasWhite = true;
              }
              else if (!isInvisibleChar(c)) {
                  accum.appendCodePoint(c);
                  lastWasWhite = false;
                  reachedNonWhite = true;
              }
          } [5551,6063]

...
