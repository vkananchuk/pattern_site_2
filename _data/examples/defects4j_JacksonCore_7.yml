---
language: java
before_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: JsonWriteContext
        children: []
        pos: 260
        length: 16
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: public final static int STATUS_OK_AS_IS = 0;
          children: []
          pos: 354
          length: 44
        - type: field_declaration
          fields:
            text: public final static int STATUS_OK_AFTER_COMMA = 1;
          children: []
          pos: 403
          length: 50
        - type: field_declaration
          fields:
            text: public final static int STATUS_OK_AFTER_COLON = 2;
          children: []
          pos: 458
          length: 50
        - type: field_declaration
          fields:
            text: public final static int STATUS_OK_AFTER_SPACE = 3;
          children: []
          pos: 513
          length: 50
        - type: field_declaration
          fields:
            text: public final static int STATUS_EXPECT_VALUE = 4;
          children: []
          pos: 587
          length: 48
        - type: field_declaration
          fields:
            text: public final static int STATUS_EXPECT_NAME = 5;
          children: []
          pos: 640
          length: 47
        - type: field_declaration
          fields:
            text: protected final JsonWriteContext _parent;
          children: []
          pos: 772
          length: 41
        - type: field_declaration
          fields:
            text: protected DupDetector _dups;
          children: []
          pos: 862
          length: 28
        - type: field_declaration
          fields:
            text: protected JsonWriteContext _child = null;
          children: []
          pos: 1164
          length: 41
        - type: field_declaration
          fields:
            text: protected String _currentName;
          children: []
          pos: 1528
          length: 30
        - type: field_declaration
          fields:
            text: protected Object _currentValue;
          children: []
          pos: 1598
          length: 31
        - type: field_declaration
          fields:
            text: protected boolean _gotName;
          children: []
          pos: 1746
          length: 27
        - type: constructor_declaration
          fields:
            text: |-
              protected JsonWriteContext(int type, JsonWriteContext parent, DupDetector dups) {
                      super();
                      _type = type;
                      _parent = parent;
                      _dups = dups;
                      _index = -1;
                  }
          children: []
          pos: 1941
          length: 195
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: reset
              children: []
              pos: 2169
              length: 5
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: int type
                children: []
                pos: 2175
                length: 8
              pos: 2142
              length: 245
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: _type = type;
                children: []
                pos: 2195
                length: 13
              - type: expression_statement
                fields:
                  text: _index = -1;
                children: []
                pos: 2217
                length: 12
              - type: expression_statement
                fields:
                  text: _currentName = null;
                children: []
                pos: 2238
                length: 20
              - type: expression_statement
                fields:
                  text: _gotName = false;
                children: []
                pos: 2267
                length: 17
              - type: expression_statement
                fields:
                  text: _currentValue = null;
                children: []
                pos: 2293
                length: 21
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: _dups
                            children: []
                            pos: 2327
                            length: 5
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 2336
                            length: 4
                        children: []
                        pos: 2327
                        length: 13
                    children: []
                    pos: 2326
                    length: 15
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: _dups.reset();
                    children: []
                    pos: 2344
                    length: 14
                  pos: 2342
                  length: 18
                pos: 2323
                length: 37
              - type: return_statement
                fields:
                  text: return this;
                children: []
                pos: 2369
                length: 12
              pos: 2185
              length: 202
          children: []
          pos: 2142
          length: 245
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: withDupDetector
              children: []
              pos: 2417
              length: 15
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: DupDetector dups
                children: []
                pos: 2433
                length: 16
              pos: 2393
              length: 108
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: _dups = dups;
                children: []
                pos: 2461
                length: 13
              - type: return_statement
                fields:
                  text: return this;
                children: []
                pos: 2483
                length: 12
              pos: 2451
              length: 50
          children: []
          pos: 2393
          length: 108
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getCurrentValue
              children: []
              pos: 2535
              length: 15
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 2507
              length: 83
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return _currentValue;
                children: []
                pos: 2563
                length: 21
              pos: 2553
              length: 37
          children: []
          pos: 2507
          length: 83
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: setCurrentValue
              children: []
              pos: 2622
              length: 15
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Object v
                children: []
                pos: 2638
                length: 8
              pos: 2596
              length: 86
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: _currentValue = v;
                children: []
                pos: 2658
                length: 18
              pos: 2648
              length: 34
          children: []
          pos: 2596
          length: 86
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: createRootContext
              children: []
              pos: 2983
              length: 17
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 2936
              length: 102
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return createRootContext(null);
                children: []
                pos: 3005
                length: 31
              pos: 3003
              length: 35
          children: []
          pos: 2936
          length: 102
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: createRootContext
              children: []
              pos: 3075
              length: 17
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: DupDetector dd
                children: []
                pos: 3093
                length: 14
              pos: 3044
              length: 130
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return new JsonWriteContext(TYPE_ROOT, null, dd);
                children: []
                pos: 3119
                length: 49
              pos: 3109
              length: 65
          children: []
          pos: 3044
          length: 130
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: createChildArrayContext
              children: []
              pos: 3204
              length: 23
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 3180
              length: 307
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: JsonWriteContext ctxt = _child;
                children: []
                pos: 3240
                length: 31
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: ctxt
                            children: []
                            pos: 3284
                            length: 4
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 3292
                            length: 4
                        children: []
                        pos: 3284
                        length: 12
                    children: []
                    pos: 3283
                    length: 14
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: '_child = ctxt = new JsonWriteContext(TYPE_ARRAY, this,
                        (_dups == null) ? null : _dups.child());'
                    children: []
                    pos: 3312
                    length: 95
                  - type: return_statement
                    fields:
                      text: return ctxt;
                    children: []
                    pos: 3420
                    length: 12
                  pos: 3298
                  length: 144
                pos: 3280
                length: 162
              - type: return_statement
                fields:
                  text: return ctxt.reset(TYPE_ARRAY);
                children: []
                pos: 3451
                length: 30
              pos: 3230
              length: 257
          children: []
          pos: 3180
          length: 307
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: createChildObjectContext
              children: []
              pos: 3517
              length: 24
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 3493
              length: 310
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: JsonWriteContext ctxt = _child;
                children: []
                pos: 3554
                length: 31
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: ctxt
                            children: []
                            pos: 3598
                            length: 4
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 3606
                            length: 4
                        children: []
                        pos: 3598
                        length: 12
                    children: []
                    pos: 3597
                    length: 14
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: '_child = ctxt = new JsonWriteContext(TYPE_OBJECT, this,
                        (_dups == null) ? null : _dups.child());'
                    children: []
                    pos: 3626
                    length: 96
                  - type: return_statement
                    fields:
                      text: return ctxt;
                    children: []
                    pos: 3735
                    length: 12
                  pos: 3612
                  length: 145
                pos: 3594
                length: 163
              - type: return_statement
                fields:
                  text: return ctxt.reset(TYPE_OBJECT);
                children: []
                pos: 3766
                length: 31
              pos: 3544
              length: 259
          children: []
          pos: 3493
          length: 310
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getParent
              children: []
              pos: 3874
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 3834
              length: 71
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return _parent;
                children: []
                pos: 3888
                length: 15
              pos: 3886
              length: 19
          children: []
          pos: 3834
          length: 71
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getCurrentName
              children: []
              pos: 3940
              length: 14
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 3910
              length: 71
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return _currentName;
                children: []
                pos: 3959
                length: 20
              pos: 3957
              length: 24
          children: []
          pos: 3910
          length: 71
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getDupDetector
              children: []
              pos: 4006
              length: 14
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 3987
              length: 65
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return _dups;
                children: []
                pos: 4033
                length: 13
              pos: 4023
              length: 29
          children: []
          pos: 3987
          length: 65
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: writeFieldName
              children: []
              pos: 4261
              length: 14
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String name
                children: []
                pos: 4276
                length: 11
              pos: 4250
              length: 348
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: identifier
                        fields:
                          text: _gotName
                        children: []
                        pos: 4334
                        length: 8
                    children: []
                    pos: 4333
                    length: 10
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return JsonWriteContext.STATUS_EXPECT_VALUE;
                    children: []
                    pos: 4358
                    length: 44
                  pos: 4344
                  length: 68
                pos: 4330
                length: 82
              - type: expression_statement
                fields:
                  text: _gotName = true;
                children: []
                pos: 4421
                length: 16
              - type: expression_statement
                fields:
                  text: _currentName = name;
                children: []
                pos: 4446
                length: 20
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: _dups
                            children: []
                            pos: 4479
                            length: 5
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 4488
                            length: 4
                        children: []
                        pos: 4479
                        length: 13
                    children: []
                    pos: 4478
                    length: 15
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: _checkDup(_dups, name);
                    children: []
                    pos: 4496
                    length: 23
                  pos: 4494
                  length: 27
                pos: 4475
                length: 46
              - type: return_statement
                fields:
                  text: 'return (_index < 0) ? STATUS_OK_AS_IS : STATUS_OK_AFTER_COMMA;'
                children: []
                pos: 4530
                length: 62
              pos: 4320
              length: 278
          children: []
          pos: 4250
          length: 348
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: _checkDup
              children: []
              pos: 4623
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: DupDetector dd
                children: []
                pos: 4633
                length: 14
              pos: 4604
              length: 193
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: dd.isDup(name)
                        children: []
                        pos: 4707
                        length: 14
                    children: []
                    pos: 4706
                    length: 16
                children:
                - type: block
                  fields: {}
                  children:
                  - type: throw_statement
                    fields:
                      text: throw new JsonGenerationException("Duplicate field '"+name+"'");
                    children: []
                    pos: 4725
                    length: 64
                  pos: 4723
                  length: 68
                pos: 4703
                length: 88
              pos: 4693
              length: 104
          children: []
          pos: 4604
          length: 193
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: writeValue
              children: []
              pos: 4818
              length: 10
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 4807
              length: 665
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: _type
                            children: []
                            pos: 4877
                            length: 5
                          right:
                            type: identifier
                            fields:
                              text: TYPE_OBJECT
                            children: []
                            pos: 4886
                            length: 11
                        children: []
                        pos: 4877
                        length: 20
                    children: []
                    pos: 4876
                    length: 22
                children:
                - type: block
                  fields: {}
                  children:
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: unary_expression
                            fields:
                              text: "!_gotName"
                            children: []
                            pos: 4917
                            length: 9
                        children: []
                        pos: 4916
                        length: 11
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: return_statement
                        fields:
                          text: return STATUS_EXPECT_NAME;
                        children: []
                        pos: 4946
                        length: 26
                      pos: 4928
                      length: 58
                    pos: 4913
                    length: 73
                  - type: expression_statement
                    fields:
                      text: _gotName = false;
                    children: []
                    pos: 4999
                    length: 17
                  - type: expression_statement
                    fields:
                      text: "++_index;"
                    children: []
                    pos: 5029
                    length: 9
                  - type: return_statement
                    fields:
                      text: return STATUS_OK_AFTER_COLON;
                    children: []
                    pos: 5051
                    length: 29
                  pos: 4899
                  length: 191
                pos: 4873
                length: 217
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: _type
                            children: []
                            pos: 5126
                            length: 5
                          right:
                            type: identifier
                            fields:
                              text: TYPE_ARRAY
                            children: []
                            pos: 5135
                            length: 10
                        children: []
                        pos: 5126
                        length: 19
                    children: []
                    pos: 5125
                    length: 21
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: int ix = _index;
                    children: []
                    pos: 5161
                    length: 16
                  - type: expression_statement
                    fields:
                      text: "++_index;"
                    children: []
                    pos: 5190
                    length: 9
                  - type: return_statement
                    fields:
                      text: 'return (ix < 0) ? STATUS_OK_AS_IS : STATUS_OK_AFTER_COMMA;'
                    children: []
                    pos: 5212
                    length: 58
                  pos: 5147
                  length: 133
                pos: 5122
                length: 158
              - type: expression_statement
                fields:
                  text: "++_index;"
                children: []
                pos: 5385
                length: 9
              - type: return_statement
                fields:
                  text: 'return (_index == 0) ? STATUS_OK_AS_IS : STATUS_OK_AFTER_SPACE;'
                children: []
                pos: 5403
                length: 63
              pos: 4831
              length: 641
          children: []
          pos: 4807
          length: 665
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: appendDesc
              children: []
              pos: 5540
              length: 10
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: StringBuilder sb
                children: []
                pos: 5551
                length: 16
              pos: 5525
              length: 635
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: _type
                            children: []
                            pos: 5583
                            length: 5
                          right:
                            type: identifier
                            fields:
                              text: TYPE_OBJECT
                            children: []
                            pos: 5592
                            length: 11
                        children: []
                        pos: 5583
                        length: 20
                    children: []
                    pos: 5582
                    length: 22
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: sb.append('{');
                    children: []
                    pos: 5619
                    length: 15
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: not_equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: _currentName
                                children: []
                                pos: 5651
                                length: 12
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 5667
                                length: 4
                            children: []
                            pos: 5651
                            length: 20
                        children: []
                        pos: 5650
                        length: 22
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: expression_statement
                        fields:
                          text: sb.append('"');
                        children: []
                        pos: 5691
                        length: 15
                      - type: expression_statement
                        fields:
                          text: sb.append(_currentName);
                        children: []
                        pos: 5782
                        length: 24
                      - type: expression_statement
                        fields:
                          text: sb.append('"');
                        children: []
                        pos: 5823
                        length: 15
                      pos: 5673
                      length: 179
                    pos: 5647
                    length: 258
                  - type: expression_statement
                    fields:
                      text: sb.append('}');
                    children: []
                    pos: 5918
                    length: 15
                  pos: 5605
                  length: 338
                pos: 5579
                length: 575
              pos: 5569
              length: 591
          children: []
          pos: 5525
          length: 635
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: toString
              children: []
              pos: 6346
              length: 8
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 6322
              length: 146
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: StringBuilder sb = new StringBuilder(64);
                children: []
                pos: 6367
                length: 41
              - type: expression_statement
                fields:
                  text: appendDesc(sb);
                children: []
                pos: 6417
                length: 15
              - type: return_statement
                fields:
                  text: return sb.toString();
                children: []
                pos: 6441
                length: 21
              pos: 6357
              length: 111
          children: []
          pos: 6322
          length: 146
        pos: 247
        length: 6223
    children: []
    pos: 247
    length: 6223
  pos: 0
  length: 6471
after_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: JsonWriteContext
        children: []
        pos: 260
        length: 16
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: public final static int STATUS_OK_AS_IS = 0;
          children: []
          pos: 354
          length: 44
        - type: field_declaration
          fields:
            text: public final static int STATUS_OK_AFTER_COMMA = 1;
          children: []
          pos: 403
          length: 50
        - type: field_declaration
          fields:
            text: public final static int STATUS_OK_AFTER_COLON = 2;
          children: []
          pos: 458
          length: 50
        - type: field_declaration
          fields:
            text: public final static int STATUS_OK_AFTER_SPACE = 3;
          children: []
          pos: 513
          length: 50
        - type: field_declaration
          fields:
            text: public final static int STATUS_EXPECT_VALUE = 4;
          children: []
          pos: 587
          length: 48
        - type: field_declaration
          fields:
            text: public final static int STATUS_EXPECT_NAME = 5;
          children: []
          pos: 640
          length: 47
        - type: field_declaration
          fields:
            text: protected final JsonWriteContext _parent;
          children: []
          pos: 772
          length: 41
        - type: field_declaration
          fields:
            text: protected DupDetector _dups;
          children: []
          pos: 862
          length: 28
        - type: field_declaration
          fields:
            text: protected JsonWriteContext _child = null;
          children: []
          pos: 1164
          length: 41
        - type: field_declaration
          fields:
            text: protected String _currentName;
          children: []
          pos: 1528
          length: 30
        - type: field_declaration
          fields:
            text: protected Object _currentValue;
          children: []
          pos: 1598
          length: 31
        - type: field_declaration
          fields:
            text: protected boolean _gotName;
          children: []
          pos: 1746
          length: 27
        - type: constructor_declaration
          fields:
            text: |-
              protected JsonWriteContext(int type, JsonWriteContext parent, DupDetector dups) {
                      super();
                      _type = type;
                      _parent = parent;
                      _dups = dups;
                      _index = -1;
                  }
          children: []
          pos: 1941
          length: 195
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: reset
              children: []
              pos: 2169
              length: 5
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: int type
                children: []
                pos: 2175
                length: 8
              pos: 2142
              length: 245
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: _type = type;
                children: []
                pos: 2195
                length: 13
              - type: expression_statement
                fields:
                  text: _index = -1;
                children: []
                pos: 2217
                length: 12
              - type: expression_statement
                fields:
                  text: _currentName = null;
                children: []
                pos: 2238
                length: 20
              - type: expression_statement
                fields:
                  text: _gotName = false;
                children: []
                pos: 2267
                length: 17
              - type: expression_statement
                fields:
                  text: _currentValue = null;
                children: []
                pos: 2293
                length: 21
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: _dups
                            children: []
                            pos: 2327
                            length: 5
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 2336
                            length: 4
                        children: []
                        pos: 2327
                        length: 13
                    children: []
                    pos: 2326
                    length: 15
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: _dups.reset();
                    children: []
                    pos: 2344
                    length: 14
                  pos: 2342
                  length: 18
                pos: 2323
                length: 37
              - type: return_statement
                fields:
                  text: return this;
                children: []
                pos: 2369
                length: 12
              pos: 2185
              length: 202
          children: []
          pos: 2142
          length: 245
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: withDupDetector
              children: []
              pos: 2417
              length: 15
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: DupDetector dups
                children: []
                pos: 2433
                length: 16
              pos: 2393
              length: 108
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: _dups = dups;
                children: []
                pos: 2461
                length: 13
              - type: return_statement
                fields:
                  text: return this;
                children: []
                pos: 2483
                length: 12
              pos: 2451
              length: 50
          children: []
          pos: 2393
          length: 108
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getCurrentValue
              children: []
              pos: 2535
              length: 15
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 2507
              length: 83
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return _currentValue;
                children: []
                pos: 2563
                length: 21
              pos: 2553
              length: 37
          children: []
          pos: 2507
          length: 83
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: setCurrentValue
              children: []
              pos: 2622
              length: 15
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Object v
                children: []
                pos: 2638
                length: 8
              pos: 2596
              length: 86
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: _currentValue = v;
                children: []
                pos: 2658
                length: 18
              pos: 2648
              length: 34
          children: []
          pos: 2596
          length: 86
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: createRootContext
              children: []
              pos: 2983
              length: 17
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 2936
              length: 102
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return createRootContext(null);
                children: []
                pos: 3005
                length: 31
              pos: 3003
              length: 35
          children: []
          pos: 2936
          length: 102
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: createRootContext
              children: []
              pos: 3075
              length: 17
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: DupDetector dd
                children: []
                pos: 3093
                length: 14
              pos: 3044
              length: 130
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return new JsonWriteContext(TYPE_ROOT, null, dd);
                children: []
                pos: 3119
                length: 49
              pos: 3109
              length: 65
          children: []
          pos: 3044
          length: 130
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: createChildArrayContext
              children: []
              pos: 3204
              length: 23
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 3180
              length: 307
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: JsonWriteContext ctxt = _child;
                children: []
                pos: 3240
                length: 31
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: ctxt
                            children: []
                            pos: 3284
                            length: 4
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 3292
                            length: 4
                        children: []
                        pos: 3284
                        length: 12
                    children: []
                    pos: 3283
                    length: 14
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: '_child = ctxt = new JsonWriteContext(TYPE_ARRAY, this,
                        (_dups == null) ? null : _dups.child());'
                    children: []
                    pos: 3312
                    length: 95
                  - type: return_statement
                    fields:
                      text: return ctxt;
                    children: []
                    pos: 3420
                    length: 12
                  pos: 3298
                  length: 144
                pos: 3280
                length: 162
              - type: return_statement
                fields:
                  text: return ctxt.reset(TYPE_ARRAY);
                children: []
                pos: 3451
                length: 30
              pos: 3230
              length: 257
          children: []
          pos: 3180
          length: 307
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: createChildObjectContext
              children: []
              pos: 3517
              length: 24
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 3493
              length: 310
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: JsonWriteContext ctxt = _child;
                children: []
                pos: 3554
                length: 31
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: ctxt
                            children: []
                            pos: 3598
                            length: 4
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 3606
                            length: 4
                        children: []
                        pos: 3598
                        length: 12
                    children: []
                    pos: 3597
                    length: 14
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: '_child = ctxt = new JsonWriteContext(TYPE_OBJECT, this,
                        (_dups == null) ? null : _dups.child());'
                    children: []
                    pos: 3626
                    length: 96
                  - type: return_statement
                    fields:
                      text: return ctxt;
                    children: []
                    pos: 3735
                    length: 12
                  pos: 3612
                  length: 145
                pos: 3594
                length: 163
              - type: return_statement
                fields:
                  text: return ctxt.reset(TYPE_OBJECT);
                children: []
                pos: 3766
                length: 31
              pos: 3544
              length: 259
          children: []
          pos: 3493
          length: 310
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getParent
              children: []
              pos: 3874
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 3834
              length: 71
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return _parent;
                children: []
                pos: 3888
                length: 15
              pos: 3886
              length: 19
          children: []
          pos: 3834
          length: 71
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getCurrentName
              children: []
              pos: 3940
              length: 14
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 3910
              length: 71
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return _currentName;
                children: []
                pos: 3959
                length: 20
              pos: 3957
              length: 24
          children: []
          pos: 3910
          length: 71
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getDupDetector
              children: []
              pos: 4006
              length: 14
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 3987
              length: 65
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return _dups;
                children: []
                pos: 4033
                length: 13
              pos: 4023
              length: 29
          children: []
          pos: 3987
          length: 65
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: writeFieldName
              children: []
              pos: 4261
              length: 14
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String name
                children: []
                pos: 4276
                length: 11
              pos: 4250
              length: 348
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: identifier
                        fields:
                          text: _gotName
                        children: []
                        pos: 4334
                        length: 8
                    children: []
                    pos: 4333
                    length: 10
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return JsonWriteContext.STATUS_EXPECT_VALUE;
                    children: []
                    pos: 4358
                    length: 44
                  pos: 4344
                  length: 68
                pos: 4330
                length: 82
              - type: expression_statement
                fields:
                  text: _gotName = true;
                children: []
                pos: 4421
                length: 16
              - type: expression_statement
                fields:
                  text: _currentName = name;
                children: []
                pos: 4446
                length: 20
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: _dups
                            children: []
                            pos: 4479
                            length: 5
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 4488
                            length: 4
                        children: []
                        pos: 4479
                        length: 13
                    children: []
                    pos: 4478
                    length: 15
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: _checkDup(_dups, name);
                    children: []
                    pos: 4496
                    length: 23
                  pos: 4494
                  length: 27
                pos: 4475
                length: 46
              - type: return_statement
                fields:
                  text: 'return (_index < 0) ? STATUS_OK_AS_IS : STATUS_OK_AFTER_COMMA;'
                children: []
                pos: 4530
                length: 62
              pos: 4320
              length: 278
          children: []
          pos: 4250
          length: 348
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: _checkDup
              children: []
              pos: 4623
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: DupDetector dd
                children: []
                pos: 4633
                length: 14
              pos: 4604
              length: 193
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: dd.isDup(name)
                        children: []
                        pos: 4707
                        length: 14
                    children: []
                    pos: 4706
                    length: 16
                children:
                - type: block
                  fields: {}
                  children:
                  - type: throw_statement
                    fields:
                      text: throw new JsonGenerationException("Duplicate field '"+name+"'");
                    children: []
                    pos: 4725
                    length: 64
                  pos: 4723
                  length: 68
                pos: 4703
                length: 88
              pos: 4693
              length: 104
          children: []
          pos: 4604
          length: 193
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: writeValue
              children: []
              pos: 4818
              length: 10
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 4807
              length: 579
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: _type
                            children: []
                            pos: 4877
                            length: 5
                          right:
                            type: identifier
                            fields:
                              text: TYPE_OBJECT
                            children: []
                            pos: 4886
                            length: 11
                        children: []
                        pos: 4877
                        length: 20
                    children: []
                    pos: 4876
                    length: 22
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: _gotName = false;
                    children: []
                    pos: 4913
                    length: 17
                  - type: expression_statement
                    fields:
                      text: "++_index;"
                    children: []
                    pos: 4943
                    length: 9
                  - type: return_statement
                    fields:
                      text: return STATUS_OK_AFTER_COLON;
                    children: []
                    pos: 4965
                    length: 29
                  pos: 4899
                  length: 105
                pos: 4873
                length: 131
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: _type
                            children: []
                            pos: 5040
                            length: 5
                          right:
                            type: identifier
                            fields:
                              text: TYPE_ARRAY
                            children: []
                            pos: 5049
                            length: 10
                        children: []
                        pos: 5040
                        length: 19
                    children: []
                    pos: 5039
                    length: 21
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: int ix = _index;
                    children: []
                    pos: 5075
                    length: 16
                  - type: expression_statement
                    fields:
                      text: "++_index;"
                    children: []
                    pos: 5104
                    length: 9
                  - type: return_statement
                    fields:
                      text: 'return (ix < 0) ? STATUS_OK_AS_IS : STATUS_OK_AFTER_COMMA;'
                    children: []
                    pos: 5126
                    length: 58
                  pos: 5061
                  length: 133
                pos: 5036
                length: 158
              - type: expression_statement
                fields:
                  text: "++_index;"
                children: []
                pos: 5299
                length: 9
              - type: return_statement
                fields:
                  text: 'return (_index == 0) ? STATUS_OK_AS_IS : STATUS_OK_AFTER_SPACE;'
                children: []
                pos: 5317
                length: 63
              pos: 4831
              length: 555
          children: []
          pos: 4807
          length: 579
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: appendDesc
              children: []
              pos: 5454
              length: 10
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: StringBuilder sb
                children: []
                pos: 5465
                length: 16
              pos: 5439
              length: 635
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: _type
                            children: []
                            pos: 5497
                            length: 5
                          right:
                            type: identifier
                            fields:
                              text: TYPE_OBJECT
                            children: []
                            pos: 5506
                            length: 11
                        children: []
                        pos: 5497
                        length: 20
                    children: []
                    pos: 5496
                    length: 22
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: sb.append('{');
                    children: []
                    pos: 5533
                    length: 15
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: not_equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: _currentName
                                children: []
                                pos: 5565
                                length: 12
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 5581
                                length: 4
                            children: []
                            pos: 5565
                            length: 20
                        children: []
                        pos: 5564
                        length: 22
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: expression_statement
                        fields:
                          text: sb.append('"');
                        children: []
                        pos: 5605
                        length: 15
                      - type: expression_statement
                        fields:
                          text: sb.append(_currentName);
                        children: []
                        pos: 5696
                        length: 24
                      - type: expression_statement
                        fields:
                          text: sb.append('"');
                        children: []
                        pos: 5737
                        length: 15
                      pos: 5587
                      length: 179
                    pos: 5561
                    length: 258
                  - type: expression_statement
                    fields:
                      text: sb.append('}');
                    children: []
                    pos: 5832
                    length: 15
                  pos: 5519
                  length: 338
                pos: 5493
                length: 575
              pos: 5483
              length: 591
          children: []
          pos: 5439
          length: 635
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: toString
              children: []
              pos: 6260
              length: 8
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 6236
              length: 146
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: StringBuilder sb = new StringBuilder(64);
                children: []
                pos: 6281
                length: 41
              - type: expression_statement
                fields:
                  text: appendDesc(sb);
                children: []
                pos: 6331
                length: 15
              - type: return_statement
                fields:
                  text: return sb.toString();
                children: []
                pos: 6355
                length: 21
              pos: 6271
              length: 111
          children: []
          pos: 6236
          length: 146
        pos: 247
        length: 6137
    children: []
    pos: 247
    length: 6137
  pos: 0
  length: 6385
text_diff: |
  --- before
  +++ after
  @@ -166,9 +166,6 @@
       public int writeValue() {
           // Most likely, object:
           if (_type == TYPE_OBJECT) {
  -            if (!_gotName) {
  -                return STATUS_EXPECT_NAME;
  -            }
               _gotName = false;
               ++_index;
               return STATUS_OK_AFTER_COLON;
tree_diff: |+
  New cluster:
  Unknown cluster type
  ------------
  ===
  delete-tree
  ---
  if_statement [4913,4986]
      parenthesized_expression [4916,4927]
          unary_expression: !_gotName [4917,4926]
      block [4928,4986]
          return_statement: return STATUS_EXPECT_NAME; [4946,4972]

...
