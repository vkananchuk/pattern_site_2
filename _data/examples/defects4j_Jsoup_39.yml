---
language: java
before_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: DataUtil
        children: []
        pos: 419
        length: 8
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: private static final Pattern charsetPattern = Pattern.compile("(?i)\\bcharset=\\s*(?:\"|')?([^\\s,;\"']*)");
          children: []
          pos: 434
          length: 108
        - type: field_declaration
          fields:
            text: static final String defaultCharset = "UTF-8";
          children: []
          pos: 547
          length: 45
        - type: field_declaration
          fields:
            text: private static final int bufferSize = 0x20000;
          children: []
          pos: 644
          length: 46
        - type: constructor_declaration
          fields:
            text: private DataUtil() {}
          children: []
          pos: 706
          length: 21
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: load
              children: []
              pos: 1027
              length: 4
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: File in
                children: []
                pos: 1032
                length: 7
              pos: 1004
              length: 449
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: FileInputStream inStream = null;
                children: []
                pos: 1106
                length: 32
              - type: try_statement
                fields:
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: expression_statement
                      fields:
                        text: inStream = new FileInputStream(in);
                      children: []
                      pos: 1165
                      length: 35
                    - type: local_variable_declaration
                      fields:
                        text: ByteBuffer byteData = readToByteBuffer(inStream);
                      children: []
                      pos: 1213
                      length: 49
                    - type: return_statement
                      fields:
                        text: return parseByteData(byteData, charsetName, baseUri,
                          Parser.htmlParser());
                      children: []
                      pos: 1275
                      length: 74
                    pos: 1151
                    length: 208
                  excepts:
                    type: excepts
                    fields: {}
                    children: []
                    pos: 1147
                    length: 300
                children: []
                pos: 1147
                length: 300
              pos: 1096
              length: 357
          children: []
          pos: 1004
          length: 449
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: load
              children: []
              pos: 1801
              length: 4
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: InputStream in
                children: []
                pos: 1806
                length: 14
              pos: 1778
              length: 241
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: ByteBuffer byteData = readToByteBuffer(in);
                children: []
                pos: 1887
                length: 43
              - type: return_statement
                fields:
                  text: return parseByteData(byteData, charsetName, baseUri, Parser.htmlParser());
                children: []
                pos: 1939
                length: 74
              pos: 1877
              length: 142
          children: []
          pos: 1778
          length: 241
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: load
              children: []
              pos: 2467
              length: 4
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: InputStream in
                children: []
                pos: 2472
                length: 14
              pos: 2444
              length: 243
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: ByteBuffer byteData = readToByteBuffer(in);
                children: []
                pos: 2568
                length: 43
              - type: return_statement
                fields:
                  text: return parseByteData(byteData, charsetName, baseUri, parser);
                children: []
                pos: 2620
                length: 61
              pos: 2558
              length: 129
          children: []
          pos: 2444
          length: 243
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: parseByteData
              children: []
              pos: 2960
              length: 13
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: ByteBuffer byteData
                children: []
                pos: 2974
                length: 19
              pos: 2944
              length: 2761
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: String docData;
                children: []
                pos: 3056
                length: 15
              - type: local_variable_declaration
                fields:
                  text: Document doc = null;
                children: []
                pos: 3080
                length: 20
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: charsetName
                            children: []
                            pos: 3113
                            length: 11
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 3128
                            length: 4
                        children: []
                        pos: 3113
                        length: 19
                    children: []
                    pos: 3112
                    length: 21
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: docData = Charset.forName(defaultCharset).decode(byteData).toString();
                    children: []
                    pos: 3317
                    length: 70
                  - type: expression_statement
                    fields:
                      text: doc = parser.parseInput(docData, baseUri);
                    children: []
                    pos: 3400
                    length: 42
                  - type: local_variable_declaration
                    fields:
                      text: Element meta = doc.select("meta[http-equiv=content-type],
                        meta[charset]").first();
                    children: []
                    pos: 3455
                    length: 82
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: not_equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: meta
                                children: []
                                pos: 3554
                                length: 4
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 3562
                                length: 4
                            children: []
                            pos: 3554
                            length: 12
                        children: []
                        pos: 3553
                        length: 14
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: local_variable_declaration
                        fields:
                          text: String foundCharset;
                        children: []
                        pos: 3635
                        length: 20
                      - type: if_statement
                        fields:
                          condition:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: method_invocation
                                fields:
                                  text: meta.hasAttr("http-equiv")
                                children: []
                                pos: 3676
                                length: 26
                            children: []
                            pos: 3675
                            length: 28
                        children:
                        - type: block
                          fields: {}
                          children:
                          - type: expression_statement
                            fields:
                              text: foundCharset = getCharsetFromContentType(meta.attr("content"));
                            children: []
                            pos: 3726
                            length: 63
                          - type: if_statement
                            fields:
                              condition:
                                type: parenthesized_expression
                                fields:
                                  expression:
                                    type: and
                                    fields:
                                      left:
                                        type: equals
                                        fields:
                                          left:
                                            type: identifier
                                            fields:
                                              text: foundCharset
                                            children: []
                                            pos: 3814
                                            length: 12
                                          right:
                                            type: null_literal
                                            fields: {}
                                            children: []
                                            pos: 3830
                                            length: 4
                                        children: []
                                        pos: 3814
                                        length: 20
                                      right:
                                        type: method_invocation
                                        fields:
                                          text: meta.hasAttr("charset")
                                        children: []
                                        pos: 3838
                                        length: 23
                                    children: []
                                    pos: 3814
                                    length: 47
                                children: []
                                pos: 3813
                                length: 49
                            children:
                            - type: block
                              fields: {}
                              children:
                              - type: try_statement
                                fields:
                                  body:
                                    type: block
                                    fields: {}
                                    children:
                                    - type: if_statement
                                      fields:
                                        condition:
                                          type: parenthesized_expression
                                          fields:
                                            expression:
                                              type: method_invocation
                                              fields:
                                                text: Charset.isSupported(meta.attr("charset"))
                                              children: []
                                              pos: 3927
                                              length: 41
                                          children: []
                                          pos: 3926
                                          length: 43
                                      children:
                                      - type: block
                                        fields: {}
                                        children:
                                        - type: expression_statement
                                          fields:
                                            text: foundCharset = meta.attr("charset");
                                          children: []
                                          pos: 4004
                                          length: 36
                                        pos: 3970
                                        length: 100
                                      pos: 3923
                                      length: 147
                                    pos: 3893
                                    length: 203
                                  excepts:
                                    type: excepts
                                    fields: {}
                                    children:
                                    - type: catch_clause
                                      fields:
                                        text: |-
                                          catch (IllegalCharsetNameException e) {
                                                                      foundCharset = null;
                                                                  }
                                      children: []
                                      pos: 4097
                                      length: 114
                                    pos: 3889
                                    length: 322
                                children: []
                                pos: 3889
                                length: 322
                              pos: 3863
                              length: 370
                            pos: 3810
                            length: 423
                          pos: 3704
                          length: 547
                        pos: 3672
                        length: 661
                      - type: if_statement
                        fields:
                          condition:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: and
                                fields:
                                  left:
                                    type: and
                                    fields:
                                      left:
                                        type: not_equals
                                        fields:
                                          left:
                                            type: identifier
                                            fields:
                                              text: foundCharset
                                            children: []
                                            pos: 4355
                                            length: 12
                                          right:
                                            type: null_literal
                                            fields: {}
                                            children: []
                                            pos: 4371
                                            length: 4
                                        children: []
                                        pos: 4355
                                        length: 20
                                      right:
                                        type: not_equals
                                        fields:
                                          left:
                                            type: method_invocation
                                            fields:
                                              text: foundCharset.length()
                                            children: []
                                            pos: 4379
                                            length: 21
                                          right:
                                            type: decimal_integer_literal
                                            fields:
                                              text: '0'
                                            children: []
                                            pos: 4404
                                            length: 1
                                        children: []
                                        pos: 4379
                                        length: 26
                                    children: []
                                    pos: 4355
                                    length: 50
                                  right:
                                    type: unary_expression
                                    fields:
                                      text: "!foundCharset.equals(defaultCharset)"
                                    children: []
                                    pos: 4409
                                    length: 36
                                children: []
                                pos: 4355
                                length: 90
                            children: []
                            pos: 4354
                            length: 92
                        children:
                        - type: block
                          fields: {}
                          children:
                          - type: expression_statement
                            fields:
                              text: foundCharset = foundCharset.trim().replaceAll("[\"']",
                                "");
                            children: []
                            pos: 4490
                            length: 59
                          - type: expression_statement
                            fields:
                              text: charsetName = foundCharset;
                            children: []
                            pos: 4570
                            length: 27
                          - type: expression_statement
                            fields:
                              text: byteData.rewind();
                            children: []
                            pos: 4618
                            length: 18
                          - type: expression_statement
                            fields:
                              text: docData = Charset.forName(foundCharset).decode(byteData).toString();
                            children: []
                            pos: 4657
                            length: 68
                          - type: expression_statement
                            fields:
                              text: doc = null;
                            children: []
                            pos: 4746
                            length: 11
                          pos: 4447
                          length: 328
                        pos: 4351
                        length: 424
                      pos: 3568
                      length: 1221
                    pos: 3550
                    length: 1239
                  pos: 3134
                  length: 1665
                pos: 3109
                length: 1995
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: and
                        fields:
                          left:
                            type: greater_than
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: docData.length()
                                children: []
                                pos: 5245
                                length: 16
                              right:
                                type: decimal_integer_literal
                                fields:
                                  text: '0'
                                children: []
                                pos: 5264
                                length: 1
                            children: []
                            pos: 5245
                            length: 20
                          right:
                            type: equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: docData.charAt(0)
                                children: []
                                pos: 5269
                                length: 17
                              right:
                                type: decimal_integer_literal
                                fields:
                                  text: '65279'
                                children: []
                                pos: 5290
                                length: 5
                            children: []
                            pos: 5269
                            length: 26
                        children: []
                        pos: 5245
                        length: 50
                    children: []
                    pos: 5244
                    length: 52
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: byteData.rewind();
                    children: []
                    pos: 5311
                    length: 18
                  - type: expression_statement
                    fields:
                      text: docData = Charset.forName(defaultCharset).decode(byteData).toString();
                    children: []
                    pos: 5342
                    length: 70
                  - type: expression_statement
                    fields:
                      text: docData = docData.substring(1);
                    children: []
                    pos: 5425
                    length: 31
                  - type: expression_statement
                    fields:
                      text: charsetName = defaultCharset;
                    children: []
                    pos: 5469
                    length: 29
                  - type: expression_statement
                    fields:
                      text: doc = null;
                    children: []
                    pos: 5511
                    length: 11
                  pos: 5297
                  length: 235
                pos: 5241
                length: 291
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: doc
                            children: []
                            pos: 5545
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 5552
                            length: 4
                        children: []
                        pos: 5545
                        length: 11
                    children: []
                    pos: 5544
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: doc = parser.parseInput(docData, baseUri);
                    children: []
                    pos: 5572
                    length: 42
                  - type: expression_statement
                    fields:
                      text: doc.outputSettings().charset(charsetName);
                    children: []
                    pos: 5627
                    length: 42
                  pos: 5558
                  length: 121
                pos: 5541
                length: 138
              - type: return_statement
                fields:
                  text: return doc;
                children: []
                pos: 5688
                length: 11
              pos: 3046
              length: 2659
          children: []
          pos: 2944
          length: 2761
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: readToByteBuffer
              children: []
              pos: 6072
              length: 16
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: InputStream inStream
                children: []
                pos: 6089
                length: 20
              pos: 6054
              length: 873
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: Validate.isTrue(maxSize >= 0, "maxSize must be 0 (unlimited)
                    or larger");
                children: []
                pos: 6153
                length: 73
              - type: local_variable_declaration
                fields:
                  text: final boolean capped = maxSize > 0;
                children: []
                pos: 6235
                length: 35
              - type: local_variable_declaration
                fields:
                  text: byte[] buffer = new byte[bufferSize];
                children: []
                pos: 6279
                length: 37
              - type: local_variable_declaration
                fields:
                  text: ByteArrayOutputStream outStream = new ByteArrayOutputStream(bufferSize);
                children: []
                pos: 6325
                length: 72
              - type: local_variable_declaration
                fields:
                  text: int read;
                children: []
                pos: 6406
                length: 9
              - type: local_variable_declaration
                fields:
                  text: int remaining = maxSize;
                children: []
                pos: 6424
                length: 24
              - type: while_statement
                fields:
                  text: |-
                    while (true) {
                                read = inStream.read(buffer);
                                if (read == -1) break;
                                if (capped) {
                                    if (read > remaining) {
                                        outStream.write(buffer, 0, remaining);
                                        break;
                                    }
                                    remaining -= read;
                                }
                                outStream.write(buffer, 0, read);
                            }
                children: []
                pos: 6458
                length: 366
              - type: local_variable_declaration
                fields:
                  text: ByteBuffer byteData = ByteBuffer.wrap(outStream.toByteArray());
                children: []
                pos: 6833
                length: 63
              - type: return_statement
                fields:
                  text: return byteData;
                children: []
                pos: 6905
                length: 16
              pos: 6143
              length: 784
          children: []
          pos: 6054
          length: 873
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: readToByteBuffer
              children: []
              pos: 6951
              length: 16
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: InputStream inStream
                children: []
                pos: 6968
                length: 20
              pos: 6933
              length: 129
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return readToByteBuffer(inStream, 0);
                children: []
                pos: 7019
                length: 37
              pos: 7009
              length: 53
          children: []
          pos: 6933
          length: 129
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getCharsetFromContentType
              children: []
              pos: 7378
              length: 25
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String contentType
                children: []
                pos: 7404
                length: 18
              pos: 7364
              length: 773
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: contentType
                            children: []
                            pos: 7438
                            length: 11
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 7453
                            length: 4
                        children: []
                        pos: 7438
                        length: 19
                    children: []
                    pos: 7437
                    length: 21
                children:
                - type: return_statement
                  fields:
                    text: return null;
                  children: []
                  pos: 7459
                  length: 12
                pos: 7434
                length: 37
              - type: local_variable_declaration
                fields:
                  text: Matcher m = charsetPattern.matcher(contentType);
                children: []
                pos: 7480
                length: 48
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: m.find()
                        children: []
                        pos: 7541
                        length: 8
                    children: []
                    pos: 7540
                    length: 10
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: String charset = m.group(1).trim();
                    children: []
                    pos: 7565
                    length: 35
                  - type: expression_statement
                    fields:
                      text: charset = charset.replace("charset=", "");
                    children: []
                    pos: 7613
                    length: 42
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: method_invocation
                            fields:
                              text: charset.isEmpty()
                            children: []
                            pos: 7672
                            length: 17
                        children: []
                        pos: 7671
                        length: 19
                    children:
                    - type: return_statement
                      fields:
                        text: return null;
                      children: []
                      pos: 7691
                      length: 12
                    pos: 7668
                    length: 35
                  - type: try_statement
                    fields:
                      body:
                        type: block
                        fields: {}
                        children:
                        - type: if_statement
                          fields:
                            condition:
                              type: parenthesized_expression
                              fields:
                                expression:
                                  type: method_invocation
                                  fields:
                                    text: Charset.isSupported(charset)
                                  children: []
                                  pos: 7742
                                  length: 28
                              children: []
                              pos: 7741
                              length: 30
                          children:
                          - type: return_statement
                            fields:
                              text: return charset;
                            children: []
                            pos: 7772
                            length: 15
                          pos: 7738
                          length: 49
                        - type: expression_statement
                          fields:
                            text: charset = charset.toUpperCase(Locale.ENGLISH);
                          children: []
                          pos: 7804
                          length: 46
                        - type: if_statement
                          fields:
                            condition:
                              type: parenthesized_expression
                              fields:
                                expression:
                                  type: method_invocation
                                  fields:
                                    text: Charset.isSupported(charset)
                                  children: []
                                  pos: 7871
                                  length: 28
                              children: []
                              pos: 7870
                              length: 30
                          children:
                          - type: return_statement
                            fields:
                              text: return charset;
                            children: []
                            pos: 7901
                            length: 15
                          pos: 7867
                          length: 49
                        pos: 7720
                        length: 210
                      excepts:
                        type: excepts
                        fields: {}
                        children:
                        - type: catch_clause
                          fields:
                            text: |-
                              catch (IllegalCharsetNameException e) {
                                              // if our advanced charset matching fails.... we just take the default
                                              return null;
                                          }
                          children: []
                          pos: 7931
                          length: 169
                        pos: 7716
                        length: 384
                    children: []
                    pos: 7716
                    length: 384
                  pos: 7551
                  length: 559
                pos: 7537
                length: 573
              - type: return_statement
                fields:
                  text: return null;
                children: []
                pos: 8119
                length: 12
              pos: 7424
              length: 713
          children: []
          pos: 7364
          length: 773
        pos: 406
        length: 7743
    children: []
    pos: 406
    length: 7743
  pos: 0
  length: 8150
after_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: DataUtil
        children: []
        pos: 419
        length: 8
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: private static final Pattern charsetPattern = Pattern.compile("(?i)\\bcharset=\\s*(?:\"|')?([^\\s,;\"']*)");
          children: []
          pos: 434
          length: 108
        - type: field_declaration
          fields:
            text: static final String defaultCharset = "UTF-8";
          children: []
          pos: 547
          length: 45
        - type: field_declaration
          fields:
            text: private static final int bufferSize = 0x20000;
          children: []
          pos: 644
          length: 46
        - type: constructor_declaration
          fields:
            text: private DataUtil() {}
          children: []
          pos: 706
          length: 21
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: load
              children: []
              pos: 1027
              length: 4
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: File in
                children: []
                pos: 1032
                length: 7
              pos: 1004
              length: 449
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: FileInputStream inStream = null;
                children: []
                pos: 1106
                length: 32
              - type: try_statement
                fields:
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: expression_statement
                      fields:
                        text: inStream = new FileInputStream(in);
                      children: []
                      pos: 1165
                      length: 35
                    - type: local_variable_declaration
                      fields:
                        text: ByteBuffer byteData = readToByteBuffer(inStream);
                      children: []
                      pos: 1213
                      length: 49
                    - type: return_statement
                      fields:
                        text: return parseByteData(byteData, charsetName, baseUri,
                          Parser.htmlParser());
                      children: []
                      pos: 1275
                      length: 74
                    pos: 1151
                    length: 208
                  excepts:
                    type: excepts
                    fields: {}
                    children: []
                    pos: 1147
                    length: 300
                children: []
                pos: 1147
                length: 300
              pos: 1096
              length: 357
          children: []
          pos: 1004
          length: 449
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: load
              children: []
              pos: 1801
              length: 4
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: InputStream in
                children: []
                pos: 1806
                length: 14
              pos: 1778
              length: 241
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: ByteBuffer byteData = readToByteBuffer(in);
                children: []
                pos: 1887
                length: 43
              - type: return_statement
                fields:
                  text: return parseByteData(byteData, charsetName, baseUri, Parser.htmlParser());
                children: []
                pos: 1939
                length: 74
              pos: 1877
              length: 142
          children: []
          pos: 1778
          length: 241
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: load
              children: []
              pos: 2467
              length: 4
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: InputStream in
                children: []
                pos: 2472
                length: 14
              pos: 2444
              length: 243
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: ByteBuffer byteData = readToByteBuffer(in);
                children: []
                pos: 2568
                length: 43
              - type: return_statement
                fields:
                  text: return parseByteData(byteData, charsetName, baseUri, parser);
                children: []
                pos: 2620
                length: 61
              pos: 2558
              length: 129
          children: []
          pos: 2444
          length: 243
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: parseByteData
              children: []
              pos: 2960
              length: 13
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: ByteBuffer byteData
                children: []
                pos: 2974
                length: 19
              pos: 2944
              length: 2737
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: String docData;
                children: []
                pos: 3056
                length: 15
              - type: local_variable_declaration
                fields:
                  text: Document doc = null;
                children: []
                pos: 3080
                length: 20
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: charsetName
                            children: []
                            pos: 3113
                            length: 11
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 3128
                            length: 4
                        children: []
                        pos: 3113
                        length: 19
                    children: []
                    pos: 3112
                    length: 21
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: docData = Charset.forName(defaultCharset).decode(byteData).toString();
                    children: []
                    pos: 3317
                    length: 70
                  - type: expression_statement
                    fields:
                      text: doc = parser.parseInput(docData, baseUri);
                    children: []
                    pos: 3400
                    length: 42
                  - type: local_variable_declaration
                    fields:
                      text: Element meta = doc.select("meta[http-equiv=content-type],
                        meta[charset]").first();
                    children: []
                    pos: 3455
                    length: 82
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: not_equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: meta
                                children: []
                                pos: 3554
                                length: 4
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 3562
                                length: 4
                            children: []
                            pos: 3554
                            length: 12
                        children: []
                        pos: 3553
                        length: 14
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: local_variable_declaration
                        fields:
                          text: String foundCharset;
                        children: []
                        pos: 3635
                        length: 20
                      - type: if_statement
                        fields:
                          condition:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: method_invocation
                                fields:
                                  text: meta.hasAttr("http-equiv")
                                children: []
                                pos: 3676
                                length: 26
                            children: []
                            pos: 3675
                            length: 28
                        children:
                        - type: block
                          fields: {}
                          children:
                          - type: expression_statement
                            fields:
                              text: foundCharset = getCharsetFromContentType(meta.attr("content"));
                            children: []
                            pos: 3726
                            length: 63
                          - type: if_statement
                            fields:
                              condition:
                                type: parenthesized_expression
                                fields:
                                  expression:
                                    type: and
                                    fields:
                                      left:
                                        type: equals
                                        fields:
                                          left:
                                            type: identifier
                                            fields:
                                              text: foundCharset
                                            children: []
                                            pos: 3814
                                            length: 12
                                          right:
                                            type: null_literal
                                            fields: {}
                                            children: []
                                            pos: 3830
                                            length: 4
                                        children: []
                                        pos: 3814
                                        length: 20
                                      right:
                                        type: method_invocation
                                        fields:
                                          text: meta.hasAttr("charset")
                                        children: []
                                        pos: 3838
                                        length: 23
                                    children: []
                                    pos: 3814
                                    length: 47
                                children: []
                                pos: 3813
                                length: 49
                            children:
                            - type: block
                              fields: {}
                              children:
                              - type: try_statement
                                fields:
                                  body:
                                    type: block
                                    fields: {}
                                    children:
                                    - type: if_statement
                                      fields:
                                        condition:
                                          type: parenthesized_expression
                                          fields:
                                            expression:
                                              type: method_invocation
                                              fields:
                                                text: Charset.isSupported(meta.attr("charset"))
                                              children: []
                                              pos: 3927
                                              length: 41
                                          children: []
                                          pos: 3926
                                          length: 43
                                      children:
                                      - type: block
                                        fields: {}
                                        children:
                                        - type: expression_statement
                                          fields:
                                            text: foundCharset = meta.attr("charset");
                                          children: []
                                          pos: 4004
                                          length: 36
                                        pos: 3970
                                        length: 100
                                      pos: 3923
                                      length: 147
                                    pos: 3893
                                    length: 203
                                  excepts:
                                    type: excepts
                                    fields: {}
                                    children:
                                    - type: catch_clause
                                      fields:
                                        text: |-
                                          catch (IllegalCharsetNameException e) {
                                                                      foundCharset = null;
                                                                  }
                                      children: []
                                      pos: 4097
                                      length: 114
                                    pos: 3889
                                    length: 322
                                children: []
                                pos: 3889
                                length: 322
                              pos: 3863
                              length: 370
                            pos: 3810
                            length: 423
                          pos: 3704
                          length: 547
                        pos: 3672
                        length: 661
                      - type: if_statement
                        fields:
                          condition:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: and
                                fields:
                                  left:
                                    type: and
                                    fields:
                                      left:
                                        type: not_equals
                                        fields:
                                          left:
                                            type: identifier
                                            fields:
                                              text: foundCharset
                                            children: []
                                            pos: 4355
                                            length: 12
                                          right:
                                            type: null_literal
                                            fields: {}
                                            children: []
                                            pos: 4371
                                            length: 4
                                        children: []
                                        pos: 4355
                                        length: 20
                                      right:
                                        type: not_equals
                                        fields:
                                          left:
                                            type: method_invocation
                                            fields:
                                              text: foundCharset.length()
                                            children: []
                                            pos: 4379
                                            length: 21
                                          right:
                                            type: decimal_integer_literal
                                            fields:
                                              text: '0'
                                            children: []
                                            pos: 4404
                                            length: 1
                                        children: []
                                        pos: 4379
                                        length: 26
                                    children: []
                                    pos: 4355
                                    length: 50
                                  right:
                                    type: unary_expression
                                    fields:
                                      text: "!foundCharset.equals(defaultCharset)"
                                    children: []
                                    pos: 4409
                                    length: 36
                                children: []
                                pos: 4355
                                length: 90
                            children: []
                            pos: 4354
                            length: 92
                        children:
                        - type: block
                          fields: {}
                          children:
                          - type: expression_statement
                            fields:
                              text: foundCharset = foundCharset.trim().replaceAll("[\"']",
                                "");
                            children: []
                            pos: 4490
                            length: 59
                          - type: expression_statement
                            fields:
                              text: charsetName = foundCharset;
                            children: []
                            pos: 4570
                            length: 27
                          - type: expression_statement
                            fields:
                              text: byteData.rewind();
                            children: []
                            pos: 4618
                            length: 18
                          - type: expression_statement
                            fields:
                              text: docData = Charset.forName(foundCharset).decode(byteData).toString();
                            children: []
                            pos: 4657
                            length: 68
                          - type: expression_statement
                            fields:
                              text: doc = null;
                            children: []
                            pos: 4746
                            length: 11
                          pos: 4447
                          length: 328
                        pos: 4351
                        length: 424
                      pos: 3568
                      length: 1221
                    pos: 3550
                    length: 1239
                  pos: 3134
                  length: 1665
                pos: 3109
                length: 1995
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: and
                        fields:
                          left:
                            type: greater_than
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: docData.length()
                                children: []
                                pos: 5245
                                length: 16
                              right:
                                type: decimal_integer_literal
                                fields:
                                  text: '0'
                                children: []
                                pos: 5264
                                length: 1
                            children: []
                            pos: 5245
                            length: 20
                          right:
                            type: equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: docData.charAt(0)
                                children: []
                                pos: 5269
                                length: 17
                              right:
                                type: decimal_integer_literal
                                fields:
                                  text: '65279'
                                children: []
                                pos: 5290
                                length: 5
                            children: []
                            pos: 5269
                            length: 26
                        children: []
                        pos: 5245
                        length: 50
                    children: []
                    pos: 5244
                    length: 52
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: byteData.rewind();
                    children: []
                    pos: 5311
                    length: 18
                  - type: expression_statement
                    fields:
                      text: docData = Charset.forName(defaultCharset).decode(byteData).toString();
                    children: []
                    pos: 5342
                    length: 70
                  - type: expression_statement
                    fields:
                      text: docData = docData.substring(1);
                    children: []
                    pos: 5425
                    length: 31
                  - type: expression_statement
                    fields:
                      text: charsetName = defaultCharset;
                    children: []
                    pos: 5469
                    length: 29
                  pos: 5297
                  length: 211
                pos: 5241
                length: 267
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: doc
                            children: []
                            pos: 5521
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 5528
                            length: 4
                        children: []
                        pos: 5521
                        length: 11
                    children: []
                    pos: 5520
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: doc = parser.parseInput(docData, baseUri);
                    children: []
                    pos: 5548
                    length: 42
                  - type: expression_statement
                    fields:
                      text: doc.outputSettings().charset(charsetName);
                    children: []
                    pos: 5603
                    length: 42
                  pos: 5534
                  length: 121
                pos: 5517
                length: 138
              - type: return_statement
                fields:
                  text: return doc;
                children: []
                pos: 5664
                length: 11
              pos: 3046
              length: 2635
          children: []
          pos: 2944
          length: 2737
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: readToByteBuffer
              children: []
              pos: 6048
              length: 16
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: InputStream inStream
                children: []
                pos: 6065
                length: 20
              pos: 6030
              length: 873
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: Validate.isTrue(maxSize >= 0, "maxSize must be 0 (unlimited)
                    or larger");
                children: []
                pos: 6129
                length: 73
              - type: local_variable_declaration
                fields:
                  text: final boolean capped = maxSize > 0;
                children: []
                pos: 6211
                length: 35
              - type: local_variable_declaration
                fields:
                  text: byte[] buffer = new byte[bufferSize];
                children: []
                pos: 6255
                length: 37
              - type: local_variable_declaration
                fields:
                  text: ByteArrayOutputStream outStream = new ByteArrayOutputStream(bufferSize);
                children: []
                pos: 6301
                length: 72
              - type: local_variable_declaration
                fields:
                  text: int read;
                children: []
                pos: 6382
                length: 9
              - type: local_variable_declaration
                fields:
                  text: int remaining = maxSize;
                children: []
                pos: 6400
                length: 24
              - type: while_statement
                fields:
                  text: |-
                    while (true) {
                                read = inStream.read(buffer);
                                if (read == -1) break;
                                if (capped) {
                                    if (read > remaining) {
                                        outStream.write(buffer, 0, remaining);
                                        break;
                                    }
                                    remaining -= read;
                                }
                                outStream.write(buffer, 0, read);
                            }
                children: []
                pos: 6434
                length: 366
              - type: local_variable_declaration
                fields:
                  text: ByteBuffer byteData = ByteBuffer.wrap(outStream.toByteArray());
                children: []
                pos: 6809
                length: 63
              - type: return_statement
                fields:
                  text: return byteData;
                children: []
                pos: 6881
                length: 16
              pos: 6119
              length: 784
          children: []
          pos: 6030
          length: 873
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: readToByteBuffer
              children: []
              pos: 6927
              length: 16
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: InputStream inStream
                children: []
                pos: 6944
                length: 20
              pos: 6909
              length: 129
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return readToByteBuffer(inStream, 0);
                children: []
                pos: 6995
                length: 37
              pos: 6985
              length: 53
          children: []
          pos: 6909
          length: 129
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getCharsetFromContentType
              children: []
              pos: 7354
              length: 25
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String contentType
                children: []
                pos: 7380
                length: 18
              pos: 7340
              length: 773
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: contentType
                            children: []
                            pos: 7414
                            length: 11
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 7429
                            length: 4
                        children: []
                        pos: 7414
                        length: 19
                    children: []
                    pos: 7413
                    length: 21
                children:
                - type: return_statement
                  fields:
                    text: return null;
                  children: []
                  pos: 7435
                  length: 12
                pos: 7410
                length: 37
              - type: local_variable_declaration
                fields:
                  text: Matcher m = charsetPattern.matcher(contentType);
                children: []
                pos: 7456
                length: 48
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: m.find()
                        children: []
                        pos: 7517
                        length: 8
                    children: []
                    pos: 7516
                    length: 10
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: String charset = m.group(1).trim();
                    children: []
                    pos: 7541
                    length: 35
                  - type: expression_statement
                    fields:
                      text: charset = charset.replace("charset=", "");
                    children: []
                    pos: 7589
                    length: 42
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: method_invocation
                            fields:
                              text: charset.isEmpty()
                            children: []
                            pos: 7648
                            length: 17
                        children: []
                        pos: 7647
                        length: 19
                    children:
                    - type: return_statement
                      fields:
                        text: return null;
                      children: []
                      pos: 7667
                      length: 12
                    pos: 7644
                    length: 35
                  - type: try_statement
                    fields:
                      body:
                        type: block
                        fields: {}
                        children:
                        - type: if_statement
                          fields:
                            condition:
                              type: parenthesized_expression
                              fields:
                                expression:
                                  type: method_invocation
                                  fields:
                                    text: Charset.isSupported(charset)
                                  children: []
                                  pos: 7718
                                  length: 28
                              children: []
                              pos: 7717
                              length: 30
                          children:
                          - type: return_statement
                            fields:
                              text: return charset;
                            children: []
                            pos: 7748
                            length: 15
                          pos: 7714
                          length: 49
                        - type: expression_statement
                          fields:
                            text: charset = charset.toUpperCase(Locale.ENGLISH);
                          children: []
                          pos: 7780
                          length: 46
                        - type: if_statement
                          fields:
                            condition:
                              type: parenthesized_expression
                              fields:
                                expression:
                                  type: method_invocation
                                  fields:
                                    text: Charset.isSupported(charset)
                                  children: []
                                  pos: 7847
                                  length: 28
                              children: []
                              pos: 7846
                              length: 30
                          children:
                          - type: return_statement
                            fields:
                              text: return charset;
                            children: []
                            pos: 7877
                            length: 15
                          pos: 7843
                          length: 49
                        pos: 7696
                        length: 210
                      excepts:
                        type: excepts
                        fields: {}
                        children:
                        - type: catch_clause
                          fields:
                            text: |-
                              catch (IllegalCharsetNameException e) {
                                              // if our advanced charset matching fails.... we just take the default
                                              return null;
                                          }
                          children: []
                          pos: 7907
                          length: 169
                        pos: 7692
                        length: 384
                    children: []
                    pos: 7692
                    length: 384
                  pos: 7527
                  length: 559
                pos: 7513
                length: 573
              - type: return_statement
                fields:
                  text: return null;
                children: []
                pos: 8095
                length: 12
              pos: 7400
              length: 713
          children: []
          pos: 7340
          length: 773
        pos: 406
        length: 7719
    children: []
    pos: 406
    length: 7719
  pos: 0
  length: 8126
text_diff: |
  --- before
  +++ after
  @@ -116,7 +116,6 @@
               docData = Charset.forName(defaultCharset).decode(byteData).toString();
               docData = docData.substring(1);
               charsetName = defaultCharset;
  -            doc = null;
           }
           if (doc == null) {
               doc = parser.parseInput(docData, baseUri);
tree_diff: |+
  New cluster:
  ===
  delete-node
  ---
  expression_statement: doc = null; [5511,5522]
  ===
  ------------
  ===
  delete-node
  ---
  expression_statement: doc = null; [5511,5522]
  ===

...
