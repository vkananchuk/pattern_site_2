---
language: java
before_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: DataUtil
        children: []
        pos: 366
        length: 8
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: private static final Pattern charsetPattern = Pattern.compile("(?i)\\bcharset=\\s*\"?([^\\s;\"]*)");
          children: []
          pos: 381
          length: 100
        - type: field_declaration
          fields:
            text: static final String defaultCharset = "UTF-8";
          children: []
          pos: 486
          length: 45
        - type: field_declaration
          fields:
            text: private static final int bufferSize = 0x20000;
          children: []
          pos: 583
          length: 46
        - type: constructor_declaration
          fields:
            text: private DataUtil() {}
          children: []
          pos: 645
          length: 21
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: load
              children: []
              pos: 966
              length: 4
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: File in
                children: []
                pos: 971
                length: 7
              pos: 943
              length: 449
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: FileInputStream inStream = null;
                children: []
                pos: 1045
                length: 32
              - type: try_statement
                fields:
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: expression_statement
                      fields:
                        text: inStream = new FileInputStream(in);
                      children: []
                      pos: 1104
                      length: 35
                    - type: local_variable_declaration
                      fields:
                        text: ByteBuffer byteData = readToByteBuffer(inStream);
                      children: []
                      pos: 1152
                      length: 49
                    - type: return_statement
                      fields:
                        text: return parseByteData(byteData, charsetName, baseUri,
                          Parser.htmlParser());
                      children: []
                      pos: 1214
                      length: 74
                    pos: 1090
                    length: 208
                  excepts:
                    type: excepts
                    fields: {}
                    children: []
                    pos: 1086
                    length: 300
                children: []
                pos: 1086
                length: 300
              pos: 1035
              length: 357
          children: []
          pos: 943
          length: 449
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: load
              children: []
              pos: 1740
              length: 4
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: InputStream in
                children: []
                pos: 1745
                length: 14
              pos: 1717
              length: 241
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: ByteBuffer byteData = readToByteBuffer(in);
                children: []
                pos: 1826
                length: 43
              - type: return_statement
                fields:
                  text: return parseByteData(byteData, charsetName, baseUri, Parser.htmlParser());
                children: []
                pos: 1878
                length: 74
              pos: 1816
              length: 142
          children: []
          pos: 1717
          length: 241
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: load
              children: []
              pos: 2406
              length: 4
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: InputStream in
                children: []
                pos: 2411
                length: 14
              pos: 2383
              length: 243
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: ByteBuffer byteData = readToByteBuffer(in);
                children: []
                pos: 2507
                length: 43
              - type: return_statement
                fields:
                  text: return parseByteData(byteData, charsetName, baseUri, parser);
                children: []
                pos: 2559
                length: 61
              pos: 2497
              length: 129
          children: []
          pos: 2383
          length: 243
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: parseByteData
              children: []
              pos: 2844
              length: 13
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: ByteBuffer byteData
                children: []
                pos: 2858
                length: 19
              pos: 2828
              length: 2036
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: String docData;
                children: []
                pos: 2940
                length: 15
              - type: local_variable_declaration
                fields:
                  text: Document doc = null;
                children: []
                pos: 2964
                length: 20
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: charsetName
                            children: []
                            pos: 2997
                            length: 11
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 3012
                            length: 4
                        children: []
                        pos: 2997
                        length: 19
                    children: []
                    pos: 2996
                    length: 21
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: docData = Charset.forName(defaultCharset).decode(byteData).toString();
                    children: []
                    pos: 3201
                    length: 70
                  - type: expression_statement
                    fields:
                      text: doc = parser.parseInput(docData, baseUri);
                    children: []
                    pos: 3284
                    length: 42
                  - type: local_variable_declaration
                    fields:
                      text: Element meta = doc.select("meta[http-equiv=content-type],
                        meta[charset]").first();
                    children: []
                    pos: 3339
                    length: 82
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: not_equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: meta
                                children: []
                                pos: 3438
                                length: 4
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 3446
                                length: 4
                            children: []
                            pos: 3438
                            length: 12
                        children: []
                        pos: 3437
                        length: 14
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: local_variable_declaration
                        fields:
                          text: 'String foundCharset = meta.hasAttr("http-equiv")
                            ? getCharsetFromContentType(meta.attr("content")) : meta.attr("charset");'
                        children: []
                        pos: 3519
                        length: 122
                      - type: if_statement
                        fields:
                          condition:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: and
                                fields:
                                  left:
                                    type: and
                                    fields:
                                      left:
                                        type: not_equals
                                        fields:
                                          left:
                                            type: identifier
                                            fields:
                                              text: foundCharset
                                            children: []
                                            pos: 3662
                                            length: 12
                                          right:
                                            type: null_literal
                                            fields: {}
                                            children: []
                                            pos: 3678
                                            length: 4
                                        children: []
                                        pos: 3662
                                        length: 20
                                      right:
                                        type: not_equals
                                        fields:
                                          left:
                                            type: method_invocation
                                            fields:
                                              text: foundCharset.length()
                                            children: []
                                            pos: 3686
                                            length: 21
                                          right:
                                            type: decimal_integer_literal
                                            fields:
                                              text: '0'
                                            children: []
                                            pos: 3711
                                            length: 1
                                        children: []
                                        pos: 3686
                                        length: 26
                                    children: []
                                    pos: 3662
                                    length: 50
                                  right:
                                    type: unary_expression
                                    fields:
                                      text: "!foundCharset.equals(defaultCharset)"
                                    children: []
                                    pos: 3716
                                    length: 36
                                children: []
                                pos: 3662
                                length: 90
                            children: []
                            pos: 3661
                            length: 92
                        children:
                        - type: block
                          fields: {}
                          children:
                          - type: expression_statement
                            fields:
                              text: charsetName = foundCharset;
                            children: []
                            pos: 3797
                            length: 27
                          - type: expression_statement
                            fields:
                              text: byteData.rewind();
                            children: []
                            pos: 3845
                            length: 18
                          - type: expression_statement
                            fields:
                              text: docData = Charset.forName(foundCharset).decode(byteData).toString();
                            children: []
                            pos: 3884
                            length: 68
                          - type: expression_statement
                            fields:
                              text: doc = null;
                            children: []
                            pos: 3973
                            length: 11
                          pos: 3754
                          length: 248
                        pos: 3658
                        length: 344
                      pos: 3452
                      length: 564
                    pos: 3434
                    length: 582
                  pos: 3018
                  length: 1008
                pos: 2993
                length: 1338
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: doc
                            children: []
                            pos: 4344
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 4351
                            length: 4
                        children: []
                        pos: 4344
                        length: 11
                    children: []
                    pos: 4343
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: docData.charAt(0)
                                children: []
                                pos: 4642
                                length: 17
                              right:
                                type: decimal_integer_literal
                                fields:
                                  text: '65279'
                                children: []
                                pos: 4663
                                length: 5
                            children: []
                            pos: 4642
                            length: 26
                        children: []
                        pos: 4641
                        length: 28
                    children:
                    - type: expression_statement
                      fields:
                        text: docData = docData.substring(1);
                      children: []
                      pos: 4686
                      length: 31
                    pos: 4638
                    length: 79
                  - type: expression_statement
                    fields:
                      text: doc = parser.parseInput(docData, baseUri);
                    children: []
                    pos: 4731
                    length: 42
                  - type: expression_statement
                    fields:
                      text: doc.outputSettings().charset(charsetName);
                    children: []
                    pos: 4786
                    length: 42
                  pos: 4357
                  length: 481
                pos: 4340
                length: 498
              - type: return_statement
                fields:
                  text: return doc;
                children: []
                pos: 4847
                length: 11
              pos: 2930
              length: 1934
          children: []
          pos: 2828
          length: 2036
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: readToByteBuffer
              children: []
              pos: 4888
              length: 16
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: InputStream inStream
                children: []
                pos: 4905
                length: 20
              pos: 4870
              length: 481
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: byte[] buffer = new byte[bufferSize];
                children: []
                pos: 4956
                length: 37
              - type: local_variable_declaration
                fields:
                  text: ByteArrayOutputStream outStream = new ByteArrayOutputStream(bufferSize);
                children: []
                pos: 5002
                length: 72
              - type: local_variable_declaration
                fields:
                  text: int read;
                children: []
                pos: 5083
                length: 9
              - type: while_statement
                fields:
                  text: |-
                    while(true) {
                                read  = inStream.read(buffer);
                                if (read == -1) break;
                                outStream.write(buffer, 0, read);
                            }
                children: []
                pos: 5101
                length: 147
              - type: local_variable_declaration
                fields:
                  text: ByteBuffer byteData = ByteBuffer.wrap(outStream.toByteArray());
                children: []
                pos: 5257
                length: 63
              - type: return_statement
                fields:
                  text: return byteData;
                children: []
                pos: 5329
                length: 16
              pos: 4946
              length: 405
          children: []
          pos: 4870
          length: 481
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getCharsetFromContentType
              children: []
              pos: 5667
              length: 25
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String contentType
                children: []
                pos: 5693
                length: 18
              pos: 5653
              length: 456
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: contentType
                            children: []
                            pos: 5727
                            length: 11
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 5742
                            length: 4
                        children: []
                        pos: 5727
                        length: 19
                    children: []
                    pos: 5726
                    length: 21
                children:
                - type: return_statement
                  fields:
                    text: return null;
                  children: []
                  pos: 5748
                  length: 12
                pos: 5723
                length: 37
              - type: local_variable_declaration
                fields:
                  text: Matcher m = charsetPattern.matcher(contentType);
                children: []
                pos: 5769
                length: 48
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: m.find()
                        children: []
                        pos: 5830
                        length: 8
                    children: []
                    pos: 5829
                    length: 10
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: String charset = m.group(1).trim();
                    children: []
                    pos: 5854
                    length: 35
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: method_invocation
                            fields:
                              text: Charset.isSupported(charset)
                            children: []
                            pos: 5906
                            length: 28
                        children: []
                        pos: 5905
                        length: 30
                    children:
                    - type: return_statement
                      fields:
                        text: return charset;
                      children: []
                      pos: 5936
                      length: 15
                    pos: 5902
                    length: 49
                  - type: expression_statement
                    fields:
                      text: charset = charset.toUpperCase(Locale.ENGLISH);
                    children: []
                    pos: 5964
                    length: 46
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: method_invocation
                            fields:
                              text: Charset.isSupported(charset)
                            children: []
                            pos: 6027
                            length: 28
                        children: []
                        pos: 6026
                        length: 30
                    children:
                    - type: return_statement
                      fields:
                        text: return charset;
                      children: []
                      pos: 6057
                      length: 15
                    pos: 6023
                    length: 49
                  pos: 5840
                  length: 242
                pos: 5826
                length: 256
              - type: return_statement
                fields:
                  text: return null;
                children: []
                pos: 6091
                length: 12
              pos: 5713
              length: 396
          children: []
          pos: 5653
          length: 456
        pos: 353
        length: 5768
    children: []
    pos: 353
    length: 5768
  pos: 0
  length: 6122
after_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: DataUtil
        children: []
        pos: 366
        length: 8
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: private static final Pattern charsetPattern = Pattern.compile("(?i)\\bcharset=\\s*\"?([^\\s;\"]*)");
          children: []
          pos: 381
          length: 100
        - type: field_declaration
          fields:
            text: static final String defaultCharset = "UTF-8";
          children: []
          pos: 486
          length: 45
        - type: field_declaration
          fields:
            text: private static final int bufferSize = 0x20000;
          children: []
          pos: 583
          length: 46
        - type: constructor_declaration
          fields:
            text: private DataUtil() {}
          children: []
          pos: 645
          length: 21
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: load
              children: []
              pos: 966
              length: 4
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: File in
                children: []
                pos: 971
                length: 7
              pos: 943
              length: 449
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: FileInputStream inStream = null;
                children: []
                pos: 1045
                length: 32
              - type: try_statement
                fields:
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: expression_statement
                      fields:
                        text: inStream = new FileInputStream(in);
                      children: []
                      pos: 1104
                      length: 35
                    - type: local_variable_declaration
                      fields:
                        text: ByteBuffer byteData = readToByteBuffer(inStream);
                      children: []
                      pos: 1152
                      length: 49
                    - type: return_statement
                      fields:
                        text: return parseByteData(byteData, charsetName, baseUri,
                          Parser.htmlParser());
                      children: []
                      pos: 1214
                      length: 74
                    pos: 1090
                    length: 208
                  excepts:
                    type: excepts
                    fields: {}
                    children: []
                    pos: 1086
                    length: 300
                children: []
                pos: 1086
                length: 300
              pos: 1035
              length: 357
          children: []
          pos: 943
          length: 449
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: load
              children: []
              pos: 1740
              length: 4
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: InputStream in
                children: []
                pos: 1745
                length: 14
              pos: 1717
              length: 241
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: ByteBuffer byteData = readToByteBuffer(in);
                children: []
                pos: 1826
                length: 43
              - type: return_statement
                fields:
                  text: return parseByteData(byteData, charsetName, baseUri, Parser.htmlParser());
                children: []
                pos: 1878
                length: 74
              pos: 1816
              length: 142
          children: []
          pos: 1717
          length: 241
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: load
              children: []
              pos: 2406
              length: 4
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: InputStream in
                children: []
                pos: 2411
                length: 14
              pos: 2383
              length: 243
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: ByteBuffer byteData = readToByteBuffer(in);
                children: []
                pos: 2507
                length: 43
              - type: return_statement
                fields:
                  text: return parseByteData(byteData, charsetName, baseUri, parser);
                children: []
                pos: 2559
                length: 61
              pos: 2497
              length: 129
          children: []
          pos: 2383
          length: 243
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: parseByteData
              children: []
              pos: 2844
              length: 13
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: ByteBuffer byteData
                children: []
                pos: 2858
                length: 19
              pos: 2828
              length: 2036
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: String docData;
                children: []
                pos: 2940
                length: 15
              - type: local_variable_declaration
                fields:
                  text: Document doc = null;
                children: []
                pos: 2964
                length: 20
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: charsetName
                            children: []
                            pos: 2997
                            length: 11
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 3012
                            length: 4
                        children: []
                        pos: 2997
                        length: 19
                    children: []
                    pos: 2996
                    length: 21
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: docData = Charset.forName(defaultCharset).decode(byteData).toString();
                    children: []
                    pos: 3201
                    length: 70
                  - type: expression_statement
                    fields:
                      text: doc = parser.parseInput(docData, baseUri);
                    children: []
                    pos: 3284
                    length: 42
                  - type: local_variable_declaration
                    fields:
                      text: Element meta = doc.select("meta[http-equiv=content-type],
                        meta[charset]").first();
                    children: []
                    pos: 3339
                    length: 82
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: not_equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: meta
                                children: []
                                pos: 3438
                                length: 4
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 3446
                                length: 4
                            children: []
                            pos: 3438
                            length: 12
                        children: []
                        pos: 3437
                        length: 14
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: local_variable_declaration
                        fields:
                          text: 'String foundCharset = meta.hasAttr("http-equiv")
                            ? getCharsetFromContentType(meta.attr("content")) : meta.attr("charset");'
                        children: []
                        pos: 3519
                        length: 122
                      - type: if_statement
                        fields:
                          condition:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: and
                                fields:
                                  left:
                                    type: and
                                    fields:
                                      left:
                                        type: not_equals
                                        fields:
                                          left:
                                            type: identifier
                                            fields:
                                              text: foundCharset
                                            children: []
                                            pos: 3662
                                            length: 12
                                          right:
                                            type: null_literal
                                            fields: {}
                                            children: []
                                            pos: 3678
                                            length: 4
                                        children: []
                                        pos: 3662
                                        length: 20
                                      right:
                                        type: not_equals
                                        fields:
                                          left:
                                            type: method_invocation
                                            fields:
                                              text: foundCharset.length()
                                            children: []
                                            pos: 3686
                                            length: 21
                                          right:
                                            type: decimal_integer_literal
                                            fields:
                                              text: '0'
                                            children: []
                                            pos: 3711
                                            length: 1
                                        children: []
                                        pos: 3686
                                        length: 26
                                    children: []
                                    pos: 3662
                                    length: 50
                                  right:
                                    type: unary_expression
                                    fields:
                                      text: "!foundCharset.equals(defaultCharset)"
                                    children: []
                                    pos: 3716
                                    length: 36
                                children: []
                                pos: 3662
                                length: 90
                            children: []
                            pos: 3661
                            length: 92
                        children:
                        - type: block
                          fields: {}
                          children:
                          - type: expression_statement
                            fields:
                              text: charsetName = foundCharset;
                            children: []
                            pos: 3797
                            length: 27
                          - type: expression_statement
                            fields:
                              text: byteData.rewind();
                            children: []
                            pos: 3845
                            length: 18
                          - type: expression_statement
                            fields:
                              text: docData = Charset.forName(foundCharset).decode(byteData).toString();
                            children: []
                            pos: 3884
                            length: 68
                          - type: expression_statement
                            fields:
                              text: doc = null;
                            children: []
                            pos: 3973
                            length: 11
                          pos: 3754
                          length: 248
                        pos: 3658
                        length: 344
                      pos: 3452
                      length: 564
                    pos: 3434
                    length: 582
                  pos: 3018
                  length: 1008
                pos: 2993
                length: 1338
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: doc
                            children: []
                            pos: 4344
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 4351
                            length: 4
                        children: []
                        pos: 4344
                        length: 11
                    children: []
                    pos: 4343
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: docData.charAt(0)
                                children: []
                                pos: 4642
                                length: 17
                              right:
                                type: decimal_integer_literal
                                fields:
                                  text: '65279'
                                children: []
                                pos: 4663
                                length: 5
                            children: []
                            pos: 4642
                            length: 26
                        children: []
                        pos: 4641
                        length: 28
                    children:
                    - type: expression_statement
                      fields:
                        text: docData = docData.substring(1);
                      children: []
                      pos: 4686
                      length: 31
                    pos: 4638
                    length: 79
                  - type: expression_statement
                    fields:
                      text: doc = parser.parseInput(docData, baseUri);
                    children: []
                    pos: 4731
                    length: 42
                  - type: expression_statement
                    fields:
                      text: doc.outputSettings().charset(charsetName);
                    children: []
                    pos: 4786
                    length: 42
                  pos: 4357
                  length: 481
                pos: 4340
                length: 498
              - type: return_statement
                fields:
                  text: return doc;
                children: []
                pos: 4847
                length: 11
              pos: 2930
              length: 1934
          children: []
          pos: 2828
          length: 2036
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: readToByteBuffer
              children: []
              pos: 4888
              length: 16
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: InputStream inStream
                children: []
                pos: 4905
                length: 20
              pos: 4870
              length: 481
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: byte[] buffer = new byte[bufferSize];
                children: []
                pos: 4956
                length: 37
              - type: local_variable_declaration
                fields:
                  text: ByteArrayOutputStream outStream = new ByteArrayOutputStream(bufferSize);
                children: []
                pos: 5002
                length: 72
              - type: local_variable_declaration
                fields:
                  text: int read;
                children: []
                pos: 5083
                length: 9
              - type: while_statement
                fields:
                  text: |-
                    while(true) {
                                read  = inStream.read(buffer);
                                if (read == -1) break;
                                outStream.write(buffer, 0, read);
                            }
                children: []
                pos: 5101
                length: 147
              - type: local_variable_declaration
                fields:
                  text: ByteBuffer byteData = ByteBuffer.wrap(outStream.toByteArray());
                children: []
                pos: 5257
                length: 63
              - type: return_statement
                fields:
                  text: return byteData;
                children: []
                pos: 5329
                length: 16
              pos: 4946
              length: 405
          children: []
          pos: 4870
          length: 481
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getCharsetFromContentType
              children: []
              pos: 5667
              length: 25
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String contentType
                children: []
                pos: 5693
                length: 18
              pos: 5653
              length: 360
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: contentType
                            children: []
                            pos: 5727
                            length: 11
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 5742
                            length: 4
                        children: []
                        pos: 5727
                        length: 19
                    children: []
                    pos: 5726
                    length: 21
                children:
                - type: return_statement
                  fields:
                    text: return null;
                  children: []
                  pos: 5748
                  length: 12
                pos: 5723
                length: 37
              - type: local_variable_declaration
                fields:
                  text: Matcher m = charsetPattern.matcher(contentType);
                children: []
                pos: 5769
                length: 48
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: m.find()
                        children: []
                        pos: 5830
                        length: 8
                    children: []
                    pos: 5829
                    length: 10
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: String charset = m.group(1).trim();
                    children: []
                    pos: 5854
                    length: 35
                  - type: expression_statement
                    fields:
                      text: charset = charset.toUpperCase(Locale.ENGLISH);
                    children: []
                    pos: 5902
                    length: 46
                  - type: return_statement
                    fields:
                      text: return charset;
                    children: []
                    pos: 5961
                    length: 15
                  pos: 5840
                  length: 146
                pos: 5826
                length: 160
              - type: return_statement
                fields:
                  text: return null;
                children: []
                pos: 5995
                length: 12
              pos: 5713
              length: 300
          children: []
          pos: 5653
          length: 360
        pos: 353
        length: 5672
    children: []
    pos: 353
    length: 5672
  pos: 0
  length: 6026
text_diff: |
  --- before
  +++ after
  @@ -129,9 +129,8 @@
           Matcher m = charsetPattern.matcher(contentType);
           if (m.find()) {
               String charset = m.group(1).trim();
  -            if (Charset.isSupported(charset)) return charset;
               charset = charset.toUpperCase(Locale.ENGLISH);
  -            if (Charset.isSupported(charset)) return charset;
  +            return charset;
           }
           return null;
       }
tree_diff: |+
  New cluster:
  ===
  insert-node
  ---
  return_statement: return charset; [5961,5976]
  to
  block [5840,6082]
  at 3
  ------------
  ===
  insert-node
  ---
  return_statement: return charset; [5961,5976]
  to
  block [5840,6082]
  at 3

  New cluster:
  Unknown cluster type
  ------------
  ===
  delete-tree
  ---
  if_statement [5902,5951]
      parenthesized_expression [5905,5935]
          method_invocation: Charset.isSupported(charset) [5906,5934]
      return_statement: return charset; [5936,5951]

  New cluster:
  Unknown cluster type
  ------------
  ===
  delete-tree
  ---
  if_statement [6023,6072]
      parenthesized_expression [6026,6056]
          method_invocation: Charset.isSupported(charset) [6027,6055]
      return_statement: return charset; [6057,6072]

...
