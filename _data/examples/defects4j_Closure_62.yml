---
language: java
before_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: LightweightMessageFormatter
        children: []
        pos: 1123
        length: 27
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: private SourceExcerpt excerpt;
          children: []
          pos: 1188
          length: 30
        - type: field_declaration
          fields:
            text: |-
              private static final ExcerptFormatter excerptFormatter =
                    new LineNumberingFormatter();
          children: []
          pos: 1221
          length: 92
        - type: constructor_declaration
          fields:
            text: |-
              private LightweightMessageFormatter() {
                  super(null);
                  this.excerpt = LINE;
                }
          children: []
          pos: 1407
          length: 85
        - type: constructor_declaration
          fields:
            text: |-
              public LightweightMessageFormatter(SourceExcerptProvider source) {
                  this(source, LINE);
                }
          children: []
          pos: 1496
          length: 94
        - type: constructor_declaration
          fields:
            text: |-
              public LightweightMessageFormatter(SourceExcerptProvider source,
                    SourceExcerpt excerpt) {
                  super(source);
                  Preconditions.checkNotNull(source);
                  this.excerpt = excerpt;
                }
          children: []
          pos: 1594
          length: 186
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: withoutSource
              children: []
              pos: 1819
              length: 13
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 1784
              length: 102
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return new LightweightMessageFormatter();
                children: []
                pos: 1841
                length: 41
              pos: 1835
              length: 51
          children: []
          pos: 1784
          length: 102
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: formatError
              children: []
              pos: 1904
              length: 11
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JSError error
                children: []
                pos: 1916
                length: 13
              pos: 1890
              length: 79
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return format(error, false);
                children: []
                pos: 1937
                length: 28
              pos: 1931
              length: 38
          children: []
          pos: 1890
          length: 79
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: formatWarning
              children: []
              pos: 1987
              length: 13
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JSError warning
                children: []
                pos: 2001
                length: 15
              pos: 1973
              length: 84
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return format(warning, true);
                children: []
                pos: 2024
                length: 29
              pos: 2018
              length: 39
          children: []
          pos: 1973
          length: 84
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: format
              children: []
              pos: 2076
              length: 6
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JSError error
                children: []
                pos: 2083
                length: 13
              pos: 2061
              length: 1376
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: SourceExcerptProvider source = getSource();
                children: []
                pos: 2151
                length: 43
              - type: local_variable_declaration
                fields:
                  text: |-
                    String sourceExcerpt = source == null ? null :
                            excerpt.get(
                                source, error.sourceName, error.lineNumber, excerptFormatter);
                children: []
                pos: 2199
                length: 142
              - type: local_variable_declaration
                fields:
                  text: StringBuilder b = new StringBuilder();
                children: []
                pos: 2377
                length: 38
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: field_access
                            fields:
                              text: error.sourceName
                            children: []
                            pos: 2424
                            length: 16
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 2444
                            length: 4
                        children: []
                        pos: 2424
                        length: 24
                    children: []
                    pos: 2423
                    length: 26
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: b.append(error.sourceName);
                    children: []
                    pos: 2458
                    length: 27
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: greater_than
                            fields:
                              left:
                                type: field_access
                                fields:
                                  text: error.lineNumber
                                children: []
                                pos: 2496
                                length: 16
                              right:
                                type: decimal_integer_literal
                                fields:
                                  text: '0'
                                children: []
                                pos: 2515
                                length: 1
                            children: []
                            pos: 2496
                            length: 20
                        children: []
                        pos: 2495
                        length: 22
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: expression_statement
                        fields:
                          text: b.append(':');
                        children: []
                        pos: 2528
                        length: 14
                      - type: expression_statement
                        fields:
                          text: b.append(error.lineNumber);
                        children: []
                        pos: 2551
                        length: 27
                      pos: 2518
                      length: 68
                    pos: 2492
                    length: 94
                  - type: expression_statement
                    fields:
                      text: 'b.append(": ");'
                    children: []
                    pos: 2593
                    length: 15
                  pos: 2450
                  length: 164
                pos: 2420
                length: 194
              - type: expression_statement
                fields:
                  text: 'b.append(getLevelName(warning ? CheckLevel.WARNING : CheckLevel.ERROR));'
                children: []
                pos: 2620
                length: 72
              - type: expression_statement
                fields:
                  text: b.append(" - ");
                children: []
                pos: 2697
                length: 16
              - type: expression_statement
                fields:
                  text: b.append(error.description);
                children: []
                pos: 2719
                length: 28
              - type: expression_statement
                fields:
                  text: b.append('\n');
                children: []
                pos: 2752
                length: 15
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: sourceExcerpt
                            children: []
                            pos: 2776
                            length: 13
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 2793
                            length: 4
                        children: []
                        pos: 2776
                        length: 21
                    children: []
                    pos: 2775
                    length: 23
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: b.append(sourceExcerpt);
                    children: []
                    pos: 2807
                    length: 24
                  - type: expression_statement
                    fields:
                      text: b.append('\n');
                    children: []
                    pos: 2838
                    length: 15
                  - type: local_variable_declaration
                    fields:
                      text: int charno = error.getCharno();
                    children: []
                    pos: 2860
                    length: 31
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: and
                            fields:
                              left:
                                type: and
                                fields:
                                  left:
                                    type: method_invocation
                                    fields:
                                      text: excerpt.equals(LINE)
                                    children: []
                                    pos: 3062
                                    length: 20
                                  right:
                                    type: less_or_equals
                                    fields:
                                      left:
                                        type: decimal_integer_literal
                                        fields:
                                          text: '0'
                                        children: []
                                        pos: 3096
                                        length: 1
                                      right:
                                        type: identifier
                                        fields:
                                          text: charno
                                        children: []
                                        pos: 3101
                                        length: 6
                                    children: []
                                    pos: 3096
                                    length: 11
                                children: []
                                pos: 3062
                                length: 45
                              right:
                                type: less_or_equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: charno
                                    children: []
                                    pos: 3111
                                    length: 6
                                  right:
                                    type: method_invocation
                                    fields:
                                      text: sourceExcerpt.length()
                                    children: []
                                    pos: 3121
                                    length: 22
                                children: []
                                pos: 3111
                                length: 32
                            children: []
                            pos: 3062
                            length: 81
                        children: []
                        pos: 3061
                        length: 83
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: for_statement
                        fields:
                          text: |-
                            for (int i = 0; i < charno; i++) {
                                      char c = sourceExcerpt.charAt(i);
                                      if (Character.isWhitespace(c)) {
                                        b.append(c);
                                      } else {
                                        b.append(' ');
                                      }
                                    }
                        children: []
                        pos: 3155
                        length: 214
                      - type: expression_statement
                        fields:
                          text: b.append("^\n");
                        children: []
                        pos: 3378
                        length: 16
                      pos: 3145
                      length: 257
                    pos: 3058
                    length: 344
                  pos: 2799
                  length: 609
                pos: 2772
                length: 636
              - type: return_statement
                fields:
                  text: return b.toString();
                children: []
                pos: 3413
                length: 20
              pos: 2115
              length: 1322
          children: []
          pos: 2061
          length: 1376
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: LineNumberingFormatter
              children: []
              pos: 3657
              length: 22
            body:
              type: class_body
              fields: {}
              children:
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: formatLine
                    children: []
                    pos: 3728
                    length: 10
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: String line
                      children: []
                      pos: 3739
                      length: 11
                    pos: 3714
                    length: 80
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return line;
                      children: []
                      pos: 3776
                      length: 12
                    pos: 3768
                    length: 26
                children: []
                pos: 3714
                length: 80
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: formatRegion
                    children: []
                    pos: 3814
                    length: 12
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Region region
                      children: []
                      pos: 3827
                      length: 13
                    pos: 3800
                    length: 1476
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: equals
                              fields:
                                left:
                                  type: identifier
                                  fields:
                                    text: region
                                  children: []
                                  pos: 3854
                                  length: 6
                                right:
                                  type: null_literal
                                  fields: {}
                                  children: []
                                  pos: 3864
                                  length: 4
                              children: []
                              pos: 3854
                              length: 14
                          children: []
                          pos: 3853
                          length: 16
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return null;
                          children: []
                          pos: 3880
                          length: 12
                        pos: 3870
                        length: 30
                      pos: 3850
                      length: 50
                    - type: local_variable_declaration
                      fields:
                        text: String code = region.getSourceExcerpt();
                      children: []
                      pos: 3907
                      length: 40
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: equals
                              fields:
                                left:
                                  type: method_invocation
                                  fields:
                                    text: code.length()
                                  children: []
                                  pos: 3958
                                  length: 13
                                right:
                                  type: decimal_integer_literal
                                  fields:
                                    text: '0'
                                  children: []
                                  pos: 3975
                                  length: 1
                              children: []
                              pos: 3958
                              length: 18
                          children: []
                          pos: 3957
                          length: 20
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return null;
                          children: []
                          pos: 3988
                          length: 12
                        pos: 3978
                        length: 30
                      pos: 3954
                      length: 54
                    - type: local_variable_declaration
                      fields:
                        text: |-
                          int numberLength = Integer.toString(region.getEndingLineNumber())
                                    .length();
                      children: []
                      pos: 4058
                      length: 86
                    - type: local_variable_declaration
                      fields:
                        text: StringBuilder builder = new StringBuilder(code.length()
                          * 2);
                      children: []
                      pos: 4172
                      length: 61
                    - type: local_variable_declaration
                      fields:
                        text: int start = 0;
                      children: []
                      pos: 4240
                      length: 14
                    - type: local_variable_declaration
                      fields:
                        text: int end = code.indexOf('\n', start);
                      children: []
                      pos: 4261
                      length: 36
                    - type: local_variable_declaration
                      fields:
                        text: int lineNumber = region.getBeginningLineNumber();
                      children: []
                      pos: 4304
                      length: 49
                    - type: while_statement
                      fields:
                        text: |-
                          while (start >= 0) {
                                  // line extraction
                                  String line;
                                  if (end < 0) {
                                    line = code.substring(start);
                                    if (line.length() == 0) {
                                      return builder.substring(0, builder.length() - 1);
                                    }
                                  } else {
                                    line = code.substring(start, end);
                                  }
                                  builder.append("  ");

                                  // nice spaces for the line number
                                  int spaces = numberLength - Integer.toString(lineNumber).length();
                                  builder.append(Strings.repeat(" ", spaces));
                                  builder.append(lineNumber);
                                  builder.append("| ");

                                  // end & update
                                  if (end < 0) {
                                    builder.append(line);
                                    start = -1;
                                  } else {
                                    builder.append(line);
                                    builder.append('\n');
                                    start = end + 1;
                                    end = code.indexOf('\n', start);
                                    lineNumber++;
                                  }
                                }
                      children: []
                      pos: 4360
                      length: 877
                    - type: return_statement
                      fields:
                        text: return builder.toString();
                      children: []
                      pos: 5244
                      length: 26
                    pos: 3842
                    length: 1434
                children: []
                pos: 3800
                length: 1476
              pos: 3644
              length: 1636
          children: []
          pos: 3644
          length: 1636
        pos: 1110
        length: 4172
    children: []
    pos: 1110
    length: 4172
  pos: 0
  length: 5283
after_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: LightweightMessageFormatter
        children: []
        pos: 1123
        length: 27
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: private SourceExcerpt excerpt;
          children: []
          pos: 1188
          length: 30
        - type: field_declaration
          fields:
            text: |-
              private static final ExcerptFormatter excerptFormatter =
                    new LineNumberingFormatter();
          children: []
          pos: 1221
          length: 92
        - type: constructor_declaration
          fields:
            text: |-
              private LightweightMessageFormatter() {
                  super(null);
                  this.excerpt = LINE;
                }
          children: []
          pos: 1407
          length: 85
        - type: constructor_declaration
          fields:
            text: |-
              public LightweightMessageFormatter(SourceExcerptProvider source) {
                  this(source, LINE);
                }
          children: []
          pos: 1496
          length: 94
        - type: constructor_declaration
          fields:
            text: |-
              public LightweightMessageFormatter(SourceExcerptProvider source,
                    SourceExcerpt excerpt) {
                  super(source);
                  Preconditions.checkNotNull(source);
                  this.excerpt = excerpt;
                }
          children: []
          pos: 1594
          length: 186
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: withoutSource
              children: []
              pos: 1819
              length: 13
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 1784
              length: 102
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return new LightweightMessageFormatter();
                children: []
                pos: 1841
                length: 41
              pos: 1835
              length: 51
          children: []
          pos: 1784
          length: 102
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: formatError
              children: []
              pos: 1904
              length: 11
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JSError error
                children: []
                pos: 1916
                length: 13
              pos: 1890
              length: 79
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return format(error, false);
                children: []
                pos: 1937
                length: 28
              pos: 1931
              length: 38
          children: []
          pos: 1890
          length: 79
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: formatWarning
              children: []
              pos: 1987
              length: 13
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JSError warning
                children: []
                pos: 2001
                length: 15
              pos: 1973
              length: 84
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return format(warning, true);
                children: []
                pos: 2024
                length: 29
              pos: 2018
              length: 39
          children: []
          pos: 1973
          length: 84
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: format
              children: []
              pos: 2076
              length: 6
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JSError error
                children: []
                pos: 2083
                length: 13
              pos: 2061
              length: 1375
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: SourceExcerptProvider source = getSource();
                children: []
                pos: 2151
                length: 43
              - type: local_variable_declaration
                fields:
                  text: |-
                    String sourceExcerpt = source == null ? null :
                            excerpt.get(
                                source, error.sourceName, error.lineNumber, excerptFormatter);
                children: []
                pos: 2199
                length: 142
              - type: local_variable_declaration
                fields:
                  text: StringBuilder b = new StringBuilder();
                children: []
                pos: 2377
                length: 38
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: field_access
                            fields:
                              text: error.sourceName
                            children: []
                            pos: 2424
                            length: 16
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 2444
                            length: 4
                        children: []
                        pos: 2424
                        length: 24
                    children: []
                    pos: 2423
                    length: 26
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: b.append(error.sourceName);
                    children: []
                    pos: 2458
                    length: 27
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: greater_than
                            fields:
                              left:
                                type: field_access
                                fields:
                                  text: error.lineNumber
                                children: []
                                pos: 2496
                                length: 16
                              right:
                                type: decimal_integer_literal
                                fields:
                                  text: '0'
                                children: []
                                pos: 2515
                                length: 1
                            children: []
                            pos: 2496
                            length: 20
                        children: []
                        pos: 2495
                        length: 22
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: expression_statement
                        fields:
                          text: b.append(':');
                        children: []
                        pos: 2528
                        length: 14
                      - type: expression_statement
                        fields:
                          text: b.append(error.lineNumber);
                        children: []
                        pos: 2551
                        length: 27
                      pos: 2518
                      length: 68
                    pos: 2492
                    length: 94
                  - type: expression_statement
                    fields:
                      text: 'b.append(": ");'
                    children: []
                    pos: 2593
                    length: 15
                  pos: 2450
                  length: 164
                pos: 2420
                length: 194
              - type: expression_statement
                fields:
                  text: 'b.append(getLevelName(warning ? CheckLevel.WARNING : CheckLevel.ERROR));'
                children: []
                pos: 2620
                length: 72
              - type: expression_statement
                fields:
                  text: b.append(" - ");
                children: []
                pos: 2697
                length: 16
              - type: expression_statement
                fields:
                  text: b.append(error.description);
                children: []
                pos: 2719
                length: 28
              - type: expression_statement
                fields:
                  text: b.append('\n');
                children: []
                pos: 2752
                length: 15
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: sourceExcerpt
                            children: []
                            pos: 2776
                            length: 13
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 2793
                            length: 4
                        children: []
                        pos: 2776
                        length: 21
                    children: []
                    pos: 2775
                    length: 23
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: b.append(sourceExcerpt);
                    children: []
                    pos: 2807
                    length: 24
                  - type: expression_statement
                    fields:
                      text: b.append('\n');
                    children: []
                    pos: 2838
                    length: 15
                  - type: local_variable_declaration
                    fields:
                      text: int charno = error.getCharno();
                    children: []
                    pos: 2860
                    length: 31
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: and
                            fields:
                              left:
                                type: and
                                fields:
                                  left:
                                    type: method_invocation
                                    fields:
                                      text: excerpt.equals(LINE)
                                    children: []
                                    pos: 3062
                                    length: 20
                                  right:
                                    type: less_or_equals
                                    fields:
                                      left:
                                        type: decimal_integer_literal
                                        fields:
                                          text: '0'
                                        children: []
                                        pos: 3096
                                        length: 1
                                      right:
                                        type: identifier
                                        fields:
                                          text: charno
                                        children: []
                                        pos: 3101
                                        length: 6
                                    children: []
                                    pos: 3096
                                    length: 11
                                children: []
                                pos: 3062
                                length: 45
                              right:
                                type: less_than
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: charno
                                    children: []
                                    pos: 3111
                                    length: 6
                                  right:
                                    type: method_invocation
                                    fields:
                                      text: sourceExcerpt.length()
                                    children: []
                                    pos: 3120
                                    length: 22
                                children: []
                                pos: 3111
                                length: 31
                            children: []
                            pos: 3062
                            length: 80
                        children: []
                        pos: 3061
                        length: 82
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: for_statement
                        fields:
                          text: |-
                            for (int i = 0; i < charno; i++) {
                                      char c = sourceExcerpt.charAt(i);
                                      if (Character.isWhitespace(c)) {
                                        b.append(c);
                                      } else {
                                        b.append(' ');
                                      }
                                    }
                        children: []
                        pos: 3154
                        length: 214
                      - type: expression_statement
                        fields:
                          text: b.append("^\n");
                        children: []
                        pos: 3377
                        length: 16
                      pos: 3144
                      length: 257
                    pos: 3058
                    length: 343
                  pos: 2799
                  length: 608
                pos: 2772
                length: 635
              - type: return_statement
                fields:
                  text: return b.toString();
                children: []
                pos: 3412
                length: 20
              pos: 2115
              length: 1321
          children: []
          pos: 2061
          length: 1375
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: LineNumberingFormatter
              children: []
              pos: 3656
              length: 22
            body:
              type: class_body
              fields: {}
              children:
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: formatLine
                    children: []
                    pos: 3727
                    length: 10
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: String line
                      children: []
                      pos: 3738
                      length: 11
                    pos: 3713
                    length: 80
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return line;
                      children: []
                      pos: 3775
                      length: 12
                    pos: 3767
                    length: 26
                children: []
                pos: 3713
                length: 80
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: formatRegion
                    children: []
                    pos: 3813
                    length: 12
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Region region
                      children: []
                      pos: 3826
                      length: 13
                    pos: 3799
                    length: 1476
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: equals
                              fields:
                                left:
                                  type: identifier
                                  fields:
                                    text: region
                                  children: []
                                  pos: 3853
                                  length: 6
                                right:
                                  type: null_literal
                                  fields: {}
                                  children: []
                                  pos: 3863
                                  length: 4
                              children: []
                              pos: 3853
                              length: 14
                          children: []
                          pos: 3852
                          length: 16
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return null;
                          children: []
                          pos: 3879
                          length: 12
                        pos: 3869
                        length: 30
                      pos: 3849
                      length: 50
                    - type: local_variable_declaration
                      fields:
                        text: String code = region.getSourceExcerpt();
                      children: []
                      pos: 3906
                      length: 40
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: equals
                              fields:
                                left:
                                  type: method_invocation
                                  fields:
                                    text: code.length()
                                  children: []
                                  pos: 3957
                                  length: 13
                                right:
                                  type: decimal_integer_literal
                                  fields:
                                    text: '0'
                                  children: []
                                  pos: 3974
                                  length: 1
                              children: []
                              pos: 3957
                              length: 18
                          children: []
                          pos: 3956
                          length: 20
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return null;
                          children: []
                          pos: 3987
                          length: 12
                        pos: 3977
                        length: 30
                      pos: 3953
                      length: 54
                    - type: local_variable_declaration
                      fields:
                        text: |-
                          int numberLength = Integer.toString(region.getEndingLineNumber())
                                    .length();
                      children: []
                      pos: 4057
                      length: 86
                    - type: local_variable_declaration
                      fields:
                        text: StringBuilder builder = new StringBuilder(code.length()
                          * 2);
                      children: []
                      pos: 4171
                      length: 61
                    - type: local_variable_declaration
                      fields:
                        text: int start = 0;
                      children: []
                      pos: 4239
                      length: 14
                    - type: local_variable_declaration
                      fields:
                        text: int end = code.indexOf('\n', start);
                      children: []
                      pos: 4260
                      length: 36
                    - type: local_variable_declaration
                      fields:
                        text: int lineNumber = region.getBeginningLineNumber();
                      children: []
                      pos: 4303
                      length: 49
                    - type: while_statement
                      fields:
                        text: |-
                          while (start >= 0) {
                                  // line extraction
                                  String line;
                                  if (end < 0) {
                                    line = code.substring(start);
                                    if (line.length() == 0) {
                                      return builder.substring(0, builder.length() - 1);
                                    }
                                  } else {
                                    line = code.substring(start, end);
                                  }
                                  builder.append("  ");

                                  // nice spaces for the line number
                                  int spaces = numberLength - Integer.toString(lineNumber).length();
                                  builder.append(Strings.repeat(" ", spaces));
                                  builder.append(lineNumber);
                                  builder.append("| ");

                                  // end & update
                                  if (end < 0) {
                                    builder.append(line);
                                    start = -1;
                                  } else {
                                    builder.append(line);
                                    builder.append('\n');
                                    start = end + 1;
                                    end = code.indexOf('\n', start);
                                    lineNumber++;
                                  }
                                }
                      children: []
                      pos: 4359
                      length: 877
                    - type: return_statement
                      fields:
                        text: return builder.toString();
                      children: []
                      pos: 5243
                      length: 26
                    pos: 3841
                    length: 1434
                children: []
                pos: 3799
                length: 1476
              pos: 3643
              length: 1636
          children: []
          pos: 3643
          length: 1636
        pos: 1110
        length: 4171
    children: []
    pos: 1110
    length: 4171
  pos: 0
  length: 5282
text_diff: |
  --- before
  +++ after
  @@ -95,7 +95,7 @@
         // charno == sourceExpert.length() means something is missing
         // at the end of the line
         if (excerpt.equals(LINE)
  -          && 0 <= charno && charno <= sourceExcerpt.length()) {
  +          && 0 <= charno && charno < sourceExcerpt.length()) {
           for (int i = 0; i < charno; i++) {
             char c = sourceExcerpt.charAt(i);
             if (Character.isWhitespace(c)) {
tree_diff: |+
  New cluster:
  Unknown cluster type
  ------------
  ===
  insert-tree
  ---
  less_than [3111,3142]
      identifier: charno [3111,3117]
      method_invocation: sourceExcerpt.length() [3120,3142]
  to
  and [3062,3143]
  at 1

  New cluster:
  Unknown cluster type
  ------------
  ===
  delete-tree
  ---
  less_or_equals [3111,3143]
      identifier: charno [3111,3117]
      method_invocation: sourceExcerpt.length() [3121,3143]

...
