---
language: java
before_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: CheckGlobalThis
        children: []
        pos: 1838
        length: 15
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType GLOBAL_THIS = DiagnosticType.warning(
                    "JSC_USED_GLOBAL_THIS",
                    "dangerous use of the global 'this' object");
          children: []
          pos: 1879
          length: 147
        - type: field_declaration
          fields:
            text: private final AbstractCompiler compiler;
          children: []
          pos: 2030
          length: 40
        - type: field_declaration
          fields:
            text: private final CheckLevel level;
          children: []
          pos: 2073
          length: 31
        - type: field_declaration
          fields:
            text: private Node assignLhsChild = null;
          children: []
          pos: 2301
          length: 35
        - type: constructor_declaration
          fields:
            text: |-
              CheckGlobalThis(AbstractCompiler compiler, CheckLevel level) {
                  this.compiler = compiler;
                  this.level = level;
                }
          children: []
          pos: 2340
          length: 120
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: shouldTraverse
              children: []
              pos: 2640
              length: 14
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 2655
                length: 15
              pos: 2625
              length: 1921
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: method_invocation
                            fields:
                              text: n.getType()
                            children: []
                            pos: 2704
                            length: 11
                          right:
                            type: field_access
                            fields:
                              text: Token.FUNCTION
                            children: []
                            pos: 2719
                            length: 14
                        children: []
                        pos: 2704
                        length: 29
                    children: []
                    pos: 2703
                    length: 31
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: JSDocInfo jsDoc = getFunctionJsDocInfo(n);
                    children: []
                    pos: 2851
                    length: 42
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: and
                            fields:
                              left:
                                type: not_equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: jsDoc
                                    children: []
                                    pos: 2904
                                    length: 5
                                  right:
                                    type: null_literal
                                    fields: {}
                                    children: []
                                    pos: 2913
                                    length: 4
                                children: []
                                pos: 2904
                                length: 13
                              right:
                                type: parenthesized_expression
                                fields:
                                  expression:
                                    type: or
                                    fields:
                                      left:
                                        type: or
                                        fields:
                                          left:
                                            type: or
                                            fields:
                                              left:
                                                type: method_invocation
                                                fields:
                                                  text: jsDoc.isConstructor()
                                                children: []
                                                pos: 2932
                                                length: 21
                                              right:
                                                type: method_invocation
                                                fields:
                                                  text: jsDoc.isInterface()
                                                children: []
                                                pos: 2968
                                                length: 19
                                            children: []
                                            pos: 2932
                                            length: 55
                                          right:
                                            type: method_invocation
                                            fields:
                                              text: jsDoc.hasThisType()
                                            children: []
                                            pos: 3002
                                            length: 19
                                        children: []
                                        pos: 2932
                                        length: 89
                                      right:
                                        type: method_invocation
                                        fields:
                                          text: jsDoc.isOverride()
                                        children: []
                                        pos: 3036
                                        length: 18
                                    children: []
                                    pos: 2932
                                    length: 122
                                children: []
                                pos: 2931
                                length: 124
                            children: []
                            pos: 2904
                            length: 151
                        children: []
                        pos: 2903
                        length: 153
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: return_statement
                        fields:
                          text: return false;
                        children: []
                        pos: 3067
                        length: 13
                      pos: 3057
                      length: 31
                    pos: 2900
                    length: 188
                  - type: local_variable_declaration
                    fields:
                      text: int pType = parent.getType();
                    children: []
                    pos: 3329
                    length: 29
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: unary_expression
                            fields:
                              text: |-
                                !(pType == Token.BLOCK ||
                                            pType == Token.SCRIPT ||
                                            pType == Token.NAME ||
                                            pType == Token.ASSIGN)
                            children: []
                            pos: 3369
                            length: 132
                        children: []
                        pos: 3368
                        length: 134
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: return_statement
                        fields:
                          text: return false;
                        children: []
                        pos: 3513
                        length: 13
                      pos: 3503
                      length: 31
                    pos: 3365
                    length: 169
                  pos: 2735
                  length: 805
                pos: 2700
                length: 840
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: and
                        fields:
                          left:
                            type: not_equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: parent
                                children: []
                                pos: 3550
                                length: 6
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 3560
                                length: 4
                            children: []
                            pos: 3550
                            length: 14
                          right:
                            type: equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: parent.getType()
                                children: []
                                pos: 3568
                                length: 16
                              right:
                                type: field_access
                                fields:
                                  text: Token.ASSIGN
                                children: []
                                pos: 3588
                                length: 12
                            children: []
                            pos: 3568
                            length: 32
                        children: []
                        pos: 3550
                        length: 50
                    children: []
                    pos: 3549
                    length: 52
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: Node lhs = parent.getFirstChild();
                    children: []
                    pos: 3610
                    length: 34
                  - type: local_variable_declaration
                    fields:
                      text: Node rhs = lhs.getNext();
                    children: []
                    pos: 3651
                    length: 25
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: "n"
                                children: []
                                pos: 3694
                                length: 1
                              right:
                                type: identifier
                                fields:
                                  text: lhs
                                children: []
                                pos: 3699
                                length: 3
                            children: []
                            pos: 3694
                            length: 8
                        children: []
                        pos: 3693
                        length: 10
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: if_statement
                        fields:
                          condition:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: assignLhsChild
                                    children: []
                                    pos: 3913
                                    length: 14
                                  right:
                                    type: null_literal
                                    fields: {}
                                    children: []
                                    pos: 3931
                                    length: 4
                                children: []
                                pos: 3913
                                length: 22
                            children: []
                            pos: 3912
                            length: 24
                        children:
                        - type: block
                          fields: {}
                          children:
                          - type: expression_statement
                            fields:
                              text: assignLhsChild = lhs;
                            children: []
                            pos: 3949
                            length: 21
                          pos: 3937
                          length: 43
                        pos: 3909
                        length: 71
                      pos: 3704
                      length: 284
                    pos: 3690
                    length: 828
                  pos: 3602
                  length: 922
                pos: 3546
                length: 978
              - type: return_statement
                fields:
                  text: return true;
                children: []
                pos: 4530
                length: 12
              pos: 2693
              length: 1853
          children: []
          pos: 2625
          length: 1921
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: visit
              children: []
              pos: 4562
              length: 5
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 4568
                length: 15
              pos: 4550
              length: 260
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: and
                        fields:
                          left:
                            type: equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: n.getType()
                                children: []
                                pos: 4616
                                length: 11
                              right:
                                type: field_access
                                fields:
                                  text: Token.THIS
                                children: []
                                pos: 4631
                                length: 10
                            children: []
                            pos: 4616
                            length: 25
                          right:
                            type: method_invocation
                            fields:
                              text: shouldReportThis(n, parent)
                            children: []
                            pos: 4645
                            length: 27
                        children: []
                        pos: 4616
                        length: 56
                    children: []
                    pos: 4615
                    length: 58
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: compiler.report(t.makeError(n, level, GLOBAL_THIS));
                    children: []
                    pos: 4682
                    length: 52
                  pos: 4674
                  length: 66
                pos: 4612
                length: 128
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: "n"
                            children: []
                            pos: 4749
                            length: 1
                          right:
                            type: identifier
                            fields:
                              text: assignLhsChild
                            children: []
                            pos: 4754
                            length: 14
                        children: []
                        pos: 4749
                        length: 19
                    children: []
                    pos: 4748
                    length: 21
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: assignLhsChild = null;
                    children: []
                    pos: 4778
                    length: 22
                  pos: 4770
                  length: 36
                pos: 4745
                length: 61
              pos: 4606
              length: 204
          children: []
          pos: 4550
          length: 260
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: shouldReportThis
              children: []
              pos: 4830
              length: 16
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Node n
                children: []
                pos: 4847
                length: 6
              pos: 4814
              length: 283
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: assignLhsChild
                            children: []
                            pos: 4878
                            length: 14
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 4896
                            length: 4
                        children: []
                        pos: 4878
                        length: 22
                    children: []
                    pos: 4877
                    length: 24
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return true;
                    children: []
                    pos: 4971
                    length: 12
                  pos: 4902
                  length: 87
                pos: 4874
                length: 115
              - type: return_statement
                fields:
                  text: return parent != null && NodeUtil.isGet(parent);
                children: []
                pos: 5045
                length: 48
              pos: 4868
              length: 229
          children: []
          pos: 4814
          length: 283
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getFunctionJsDocInfo
              children: []
              pos: 5395
              length: 20
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Node n
                children: []
                pos: 5416
                length: 6
              pos: 5377
              length: 543
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: JSDocInfo jsDoc = n.getJSDocInfo();
                children: []
                pos: 5430
                length: 35
              - type: local_variable_declaration
                fields:
                  text: Node parent = n.getParent();
                children: []
                pos: 5470
                length: 28
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: jsDoc
                            children: []
                            pos: 5507
                            length: 5
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 5516
                            length: 4
                        children: []
                        pos: 5507
                        length: 13
                    children: []
                    pos: 5506
                    length: 15
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: int parentType = parent.getType();
                    children: []
                    pos: 5530
                    length: 34
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: or
                            fields:
                              left:
                                type: equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: parentType
                                    children: []
                                    pos: 5575
                                    length: 10
                                  right:
                                    type: field_access
                                    fields:
                                      text: Token.NAME
                                    children: []
                                    pos: 5589
                                    length: 10
                                children: []
                                pos: 5575
                                length: 24
                              right:
                                type: equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: parentType
                                    children: []
                                    pos: 5603
                                    length: 10
                                  right:
                                    type: field_access
                                    fields:
                                      text: Token.ASSIGN
                                    children: []
                                    pos: 5617
                                    length: 12
                                children: []
                                pos: 5603
                                length: 26
                            children: []
                            pos: 5575
                            length: 54
                        children: []
                        pos: 5574
                        length: 56
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: expression_statement
                        fields:
                          text: jsDoc = parent.getJSDocInfo();
                        children: []
                        pos: 5641
                        length: 30
                      - type: if_statement
                        fields:
                          condition:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: and
                                fields:
                                  left:
                                    type: equals
                                    fields:
                                      left:
                                        type: identifier
                                        fields:
                                          text: jsDoc
                                        children: []
                                        pos: 5684
                                        length: 5
                                      right:
                                        type: null_literal
                                        fields: {}
                                        children: []
                                        pos: 5693
                                        length: 4
                                    children: []
                                    pos: 5684
                                    length: 13
                                  right:
                                    type: equals
                                    fields:
                                      left:
                                        type: identifier
                                        fields:
                                          text: parentType
                                        children: []
                                        pos: 5701
                                        length: 10
                                      right:
                                        type: field_access
                                        fields:
                                          text: Token.NAME
                                        children: []
                                        pos: 5715
                                        length: 10
                                    children: []
                                    pos: 5701
                                    length: 24
                                children: []
                                pos: 5684
                                length: 41
                            children: []
                            pos: 5683
                            length: 43
                        children:
                        - type: block
                          fields: {}
                          children:
                          - type: local_variable_declaration
                            fields:
                              text: Node gramps = parent.getParent();
                            children: []
                            pos: 5739
                            length: 33
                          - type: if_statement
                            fields:
                              condition:
                                type: parenthesized_expression
                                fields:
                                  expression:
                                    type: equals
                                    fields:
                                      left:
                                        type: method_invocation
                                        fields:
                                          text: gramps.getType()
                                        children: []
                                        pos: 5787
                                        length: 16
                                      right:
                                        type: field_access
                                        fields:
                                          text: Token.VAR
                                        children: []
                                        pos: 5807
                                        length: 9
                                    children: []
                                    pos: 5787
                                    length: 29
                                children: []
                                pos: 5786
                                length: 31
                            children:
                            - type: block
                              fields: {}
                              children:
                              - type: expression_statement
                                fields:
                                  text: jsDoc = gramps.getJSDocInfo();
                                children: []
                                pos: 5832
                                length: 30
                              pos: 5818
                              length: 56
                            pos: 5783
                            length: 91
                          pos: 5727
                          length: 157
                        pos: 5680
                        length: 204
                      pos: 5631
                      length: 261
                    pos: 5571
                    length: 321
                  pos: 5522
                  length: 376
                pos: 5503
                length: 395
              - type: return_statement
                fields:
                  text: return jsDoc;
                children: []
                pos: 5903
                length: 13
              pos: 5424
              length: 496
          children: []
          pos: 5377
          length: 543
        pos: 1826
        length: 4096
    children: []
    pos: 1826
    length: 4096
  pos: 0
  length: 5923
after_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: CheckGlobalThis
        children: []
        pos: 1838
        length: 15
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType GLOBAL_THIS = DiagnosticType.warning(
                    "JSC_USED_GLOBAL_THIS",
                    "dangerous use of the global 'this' object");
          children: []
          pos: 1879
          length: 147
        - type: field_declaration
          fields:
            text: private final AbstractCompiler compiler;
          children: []
          pos: 2030
          length: 40
        - type: field_declaration
          fields:
            text: private final CheckLevel level;
          children: []
          pos: 2073
          length: 31
        - type: field_declaration
          fields:
            text: private Node assignLhsChild = null;
          children: []
          pos: 2301
          length: 35
        - type: constructor_declaration
          fields:
            text: |-
              CheckGlobalThis(AbstractCompiler compiler, CheckLevel level) {
                  this.compiler = compiler;
                  this.level = level;
                }
          children: []
          pos: 2340
          length: 120
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: shouldTraverse
              children: []
              pos: 2640
              length: 14
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 2655
                length: 15
              pos: 2625
              length: 1779
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: method_invocation
                            fields:
                              text: n.getType()
                            children: []
                            pos: 2704
                            length: 11
                          right:
                            type: field_access
                            fields:
                              text: Token.FUNCTION
                            children: []
                            pos: 2719
                            length: 14
                        children: []
                        pos: 2704
                        length: 29
                    children: []
                    pos: 2703
                    length: 31
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: JSDocInfo jsDoc = getFunctionJsDocInfo(n);
                    children: []
                    pos: 2851
                    length: 42
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: and
                            fields:
                              left:
                                type: not_equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: jsDoc
                                    children: []
                                    pos: 2904
                                    length: 5
                                  right:
                                    type: null_literal
                                    fields: {}
                                    children: []
                                    pos: 2913
                                    length: 4
                                children: []
                                pos: 2904
                                length: 13
                              right:
                                type: parenthesized_expression
                                fields:
                                  expression:
                                    type: or
                                    fields:
                                      left:
                                        type: or
                                        fields:
                                          left:
                                            type: method_invocation
                                            fields:
                                              text: jsDoc.isConstructor()
                                            children: []
                                            pos: 2932
                                            length: 21
                                          right:
                                            type: method_invocation
                                            fields:
                                              text: jsDoc.hasThisType()
                                            children: []
                                            pos: 2968
                                            length: 19
                                        children: []
                                        pos: 2932
                                        length: 55
                                      right:
                                        type: method_invocation
                                        fields:
                                          text: jsDoc.isOverride()
                                        children: []
                                        pos: 3002
                                        length: 18
                                    children: []
                                    pos: 2932
                                    length: 88
                                children: []
                                pos: 2931
                                length: 90
                            children: []
                            pos: 2904
                            length: 117
                        children: []
                        pos: 2903
                        length: 119
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: return_statement
                        fields:
                          text: return false;
                        children: []
                        pos: 3033
                        length: 13
                      pos: 3023
                      length: 31
                    pos: 2900
                    length: 154
                  - type: local_variable_declaration
                    fields:
                      text: int pType = parent.getType();
                    children: []
                    pos: 3295
                    length: 29
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: unary_expression
                            fields:
                              text: |-
                                !(pType == Token.BLOCK ||
                                            pType == Token.SCRIPT ||
                                            pType == Token.NAME ||
                                            pType == Token.ASSIGN)
                            children: []
                            pos: 3335
                            length: 132
                        children: []
                        pos: 3334
                        length: 134
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: return_statement
                        fields:
                          text: return false;
                        children: []
                        pos: 3479
                        length: 13
                      pos: 3469
                      length: 31
                    pos: 3331
                    length: 169
                  pos: 2735
                  length: 771
                pos: 2700
                length: 806
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: and
                        fields:
                          left:
                            type: not_equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: parent
                                children: []
                                pos: 3516
                                length: 6
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 3526
                                length: 4
                            children: []
                            pos: 3516
                            length: 14
                          right:
                            type: equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: parent.getType()
                                children: []
                                pos: 3534
                                length: 16
                              right:
                                type: field_access
                                fields:
                                  text: Token.ASSIGN
                                children: []
                                pos: 3554
                                length: 12
                            children: []
                            pos: 3534
                            length: 32
                        children: []
                        pos: 3516
                        length: 50
                    children: []
                    pos: 3515
                    length: 52
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: Node lhs = parent.getFirstChild();
                    children: []
                    pos: 3576
                    length: 34
                  - type: local_variable_declaration
                    fields:
                      text: Node rhs = lhs.getNext();
                    children: []
                    pos: 3617
                    length: 25
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: "n"
                                children: []
                                pos: 3660
                                length: 1
                              right:
                                type: identifier
                                fields:
                                  text: lhs
                                children: []
                                pos: 3665
                                length: 3
                            children: []
                            pos: 3660
                            length: 8
                        children: []
                        pos: 3659
                        length: 10
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: if_statement
                        fields:
                          condition:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: assignLhsChild
                                    children: []
                                    pos: 3879
                                    length: 14
                                  right:
                                    type: null_literal
                                    fields: {}
                                    children: []
                                    pos: 3897
                                    length: 4
                                children: []
                                pos: 3879
                                length: 22
                            children: []
                            pos: 3878
                            length: 24
                        children:
                        - type: block
                          fields: {}
                          children:
                          - type: expression_statement
                            fields:
                              text: assignLhsChild = lhs;
                            children: []
                            pos: 3915
                            length: 21
                          pos: 3903
                          length: 43
                        pos: 3875
                        length: 71
                      pos: 3670
                      length: 284
                    pos: 3656
                    length: 720
                  pos: 3568
                  length: 814
                pos: 3512
                length: 870
              - type: return_statement
                fields:
                  text: return true;
                children: []
                pos: 4388
                length: 12
              pos: 2693
              length: 1711
          children: []
          pos: 2625
          length: 1779
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: visit
              children: []
              pos: 4420
              length: 5
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 4426
                length: 15
              pos: 4408
              length: 260
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: and
                        fields:
                          left:
                            type: equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: n.getType()
                                children: []
                                pos: 4474
                                length: 11
                              right:
                                type: field_access
                                fields:
                                  text: Token.THIS
                                children: []
                                pos: 4489
                                length: 10
                            children: []
                            pos: 4474
                            length: 25
                          right:
                            type: method_invocation
                            fields:
                              text: shouldReportThis(n, parent)
                            children: []
                            pos: 4503
                            length: 27
                        children: []
                        pos: 4474
                        length: 56
                    children: []
                    pos: 4473
                    length: 58
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: compiler.report(t.makeError(n, level, GLOBAL_THIS));
                    children: []
                    pos: 4540
                    length: 52
                  pos: 4532
                  length: 66
                pos: 4470
                length: 128
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: "n"
                            children: []
                            pos: 4607
                            length: 1
                          right:
                            type: identifier
                            fields:
                              text: assignLhsChild
                            children: []
                            pos: 4612
                            length: 14
                        children: []
                        pos: 4607
                        length: 19
                    children: []
                    pos: 4606
                    length: 21
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: assignLhsChild = null;
                    children: []
                    pos: 4636
                    length: 22
                  pos: 4628
                  length: 36
                pos: 4603
                length: 61
              pos: 4464
              length: 204
          children: []
          pos: 4408
          length: 260
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: shouldReportThis
              children: []
              pos: 4688
              length: 16
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Node n
                children: []
                pos: 4705
                length: 6
              pos: 4672
              length: 283
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: assignLhsChild
                            children: []
                            pos: 4736
                            length: 14
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 4754
                            length: 4
                        children: []
                        pos: 4736
                        length: 22
                    children: []
                    pos: 4735
                    length: 24
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return true;
                    children: []
                    pos: 4829
                    length: 12
                  pos: 4760
                  length: 87
                pos: 4732
                length: 115
              - type: return_statement
                fields:
                  text: return parent != null && NodeUtil.isGet(parent);
                children: []
                pos: 4903
                length: 48
              pos: 4726
              length: 229
          children: []
          pos: 4672
          length: 283
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getFunctionJsDocInfo
              children: []
              pos: 5253
              length: 20
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Node n
                children: []
                pos: 5274
                length: 6
              pos: 5235
              length: 543
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: JSDocInfo jsDoc = n.getJSDocInfo();
                children: []
                pos: 5288
                length: 35
              - type: local_variable_declaration
                fields:
                  text: Node parent = n.getParent();
                children: []
                pos: 5328
                length: 28
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: jsDoc
                            children: []
                            pos: 5365
                            length: 5
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 5374
                            length: 4
                        children: []
                        pos: 5365
                        length: 13
                    children: []
                    pos: 5364
                    length: 15
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: int parentType = parent.getType();
                    children: []
                    pos: 5388
                    length: 34
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: or
                            fields:
                              left:
                                type: equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: parentType
                                    children: []
                                    pos: 5433
                                    length: 10
                                  right:
                                    type: field_access
                                    fields:
                                      text: Token.NAME
                                    children: []
                                    pos: 5447
                                    length: 10
                                children: []
                                pos: 5433
                                length: 24
                              right:
                                type: equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: parentType
                                    children: []
                                    pos: 5461
                                    length: 10
                                  right:
                                    type: field_access
                                    fields:
                                      text: Token.ASSIGN
                                    children: []
                                    pos: 5475
                                    length: 12
                                children: []
                                pos: 5461
                                length: 26
                            children: []
                            pos: 5433
                            length: 54
                        children: []
                        pos: 5432
                        length: 56
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: expression_statement
                        fields:
                          text: jsDoc = parent.getJSDocInfo();
                        children: []
                        pos: 5499
                        length: 30
                      - type: if_statement
                        fields:
                          condition:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: and
                                fields:
                                  left:
                                    type: equals
                                    fields:
                                      left:
                                        type: identifier
                                        fields:
                                          text: jsDoc
                                        children: []
                                        pos: 5542
                                        length: 5
                                      right:
                                        type: null_literal
                                        fields: {}
                                        children: []
                                        pos: 5551
                                        length: 4
                                    children: []
                                    pos: 5542
                                    length: 13
                                  right:
                                    type: equals
                                    fields:
                                      left:
                                        type: identifier
                                        fields:
                                          text: parentType
                                        children: []
                                        pos: 5559
                                        length: 10
                                      right:
                                        type: field_access
                                        fields:
                                          text: Token.NAME
                                        children: []
                                        pos: 5573
                                        length: 10
                                    children: []
                                    pos: 5559
                                    length: 24
                                children: []
                                pos: 5542
                                length: 41
                            children: []
                            pos: 5541
                            length: 43
                        children:
                        - type: block
                          fields: {}
                          children:
                          - type: local_variable_declaration
                            fields:
                              text: Node gramps = parent.getParent();
                            children: []
                            pos: 5597
                            length: 33
                          - type: if_statement
                            fields:
                              condition:
                                type: parenthesized_expression
                                fields:
                                  expression:
                                    type: equals
                                    fields:
                                      left:
                                        type: method_invocation
                                        fields:
                                          text: gramps.getType()
                                        children: []
                                        pos: 5645
                                        length: 16
                                      right:
                                        type: field_access
                                        fields:
                                          text: Token.VAR
                                        children: []
                                        pos: 5665
                                        length: 9
                                    children: []
                                    pos: 5645
                                    length: 29
                                children: []
                                pos: 5644
                                length: 31
                            children:
                            - type: block
                              fields: {}
                              children:
                              - type: expression_statement
                                fields:
                                  text: jsDoc = gramps.getJSDocInfo();
                                children: []
                                pos: 5690
                                length: 30
                              pos: 5676
                              length: 56
                            pos: 5641
                            length: 91
                          pos: 5585
                          length: 157
                        pos: 5538
                        length: 204
                      pos: 5489
                      length: 261
                    pos: 5429
                    length: 321
                  pos: 5380
                  length: 376
                pos: 5361
                length: 395
              - type: return_statement
                fields:
                  text: return jsDoc;
                children: []
                pos: 5761
                length: 13
              pos: 5282
              length: 496
          children: []
          pos: 5235
          length: 543
        pos: 1826
        length: 3954
    children: []
    pos: 1826
    length: 3954
  pos: 0
  length: 5781
text_diff: "--- before\n+++ after\n@@ -89,7 +89,6 @@\n       JSDocInfo jsDoc = getFunctionJsDocInfo(n);\n
  \      if (jsDoc != null &&\n           (jsDoc.isConstructor() ||\n-           jsDoc.isInterface()
  ||\n            jsDoc.hasThisType() ||\n            jsDoc.isOverride())) {\n         return
  false;\n@@ -123,17 +122,13 @@\n       } else {\n         // Only traverse the right
  side if it's not an assignment to a prototype\n         // property or subproperty.\n-
  \       if (NodeUtil.isGet(lhs)) {\n           if (lhs.getType() == Token.GETPROP
  &&\n               lhs.getLastChild().getString().equals(\"prototype\")) {\n             return
  false;\n           }\n-          Node llhs = lhs.getFirstChild();\n-          if
  (llhs.getType() == Token.GETPROP &&\n-              llhs.getLastChild().getString().equals(\"prototype\"))
  {\n+          if (lhs.getQualifiedName() != null && lhs.getQualifiedName().contains(\".prototype.\"))
  {\n             return false;\n           }\n-        }\n       }\n     }\n \n"
tree_diff: |+
  New cluster:
  ===
  insert-node
  ---
  method_invocation: jsDoc.isConstructor() [2932,2953]
  to
  or [2932,3021]
  at 0
  ------------
  ===
  insert-node
  ---
  method_invocation: jsDoc.isConstructor() [2932,2953]
  to
  or [2932,3021]
  at 0

  New cluster:
  Unknown cluster type
  ------------
  ===
  delete-tree
  ---
  or [2932,2987]
      method_invocation: jsDoc.isConstructor() [2932,2953]
      method_invocation: jsDoc.isInterface() [2968,2987]

...
