---
language: java
before_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: StringCollectionDeserializer
        children: []
        pos: 877
        length: 28
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: private static final long serialVersionUID = 1L;
          children: []
          pos: 1008
          length: 48
        - type: field_declaration
          fields:
            text: protected final JsonDeserializer<String> _valueDeserializer;
          children: []
          pos: 1194
          length: 60
        - type: field_declaration
          fields:
            text: protected final ValueInstantiator _valueInstantiator;
          children: []
          pos: 1396
          length: 53
        - type: field_declaration
          fields:
            text: protected final JsonDeserializer<Object> _delegateDeserializer;
          children: []
          pos: 1588
          length: 63
        - type: constructor_declaration
          fields:
            text: |-
              public StringCollectionDeserializer(JavaType collectionType,
                          JsonDeserializer<?> valueDeser, ValueInstantiator valueInstantiator)
                  {
                      this(collectionType, valueInstantiator, null, valueDeser, valueDeser, null);
                  }
          children: []
          pos: 1896
          length: 238
        - type: constructor_declaration
          fields:
            text: |-
              @SuppressWarnings("unchecked")
                  protected StringCollectionDeserializer(JavaType collectionType,
                          ValueInstantiator valueInstantiator, JsonDeserializer<?> delegateDeser,
                          JsonDeserializer<?> valueDeser,
                          NullValueProvider nuller, Boolean unwrapSingle)
                  {
                      super(collectionType, nuller, unwrapSingle);
                      _valueDeserializer = (JsonDeserializer<String>) valueDeser;
                      _valueInstantiator = valueInstantiator;
                      _delegateDeserializer = (JsonDeserializer<Object>) delegateDeser;
                  }
          children: []
          pos: 2140
          length: 541
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: withResolved
              children: []
              pos: 2726
              length: 12
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonDeserializer<?> delegateDeser
                children: []
                pos: 2739
                length: 33
              pos: 2687
              length: 561
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: and
                        fields:
                          left:
                            type: and
                            fields:
                              left:
                                type: and
                                fields:
                                  left:
                                    type: parenthesized_expression
                                    fields:
                                      expression:
                                        type: equals
                                        fields:
                                          left:
                                            type: identifier
                                            fields:
                                              text: _unwrapSingle
                                            children: []
                                            pos: 2897
                                            length: 13
                                          right:
                                            type: identifier
                                            fields:
                                              text: unwrapSingle
                                            children: []
                                            pos: 2914
                                            length: 12
                                        children: []
                                        pos: 2897
                                        length: 29
                                    children: []
                                    pos: 2896
                                    length: 31
                                  right:
                                    type: parenthesized_expression
                                    fields:
                                      expression:
                                        type: equals
                                        fields:
                                          left:
                                            type: identifier
                                            fields:
                                              text: _nullProvider
                                            children: []
                                            pos: 2932
                                            length: 13
                                          right:
                                            type: identifier
                                            fields:
                                              text: nuller
                                            children: []
                                            pos: 2949
                                            length: 6
                                        children: []
                                        pos: 2932
                                        length: 23
                                    children: []
                                    pos: 2931
                                    length: 25
                                children: []
                                pos: 2896
                                length: 60
                              right:
                                type: parenthesized_expression
                                fields:
                                  expression:
                                    type: equals
                                    fields:
                                      left:
                                        type: identifier
                                        fields:
                                          text: _valueDeserializer
                                        children: []
                                        pos: 2977
                                        length: 18
                                      right:
                                        type: identifier
                                        fields:
                                          text: valueDeser
                                        children: []
                                        pos: 2999
                                        length: 10
                                    children: []
                                    pos: 2977
                                    length: 32
                                children: []
                                pos: 2976
                                length: 34
                            children: []
                            pos: 2896
                            length: 114
                          right:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: _delegateDeserializer
                                    children: []
                                    pos: 3015
                                    length: 21
                                  right:
                                    type: identifier
                                    fields:
                                      text: delegateDeser
                                    children: []
                                    pos: 3040
                                    length: 13
                                children: []
                                pos: 3015
                                length: 38
                            children: []
                            pos: 3014
                            length: 40
                        children: []
                        pos: 2896
                        length: 158
                    children: []
                    pos: 2895
                    length: 160
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return this;
                    children: []
                    pos: 3070
                    length: 12
                  pos: 3056
                  length: 36
                pos: 2892
                length: 200
              - type: return_statement
                fields:
                  text: |-
                    return new StringCollectionDeserializer(_containerType, _valueInstantiator,
                                    delegateDeser, valueDeser, nuller, unwrapSingle);
                children: []
                pos: 3101
                length: 141
              pos: 2882
              length: 366
          children: []
          pos: 2687
          length: 561
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: isCachable
              children: []
              pos: 3296
              length: 10
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 3254
              length: 266
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return (_valueDeserializer == null) && (_delegateDeserializer
                    == null);
                children: []
                pos: 3443
                length: 71
              pos: 3309
              length: 211
          children: []
          pos: 3254
          length: 266
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: createContextual
              children: []
              pos: 3749
              length: 16
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: DeserializationContext ctxt
                children: []
                pos: 3766
                length: 27
              pos: 3708
              length: 2275
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: JsonDeserializer<Object> delegate = null;
                children: []
                pos: 3938
                length: 41
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: _valueInstantiator
                            children: []
                            pos: 3992
                            length: 18
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 4014
                            length: 4
                        children: []
                        pos: 3992
                        length: 26
                    children: []
                    pos: 3991
                    length: 28
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: AnnotatedWithParams delegateCreator = _valueInstantiator.getArrayDelegateCreator();
                    children: []
                    pos: 4109
                    length: 83
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: not_equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: delegateCreator
                                children: []
                                pos: 4209
                                length: 15
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 4228
                                length: 4
                            children: []
                            pos: 4209
                            length: 23
                        children: []
                        pos: 4208
                        length: 25
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: local_variable_declaration
                        fields:
                          text: JavaType delegateType = _valueInstantiator.getArrayDelegateType(ctxt.getConfig());
                        children: []
                        pos: 4252
                        length: 82
                      - type: expression_statement
                        fields:
                          text: delegate = findDeserializer(ctxt, delegateType, property);
                        children: []
                        pos: 4351
                        length: 58
                      pos: 4234
                      length: 189
                    pos: 4205
                    length: 481
                  pos: 4020
                  length: 676
                pos: 3988
                length: 708
              - type: local_variable_declaration
                fields:
                  text: JsonDeserializer<?> valueDeser = _valueDeserializer;
                children: []
                pos: 4705
                length: 52
              - type: local_variable_declaration
                fields:
                  text: final JavaType valueType = _containerType.getContentType();
                children: []
                pos: 4766
                length: 59
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: valueDeser
                            children: []
                            pos: 4838
                            length: 10
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 4852
                            length: 4
                        children: []
                        pos: 4838
                        length: 18
                    children: []
                    pos: 4837
                    length: 20
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: valueDeser = findConvertingContentDeserializer(ctxt, property,
                        valueDeser);
                    children: []
                    pos: 4932
                    length: 75
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: valueDeser
                                children: []
                                pos: 5024
                                length: 10
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 5038
                                length: 4
                            children: []
                            pos: 5024
                            length: 18
                        children: []
                        pos: 5023
                        length: 20
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: expression_statement
                        fields:
                          text: valueDeser = ctxt.findContextualValueDeserializer(valueType,
                            property);
                        children: []
                        pos: 5129
                        length: 71
                      pos: 5044
                      length: 170
                    pos: 5020
                    length: 194
                  pos: 4858
                  length: 366
                pos: 4834
                length: 562
              - type: local_variable_declaration
                fields:
                  text: |-
                    Boolean unwrapSingle = findFormatFeature(ctxt, property, Collection.class,
                                    JsonFormat.Feature.ACCEPT_SINGLE_VALUE_AS_ARRAY);
                children: []
                pos: 5586
                length: 140
              - type: local_variable_declaration
                fields:
                  text: NullValueProvider nuller = findContentNullProvider(ctxt, property,
                    valueDeser);
                children: []
                pos: 5735
                length: 79
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: isDefaultDeserializer(valueDeser)
                        children: []
                        pos: 5827
                        length: 33
                    children: []
                    pos: 5826
                    length: 35
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: valueDeser = null;
                    children: []
                    pos: 5876
                    length: 18
                  pos: 5862
                  length: 42
                pos: 5823
                length: 81
              - type: return_statement
                fields:
                  text: return withResolved(delegate, valueDeser, nuller, unwrapSingle);
                children: []
                pos: 5913
                length: 64
              pos: 3862
              length: 2121
          children: []
          pos: 3708
          length: 2275
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getContentDeserializer
              children: []
              pos: 6255
              length: 22
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 6174
              length: 218
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: JsonDeserializer<?> deser = _valueDeserializer;
                children: []
                pos: 6290
                length: 47
              - type: return_statement
                fields:
                  text: return (JsonDeserializer<Object>) deser;
                children: []
                pos: 6346
                length: 40
              pos: 6280
              length: 112
          children: []
          pos: 6174
          length: 218
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getValueInstantiator
              children: []
              pos: 6437
              length: 20
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 6398
              length: 104
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return _valueInstantiator;
                children: []
                pos: 6470
                length: 26
              pos: 6460
              length: 42
          children: []
          pos: 6398
          length: 104
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: deserialize
              children: []
              pos: 6759
              length: 11
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonParser p
                children: []
                pos: 6771
                length: 12
              pos: 6684
              length: 526
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: _delegateDeserializer
                            children: []
                            pos: 6859
                            length: 21
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 6884
                            length: 4
                        children: []
                        pos: 6859
                        length: 29
                    children: []
                    pos: 6858
                    length: 31
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: |-
                        return (Collection<String>) _valueInstantiator.createUsingDelegate(ctxt,
                                            _delegateDeserializer.deserialize(p, ctxt));
                    children: []
                    pos: 6904
                    length: 137
                  pos: 6890
                  length: 161
                pos: 6855
                length: 196
              - type: local_variable_declaration
                fields:
                  text: final Collection<String> result = (Collection<String>) _valueInstantiator.createUsingDefault(ctxt);
                children: []
                pos: 7060
                length: 99
              - type: return_statement
                fields:
                  text: return deserialize(p, ctxt, result);
                children: []
                pos: 7168
                length: 36
              pos: 6845
              length: 365
          children: []
          pos: 6684
          length: 526
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: deserialize
              children: []
              pos: 7256
              length: 11
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonParser p
                children: []
                pos: 7268
                length: 12
              pos: 7216
              length: 1361
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: unary_expression
                        fields:
                          text: "!p.isExpectedStartArrayToken()"
                        children: []
                        pos: 7436
                        length: 30
                    children: []
                    pos: 7435
                    length: 32
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return handleNonArray(p, ctxt, result);
                    children: []
                    pos: 7482
                    length: 39
                  pos: 7468
                  length: 63
                pos: 7432
                length: 99
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: _valueDeserializer
                            children: []
                            pos: 7545
                            length: 18
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 7567
                            length: 4
                        children: []
                        pos: 7545
                        length: 26
                    children: []
                    pos: 7544
                    length: 28
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return deserializeUsingCustom(p, ctxt, result, _valueDeserializer);
                    children: []
                    pos: 7587
                    length: 67
                  pos: 7573
                  length: 91
                pos: 7541
                length: 123
              - type: try_statement
                fields:
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: while_statement
                      fields:
                        text: |-
                          while (true) {
                                          // First the common case:
                                          String value = p.nextTextValue();
                                          if (value != null) {
                                              result.add(value);
                                              continue;
                                          }
                                          JsonToken t = p.getCurrentToken();
                                          if (t == JsonToken.END_ARRAY) {
                                              break;
                                          }
                                          if (t == JsonToken.VALUE_NULL) {
                                              if (_skipNullValues) {
                                                  continue;
                                              }
                                              value = (String) _nullProvider.getNullValue(ctxt);
                                          } else {
                                              value = _parseString(p, ctxt);
                                          }
                                          result.add(value);
                                      }
                      children: []
                      pos: 7691
                      length: 736
                    pos: 7677
                    length: 760
                  excepts:
                    type: excepts
                    fields: {}
                    children:
                    - type: catch_clause
                      fields:
                        text: |-
                          catch (Exception e) {
                                      throw JsonMappingException.wrapWithPath(e, result, result.size());
                                  }
                      children: []
                      pos: 8438
                      length: 110
                    pos: 7673
                    length: 875
                children: []
                pos: 7673
                length: 875
              - type: return_statement
                fields:
                  text: return result;
                children: []
                pos: 8557
                length: 14
              pos: 7381
              length: 1196
          children: []
          pos: 7216
          length: 1361
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: deserializeUsingCustom
              children: []
              pos: 8614
              length: 22
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonParser p
                children: []
                pos: 8637
                length: 12
              pos: 8587
              length: 1324
            body:
              type: block
              fields: {}
              children:
              - type: while_statement
                fields:
                  text: |-
                    while (true) {
                                /* 30-Dec-2014, tatu: This may look odd, but let's actually call method
                                 *   that suggest we are expecting a String; this helps with some formats,
                                 *   notably XML. Note, however, that while we can get String, we can't
                                 *   assume that's what we use due to custom deserializer
                                 */
                                String value;
                                if (p.nextTextValue() == null) {
                                    JsonToken t = p.getCurrentToken();
                                    if (t == JsonToken.END_ARRAY) {
                                        break;
                                    }
                                    // Ok: no need to convert Strings, but must recognize nulls
                                    if (t == JsonToken.VALUE_NULL) {
                                        if (_skipNullValues) {
                                            continue;
                                        }
                                        value = (String) _nullProvider.getNullValue(ctxt);
                                    } else {
                                        value = deser.deserialize(p, ctxt);
                                    }
                                } else {
                                    value = deser.deserialize(p, ctxt);
                                }
                                result.add(value);
                            }
                children: []
                pos: 8790
                length: 1092
              - type: return_statement
                fields:
                  text: return result;
                children: []
                pos: 9891
                length: 14
              pos: 8780
              length: 1131
          children: []
          pos: 8587
          length: 1324
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: deserializeWithType
              children: []
              pos: 9949
              length: 19
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonParser p
                children: []
                pos: 9969
                length: 12
              pos: 9921
              length: 313
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return typeDeserializer.deserializeTypedFromArray(p, ctxt);
                children: []
                pos: 10169
                length: 59
              pos: 10078
              length: 156
          children: []
          pos: 9921
          length: 313
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: handleNonArray
              children: []
              pos: 10520
              length: 14
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonParser p
                children: []
                pos: 10535
                length: 12
              pos: 10452
              length: 1224
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: |-
                    boolean canWrap = (_unwrapSingle == Boolean.TRUE) ||
                                    ((_unwrapSingle == null) &&
                                            ctxt.isEnabled(DeserializationFeature.ACCEPT_SINGLE_VALUE_AS_ARRAY));
                children: []
                pos: 10697
                length: 190
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: unary_expression
                        fields:
                          text: "!canWrap"
                        children: []
                        pos: 10900
                        length: 8
                    children: []
                    pos: 10899
                    length: 10
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return (Collection<String>) ctxt.handleUnexpectedToken(_containerType.getRawClass(),
                        p);
                    children: []
                    pos: 10924
                    length: 88
                  pos: 10910
                  length: 112
                pos: 10896
                length: 126
              - type: local_variable_declaration
                fields:
                  text: JsonDeserializer<String> valueDes = _valueDeserializer;
                children: []
                pos: 11133
                length: 55
              - type: local_variable_declaration
                fields:
                  text: JsonToken t = p.getCurrentToken();
                children: []
                pos: 11197
                length: 34
              - type: local_variable_declaration
                fields:
                  text: String value;
                children: []
                pos: 11241
                length: 13
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: t
                            children: []
                            pos: 11276
                            length: 1
                          right:
                            type: field_access
                            fields:
                              text: JsonToken.VALUE_NULL
                            children: []
                            pos: 11281
                            length: 20
                        children: []
                        pos: 11276
                        length: 25
                    children: []
                    pos: 11275
                    length: 27
                children:
                - type: block
                  fields: {}
                  children:
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: identifier
                            fields:
                              text: _skipNullValues
                            children: []
                            pos: 11371
                            length: 15
                        children: []
                        pos: 11370
                        length: 17
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: return_statement
                        fields:
                          text: return result;
                        children: []
                        pos: 11406
                        length: 14
                      pos: 11388
                      length: 46
                    pos: 11367
                    length: 67
                  - type: expression_statement
                    fields:
                      text: value = (String) _nullProvider.getNullValue(ctxt);
                    children: []
                    pos: 11447
                    length: 50
                  pos: 11303
                  length: 204
                pos: 11272
                length: 348
              - type: expression_statement
                fields:
                  text: result.add(value);
                children: []
                pos: 11629
                length: 18
              - type: return_statement
                fields:
                  text: return result;
                children: []
                pos: 11656
                length: 14
              pos: 10640
              length: 1036
          children: []
          pos: 10452
          length: 1224
        pos: 842
        length: 10836
    children: []
    pos: 842
    length: 10836
  pos: 0
  length: 11679
after_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: StringCollectionDeserializer
        children: []
        pos: 877
        length: 28
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: private static final long serialVersionUID = 1L;
          children: []
          pos: 1008
          length: 48
        - type: field_declaration
          fields:
            text: protected final JsonDeserializer<String> _valueDeserializer;
          children: []
          pos: 1194
          length: 60
        - type: field_declaration
          fields:
            text: protected final ValueInstantiator _valueInstantiator;
          children: []
          pos: 1396
          length: 53
        - type: field_declaration
          fields:
            text: protected final JsonDeserializer<Object> _delegateDeserializer;
          children: []
          pos: 1588
          length: 63
        - type: constructor_declaration
          fields:
            text: |-
              public StringCollectionDeserializer(JavaType collectionType,
                          JsonDeserializer<?> valueDeser, ValueInstantiator valueInstantiator)
                  {
                      this(collectionType, valueInstantiator, null, valueDeser, valueDeser, null);
                  }
          children: []
          pos: 1896
          length: 238
        - type: constructor_declaration
          fields:
            text: |-
              @SuppressWarnings("unchecked")
                  protected StringCollectionDeserializer(JavaType collectionType,
                          ValueInstantiator valueInstantiator, JsonDeserializer<?> delegateDeser,
                          JsonDeserializer<?> valueDeser,
                          NullValueProvider nuller, Boolean unwrapSingle)
                  {
                      super(collectionType, nuller, unwrapSingle);
                      _valueDeserializer = (JsonDeserializer<String>) valueDeser;
                      _valueInstantiator = valueInstantiator;
                      _delegateDeserializer = (JsonDeserializer<Object>) delegateDeser;
                  }
          children: []
          pos: 2140
          length: 541
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: withResolved
              children: []
              pos: 2726
              length: 12
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonDeserializer<?> delegateDeser
                children: []
                pos: 2739
                length: 33
              pos: 2687
              length: 561
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: and
                        fields:
                          left:
                            type: and
                            fields:
                              left:
                                type: and
                                fields:
                                  left:
                                    type: parenthesized_expression
                                    fields:
                                      expression:
                                        type: equals
                                        fields:
                                          left:
                                            type: identifier
                                            fields:
                                              text: _unwrapSingle
                                            children: []
                                            pos: 2897
                                            length: 13
                                          right:
                                            type: identifier
                                            fields:
                                              text: unwrapSingle
                                            children: []
                                            pos: 2914
                                            length: 12
                                        children: []
                                        pos: 2897
                                        length: 29
                                    children: []
                                    pos: 2896
                                    length: 31
                                  right:
                                    type: parenthesized_expression
                                    fields:
                                      expression:
                                        type: equals
                                        fields:
                                          left:
                                            type: identifier
                                            fields:
                                              text: _nullProvider
                                            children: []
                                            pos: 2932
                                            length: 13
                                          right:
                                            type: identifier
                                            fields:
                                              text: nuller
                                            children: []
                                            pos: 2949
                                            length: 6
                                        children: []
                                        pos: 2932
                                        length: 23
                                    children: []
                                    pos: 2931
                                    length: 25
                                children: []
                                pos: 2896
                                length: 60
                              right:
                                type: parenthesized_expression
                                fields:
                                  expression:
                                    type: equals
                                    fields:
                                      left:
                                        type: identifier
                                        fields:
                                          text: _valueDeserializer
                                        children: []
                                        pos: 2977
                                        length: 18
                                      right:
                                        type: identifier
                                        fields:
                                          text: valueDeser
                                        children: []
                                        pos: 2999
                                        length: 10
                                    children: []
                                    pos: 2977
                                    length: 32
                                children: []
                                pos: 2976
                                length: 34
                            children: []
                            pos: 2896
                            length: 114
                          right:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: _delegateDeserializer
                                    children: []
                                    pos: 3015
                                    length: 21
                                  right:
                                    type: identifier
                                    fields:
                                      text: delegateDeser
                                    children: []
                                    pos: 3040
                                    length: 13
                                children: []
                                pos: 3015
                                length: 38
                            children: []
                            pos: 3014
                            length: 40
                        children: []
                        pos: 2896
                        length: 158
                    children: []
                    pos: 2895
                    length: 160
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return this;
                    children: []
                    pos: 3070
                    length: 12
                  pos: 3056
                  length: 36
                pos: 2892
                length: 200
              - type: return_statement
                fields:
                  text: |-
                    return new StringCollectionDeserializer(_containerType, _valueInstantiator,
                                    delegateDeser, valueDeser, nuller, unwrapSingle);
                children: []
                pos: 3101
                length: 141
              pos: 2882
              length: 366
          children: []
          pos: 2687
          length: 561
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: isCachable
              children: []
              pos: 3296
              length: 10
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 3254
              length: 266
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return (_valueDeserializer == null) && (_delegateDeserializer
                    == null);
                children: []
                pos: 3443
                length: 71
              pos: 3309
              length: 211
          children: []
          pos: 3254
          length: 266
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: createContextual
              children: []
              pos: 3749
              length: 16
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: DeserializationContext ctxt
                children: []
                pos: 3766
                length: 27
              pos: 3708
              length: 2002
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: JsonDeserializer<Object> delegate = null;
                children: []
                pos: 3938
                length: 41
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: _valueInstantiator
                            children: []
                            pos: 3992
                            length: 18
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 4014
                            length: 4
                        children: []
                        pos: 3992
                        length: 26
                    children: []
                    pos: 3991
                    length: 28
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: AnnotatedWithParams delegateCreator = _valueInstantiator.getDelegateCreator();
                    children: []
                    pos: 4109
                    length: 78
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: not_equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: delegateCreator
                                children: []
                                pos: 4204
                                length: 15
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 4223
                                length: 4
                            children: []
                            pos: 4204
                            length: 23
                        children: []
                        pos: 4203
                        length: 25
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: local_variable_declaration
                        fields:
                          text: JavaType delegateType = _valueInstantiator.getDelegateType(ctxt.getConfig());
                        children: []
                        pos: 4247
                        length: 77
                      - type: expression_statement
                        fields:
                          text: delegate = findDeserializer(ctxt, delegateType, property);
                        children: []
                        pos: 4341
                        length: 58
                      pos: 4229
                      length: 184
                    pos: 4200
                    length: 213
                  pos: 4020
                  length: 403
                pos: 3988
                length: 435
              - type: local_variable_declaration
                fields:
                  text: JsonDeserializer<?> valueDeser = _valueDeserializer;
                children: []
                pos: 4432
                length: 52
              - type: local_variable_declaration
                fields:
                  text: final JavaType valueType = _containerType.getContentType();
                children: []
                pos: 4493
                length: 59
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: valueDeser
                            children: []
                            pos: 4565
                            length: 10
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 4579
                            length: 4
                        children: []
                        pos: 4565
                        length: 18
                    children: []
                    pos: 4564
                    length: 20
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: valueDeser = findConvertingContentDeserializer(ctxt, property,
                        valueDeser);
                    children: []
                    pos: 4659
                    length: 75
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: valueDeser
                                children: []
                                pos: 4751
                                length: 10
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 4765
                                length: 4
                            children: []
                            pos: 4751
                            length: 18
                        children: []
                        pos: 4750
                        length: 20
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: expression_statement
                        fields:
                          text: valueDeser = ctxt.findContextualValueDeserializer(valueType,
                            property);
                        children: []
                        pos: 4856
                        length: 71
                      pos: 4771
                      length: 170
                    pos: 4747
                    length: 194
                  pos: 4585
                  length: 366
                pos: 4561
                length: 562
              - type: local_variable_declaration
                fields:
                  text: |-
                    Boolean unwrapSingle = findFormatFeature(ctxt, property, Collection.class,
                                    JsonFormat.Feature.ACCEPT_SINGLE_VALUE_AS_ARRAY);
                children: []
                pos: 5313
                length: 140
              - type: local_variable_declaration
                fields:
                  text: NullValueProvider nuller = findContentNullProvider(ctxt, property,
                    valueDeser);
                children: []
                pos: 5462
                length: 79
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: isDefaultDeserializer(valueDeser)
                        children: []
                        pos: 5554
                        length: 33
                    children: []
                    pos: 5553
                    length: 35
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: valueDeser = null;
                    children: []
                    pos: 5603
                    length: 18
                  pos: 5589
                  length: 42
                pos: 5550
                length: 81
              - type: return_statement
                fields:
                  text: return withResolved(delegate, valueDeser, nuller, unwrapSingle);
                children: []
                pos: 5640
                length: 64
              pos: 3862
              length: 1848
          children: []
          pos: 3708
          length: 2002
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getContentDeserializer
              children: []
              pos: 5982
              length: 22
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 5901
              length: 218
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: JsonDeserializer<?> deser = _valueDeserializer;
                children: []
                pos: 6017
                length: 47
              - type: return_statement
                fields:
                  text: return (JsonDeserializer<Object>) deser;
                children: []
                pos: 6073
                length: 40
              pos: 6007
              length: 112
          children: []
          pos: 5901
          length: 218
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getValueInstantiator
              children: []
              pos: 6164
              length: 20
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 6125
              length: 104
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return _valueInstantiator;
                children: []
                pos: 6197
                length: 26
              pos: 6187
              length: 42
          children: []
          pos: 6125
          length: 104
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: deserialize
              children: []
              pos: 6486
              length: 11
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonParser p
                children: []
                pos: 6498
                length: 12
              pos: 6411
              length: 526
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: _delegateDeserializer
                            children: []
                            pos: 6586
                            length: 21
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 6611
                            length: 4
                        children: []
                        pos: 6586
                        length: 29
                    children: []
                    pos: 6585
                    length: 31
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: |-
                        return (Collection<String>) _valueInstantiator.createUsingDelegate(ctxt,
                                            _delegateDeserializer.deserialize(p, ctxt));
                    children: []
                    pos: 6631
                    length: 137
                  pos: 6617
                  length: 161
                pos: 6582
                length: 196
              - type: local_variable_declaration
                fields:
                  text: final Collection<String> result = (Collection<String>) _valueInstantiator.createUsingDefault(ctxt);
                children: []
                pos: 6787
                length: 99
              - type: return_statement
                fields:
                  text: return deserialize(p, ctxt, result);
                children: []
                pos: 6895
                length: 36
              pos: 6572
              length: 365
          children: []
          pos: 6411
          length: 526
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: deserialize
              children: []
              pos: 6983
              length: 11
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonParser p
                children: []
                pos: 6995
                length: 12
              pos: 6943
              length: 1361
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: unary_expression
                        fields:
                          text: "!p.isExpectedStartArrayToken()"
                        children: []
                        pos: 7163
                        length: 30
                    children: []
                    pos: 7162
                    length: 32
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return handleNonArray(p, ctxt, result);
                    children: []
                    pos: 7209
                    length: 39
                  pos: 7195
                  length: 63
                pos: 7159
                length: 99
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: _valueDeserializer
                            children: []
                            pos: 7272
                            length: 18
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 7294
                            length: 4
                        children: []
                        pos: 7272
                        length: 26
                    children: []
                    pos: 7271
                    length: 28
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return deserializeUsingCustom(p, ctxt, result, _valueDeserializer);
                    children: []
                    pos: 7314
                    length: 67
                  pos: 7300
                  length: 91
                pos: 7268
                length: 123
              - type: try_statement
                fields:
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: while_statement
                      fields:
                        text: |-
                          while (true) {
                                          // First the common case:
                                          String value = p.nextTextValue();
                                          if (value != null) {
                                              result.add(value);
                                              continue;
                                          }
                                          JsonToken t = p.getCurrentToken();
                                          if (t == JsonToken.END_ARRAY) {
                                              break;
                                          }
                                          if (t == JsonToken.VALUE_NULL) {
                                              if (_skipNullValues) {
                                                  continue;
                                              }
                                              value = (String) _nullProvider.getNullValue(ctxt);
                                          } else {
                                              value = _parseString(p, ctxt);
                                          }
                                          result.add(value);
                                      }
                      children: []
                      pos: 7418
                      length: 736
                    pos: 7404
                    length: 760
                  excepts:
                    type: excepts
                    fields: {}
                    children:
                    - type: catch_clause
                      fields:
                        text: |-
                          catch (Exception e) {
                                      throw JsonMappingException.wrapWithPath(e, result, result.size());
                                  }
                      children: []
                      pos: 8165
                      length: 110
                    pos: 7400
                    length: 875
                children: []
                pos: 7400
                length: 875
              - type: return_statement
                fields:
                  text: return result;
                children: []
                pos: 8284
                length: 14
              pos: 7108
              length: 1196
          children: []
          pos: 6943
          length: 1361
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: deserializeUsingCustom
              children: []
              pos: 8341
              length: 22
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonParser p
                children: []
                pos: 8364
                length: 12
              pos: 8314
              length: 1324
            body:
              type: block
              fields: {}
              children:
              - type: while_statement
                fields:
                  text: |-
                    while (true) {
                                /* 30-Dec-2014, tatu: This may look odd, but let's actually call method
                                 *   that suggest we are expecting a String; this helps with some formats,
                                 *   notably XML. Note, however, that while we can get String, we can't
                                 *   assume that's what we use due to custom deserializer
                                 */
                                String value;
                                if (p.nextTextValue() == null) {
                                    JsonToken t = p.getCurrentToken();
                                    if (t == JsonToken.END_ARRAY) {
                                        break;
                                    }
                                    // Ok: no need to convert Strings, but must recognize nulls
                                    if (t == JsonToken.VALUE_NULL) {
                                        if (_skipNullValues) {
                                            continue;
                                        }
                                        value = (String) _nullProvider.getNullValue(ctxt);
                                    } else {
                                        value = deser.deserialize(p, ctxt);
                                    }
                                } else {
                                    value = deser.deserialize(p, ctxt);
                                }
                                result.add(value);
                            }
                children: []
                pos: 8517
                length: 1092
              - type: return_statement
                fields:
                  text: return result;
                children: []
                pos: 9618
                length: 14
              pos: 8507
              length: 1131
          children: []
          pos: 8314
          length: 1324
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: deserializeWithType
              children: []
              pos: 9676
              length: 19
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonParser p
                children: []
                pos: 9696
                length: 12
              pos: 9648
              length: 313
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return typeDeserializer.deserializeTypedFromArray(p, ctxt);
                children: []
                pos: 9896
                length: 59
              pos: 9805
              length: 156
          children: []
          pos: 9648
          length: 313
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: handleNonArray
              children: []
              pos: 10247
              length: 14
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonParser p
                children: []
                pos: 10262
                length: 12
              pos: 10179
              length: 1224
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: |-
                    boolean canWrap = (_unwrapSingle == Boolean.TRUE) ||
                                    ((_unwrapSingle == null) &&
                                            ctxt.isEnabled(DeserializationFeature.ACCEPT_SINGLE_VALUE_AS_ARRAY));
                children: []
                pos: 10424
                length: 190
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: unary_expression
                        fields:
                          text: "!canWrap"
                        children: []
                        pos: 10627
                        length: 8
                    children: []
                    pos: 10626
                    length: 10
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return (Collection<String>) ctxt.handleUnexpectedToken(_containerType.getRawClass(),
                        p);
                    children: []
                    pos: 10651
                    length: 88
                  pos: 10637
                  length: 112
                pos: 10623
                length: 126
              - type: local_variable_declaration
                fields:
                  text: JsonDeserializer<String> valueDes = _valueDeserializer;
                children: []
                pos: 10860
                length: 55
              - type: local_variable_declaration
                fields:
                  text: JsonToken t = p.getCurrentToken();
                children: []
                pos: 10924
                length: 34
              - type: local_variable_declaration
                fields:
                  text: String value;
                children: []
                pos: 10968
                length: 13
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: t
                            children: []
                            pos: 11003
                            length: 1
                          right:
                            type: field_access
                            fields:
                              text: JsonToken.VALUE_NULL
                            children: []
                            pos: 11008
                            length: 20
                        children: []
                        pos: 11003
                        length: 25
                    children: []
                    pos: 11002
                    length: 27
                children:
                - type: block
                  fields: {}
                  children:
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: identifier
                            fields:
                              text: _skipNullValues
                            children: []
                            pos: 11098
                            length: 15
                        children: []
                        pos: 11097
                        length: 17
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: return_statement
                        fields:
                          text: return result;
                        children: []
                        pos: 11133
                        length: 14
                      pos: 11115
                      length: 46
                    pos: 11094
                    length: 67
                  - type: expression_statement
                    fields:
                      text: value = (String) _nullProvider.getNullValue(ctxt);
                    children: []
                    pos: 11174
                    length: 50
                  pos: 11030
                  length: 204
                pos: 10999
                length: 348
              - type: expression_statement
                fields:
                  text: result.add(value);
                children: []
                pos: 11356
                length: 18
              - type: return_statement
                fields:
                  text: return result;
                children: []
                pos: 11383
                length: 14
              pos: 10367
              length: 1036
          children: []
          pos: 10179
          length: 1224
        pos: 842
        length: 10563
    children: []
    pos: 842
    length: 10563
  pos: 0
  length: 11406
text_diff: |
  --- before
  +++ after
  @@ -104,11 +104,8 @@
           JsonDeserializer<Object> delegate = null;
           if (_valueInstantiator != null) {
               // [databind#2324]: check both array-delegating and delegating
  -            AnnotatedWithParams delegateCreator = _valueInstantiator.getArrayDelegateCreator();
  +            AnnotatedWithParams delegateCreator = _valueInstantiator.getDelegateCreator();
               if (delegateCreator != null) {
  -                JavaType delegateType = _valueInstantiator.getArrayDelegateType(ctxt.getConfig());
  -                delegate = findDeserializer(ctxt, delegateType, property);
  -            } else if ((delegateCreator = _valueInstantiator.getDelegateCreator()) != null) {
                   JavaType delegateType = _valueInstantiator.getDelegateType(ctxt.getConfig());
                   delegate = findDeserializer(ctxt, delegateType, property);
               }
tree_diff: |+
  New cluster:
  UPDATE from AnnotatedWithParams delegateCreator = _valueInstantiator.getArrayDelegateCreator(); to AnnotatedWithParams delegateCreator = _valueInstantiator.getDelegateCreator();
  ------------
  ===
  update-node
  ---
  local_variable_declaration: AnnotatedWithParams delegateCreator = _valueInstantiator.getArrayDelegateCreator(); [4109,4192]
  replace AnnotatedWithParams delegateCreator = _valueInstantiator.getArrayDelegateCreator(); by AnnotatedWithParams delegateCreator = _valueInstantiator.getDelegateCreator();

  New cluster:
  UPDATE from JavaType delegateType = _valueInstantiator.getArrayDelegateType(ctxt.getConfig()); to JavaType delegateType = _valueInstantiator.getDelegateType(ctxt.getConfig());
  ------------
  ===
  update-node
  ---
  local_variable_declaration: JavaType delegateType = _valueInstantiator.getArrayDelegateType(ctxt.getConfig()); [4252,4334]
  replace JavaType delegateType = _valueInstantiator.getArrayDelegateType(ctxt.getConfig()); by JavaType delegateType = _valueInstantiator.getDelegateType(ctxt.getConfig());

...
