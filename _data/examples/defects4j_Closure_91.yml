---
language: java
before_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: CheckGlobalThis
        children: []
        pos: 1834
        length: 15
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType GLOBAL_THIS = DiagnosticType.warning(
                    "JSC_USED_GLOBAL_THIS",
                    "dangerous use of the global 'this' object");
          children: []
          pos: 1875
          length: 147
        - type: field_declaration
          fields:
            text: private final AbstractCompiler compiler;
          children: []
          pos: 2026
          length: 40
        - type: field_declaration
          fields:
            text: private final CheckLevel level;
          children: []
          pos: 2069
          length: 31
        - type: field_declaration
          fields:
            text: private Node assignLhsChild = null;
          children: []
          pos: 2295
          length: 35
        - type: constructor_declaration
          fields:
            text: |-
              CheckGlobalThis(AbstractCompiler compiler, CheckLevel level) {
                  this.compiler = compiler;
                  this.level = level;
                }
          children: []
          pos: 2334
          length: 120
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: shouldTraverse
              children: []
              pos: 2634
              length: 14
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 2649
                length: 15
              pos: 2619
              length: 2477
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: method_invocation
                            fields:
                              text: n.getType()
                            children: []
                            pos: 2698
                            length: 11
                          right:
                            type: field_access
                            fields:
                              text: Token.FUNCTION
                            children: []
                            pos: 2713
                            length: 14
                        children: []
                        pos: 2698
                        length: 29
                    children: []
                    pos: 2697
                    length: 31
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: JSDocInfo jsDoc = getFunctionJsDocInfo(n);
                    children: []
                    pos: 2845
                    length: 42
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: and
                            fields:
                              left:
                                type: not_equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: jsDoc
                                    children: []
                                    pos: 2898
                                    length: 5
                                  right:
                                    type: null_literal
                                    fields: {}
                                    children: []
                                    pos: 2907
                                    length: 4
                                children: []
                                pos: 2898
                                length: 13
                              right:
                                type: parenthesized_expression
                                fields:
                                  expression:
                                    type: or
                                    fields:
                                      left:
                                        type: or
                                        fields:
                                          left:
                                            type: or
                                            fields:
                                              left:
                                                type: method_invocation
                                                fields:
                                                  text: jsDoc.isConstructor()
                                                children: []
                                                pos: 2926
                                                length: 21
                                              right:
                                                type: method_invocation
                                                fields:
                                                  text: jsDoc.isInterface()
                                                children: []
                                                pos: 2962
                                                length: 19
                                            children: []
                                            pos: 2926
                                            length: 55
                                          right:
                                            type: method_invocation
                                            fields:
                                              text: jsDoc.hasThisType()
                                            children: []
                                            pos: 2996
                                            length: 19
                                        children: []
                                        pos: 2926
                                        length: 89
                                      right:
                                        type: method_invocation
                                        fields:
                                          text: jsDoc.isOverride()
                                        children: []
                                        pos: 3030
                                        length: 18
                                    children: []
                                    pos: 2926
                                    length: 122
                                children: []
                                pos: 2925
                                length: 124
                            children: []
                            pos: 2898
                            length: 151
                        children: []
                        pos: 2897
                        length: 153
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: return_statement
                        fields:
                          text: return false;
                        children: []
                        pos: 3061
                        length: 13
                      pos: 3051
                      length: 31
                    pos: 2894
                    length: 188
                  - type: local_variable_declaration
                    fields:
                      text: int pType = parent.getType();
                    children: []
                    pos: 3366
                    length: 29
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: unary_expression
                            fields:
                              text: |-
                                !(pType == Token.BLOCK ||
                                            pType == Token.SCRIPT ||
                                            pType == Token.NAME ||
                                            pType == Token.ASSIGN ||

                                            // object literal keys
                                            pType == Token.STRING ||
                                            pType == Token.NUMBER)
                            children: []
                            pos: 3406
                            length: 242
                        children: []
                        pos: 3405
                        length: 244
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: return_statement
                        fields:
                          text: return false;
                        children: []
                        pos: 3660
                        length: 13
                      pos: 3650
                      length: 31
                    pos: 3402
                    length: 279
                  - type: local_variable_declaration
                    fields:
                      text: Node gramps = parent.getParent();
                    children: []
                    pos: 3761
                    length: 33
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: method_invocation
                            fields:
                              text: NodeUtil.isObjectLitKey(parent, gramps)
                            children: []
                            pos: 3805
                            length: 39
                        children: []
                        pos: 3804
                        length: 41
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: local_variable_declaration
                        fields:
                          text: JSDocInfo maybeLends = gramps.getJSDocInfo();
                        children: []
                        pos: 3856
                        length: 45
                      - type: if_statement
                        fields:
                          condition:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: and
                                fields:
                                  left:
                                    type: and
                                    fields:
                                      left:
                                        type: not_equals
                                        fields:
                                          left:
                                            type: identifier
                                            fields:
                                              text: maybeLends
                                            children: []
                                            pos: 3914
                                            length: 10
                                          right:
                                            type: null_literal
                                            fields: {}
                                            children: []
                                            pos: 3928
                                            length: 4
                                        children: []
                                        pos: 3914
                                        length: 18
                                      right:
                                        type: not_equals
                                        fields:
                                          left:
                                            type: method_invocation
                                            fields:
                                              text: maybeLends.getLendsName()
                                            children: []
                                            pos: 3948
                                            length: 25
                                          right:
                                            type: null_literal
                                            fields: {}
                                            children: []
                                            pos: 3977
                                            length: 4
                                        children: []
                                        pos: 3948
                                        length: 33
                                    children: []
                                    pos: 3914
                                    length: 67
                                  right:
                                    type: method_invocation
                                    fields:
                                      text: maybeLends.getLendsName().endsWith(".prototype")
                                    children: []
                                    pos: 3997
                                    length: 48
                                children: []
                                pos: 3914
                                length: 131
                            children: []
                            pos: 3913
                            length: 133
                        children:
                        - type: block
                          fields: {}
                          children:
                          - type: return_statement
                            fields:
                              text: return false;
                            children: []
                            pos: 4059
                            length: 13
                          pos: 4047
                          length: 35
                        pos: 3910
                        length: 172
                      pos: 3846
                      length: 244
                    pos: 3801
                    length: 289
                  pos: 2729
                  length: 1367
                pos: 2694
                length: 1402
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: and
                        fields:
                          left:
                            type: not_equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: parent
                                children: []
                                pos: 4106
                                length: 6
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 4116
                                length: 4
                            children: []
                            pos: 4106
                            length: 14
                          right:
                            type: equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: parent.getType()
                                children: []
                                pos: 4124
                                length: 16
                              right:
                                type: field_access
                                fields:
                                  text: Token.ASSIGN
                                children: []
                                pos: 4144
                                length: 12
                            children: []
                            pos: 4124
                            length: 32
                        children: []
                        pos: 4106
                        length: 50
                    children: []
                    pos: 4105
                    length: 52
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: Node lhs = parent.getFirstChild();
                    children: []
                    pos: 4166
                    length: 34
                  - type: local_variable_declaration
                    fields:
                      text: Node rhs = lhs.getNext();
                    children: []
                    pos: 4207
                    length: 25
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: "n"
                                children: []
                                pos: 4244
                                length: 1
                              right:
                                type: identifier
                                fields:
                                  text: lhs
                                children: []
                                pos: 4249
                                length: 3
                            children: []
                            pos: 4244
                            length: 8
                        children: []
                        pos: 4243
                        length: 10
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: if_statement
                        fields:
                          condition:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: assignLhsChild
                                    children: []
                                    pos: 4463
                                    length: 14
                                  right:
                                    type: null_literal
                                    fields: {}
                                    children: []
                                    pos: 4481
                                    length: 4
                                children: []
                                pos: 4463
                                length: 22
                            children: []
                            pos: 4462
                            length: 24
                        children:
                        - type: block
                          fields: {}
                          children:
                          - type: expression_statement
                            fields:
                              text: assignLhsChild = lhs;
                            children: []
                            pos: 4499
                            length: 21
                          pos: 4487
                          length: 43
                        pos: 4459
                        length: 71
                      pos: 4254
                      length: 284
                    pos: 4240
                    length: 828
                  pos: 4158
                  length: 916
                pos: 4102
                length: 972
              - type: return_statement
                fields:
                  text: return true;
                children: []
                pos: 5080
                length: 12
              pos: 2687
              length: 2409
          children: []
          pos: 2619
          length: 2477
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: visit
              children: []
              pos: 5112
              length: 5
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 5118
                length: 15
              pos: 5100
              length: 260
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: and
                        fields:
                          left:
                            type: equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: n.getType()
                                children: []
                                pos: 5166
                                length: 11
                              right:
                                type: field_access
                                fields:
                                  text: Token.THIS
                                children: []
                                pos: 5181
                                length: 10
                            children: []
                            pos: 5166
                            length: 25
                          right:
                            type: method_invocation
                            fields:
                              text: shouldReportThis(n, parent)
                            children: []
                            pos: 5195
                            length: 27
                        children: []
                        pos: 5166
                        length: 56
                    children: []
                    pos: 5165
                    length: 58
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: compiler.report(t.makeError(n, level, GLOBAL_THIS));
                    children: []
                    pos: 5232
                    length: 52
                  pos: 5224
                  length: 66
                pos: 5162
                length: 128
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: "n"
                            children: []
                            pos: 5299
                            length: 1
                          right:
                            type: identifier
                            fields:
                              text: assignLhsChild
                            children: []
                            pos: 5304
                            length: 14
                        children: []
                        pos: 5299
                        length: 19
                    children: []
                    pos: 5298
                    length: 21
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: assignLhsChild = null;
                    children: []
                    pos: 5328
                    length: 22
                  pos: 5320
                  length: 36
                pos: 5295
                length: 61
              pos: 5156
              length: 204
          children: []
          pos: 5100
          length: 260
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: shouldReportThis
              children: []
              pos: 5380
              length: 16
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Node n
                children: []
                pos: 5397
                length: 6
              pos: 5364
              length: 283
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: assignLhsChild
                            children: []
                            pos: 5428
                            length: 14
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 5446
                            length: 4
                        children: []
                        pos: 5428
                        length: 22
                    children: []
                    pos: 5427
                    length: 24
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return true;
                    children: []
                    pos: 5521
                    length: 12
                  pos: 5452
                  length: 87
                pos: 5424
                length: 115
              - type: return_statement
                fields:
                  text: return parent != null && NodeUtil.isGet(parent);
                children: []
                pos: 5595
                length: 48
              pos: 5418
              length: 229
          children: []
          pos: 5364
          length: 283
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getFunctionJsDocInfo
              children: []
              pos: 5945
              length: 20
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Node n
                children: []
                pos: 5966
                length: 6
              pos: 5927
              length: 543
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: JSDocInfo jsDoc = n.getJSDocInfo();
                children: []
                pos: 5980
                length: 35
              - type: local_variable_declaration
                fields:
                  text: Node parent = n.getParent();
                children: []
                pos: 6020
                length: 28
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: jsDoc
                            children: []
                            pos: 6057
                            length: 5
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 6066
                            length: 4
                        children: []
                        pos: 6057
                        length: 13
                    children: []
                    pos: 6056
                    length: 15
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: int parentType = parent.getType();
                    children: []
                    pos: 6080
                    length: 34
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: or
                            fields:
                              left:
                                type: equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: parentType
                                    children: []
                                    pos: 6125
                                    length: 10
                                  right:
                                    type: field_access
                                    fields:
                                      text: Token.NAME
                                    children: []
                                    pos: 6139
                                    length: 10
                                children: []
                                pos: 6125
                                length: 24
                              right:
                                type: equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: parentType
                                    children: []
                                    pos: 6153
                                    length: 10
                                  right:
                                    type: field_access
                                    fields:
                                      text: Token.ASSIGN
                                    children: []
                                    pos: 6167
                                    length: 12
                                children: []
                                pos: 6153
                                length: 26
                            children: []
                            pos: 6125
                            length: 54
                        children: []
                        pos: 6124
                        length: 56
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: expression_statement
                        fields:
                          text: jsDoc = parent.getJSDocInfo();
                        children: []
                        pos: 6191
                        length: 30
                      - type: if_statement
                        fields:
                          condition:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: and
                                fields:
                                  left:
                                    type: equals
                                    fields:
                                      left:
                                        type: identifier
                                        fields:
                                          text: jsDoc
                                        children: []
                                        pos: 6234
                                        length: 5
                                      right:
                                        type: null_literal
                                        fields: {}
                                        children: []
                                        pos: 6243
                                        length: 4
                                    children: []
                                    pos: 6234
                                    length: 13
                                  right:
                                    type: equals
                                    fields:
                                      left:
                                        type: identifier
                                        fields:
                                          text: parentType
                                        children: []
                                        pos: 6251
                                        length: 10
                                      right:
                                        type: field_access
                                        fields:
                                          text: Token.NAME
                                        children: []
                                        pos: 6265
                                        length: 10
                                    children: []
                                    pos: 6251
                                    length: 24
                                children: []
                                pos: 6234
                                length: 41
                            children: []
                            pos: 6233
                            length: 43
                        children:
                        - type: block
                          fields: {}
                          children:
                          - type: local_variable_declaration
                            fields:
                              text: Node gramps = parent.getParent();
                            children: []
                            pos: 6289
                            length: 33
                          - type: if_statement
                            fields:
                              condition:
                                type: parenthesized_expression
                                fields:
                                  expression:
                                    type: equals
                                    fields:
                                      left:
                                        type: method_invocation
                                        fields:
                                          text: gramps.getType()
                                        children: []
                                        pos: 6337
                                        length: 16
                                      right:
                                        type: field_access
                                        fields:
                                          text: Token.VAR
                                        children: []
                                        pos: 6357
                                        length: 9
                                    children: []
                                    pos: 6337
                                    length: 29
                                children: []
                                pos: 6336
                                length: 31
                            children:
                            - type: block
                              fields: {}
                              children:
                              - type: expression_statement
                                fields:
                                  text: jsDoc = gramps.getJSDocInfo();
                                children: []
                                pos: 6382
                                length: 30
                              pos: 6368
                              length: 56
                            pos: 6333
                            length: 91
                          pos: 6277
                          length: 157
                        pos: 6230
                        length: 204
                      pos: 6181
                      length: 261
                    pos: 6121
                    length: 321
                  pos: 6072
                  length: 376
                pos: 6053
                length: 395
              - type: return_statement
                fields:
                  text: return jsDoc;
                children: []
                pos: 6453
                length: 13
              pos: 5974
              length: 496
          children: []
          pos: 5927
          length: 543
        pos: 1822
        length: 4650
    children: []
    pos: 1822
    length: 4650
  pos: 0
  length: 6473
after_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: CheckGlobalThis
        children: []
        pos: 1834
        length: 15
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: |-
              static final DiagnosticType GLOBAL_THIS = DiagnosticType.warning(
                    "JSC_USED_GLOBAL_THIS",
                    "dangerous use of the global 'this' object");
          children: []
          pos: 1875
          length: 147
        - type: field_declaration
          fields:
            text: private final AbstractCompiler compiler;
          children: []
          pos: 2026
          length: 40
        - type: field_declaration
          fields:
            text: private final CheckLevel level;
          children: []
          pos: 2069
          length: 31
        - type: field_declaration
          fields:
            text: private Node assignLhsChild = null;
          children: []
          pos: 2295
          length: 35
        - type: constructor_declaration
          fields:
            text: |-
              CheckGlobalThis(AbstractCompiler compiler, CheckLevel level) {
                  this.compiler = compiler;
                  this.level = level;
                }
          children: []
          pos: 2334
          length: 120
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: shouldTraverse
              children: []
              pos: 2634
              length: 14
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 2649
                length: 15
              pos: 2619
              length: 2141
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: method_invocation
                            fields:
                              text: n.getType()
                            children: []
                            pos: 2698
                            length: 11
                          right:
                            type: field_access
                            fields:
                              text: Token.FUNCTION
                            children: []
                            pos: 2713
                            length: 14
                        children: []
                        pos: 2698
                        length: 29
                    children: []
                    pos: 2697
                    length: 31
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: JSDocInfo jsDoc = getFunctionJsDocInfo(n);
                    children: []
                    pos: 2845
                    length: 42
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: and
                            fields:
                              left:
                                type: not_equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: jsDoc
                                    children: []
                                    pos: 2898
                                    length: 5
                                  right:
                                    type: null_literal
                                    fields: {}
                                    children: []
                                    pos: 2907
                                    length: 4
                                children: []
                                pos: 2898
                                length: 13
                              right:
                                type: parenthesized_expression
                                fields:
                                  expression:
                                    type: or
                                    fields:
                                      left:
                                        type: or
                                        fields:
                                          left:
                                            type: or
                                            fields:
                                              left:
                                                type: method_invocation
                                                fields:
                                                  text: jsDoc.isConstructor()
                                                children: []
                                                pos: 2926
                                                length: 21
                                              right:
                                                type: method_invocation
                                                fields:
                                                  text: jsDoc.isInterface()
                                                children: []
                                                pos: 2962
                                                length: 19
                                            children: []
                                            pos: 2926
                                            length: 55
                                          right:
                                            type: method_invocation
                                            fields:
                                              text: jsDoc.hasThisType()
                                            children: []
                                            pos: 2996
                                            length: 19
                                        children: []
                                        pos: 2926
                                        length: 89
                                      right:
                                        type: method_invocation
                                        fields:
                                          text: jsDoc.isOverride()
                                        children: []
                                        pos: 3030
                                        length: 18
                                    children: []
                                    pos: 2926
                                    length: 122
                                children: []
                                pos: 2925
                                length: 124
                            children: []
                            pos: 2898
                            length: 151
                        children: []
                        pos: 2897
                        length: 153
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: return_statement
                        fields:
                          text: return false;
                        children: []
                        pos: 3061
                        length: 13
                      pos: 3051
                      length: 31
                    pos: 2894
                    length: 188
                  - type: local_variable_declaration
                    fields:
                      text: int pType = parent.getType();
                    children: []
                    pos: 3366
                    length: 29
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: unary_expression
                            fields:
                              text: |-
                                !(pType == Token.BLOCK ||
                                            pType == Token.SCRIPT ||
                                            pType == Token.NAME ||
                                            pType == Token.ASSIGN ||

                                            // object literal keys
                                            pType == Token.STRING ||
                                            pType == Token.NUMBER)
                            children: []
                            pos: 3406
                            length: 242
                        children: []
                        pos: 3405
                        length: 244
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: return_statement
                        fields:
                          text: return false;
                        children: []
                        pos: 3660
                        length: 13
                      pos: 3650
                      length: 31
                    pos: 3402
                    length: 279
                  pos: 2729
                  length: 1031
                pos: 2694
                length: 1066
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: and
                        fields:
                          left:
                            type: not_equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: parent
                                children: []
                                pos: 3770
                                length: 6
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 3780
                                length: 4
                            children: []
                            pos: 3770
                            length: 14
                          right:
                            type: equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: parent.getType()
                                children: []
                                pos: 3788
                                length: 16
                              right:
                                type: field_access
                                fields:
                                  text: Token.ASSIGN
                                children: []
                                pos: 3808
                                length: 12
                            children: []
                            pos: 3788
                            length: 32
                        children: []
                        pos: 3770
                        length: 50
                    children: []
                    pos: 3769
                    length: 52
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: Node lhs = parent.getFirstChild();
                    children: []
                    pos: 3830
                    length: 34
                  - type: local_variable_declaration
                    fields:
                      text: Node rhs = lhs.getNext();
                    children: []
                    pos: 3871
                    length: 25
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: "n"
                                children: []
                                pos: 3908
                                length: 1
                              right:
                                type: identifier
                                fields:
                                  text: lhs
                                children: []
                                pos: 3913
                                length: 3
                            children: []
                            pos: 3908
                            length: 8
                        children: []
                        pos: 3907
                        length: 10
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: if_statement
                        fields:
                          condition:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: assignLhsChild
                                    children: []
                                    pos: 4127
                                    length: 14
                                  right:
                                    type: null_literal
                                    fields: {}
                                    children: []
                                    pos: 4145
                                    length: 4
                                children: []
                                pos: 4127
                                length: 22
                            children: []
                            pos: 4126
                            length: 24
                        children:
                        - type: block
                          fields: {}
                          children:
                          - type: expression_statement
                            fields:
                              text: assignLhsChild = lhs;
                            children: []
                            pos: 4163
                            length: 21
                          pos: 4151
                          length: 43
                        pos: 4123
                        length: 71
                      pos: 3918
                      length: 284
                    pos: 3904
                    length: 828
                  pos: 3822
                  length: 916
                pos: 3766
                length: 972
              - type: return_statement
                fields:
                  text: return true;
                children: []
                pos: 4744
                length: 12
              pos: 2687
              length: 2073
          children: []
          pos: 2619
          length: 2141
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: visit
              children: []
              pos: 4776
              length: 5
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: NodeTraversal t
                children: []
                pos: 4782
                length: 15
              pos: 4764
              length: 260
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: and
                        fields:
                          left:
                            type: equals
                            fields:
                              left:
                                type: method_invocation
                                fields:
                                  text: n.getType()
                                children: []
                                pos: 4830
                                length: 11
                              right:
                                type: field_access
                                fields:
                                  text: Token.THIS
                                children: []
                                pos: 4845
                                length: 10
                            children: []
                            pos: 4830
                            length: 25
                          right:
                            type: method_invocation
                            fields:
                              text: shouldReportThis(n, parent)
                            children: []
                            pos: 4859
                            length: 27
                        children: []
                        pos: 4830
                        length: 56
                    children: []
                    pos: 4829
                    length: 58
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: compiler.report(t.makeError(n, level, GLOBAL_THIS));
                    children: []
                    pos: 4896
                    length: 52
                  pos: 4888
                  length: 66
                pos: 4826
                length: 128
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: "n"
                            children: []
                            pos: 4963
                            length: 1
                          right:
                            type: identifier
                            fields:
                              text: assignLhsChild
                            children: []
                            pos: 4968
                            length: 14
                        children: []
                        pos: 4963
                        length: 19
                    children: []
                    pos: 4962
                    length: 21
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: assignLhsChild = null;
                    children: []
                    pos: 4992
                    length: 22
                  pos: 4984
                  length: 36
                pos: 4959
                length: 61
              pos: 4820
              length: 204
          children: []
          pos: 4764
          length: 260
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: shouldReportThis
              children: []
              pos: 5044
              length: 16
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Node n
                children: []
                pos: 5061
                length: 6
              pos: 5028
              length: 283
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: assignLhsChild
                            children: []
                            pos: 5092
                            length: 14
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 5110
                            length: 4
                        children: []
                        pos: 5092
                        length: 22
                    children: []
                    pos: 5091
                    length: 24
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return true;
                    children: []
                    pos: 5185
                    length: 12
                  pos: 5116
                  length: 87
                pos: 5088
                length: 115
              - type: return_statement
                fields:
                  text: return parent != null && NodeUtil.isGet(parent);
                children: []
                pos: 5259
                length: 48
              pos: 5082
              length: 229
          children: []
          pos: 5028
          length: 283
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getFunctionJsDocInfo
              children: []
              pos: 5609
              length: 20
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Node n
                children: []
                pos: 5630
                length: 6
              pos: 5591
              length: 543
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: JSDocInfo jsDoc = n.getJSDocInfo();
                children: []
                pos: 5644
                length: 35
              - type: local_variable_declaration
                fields:
                  text: Node parent = n.getParent();
                children: []
                pos: 5684
                length: 28
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: jsDoc
                            children: []
                            pos: 5721
                            length: 5
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 5730
                            length: 4
                        children: []
                        pos: 5721
                        length: 13
                    children: []
                    pos: 5720
                    length: 15
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: int parentType = parent.getType();
                    children: []
                    pos: 5744
                    length: 34
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: or
                            fields:
                              left:
                                type: equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: parentType
                                    children: []
                                    pos: 5789
                                    length: 10
                                  right:
                                    type: field_access
                                    fields:
                                      text: Token.NAME
                                    children: []
                                    pos: 5803
                                    length: 10
                                children: []
                                pos: 5789
                                length: 24
                              right:
                                type: equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: parentType
                                    children: []
                                    pos: 5817
                                    length: 10
                                  right:
                                    type: field_access
                                    fields:
                                      text: Token.ASSIGN
                                    children: []
                                    pos: 5831
                                    length: 12
                                children: []
                                pos: 5817
                                length: 26
                            children: []
                            pos: 5789
                            length: 54
                        children: []
                        pos: 5788
                        length: 56
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: expression_statement
                        fields:
                          text: jsDoc = parent.getJSDocInfo();
                        children: []
                        pos: 5855
                        length: 30
                      - type: if_statement
                        fields:
                          condition:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: and
                                fields:
                                  left:
                                    type: equals
                                    fields:
                                      left:
                                        type: identifier
                                        fields:
                                          text: jsDoc
                                        children: []
                                        pos: 5898
                                        length: 5
                                      right:
                                        type: null_literal
                                        fields: {}
                                        children: []
                                        pos: 5907
                                        length: 4
                                    children: []
                                    pos: 5898
                                    length: 13
                                  right:
                                    type: equals
                                    fields:
                                      left:
                                        type: identifier
                                        fields:
                                          text: parentType
                                        children: []
                                        pos: 5915
                                        length: 10
                                      right:
                                        type: field_access
                                        fields:
                                          text: Token.NAME
                                        children: []
                                        pos: 5929
                                        length: 10
                                    children: []
                                    pos: 5915
                                    length: 24
                                children: []
                                pos: 5898
                                length: 41
                            children: []
                            pos: 5897
                            length: 43
                        children:
                        - type: block
                          fields: {}
                          children:
                          - type: local_variable_declaration
                            fields:
                              text: Node gramps = parent.getParent();
                            children: []
                            pos: 5953
                            length: 33
                          - type: if_statement
                            fields:
                              condition:
                                type: parenthesized_expression
                                fields:
                                  expression:
                                    type: equals
                                    fields:
                                      left:
                                        type: method_invocation
                                        fields:
                                          text: gramps.getType()
                                        children: []
                                        pos: 6001
                                        length: 16
                                      right:
                                        type: field_access
                                        fields:
                                          text: Token.VAR
                                        children: []
                                        pos: 6021
                                        length: 9
                                    children: []
                                    pos: 6001
                                    length: 29
                                children: []
                                pos: 6000
                                length: 31
                            children:
                            - type: block
                              fields: {}
                              children:
                              - type: expression_statement
                                fields:
                                  text: jsDoc = gramps.getJSDocInfo();
                                children: []
                                pos: 6046
                                length: 30
                              pos: 6032
                              length: 56
                            pos: 5997
                            length: 91
                          pos: 5941
                          length: 157
                        pos: 5894
                        length: 204
                      pos: 5845
                      length: 261
                    pos: 5785
                    length: 321
                  pos: 5736
                  length: 376
                pos: 5717
                length: 395
              - type: return_statement
                fields:
                  text: return jsDoc;
                children: []
                pos: 6117
                length: 13
              pos: 5638
              length: 496
          children: []
          pos: 5591
          length: 543
        pos: 1822
        length: 4314
    children: []
    pos: 1822
    length: 4314
  pos: 0
  length: 6137
text_diff: "--- before\n+++ after\n@@ -112,15 +112,6 @@\n       }\n \n       // Don't
  traverse functions that are getting lent to a prototype.\n-      Node gramps = parent.getParent();\n-
  \     if (NodeUtil.isObjectLitKey(parent, gramps)) {\n-        JSDocInfo maybeLends
  = gramps.getJSDocInfo();\n-        if (maybeLends != null &&\n-            maybeLends.getLendsName()
  != null &&\n-            maybeLends.getLendsName().endsWith(\".prototype\")) {\n-
  \         return false;\n-        }\n-      }\n     }\n \n     if (parent != null
  && parent.getType() == Token.ASSIGN) {\n"
tree_diff: |+
  New cluster:
  ===
  delete-node
  ---
  local_variable_declaration: Node gramps = parent.getParent(); [3761,3794]
  ===
  ------------
  ===
  delete-node
  ---
  local_variable_declaration: Node gramps = parent.getParent(); [3761,3794]
  ===

  New cluster:
  Unknown cluster type
  ------------
  ===
  delete-tree
  ---
  if_statement [3801,4090]
      parenthesized_expression [3804,3845]
          method_invocation: NodeUtil.isObjectLitKey(parent, gramps) [3805,3844]
      block [3846,4090]
          local_variable_declaration: JSDocInfo maybeLends = gramps.getJSDocInfo(); [3856,3901]
          if_statement [3910,4082]
              parenthesized_expression [3913,4046]
                  and [3914,4045]
                      and [3914,3981]
                          not_equals [3914,3932]
                              identifier: maybeLends [3914,3924]
                              null_literal [3928,3932]
                          not_equals [3948,3981]
                              method_invocation: maybeLends.getLendsName() [3948,3973]
                              null_literal [3977,3981]
                      method_invocation: maybeLends.getLendsName().endsWith(".prototype") [3997,4045]
              block [4047,4082]
                  return_statement: return false; [4059,4072]

...
