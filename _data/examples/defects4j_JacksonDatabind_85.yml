---
language: java
before_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: DateTimeSerializerBase
        children: []
        pos: 648
        length: 22
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: protected final Boolean _useTimestamp;
          children: []
          pos: 886
          length: 38
        - type: field_declaration
          fields:
            text: protected final DateFormat _customFormat;
          children: []
          pos: 1155
          length: 41
        - type: constructor_declaration
          fields:
            text: |-
              protected DateTimeSerializerBase(Class<T> type,
                          Boolean useTimestamp, DateFormat customFormat)
                  {
                      super(type);
                      _useTimestamp = useTimestamp;
                      _customFormat = customFormat;
                  }
          children: []
          pos: 1202
          length: 215
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: withFormat
              children: []
              pos: 1465
              length: 10
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Boolean timestamp
                children: []
                pos: 1476
                length: 17
              pos: 1423
              length: 97
          children: []
          pos: 1423
          length: 97
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: createContextual
              children: []
              pos: 1565
              length: 16
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: SerializerProvider serializers
                children: []
                pos: 1582
                length: 30
              pos: 1526
              length: 3134
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: property
                            children: []
                            pos: 1695
                            length: 8
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 1707
                            length: 4
                        children: []
                        pos: 1695
                        length: 16
                    children: []
                    pos: 1694
                    length: 18
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return this;
                    children: []
                    pos: 1727
                    length: 12
                  pos: 1713
                  length: 36
                pos: 1691
                length: 58
              - type: local_variable_declaration
                fields:
                  text: JsonFormat.Value format = findFormatOverrides(serializers,
                    property, handledType());
                children: []
                pos: 1758
                length: 84
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: format
                            children: []
                            pos: 1855
                            length: 6
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 1865
                            length: 4
                        children: []
                        pos: 1855
                        length: 14
                    children: []
                    pos: 1854
                    length: 16
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return this;
                    children: []
                    pos: 1885
                    length: 12
                  pos: 1871
                  length: 36
                pos: 1851
                length: 56
              - type: local_variable_declaration
                fields:
                  text: JsonFormat.Shape shape = format.getShape();
                children: []
                pos: 1978
                length: 43
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: shape.isNumeric()
                        children: []
                        pos: 2034
                        length: 17
                    children: []
                    pos: 2033
                    length: 19
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return withFormat(Boolean.TRUE, null);
                    children: []
                    pos: 2067
                    length: 38
                  pos: 2053
                  length: 62
                pos: 2030
                length: 85
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: format.hasPattern()
                        children: []
                        pos: 2258
                        length: 19
                    children: []
                    pos: 2257
                    length: 21
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: |-
                        final Locale loc = format.hasLocale()
                                                    ? format.getLocale()
                                                    : serializers.getLocale();
                    children: []
                    pos: 2293
                    length: 141
                  - type: local_variable_declaration
                    fields:
                      text: SimpleDateFormat df = new SimpleDateFormat(format.getPattern(),
                        loc);
                    children: []
                    pos: 2447
                    length: 69
                  - type: local_variable_declaration
                    fields:
                      text: |-
                        TimeZone tz = format.hasTimeZone() ? format.getTimeZone()
                                            : serializers.getTimeZone();
                    children: []
                    pos: 2529
                    length: 106
                  - type: expression_statement
                    fields:
                      text: df.setTimeZone(tz);
                    children: []
                    pos: 2648
                    length: 19
                  - type: return_statement
                    fields:
                      text: return withFormat(Boolean.FALSE, df);
                    children: []
                    pos: 2680
                    length: 37
                  pos: 2279
                  length: 448
                pos: 2254
                length: 473
              - type: local_variable_declaration
                fields:
                  text: final boolean hasLocale = format.hasLocale();
                children: []
                pos: 2786
                length: 45
              - type: local_variable_declaration
                fields:
                  text: final boolean hasTZ = format.hasTimeZone();
                children: []
                pos: 2840
                length: 43
              - type: local_variable_declaration
                fields:
                  text: final boolean asString = (shape == JsonFormat.Shape.STRING);
                children: []
                pos: 2892
                length: 60
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: and
                        fields:
                          left:
                            type: and
                            fields:
                              left:
                                type: unary_expression
                                fields:
                                  text: "!hasLocale"
                                children: []
                                pos: 2966
                                length: 10
                              right:
                                type: unary_expression
                                fields:
                                  text: "!hasTZ"
                                children: []
                                pos: 2980
                                length: 6
                            children: []
                            pos: 2966
                            length: 20
                          right:
                            type: unary_expression
                            fields:
                              text: "!asString"
                            children: []
                            pos: 2990
                            length: 9
                        children: []
                        pos: 2966
                        length: 33
                    children: []
                    pos: 2965
                    length: 35
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return this;
                    children: []
                    pos: 3015
                    length: 12
                  pos: 3001
                  length: 36
                pos: 2962
                length: 75
              - type: local_variable_declaration
                fields:
                  text: DateFormat df0 = serializers.getConfig().getDateFormat();
                children: []
                pos: 3047
                length: 57
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: instanceof_expression
                        fields:
                          text: df0 instanceof StdDateFormat
                        children: []
                        pos: 3188
                        length: 28
                    children: []
                    pos: 3187
                    length: 30
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: StdDateFormat std = (StdDateFormat) df0;
                    children: []
                    pos: 3232
                    length: 40
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: method_invocation
                            fields:
                              text: format.hasLocale()
                            children: []
                            pos: 3289
                            length: 18
                        children: []
                        pos: 3288
                        length: 20
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: expression_statement
                        fields:
                          text: std = std.withLocale(format.getLocale());
                        children: []
                        pos: 3327
                        length: 41
                      pos: 3309
                      length: 73
                    pos: 3285
                    length: 97
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: method_invocation
                            fields:
                              text: format.hasTimeZone()
                            children: []
                            pos: 3399
                            length: 20
                        children: []
                        pos: 3398
                        length: 22
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: expression_statement
                        fields:
                          text: std = std.withTimeZone(format.getTimeZone());
                        children: []
                        pos: 3439
                        length: 45
                      pos: 3421
                      length: 77
                    pos: 3395
                    length: 103
                  - type: return_statement
                    fields:
                      text: return withFormat(Boolean.FALSE, std);
                    children: []
                    pos: 3511
                    length: 38
                  pos: 3218
                  length: 341
                pos: 3184
                length: 375
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: unary_expression
                        fields:
                          text: "!(df0 instanceof SimpleDateFormat)"
                        children: []
                        pos: 3803
                        length: 34
                    children: []
                    pos: 3802
                    length: 36
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: |-
                        serializers.reportMappingProblem(
                        "Configured `DateFormat` (%s) not a `SimpleDateFormat`; can not configure `Locale` or `TimeZone`",
                        df0.getClass().getName());
                    children: []
                    pos: 3929
                    length: 159
                  pos: 3839
                  length: 259
                pos: 3799
                length: 299
              - type: local_variable_declaration
                fields:
                  text: SimpleDateFormat df = (SimpleDateFormat) df0;
                children: []
                pos: 4107
                length: 45
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: identifier
                        fields:
                          text: hasLocale
                        children: []
                        pos: 4165
                        length: 9
                    children: []
                    pos: 4164
                    length: 11
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: df = new SimpleDateFormat(df.toPattern(), format.getLocale());
                    children: []
                    pos: 4276
                    length: 62
                  pos: 4176
                  length: 172
                pos: 4161
                length: 252
              - type: local_variable_declaration
                fields:
                  text: TimeZone newTz = format.getTimeZone();
                children: []
                pos: 4422
                length: 38
              - type: local_variable_declaration
                fields:
                  text: boolean changeTZ = (newTz != null) && !newTz.equals(df.getTimeZone());
                children: []
                pos: 4469
                length: 70
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: identifier
                        fields:
                          text: changeTZ
                        children: []
                        pos: 4552
                        length: 8
                    children: []
                    pos: 4551
                    length: 10
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: df.setTimeZone(newTz);
                    children: []
                    pos: 4576
                    length: 22
                  pos: 4562
                  length: 46
                pos: 4548
                length: 60
              - type: return_statement
                fields:
                  text: return withFormat(Boolean.FALSE, df);
                children: []
                pos: 4617
                length: 37
              pos: 1681
              length: 2979
          children: []
          pos: 1526
          length: 3134
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: isEmpty
              children: []
              pos: 4872
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: T value
                children: []
                pos: 4880
                length: 7
              pos: 4827
              length: 200
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return (value == null) || (_timestamp(value) == 0L);
                children: []
                pos: 4969
                length: 52
              pos: 4889
              length: 138
          children: []
          pos: 4827
          length: 200
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: isEmpty
              children: []
              pos: 5062
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: SerializerProvider serializers
                children: []
                pos: 5070
                length: 30
              pos: 5033
              length: 216
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return (value == null) || (_timestamp(value) == 0L);
                children: []
                pos: 5191
                length: 52
              pos: 5111
              length: 138
          children: []
          pos: 5033
          length: 216
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: _timestamp
              children: []
              pos: 5283
              length: 10
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: T value
                children: []
                pos: 5294
                length: 7
              pos: 5259
              length: 44
          children: []
          pos: 5259
          length: 44
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getSchema
              children: []
              pos: 5343
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: SerializerProvider serializers
                children: []
                pos: 5353
                length: 30
              pos: 5313
              length: 246
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: 'return createSchemaNode(_asTimestamp(serializers) ? "number"
                    : "string", true);'
                children: []
                pos: 5474
                length: 79
              pos: 5400
              length: 159
          children: []
          pos: 5313
          length: 246
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: acceptJsonFormatVisitor
              children: []
              pos: 5591
              length: 23
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonFormatVisitorWrapper visitor
                children: []
                pos: 5615
                length: 32
              pos: 5565
              length: 232
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: _acceptJsonFormatVisitor(visitor, typeHint, _asTimestamp(visitor.getProvider()));
                children: []
                pos: 5710
                length: 81
              pos: 5700
              length: 97
          children: []
          pos: 5565
          length: 232
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: serialize
              children: []
              pos: 6010
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: T value
                children: []
                pos: 6020
                length: 7
              pos: 5975
              length: 132
          children: []
          pos: 5975
          length: 132
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: _asTimestamp
              children: []
              pos: 6301
              length: 12
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: SerializerProvider serializers
                children: []
                pos: 6314
                length: 30
              pos: 6283
              length: 602
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: _useTimestamp
                            children: []
                            pos: 6364
                            length: 13
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 6381
                            length: 4
                        children: []
                        pos: 6364
                        length: 21
                    children: []
                    pos: 6363
                    length: 23
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return _useTimestamp.booleanValue();
                    children: []
                    pos: 6401
                    length: 36
                  pos: 6387
                  length: 60
                pos: 6360
                length: 87
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: _customFormat
                            children: []
                            pos: 6460
                            length: 13
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 6477
                            length: 4
                        children: []
                        pos: 6460
                        length: 21
                    children: []
                    pos: 6459
                    length: 23
                children:
                - type: block
                  fields: {}
                  children:
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: not_equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: serializers
                                children: []
                                pos: 6501
                                length: 11
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 6516
                                length: 4
                            children: []
                            pos: 6501
                            length: 19
                        children: []
                        pos: 6500
                        length: 21
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: return_statement
                        fields:
                          text: return serializers.isEnabled(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);
                        children: []
                        pos: 6540
                        length: 77
                      pos: 6522
                      length: 109
                    pos: 6497
                    length: 134
                  - type: throw_statement
                    fields:
                      text: throw new IllegalArgumentException("Null SerializerProvider
                        passed for "+handledType().getName());
                    children: []
                    pos: 6749
                    length: 98
                  pos: 6483
                  length: 374
                pos: 6456
                length: 401
              - type: return_statement
                fields:
                  text: return false;
                children: []
                pos: 6866
                length: 13
              pos: 6350
              length: 535
          children: []
          pos: 6283
          length: 602
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: _acceptJsonFormatVisitor
              children: []
              pos: 6906
              length: 24
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonFormatVisitorWrapper visitor
                children: []
                pos: 6931
                length: 32
              pos: 6891
              length: 405
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: identifier
                        fields:
                          text: asNumber
                        children: []
                        pos: 7050
                        length: 8
                    children: []
                    pos: 7049
                    length: 10
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: |-
                        visitIntFormat(visitor, typeHint,
                                            JsonParser.NumberType.LONG, JsonValueFormat.UTC_MILLISEC);
                    children: []
                    pos: 7074
                    length: 112
                  pos: 7060
                  length: 136
                pos: 7046
                length: 244
              pos: 7036
              length: 260
          children: []
          pos: 6891
          length: 405
        pos: 598
        length: 6700
    children: []
    pos: 598
    length: 6700
  pos: 0
  length: 7299
after_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: DateTimeSerializerBase
        children: []
        pos: 648
        length: 22
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: protected final Boolean _useTimestamp;
          children: []
          pos: 886
          length: 38
        - type: field_declaration
          fields:
            text: protected final DateFormat _customFormat;
          children: []
          pos: 1155
          length: 41
        - type: constructor_declaration
          fields:
            text: |-
              protected DateTimeSerializerBase(Class<T> type,
                          Boolean useTimestamp, DateFormat customFormat)
                  {
                      super(type);
                      _useTimestamp = useTimestamp;
                      _customFormat = customFormat;
                  }
          children: []
          pos: 1202
          length: 215
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: withFormat
              children: []
              pos: 1465
              length: 10
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Boolean timestamp
                children: []
                pos: 1476
                length: 17
              pos: 1423
              length: 97
          children: []
          pos: 1423
          length: 97
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: createContextual
              children: []
              pos: 1565
              length: 16
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: SerializerProvider serializers
                children: []
                pos: 1582
                length: 30
              pos: 1526
              length: 2115
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: property
                            children: []
                            pos: 1695
                            length: 8
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 1707
                            length: 4
                        children: []
                        pos: 1695
                        length: 16
                    children: []
                    pos: 1694
                    length: 18
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return this;
                    children: []
                    pos: 1727
                    length: 12
                  pos: 1713
                  length: 36
                pos: 1691
                length: 58
              - type: local_variable_declaration
                fields:
                  text: JsonFormat.Value format = findFormatOverrides(serializers,
                    property, handledType());
                children: []
                pos: 1758
                length: 84
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: format
                            children: []
                            pos: 1855
                            length: 6
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 1865
                            length: 4
                        children: []
                        pos: 1855
                        length: 14
                    children: []
                    pos: 1854
                    length: 16
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return this;
                    children: []
                    pos: 1885
                    length: 12
                  pos: 1871
                  length: 36
                pos: 1851
                length: 56
              - type: local_variable_declaration
                fields:
                  text: JsonFormat.Shape shape = format.getShape();
                children: []
                pos: 1978
                length: 43
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: shape.isNumeric()
                        children: []
                        pos: 2034
                        length: 17
                    children: []
                    pos: 2033
                    length: 19
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return withFormat(Boolean.TRUE, null);
                    children: []
                    pos: 2067
                    length: 38
                  pos: 2053
                  length: 62
                pos: 2030
                length: 85
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: or
                        fields:
                          left:
                            type: or
                            fields:
                              left:
                                type: or
                                fields:
                                  left:
                                    type: parenthesized_expression
                                    fields:
                                      expression:
                                        type: equals
                                        fields:
                                          left:
                                            type: identifier
                                            fields:
                                              text: shape
                                            children: []
                                            pos: 2267
                                            length: 5
                                          right:
                                            type: field_access
                                            fields:
                                              text: JsonFormat.Shape.STRING
                                            children: []
                                            pos: 2276
                                            length: 23
                                        children: []
                                        pos: 2267
                                        length: 32
                                    children: []
                                    pos: 2266
                                    length: 34
                                  right:
                                    type: method_invocation
                                    fields:
                                      text: format.hasPattern()
                                    children: []
                                    pos: 2304
                                    length: 19
                                children: []
                                pos: 2266
                                length: 57
                              right:
                                type: method_invocation
                                fields:
                                  text: format.hasLocale()
                                children: []
                                pos: 2359
                                length: 18
                            children: []
                            pos: 2266
                            length: 111
                          right:
                            type: method_invocation
                            fields:
                              text: format.hasTimeZone()
                            children: []
                            pos: 2381
                            length: 20
                        children: []
                        pos: 2266
                        length: 135
                    children: []
                    pos: 2265
                    length: 137
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: TimeZone tz = format.getTimeZone();
                    children: []
                    pos: 2425
                    length: 35
                  - type: local_variable_declaration
                    fields:
                      text: |-
                        final String pattern = format.hasPattern()
                                                            ? format.getPattern()
                                                            : StdDateFormat.DATE_FORMAT_STR_ISO8601;
                    children: []
                    pos: 2481
                    length: 177
                  - type: local_variable_declaration
                    fields:
                      text: |-
                        final Locale loc = format.hasLocale()
                                                    ? format.getLocale()
                                                    : serializers.getLocale();
                    children: []
                    pos: 2671
                    length: 141
                  - type: local_variable_declaration
                    fields:
                      text: SimpleDateFormat df = new SimpleDateFormat(pattern, loc);
                    children: []
                    pos: 2833
                    length: 57
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: tz
                                children: []
                                pos: 2915
                                length: 2
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 2921
                                length: 4
                            children: []
                            pos: 2915
                            length: 10
                        children: []
                        pos: 2914
                        length: 12
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: expression_statement
                        fields:
                          text: tz = serializers.getTimeZone();
                        children: []
                        pos: 2953
                        length: 31
                      pos: 2927
                      length: 79
                    pos: 2911
                    length: 95
                  - type: expression_statement
                    fields:
                      text: df.setTimeZone(tz);
                    children: []
                    pos: 3019
                    length: 19
                  - type: return_statement
                    fields:
                      text: return withFormat(Boolean.FALSE, df);
                    children: []
                    pos: 3051
                    length: 37
                  pos: 2403
                  length: 695
                pos: 2262
                length: 836
              - type: return_statement
                fields:
                  text: return this;
                children: []
                pos: 3623
                length: 12
              pos: 1681
              length: 1960
          children: []
          pos: 1526
          length: 2115
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: isEmpty
              children: []
              pos: 3853
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: T value
                children: []
                pos: 3861
                length: 7
              pos: 3808
              length: 200
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return (value == null) || (_timestamp(value) == 0L);
                children: []
                pos: 3950
                length: 52
              pos: 3870
              length: 138
          children: []
          pos: 3808
          length: 200
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: isEmpty
              children: []
              pos: 4043
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: SerializerProvider serializers
                children: []
                pos: 4051
                length: 30
              pos: 4014
              length: 216
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return (value == null) || (_timestamp(value) == 0L);
                children: []
                pos: 4172
                length: 52
              pos: 4092
              length: 138
          children: []
          pos: 4014
          length: 216
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: _timestamp
              children: []
              pos: 4264
              length: 10
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: T value
                children: []
                pos: 4275
                length: 7
              pos: 4240
              length: 44
          children: []
          pos: 4240
          length: 44
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getSchema
              children: []
              pos: 4324
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: SerializerProvider serializers
                children: []
                pos: 4334
                length: 30
              pos: 4294
              length: 246
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: 'return createSchemaNode(_asTimestamp(serializers) ? "number"
                    : "string", true);'
                children: []
                pos: 4455
                length: 79
              pos: 4381
              length: 159
          children: []
          pos: 4294
          length: 246
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: acceptJsonFormatVisitor
              children: []
              pos: 4572
              length: 23
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonFormatVisitorWrapper visitor
                children: []
                pos: 4596
                length: 32
              pos: 4546
              length: 232
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: _acceptJsonFormatVisitor(visitor, typeHint, _asTimestamp(visitor.getProvider()));
                children: []
                pos: 4691
                length: 81
              pos: 4681
              length: 97
          children: []
          pos: 4546
          length: 232
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: serialize
              children: []
              pos: 4991
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: T value
                children: []
                pos: 5001
                length: 7
              pos: 4956
              length: 132
          children: []
          pos: 4956
          length: 132
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: _asTimestamp
              children: []
              pos: 5282
              length: 12
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: SerializerProvider serializers
                children: []
                pos: 5295
                length: 30
              pos: 5264
              length: 602
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: _useTimestamp
                            children: []
                            pos: 5345
                            length: 13
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 5362
                            length: 4
                        children: []
                        pos: 5345
                        length: 21
                    children: []
                    pos: 5344
                    length: 23
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return _useTimestamp.booleanValue();
                    children: []
                    pos: 5382
                    length: 36
                  pos: 5368
                  length: 60
                pos: 5341
                length: 87
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: _customFormat
                            children: []
                            pos: 5441
                            length: 13
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 5458
                            length: 4
                        children: []
                        pos: 5441
                        length: 21
                    children: []
                    pos: 5440
                    length: 23
                children:
                - type: block
                  fields: {}
                  children:
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: not_equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: serializers
                                children: []
                                pos: 5482
                                length: 11
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 5497
                                length: 4
                            children: []
                            pos: 5482
                            length: 19
                        children: []
                        pos: 5481
                        length: 21
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: return_statement
                        fields:
                          text: return serializers.isEnabled(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);
                        children: []
                        pos: 5521
                        length: 77
                      pos: 5503
                      length: 109
                    pos: 5478
                    length: 134
                  - type: throw_statement
                    fields:
                      text: throw new IllegalArgumentException("Null SerializerProvider
                        passed for "+handledType().getName());
                    children: []
                    pos: 5730
                    length: 98
                  pos: 5464
                  length: 374
                pos: 5437
                length: 401
              - type: return_statement
                fields:
                  text: return false;
                children: []
                pos: 5847
                length: 13
              pos: 5331
              length: 535
          children: []
          pos: 5264
          length: 602
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: _acceptJsonFormatVisitor
              children: []
              pos: 5887
              length: 24
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonFormatVisitorWrapper visitor
                children: []
                pos: 5912
                length: 32
              pos: 5872
              length: 405
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: identifier
                        fields:
                          text: asNumber
                        children: []
                        pos: 6031
                        length: 8
                    children: []
                    pos: 6030
                    length: 10
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: |-
                        visitIntFormat(visitor, typeHint,
                                            JsonParser.NumberType.LONG, JsonValueFormat.UTC_MILLISEC);
                    children: []
                    pos: 6055
                    length: 112
                  pos: 6041
                  length: 136
                pos: 6027
                length: 244
              pos: 6017
              length: 260
          children: []
          pos: 5872
          length: 405
        pos: 598
        length: 5681
    children: []
    pos: 598
    length: 5681
  pos: 0
  length: 6280
text_diff: "--- before\n+++ after\n@@ -64,61 +64,34 @@\n \n         // 08-Jun-2017,
  tatu: With [databind#1648], this gets bit tricky..\n         // First: custom pattern
  will override things\n-        if (format.hasPattern()) {\n+                if ((shape
  == JsonFormat.Shape.STRING) || format.hasPattern()\n+                                ||
  format.hasLocale() || format.hasTimeZone()) {\n+                    TimeZone tz
  = format.getTimeZone();\n+                    final String pattern = format.hasPattern()\n+
  \                                   ? format.getPattern()\n+                                    :
  StdDateFormat.DATE_FORMAT_STR_ISO8601;\n             final Locale loc = format.hasLocale()\n
  \                            ? format.getLocale()\n                             :
  serializers.getLocale();\n-            SimpleDateFormat df = new SimpleDateFormat(format.getPattern(),
  loc);\n-            TimeZone tz = format.hasTimeZone() ? format.getTimeZone()\n-
  \                   : serializers.getTimeZone();\n+                    SimpleDateFormat
  df = new SimpleDateFormat(pattern, loc);\n+                    if (tz == null) {\n+
  \                       tz = serializers.getTimeZone();\n+                    }\n
  \            df.setTimeZone(tz);\n             return withFormat(Boolean.FALSE,
  df);\n         }\n \n         // Otherwise, need one of these changes:\n-        final
  boolean hasLocale = format.hasLocale();\n-        final boolean hasTZ = format.hasTimeZone();\n-
  \       final boolean asString = (shape == JsonFormat.Shape.STRING);\n \n-        if
  (!hasLocale && !hasTZ && !asString) {\n-            return this;\n-        }\n \n-
  \       DateFormat df0 = serializers.getConfig().getDateFormat();\n         // Jackson's
  own `StdDateFormat` is quite easy to deal with...\n-        if (df0 instanceof StdDateFormat)
  {\n-            StdDateFormat std = (StdDateFormat) df0;\n-            if (format.hasLocale())
  {\n-                std = std.withLocale(format.getLocale());\n-            }\n-
  \           if (format.hasTimeZone()) {\n-                std = std.withTimeZone(format.getTimeZone());\n-
  \           }\n-            return withFormat(Boolean.FALSE, std);\n-        }\n
  \n         // 08-Jun-2017, tatu: Unfortunately there's no generally usable\n         //
  \   mechanism for changing `DateFormat` instances (or even clone()ing)\n         //
  \   So: require it be `SimpleDateFormat`; can't config other types\n-        if
  (!(df0 instanceof SimpleDateFormat)) {\n //            serializers.reportBadDefinition(handledType(),
  String.format(\n-            serializers.reportMappingProblem(\n-\"Configured `DateFormat`
  (%s) not a `SimpleDateFormat`; can not configure `Locale` or `TimeZone`\",\n-df0.getClass().getName());\n-
  \       }\n-        SimpleDateFormat df = (SimpleDateFormat) df0;\n-        if (hasLocale)
  {\n             // Ugh. No way to change `Locale`, create copy; must re-crete completely:\n-
  \           df = new SimpleDateFormat(df.toPattern(), format.getLocale());\n-        }
  else {\n-            df = (SimpleDateFormat) df.clone();\n-        }\n-        TimeZone
  newTz = format.getTimeZone();\n-        boolean changeTZ = (newTz != null) && !newTz.equals(df.getTimeZone());\n-
  \       if (changeTZ) {\n-            df.setTimeZone(newTz);\n-        }\n-        return
  withFormat(Boolean.FALSE, df);\n+        return this;\n     }\n \n     /*\n"
tree_diff: |+
  New cluster:
  Unknown cluster type
  ------------
  ===
  insert-tree
  ---
  if_statement [2262,3098]
      parenthesized_expression [2265,2402]
          or [2266,2401]
              or [2266,2377]
                  or [2266,2323]
                      parenthesized_expression [2266,2300]
                          equals [2267,2299]
                              identifier: shape [2267,2272]
                              field_access: JsonFormat.Shape.STRING [2276,2299]
                      method_invocation: format.hasPattern() [2304,2323]
                  method_invocation: format.hasLocale() [2359,2377]
              method_invocation: format.hasTimeZone() [2381,2401]
      block [2403,3098]
          local_variable_declaration: TimeZone tz = format.getTimeZone(); [2425,2460]
          local_variable_declaration: final String pattern = format.hasPattern()
                                      ? format.getPattern()
                                      : StdDateFormat.DATE_FORMAT_STR_ISO8601; [2481,2658]
          local_variable_declaration: final Locale loc = format.hasLocale()
                              ? format.getLocale()
                              : serializers.getLocale(); [2671,2812]
          local_variable_declaration: SimpleDateFormat df = new SimpleDateFormat(pattern, loc); [2833,2890]
          if_statement [2911,3006]
              parenthesized_expression [2914,2926]
                  equals [2915,2925]
                      identifier: tz [2915,2917]
                      null_literal [2921,2925]
              block [2927,3006]
                  expression_statement: tz = serializers.getTimeZone(); [2953,2984]
          expression_statement: df.setTimeZone(tz); [3019,3038]
          return_statement: return withFormat(Boolean.FALSE, df); [3051,3088]
  to
  block [1681,4660]
  at 5

  New cluster:
  UPDATE from return withFormat(Boolean.FALSE, df); to return this;
  ------------
  ===
  update-node
  ---
  return_statement: return withFormat(Boolean.FALSE, df); [4617,4654]
  replace return withFormat(Boolean.FALSE, df); by return this;

  New cluster:
  Unknown cluster type
  ------------
  ===
  delete-tree
  ---
  if_statement [2254,2727]
      parenthesized_expression [2257,2278]
          method_invocation: format.hasPattern() [2258,2277]
      block [2279,2727]
          local_variable_declaration: final Locale loc = format.hasLocale()
                              ? format.getLocale()
                              : serializers.getLocale(); [2293,2434]
          local_variable_declaration: SimpleDateFormat df = new SimpleDateFormat(format.getPattern(), loc); [2447,2516]
          local_variable_declaration: TimeZone tz = format.hasTimeZone() ? format.getTimeZone()
                      : serializers.getTimeZone(); [2529,2635]
          expression_statement: df.setTimeZone(tz); [2648,2667]
          return_statement: return withFormat(Boolean.FALSE, df); [2680,2717]

  New cluster:
  ===
  delete-node
  ---
  local_variable_declaration: final boolean hasLocale = format.hasLocale(); [2786,2831]
  ===
  ------------
  ===
  delete-node
  ---
  local_variable_declaration: final boolean hasLocale = format.hasLocale(); [2786,2831]
  ===

  New cluster:
  ===
  delete-node
  ---
  local_variable_declaration: final boolean hasTZ = format.hasTimeZone(); [2840,2883]
  ===
  ------------
  ===
  delete-node
  ---
  local_variable_declaration: final boolean hasTZ = format.hasTimeZone(); [2840,2883]
  ===

  New cluster:
  ===
  delete-node
  ---
  local_variable_declaration: final boolean asString = (shape == JsonFormat.Shape.STRING); [2892,2952]
  ===
  ------------
  ===
  delete-node
  ---
  local_variable_declaration: final boolean asString = (shape == JsonFormat.Shape.STRING); [2892,2952]
  ===

  New cluster:
  Unknown cluster type
  ------------
  ===
  delete-tree
  ---
  if_statement [2962,3037]
      parenthesized_expression [2965,3000]
          and [2966,2999]
              and [2966,2986]
                  unary_expression: !hasLocale [2966,2976]
                  unary_expression: !hasTZ [2980,2986]
              unary_expression: !asString [2990,2999]
      block [3001,3037]
          return_statement: return this; [3015,3027]

  New cluster:
  ===
  delete-node
  ---
  local_variable_declaration: DateFormat df0 = serializers.getConfig().getDateFormat(); [3047,3104]
  ===
  ------------
  ===
  delete-node
  ---
  local_variable_declaration: DateFormat df0 = serializers.getConfig().getDateFormat(); [3047,3104]
  ===

  New cluster:
  Unknown cluster type
  ------------
  ===
  delete-tree
  ---
  if_statement [3184,3559]
      parenthesized_expression [3187,3217]
          instanceof_expression: df0 instanceof StdDateFormat [3188,3216]
      block [3218,3559]
          local_variable_declaration: StdDateFormat std = (StdDateFormat) df0; [3232,3272]
          if_statement [3285,3382]
              parenthesized_expression [3288,3308]
                  method_invocation: format.hasLocale() [3289,3307]
              block [3309,3382]
                  expression_statement: std = std.withLocale(format.getLocale()); [3327,3368]
          if_statement [3395,3498]
              parenthesized_expression [3398,3420]
                  method_invocation: format.hasTimeZone() [3399,3419]
              block [3421,3498]
                  expression_statement: std = std.withTimeZone(format.getTimeZone()); [3439,3484]
          return_statement: return withFormat(Boolean.FALSE, std); [3511,3549]

  New cluster:
  Unknown cluster type
  ------------
  ===
  delete-tree
  ---
  if_statement [3799,4098]
      parenthesized_expression [3802,3838]
          unary_expression: !(df0 instanceof SimpleDateFormat) [3803,3837]
      block [3839,4098]
          expression_statement: serializers.reportMappingProblem(
  "Configured `DateFormat` (%s) not a `SimpleDateFormat`; can not configure `Locale` or `TimeZone`",
  df0.getClass().getName()); [3929,4088]

  New cluster:
  ===
  delete-node
  ---
  local_variable_declaration: SimpleDateFormat df = (SimpleDateFormat) df0; [4107,4152]
  ===
  ------------
  ===
  delete-node
  ---
  local_variable_declaration: SimpleDateFormat df = (SimpleDateFormat) df0; [4107,4152]
  ===

  New cluster:
  Unknown cluster type
  ------------
  ===
  delete-tree
  ---
  if_statement [4161,4413]
      parenthesized_expression [4164,4175]
          identifier: hasLocale [4165,4174]
      block [4176,4348]
          expression_statement: df = new SimpleDateFormat(df.toPattern(), format.getLocale()); [4276,4338]

  New cluster:
  ===
  delete-node
  ---
  local_variable_declaration: TimeZone newTz = format.getTimeZone(); [4422,4460]
  ===
  ------------
  ===
  delete-node
  ---
  local_variable_declaration: TimeZone newTz = format.getTimeZone(); [4422,4460]
  ===

  New cluster:
  ===
  delete-node
  ---
  local_variable_declaration: boolean changeTZ = (newTz != null) && !newTz.equals(df.getTimeZone()); [4469,4539]
  ===
  ------------
  ===
  delete-node
  ---
  local_variable_declaration: boolean changeTZ = (newTz != null) && !newTz.equals(df.getTimeZone()); [4469,4539]
  ===

  New cluster:
  Unknown cluster type
  ------------
  ===
  delete-tree
  ---
  if_statement [4548,4608]
      parenthesized_expression [4551,4561]
          identifier: changeTZ [4552,4560]
      block [4562,4608]
          expression_statement: df.setTimeZone(newTz); [4576,4598]

...
