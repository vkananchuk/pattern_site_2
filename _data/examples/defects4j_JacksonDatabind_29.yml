---
language: java
before_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: ExternalTypeHandler
        children: []
        pos: 744
        length: 19
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: private final ExtTypedProperty[] _properties;
          children: []
          pos: 770
          length: 45
        - type: field_declaration
          fields:
            text: private final HashMap<String, Integer> _nameToPropertyIndex;
          children: []
          pos: 820
          length: 60
        - type: field_declaration
          fields:
            text: private final String[] _typeIds;
          children: []
          pos: 886
          length: 32
        - type: field_declaration
          fields:
            text: private final TokenBuffer[] _tokens;
          children: []
          pos: 923
          length: 36
        - type: constructor_declaration
          fields:
            text: "protected ExternalTypeHandler(ExtTypedProperty[] properties,\n
              \           HashMap<String, Integer> nameToPropertyIndex,\n            String[]
              typeIds, TokenBuffer[] tokens)\n    {\n        _properties = properties;
              \       \n        _nameToPropertyIndex = nameToPropertyIndex;\n        _typeIds
              = typeIds;\n        _tokens = tokens;\n    }"
          children: []
          pos: 969
          length: 330
        - type: constructor_declaration
          fields:
            text: |-
              protected ExternalTypeHandler(ExternalTypeHandler h)
                  {
                      _properties = h._properties;
                      _nameToPropertyIndex = h._nameToPropertyIndex;
                      int len = _properties.length;
                      _typeIds = new String[len];
                      _tokens = new TokenBuffer[len];
                  }
          children: []
          pos: 1305
          length: 270
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: start
              children: []
              pos: 1612
              length: 5
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 1585
              length: 88
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return new ExternalTypeHandler(this);
                children: []
                pos: 1630
                length: 37
              pos: 1620
              length: 53
          children: []
          pos: 1585
          length: 88
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: handleTypePropertyValue
              children: []
              pos: 2009
              length: 23
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonParser jp
                children: []
                pos: 2033
                length: 13
              pos: 1994
              length: 1016
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: Integer I = _nameToPropertyIndex.get(propName);
                children: []
                pos: 2160
                length: 47
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: I
                            children: []
                            pos: 2220
                            length: 1
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 2225
                            length: 4
                        children: []
                        pos: 2220
                        length: 9
                    children: []
                    pos: 2219
                    length: 11
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return false;
                    children: []
                    pos: 2245
                    length: 13
                  pos: 2231
                  length: 37
                pos: 2216
                length: 52
              - type: local_variable_declaration
                fields:
                  text: int index = I.intValue();
                children: []
                pos: 2277
                length: 25
              - type: local_variable_declaration
                fields:
                  text: ExtTypedProperty prop = _properties[index];
                children: []
                pos: 2311
                length: 43
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: unary_expression
                        fields:
                          text: "!prop.hasTypePropertyName(propName)"
                        children: []
                        pos: 2367
                        length: 35
                    children: []
                    pos: 2366
                    length: 37
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return false;
                    children: []
                    pos: 2418
                    length: 13
                  pos: 2404
                  length: 37
                pos: 2363
                length: 78
              - type: local_variable_declaration
                fields:
                  text: String typeId = jp.getText();
                children: []
                pos: 2450
                length: 29
              - type: local_variable_declaration
                fields:
                  text: boolean canDeserialize = (bean != null) && (_tokens[index]
                    != null);
                children: []
                pos: 2564
                length: 68
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: identifier
                        fields:
                          text: canDeserialize
                        children: []
                        pos: 2731
                        length: 14
                    children: []
                    pos: 2730
                    length: 16
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: _deserializeAndSet(jp, ctxt, bean, index, typeId);
                    children: []
                    pos: 2761
                    length: 50
                  - type: expression_statement
                    fields:
                      text: _tokens[index] = null;
                    children: []
                    pos: 2896
                    length: 22
                  pos: 2747
                  length: 181
                pos: 2727
                length: 256
              - type: return_statement
                fields:
                  text: return true;
                children: []
                pos: 2992
                length: 12
              pos: 2150
              length: 860
          children: []
          pos: 1994
          length: 1016
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: handlePropertyValue
              children: []
              pos: 3411
              length: 19
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonParser jp
                children: []
                pos: 3431
                length: 13
              pos: 3396
              length: 1304
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: Integer I = _nameToPropertyIndex.get(propName);
                children: []
                pos: 3550
                length: 47
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: I
                            children: []
                            pos: 3610
                            length: 1
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 3615
                            length: 4
                        children: []
                        pos: 3610
                        length: 9
                    children: []
                    pos: 3609
                    length: 11
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return false;
                    children: []
                    pos: 3635
                    length: 13
                  pos: 3621
                  length: 37
                pos: 3606
                length: 52
              - type: local_variable_declaration
                fields:
                  text: int index = I.intValue();
                children: []
                pos: 3667
                length: 25
              - type: local_variable_declaration
                fields:
                  text: ExtTypedProperty prop = _properties[index];
                children: []
                pos: 3701
                length: 43
              - type: local_variable_declaration
                fields:
                  text: boolean canDeserialize;
                children: []
                pos: 3753
                length: 23
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: prop.hasTypePropertyName(propName)
                        children: []
                        pos: 3789
                        length: 34
                    children: []
                    pos: 3788
                    length: 36
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: _typeIds[index] = jp.getText();
                    children: []
                    pos: 3839
                    length: 31
                  - type: expression_statement
                    fields:
                      text: jp.skipChildren();
                    children: []
                    pos: 3883
                    length: 18
                  - type: expression_statement
                    fields:
                      text: canDeserialize = (bean != null) && (_tokens[index] !=
                        null);
                    children: []
                    pos: 3914
                    length: 60
                  pos: 3825
                  length: 159
                pos: 3785
                length: 468
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: identifier
                        fields:
                          text: canDeserialize
                        children: []
                        pos: 4395
                        length: 14
                    children: []
                    pos: 4394
                    length: 16
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: String typeId = _typeIds[index];
                    children: []
                    pos: 4425
                    length: 32
                  - type: expression_statement
                    fields:
                      text: _typeIds[index] = null;
                    children: []
                    pos: 4542
                    length: 23
                  - type: expression_statement
                    fields:
                      text: _deserializeAndSet(jp, ctxt, bean, index, typeId);
                    children: []
                    pos: 4578
                    length: 50
                  - type: expression_statement
                    fields:
                      text: _tokens[index] = null;
                    children: []
                    pos: 4641
                    length: 22
                  pos: 4411
                  length: 262
                pos: 4391
                length: 282
              - type: return_statement
                fields:
                  text: return true;
                children: []
                pos: 4682
                length: 12
              pos: 3540
              length: 1160
          children: []
          pos: 3396
          length: 1304
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: complete
              children: []
              pos: 4888
              length: 8
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonParser p
                children: []
                pos: 4897
                length: 12
              pos: 4840
              length: 2081
            body:
              type: block
              fields: {}
              children:
              - type: for_statement
                fields:
                  text: "for (int i = 0, len = _properties.length; i < len; ++i) {\n
                    \           String typeId = _typeIds[i];\n            if (typeId
                    == null) {\n                TokenBuffer tokens = _tokens[i];\n
                    \               // let's allow missing both type and property
                    (may already have been set, too)\n                // but not just
                    one\n                if (tokens == null) {\n                    continue;\n
                    \               }\n                // [databind#118]: Need to
                    mind natural types, for which no type id\n                // will
                    be included.\n                JsonToken t = tokens.firstToken();\n
                    \               if (t != null && t.isScalarValue()) {\n                    JsonParser
                    buffered = tokens.asParser(p);\n                    buffered.nextToken();\n
                    \                   SettableBeanProperty extProp = _properties[i].getProperty();\n
                    \                   Object result = TypeDeserializer.deserializeIfNatural(buffered,
                    ctxt, extProp.getType());\n                    if (result != null)
                    {\n                        extProp.set(bean, result);\n                        continue;\n
                    \                   }\n                    // 26-Oct-2012, tatu:
                    As per [databind#94], must allow use of 'defaultImpl'\n                    if
                    (!_properties[i].hasDefaultType()) {\n                        throw
                    ctxt.mappingException(\"Missing external type id property '%s'\",\n
                    \                               _properties[i].getTypePropertyName());
                    \                               \n                    }\n                    typeId
                    = _properties[i].getDefaultTypeId();\n                }\n            }
                    else if (_tokens[i] == null) {\n                SettableBeanProperty
                    prop = _properties[i].getProperty();\n                throw ctxt.mappingException(\"Missing
                    property '%s' for external type id '%s'\",\n                        prop.getName(),
                    _properties[i].getTypePropertyName());\n            }\n            _deserializeAndSet(p,
                    ctxt, bean, i, typeId);\n        }"
                children: []
                pos: 4994
                length: 1900
              - type: return_statement
                fields:
                  text: return bean;
                children: []
                pos: 6903
                length: 12
              pos: 4984
              length: 1937
          children: []
          pos: 4840
          length: 2081
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: complete
              children: []
              pos: 7088
              length: 8
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonParser jp
                children: []
                pos: 7097
                length: 13
              pos: 7074
              length: 2093
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: final int len = _properties.length;
                children: []
                pos: 7314
                length: 35
              - type: local_variable_declaration
                fields:
                  text: Object[] values = new Object[len];
                children: []
                pos: 7358
                length: 34
              - type: for_statement
                fields:
                  text: |-
                    for (int i = 0; i < len; ++i) {
                                String typeId = _typeIds[i];
                                if (typeId == null) {
                                    // let's allow missing both type and property (may already have been set, too)
                                    if (_tokens[i] == null) {
                                        continue;
                                    }
                                    // but not just one
                                    // 26-Oct-2012, tatu: As per [Issue#94], must allow use of 'defaultImpl'
                                    if (!_properties[i].hasDefaultType()) {
                                        throw ctxt.mappingException("Missing external type id property '%s'",
                                                _properties[i].getTypePropertyName());
                                    }
                                    typeId = _properties[i].getDefaultTypeId();
                                } else if (_tokens[i] == null) {
                                    SettableBeanProperty prop = _properties[i].getProperty();
                                    throw ctxt.mappingException("Missing property '%s' for external type id '%s'",
                                            prop.getName(), _properties[i].getTypePropertyName());
                                }
                                values[i] = _deserialize(jp, ctxt, i, typeId);
                            }
                children: []
                pos: 7401
                length: 1083
              - type: for_statement
                fields:
                  text: |-
                    for (int i = 0; i < len; ++i) {
                                SettableBeanProperty prop = _properties[i].getProperty();
                                if (creator.findCreatorProperty(prop.getName()) != null) {
                                    buffer.assignParameter(prop, values[i]);
                                }
                            }
                children: []
                pos: 8540
                length: 253
              - type: local_variable_declaration
                fields:
                  text: Object bean = creator.build(ctxt, buffer);
                children: []
                pos: 8802
                length: 42
              - type: for_statement
                fields:
                  text: |-
                    for (int i = 0; i < len; ++i) {
                                SettableBeanProperty prop = _properties[i].getProperty();
                                if (creator.findCreatorProperty(prop.getName()) == null) {
                                    prop.set(bean, values[i]);
                                }
                            }
                children: []
                pos: 8901
                length: 239
              - type: return_statement
                fields:
                  text: return bean;
                children: []
                pos: 9149
                length: 12
              pos: 7242
              length: 1925
          children: []
          pos: 7074
          length: 2093
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: _deserialize
              children: []
              pos: 9230
              length: 12
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonParser p
                children: []
                pos: 9243
                length: 12
              pos: 9173
              length: 831
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: JsonParser p2 = _tokens[index].asParser(p);
                children: []
                pos: 9357
                length: 43
              - type: local_variable_declaration
                fields:
                  text: JsonToken t = p2.nextToken();
                children: []
                pos: 9409
                length: 29
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: t
                            children: []
                            pos: 9531
                            length: 1
                          right:
                            type: field_access
                            fields:
                              text: JsonToken.VALUE_NULL
                            children: []
                            pos: 9536
                            length: 20
                        children: []
                        pos: 9531
                        length: 25
                    children: []
                    pos: 9530
                    length: 27
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return null;
                    children: []
                    pos: 9572
                    length: 12
                  pos: 9558
                  length: 36
                pos: 9527
                length: 67
              - type: local_variable_declaration
                fields:
                  text: TokenBuffer merged = new TokenBuffer(p);
                children: []
                pos: 9604
                length: 40
              - type: expression_statement
                fields:
                  text: merged.writeStartArray();
                children: []
                pos: 9653
                length: 25
              - type: expression_statement
                fields:
                  text: merged.writeString(typeId);
                children: []
                pos: 9687
                length: 27
              - type: expression_statement
                fields:
                  text: merged.copyCurrentStructure(p2);
                children: []
                pos: 9723
                length: 32
              - type: expression_statement
                fields:
                  text: merged.writeEndArray();
                children: []
                pos: 9764
                length: 23
              - type: local_variable_declaration
                fields:
                  text: JsonParser mp = merged.asParser(p);
                children: []
                pos: 9868
                length: 35
              - type: expression_statement
                fields:
                  text: mp.nextToken();
                children: []
                pos: 9912
                length: 15
              - type: return_statement
                fields:
                  text: return _properties[index].getProperty().deserialize(mp, ctxt);
                children: []
                pos: 9936
                length: 62
              pos: 9347
              length: 657
          children: []
          pos: 9173
          length: 831
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: _deserializeAndSet
              children: []
              pos: 10065
              length: 18
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonParser p
                children: []
                pos: 10084
                length: 12
              pos: 10010
              length: 1084
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: JsonParser p2 = _tokens[index].asParser(p);
                children: []
                pos: 10378
                length: 43
              - type: local_variable_declaration
                fields:
                  text: JsonToken t = p2.nextToken();
                children: []
                pos: 10430
                length: 29
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: t
                            children: []
                            pos: 10552
                            length: 1
                          right:
                            type: field_access
                            fields:
                              text: JsonToken.VALUE_NULL
                            children: []
                            pos: 10557
                            length: 20
                        children: []
                        pos: 10552
                        length: 25
                    children: []
                    pos: 10551
                    length: 27
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: _properties[index].getProperty().set(bean, null);
                    children: []
                    pos: 10593
                    length: 49
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 10655
                    length: 7
                  pos: 10579
                  length: 93
                pos: 10548
                length: 124
              - type: local_variable_declaration
                fields:
                  text: TokenBuffer merged = new TokenBuffer(p);
                children: []
                pos: 10681
                length: 40
              - type: expression_statement
                fields:
                  text: merged.writeStartArray();
                children: []
                pos: 10730
                length: 25
              - type: expression_statement
                fields:
                  text: merged.writeString(typeId);
                children: []
                pos: 10764
                length: 27
              - type: expression_statement
                fields:
                  text: merged.copyCurrentStructure(p2);
                children: []
                pos: 10809
                length: 32
              - type: expression_statement
                fields:
                  text: merged.writeEndArray();
                children: []
                pos: 10850
                length: 23
              - type: local_variable_declaration
                fields:
                  text: JsonParser mp = merged.asParser(p);
                children: []
                pos: 10953
                length: 35
              - type: expression_statement
                fields:
                  text: mp.nextToken();
                children: []
                pos: 10997
                length: 15
              - type: expression_statement
                fields:
                  text: _properties[index].getProperty().deserializeAndSet(mp, ctxt,
                    bean);
                children: []
                pos: 11021
                length: 67
              pos: 10201
              length: 893
          children: []
          pos: 10010
          length: 1084
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: Builder
              children: []
              pos: 11294
              length: 7
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: private final ArrayList<ExtTypedProperty> _properties = new
                    ArrayList<ExtTypedProperty>();
                children: []
                pos: 11316
                length: 90
              - type: field_declaration
                fields:
                  text: private final HashMap<String, Integer> _nameToPropertyIndex
                    = new HashMap<String, Integer>();
                children: []
                pos: 11415
                length: 93
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: addExternal
                    children: []
                    pos: 11530
                    length: 11
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: SettableBeanProperty property
                      children: []
                      pos: 11542
                      length: 29
                    pos: 11518
                    length: 361
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: Integer index = _properties.size();
                      children: []
                      pos: 11623
                      length: 35
                    - type: expression_statement
                      fields:
                        text: _properties.add(new ExtTypedProperty(property, typeDeser));
                      children: []
                      pos: 11671
                      length: 59
                    - type: expression_statement
                      fields:
                        text: _nameToPropertyIndex.put(property.getName(), index);
                      children: []
                      pos: 11743
                      length: 52
                    - type: expression_statement
                      fields:
                        text: _nameToPropertyIndex.put(typeDeser.getPropertyName(),
                          index);
                      children: []
                      pos: 11808
                      length: 61
                    pos: 11609
                    length: 270
                children: []
                pos: 11518
                length: 361
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: build
                    children: []
                    pos: 11924
                    length: 5
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 11897
                    length: 207
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: |-
                          return new ExternalTypeHandler(_properties.toArray(new ExtTypedProperty[_properties.size()]),
                                              _nameToPropertyIndex, null, null);
                      children: []
                      pos: 11946
                      length: 148
                    pos: 11932
                    length: 172
                children: []
                pos: 11897
                length: 207
              pos: 11274
              length: 836
          children: []
          pos: 11274
          length: 836
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: ExtTypedProperty
              children: []
              pos: 12143
              length: 16
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: private final SettableBeanProperty _property;
                children: []
                pos: 12174
                length: 45
              - type: field_declaration
                fields:
                  text: private final TypeDeserializer _typeDeserializer;
                children: []
                pos: 12228
                length: 49
              - type: field_declaration
                fields:
                  text: private final String _typePropertyName;
                children: []
                pos: 12286
                length: 39
              - type: constructor_declaration
                fields:
                  text: |-
                    public ExtTypedProperty(SettableBeanProperty property, TypeDeserializer typeDeser)
                            {
                                _property = property;
                                _typeDeserializer = typeDeser;
                                _typePropertyName = typeDeser.getPropertyName();
                            }
                children: []
                pos: 12343
                length: 240
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: hasTypePropertyName
                    children: []
                    pos: 12608
                    length: 19
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: String n
                      children: []
                      pos: 12628
                      length: 8
                    pos: 12593
                    length: 104
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return n.equals(_typePropertyName);
                      children: []
                      pos: 12652
                      length: 35
                    pos: 12638
                    length: 59
                children: []
                pos: 12593
                length: 104
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: hasDefaultType
                    children: []
                    pos: 12722
                    length: 14
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 12707
                    length: 106
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return _typeDeserializer.getDefaultImpl() != null;
                      children: []
                      pos: 12753
                      length: 50
                    pos: 12739
                    length: 74
                children: []
                pos: 12707
                length: 106
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: getDefaultTypeId
                    children: []
                    pos: 12837
                    length: 16
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 12823
                    length: 293
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: Class<?> defaultType = _typeDeserializer.getDefaultImpl();
                      children: []
                      pos: 12870
                      length: 58
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: equals
                              fields:
                                left:
                                  type: identifier
                                  fields:
                                    text: defaultType
                                  children: []
                                  pos: 12945
                                  length: 11
                                right:
                                  type: null_literal
                                  fields: {}
                                  children: []
                                  pos: 12960
                                  length: 4
                              children: []
                              pos: 12945
                              length: 19
                          children: []
                          pos: 12944
                          length: 21
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return null;
                          children: []
                          pos: 12984
                          length: 12
                        pos: 12966
                        length: 44
                      pos: 12941
                      length: 69
                    - type: return_statement
                      fields:
                        text: return _typeDeserializer.getTypeIdResolver().idFromValueAndType(null,
                          defaultType);
                      children: []
                      pos: 13023
                      length: 83
                    pos: 12856
                    length: 260
                children: []
                pos: 12823
                length: 293
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: getTypePropertyName
                    children: []
                    pos: 13148
                    length: 19
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 13134
                    length: 65
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return _typePropertyName;
                      children: []
                      pos: 13172
                      length: 25
                    pos: 13170
                    length: 29
                children: []
                pos: 13134
                length: 65
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: getProperty
                    children: []
                    pos: 13245
                    length: 11
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 13217
                    length: 83
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return _property;
                      children: []
                      pos: 13273
                      length: 17
                    pos: 13259
                    length: 41
                children: []
                pos: 13217
                length: 83
              pos: 12116
              length: 1190
          children: []
          pos: 12116
          length: 1190
        pos: 731
        length: 12577
    children: []
    pos: 731
    length: 12577
  pos: 0
  length: 13309
after_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: ExternalTypeHandler
        children: []
        pos: 744
        length: 19
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: private final ExtTypedProperty[] _properties;
          children: []
          pos: 770
          length: 45
        - type: field_declaration
          fields:
            text: private final HashMap<String, Integer> _nameToPropertyIndex;
          children: []
          pos: 820
          length: 60
        - type: field_declaration
          fields:
            text: private final String[] _typeIds;
          children: []
          pos: 886
          length: 32
        - type: field_declaration
          fields:
            text: private final TokenBuffer[] _tokens;
          children: []
          pos: 923
          length: 36
        - type: constructor_declaration
          fields:
            text: "protected ExternalTypeHandler(ExtTypedProperty[] properties,\n
              \           HashMap<String, Integer> nameToPropertyIndex,\n            String[]
              typeIds, TokenBuffer[] tokens)\n    {\n        _properties = properties;
              \       \n        _nameToPropertyIndex = nameToPropertyIndex;\n        _typeIds
              = typeIds;\n        _tokens = tokens;\n    }"
          children: []
          pos: 969
          length: 330
        - type: constructor_declaration
          fields:
            text: |-
              protected ExternalTypeHandler(ExternalTypeHandler h)
                  {
                      _properties = h._properties;
                      _nameToPropertyIndex = h._nameToPropertyIndex;
                      int len = _properties.length;
                      _typeIds = new String[len];
                      _tokens = new TokenBuffer[len];
                  }
          children: []
          pos: 1305
          length: 270
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: start
              children: []
              pos: 1612
              length: 5
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 1585
              length: 88
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return new ExternalTypeHandler(this);
                children: []
                pos: 1630
                length: 37
              pos: 1620
              length: 53
          children: []
          pos: 1585
          length: 88
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: handleTypePropertyValue
              children: []
              pos: 2009
              length: 23
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonParser jp
                children: []
                pos: 2033
                length: 13
              pos: 1994
              length: 1016
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: Integer I = _nameToPropertyIndex.get(propName);
                children: []
                pos: 2160
                length: 47
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: I
                            children: []
                            pos: 2220
                            length: 1
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 2225
                            length: 4
                        children: []
                        pos: 2220
                        length: 9
                    children: []
                    pos: 2219
                    length: 11
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return false;
                    children: []
                    pos: 2245
                    length: 13
                  pos: 2231
                  length: 37
                pos: 2216
                length: 52
              - type: local_variable_declaration
                fields:
                  text: int index = I.intValue();
                children: []
                pos: 2277
                length: 25
              - type: local_variable_declaration
                fields:
                  text: ExtTypedProperty prop = _properties[index];
                children: []
                pos: 2311
                length: 43
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: unary_expression
                        fields:
                          text: "!prop.hasTypePropertyName(propName)"
                        children: []
                        pos: 2367
                        length: 35
                    children: []
                    pos: 2366
                    length: 37
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return false;
                    children: []
                    pos: 2418
                    length: 13
                  pos: 2404
                  length: 37
                pos: 2363
                length: 78
              - type: local_variable_declaration
                fields:
                  text: String typeId = jp.getText();
                children: []
                pos: 2450
                length: 29
              - type: local_variable_declaration
                fields:
                  text: boolean canDeserialize = (bean != null) && (_tokens[index]
                    != null);
                children: []
                pos: 2564
                length: 68
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: identifier
                        fields:
                          text: canDeserialize
                        children: []
                        pos: 2731
                        length: 14
                    children: []
                    pos: 2730
                    length: 16
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: _deserializeAndSet(jp, ctxt, bean, index, typeId);
                    children: []
                    pos: 2761
                    length: 50
                  - type: expression_statement
                    fields:
                      text: _tokens[index] = null;
                    children: []
                    pos: 2896
                    length: 22
                  pos: 2747
                  length: 181
                pos: 2727
                length: 256
              - type: return_statement
                fields:
                  text: return true;
                children: []
                pos: 2992
                length: 12
              pos: 2150
              length: 860
          children: []
          pos: 1994
          length: 1016
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: handlePropertyValue
              children: []
              pos: 3411
              length: 19
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonParser jp
                children: []
                pos: 3431
                length: 13
              pos: 3396
              length: 1304
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: Integer I = _nameToPropertyIndex.get(propName);
                children: []
                pos: 3550
                length: 47
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: I
                            children: []
                            pos: 3610
                            length: 1
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 3615
                            length: 4
                        children: []
                        pos: 3610
                        length: 9
                    children: []
                    pos: 3609
                    length: 11
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return false;
                    children: []
                    pos: 3635
                    length: 13
                  pos: 3621
                  length: 37
                pos: 3606
                length: 52
              - type: local_variable_declaration
                fields:
                  text: int index = I.intValue();
                children: []
                pos: 3667
                length: 25
              - type: local_variable_declaration
                fields:
                  text: ExtTypedProperty prop = _properties[index];
                children: []
                pos: 3701
                length: 43
              - type: local_variable_declaration
                fields:
                  text: boolean canDeserialize;
                children: []
                pos: 3753
                length: 23
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: prop.hasTypePropertyName(propName)
                        children: []
                        pos: 3789
                        length: 34
                    children: []
                    pos: 3788
                    length: 36
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: _typeIds[index] = jp.getText();
                    children: []
                    pos: 3839
                    length: 31
                  - type: expression_statement
                    fields:
                      text: jp.skipChildren();
                    children: []
                    pos: 3883
                    length: 18
                  - type: expression_statement
                    fields:
                      text: canDeserialize = (bean != null) && (_tokens[index] !=
                        null);
                    children: []
                    pos: 3914
                    length: 60
                  pos: 3825
                  length: 159
                pos: 3785
                length: 468
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: identifier
                        fields:
                          text: canDeserialize
                        children: []
                        pos: 4395
                        length: 14
                    children: []
                    pos: 4394
                    length: 16
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: String typeId = _typeIds[index];
                    children: []
                    pos: 4425
                    length: 32
                  - type: expression_statement
                    fields:
                      text: _typeIds[index] = null;
                    children: []
                    pos: 4542
                    length: 23
                  - type: expression_statement
                    fields:
                      text: _deserializeAndSet(jp, ctxt, bean, index, typeId);
                    children: []
                    pos: 4578
                    length: 50
                  - type: expression_statement
                    fields:
                      text: _tokens[index] = null;
                    children: []
                    pos: 4641
                    length: 22
                  pos: 4411
                  length: 262
                pos: 4391
                length: 282
              - type: return_statement
                fields:
                  text: return true;
                children: []
                pos: 4682
                length: 12
              pos: 3540
              length: 1160
          children: []
          pos: 3396
          length: 1304
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: complete
              children: []
              pos: 4888
              length: 8
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonParser p
                children: []
                pos: 4897
                length: 12
              pos: 4840
              length: 2081
            body:
              type: block
              fields: {}
              children:
              - type: for_statement
                fields:
                  text: "for (int i = 0, len = _properties.length; i < len; ++i) {\n
                    \           String typeId = _typeIds[i];\n            if (typeId
                    == null) {\n                TokenBuffer tokens = _tokens[i];\n
                    \               // let's allow missing both type and property
                    (may already have been set, too)\n                // but not just
                    one\n                if (tokens == null) {\n                    continue;\n
                    \               }\n                // [databind#118]: Need to
                    mind natural types, for which no type id\n                // will
                    be included.\n                JsonToken t = tokens.firstToken();\n
                    \               if (t != null && t.isScalarValue()) {\n                    JsonParser
                    buffered = tokens.asParser(p);\n                    buffered.nextToken();\n
                    \                   SettableBeanProperty extProp = _properties[i].getProperty();\n
                    \                   Object result = TypeDeserializer.deserializeIfNatural(buffered,
                    ctxt, extProp.getType());\n                    if (result != null)
                    {\n                        extProp.set(bean, result);\n                        continue;\n
                    \                   }\n                    // 26-Oct-2012, tatu:
                    As per [databind#94], must allow use of 'defaultImpl'\n                    if
                    (!_properties[i].hasDefaultType()) {\n                        throw
                    ctxt.mappingException(\"Missing external type id property '%s'\",\n
                    \                               _properties[i].getTypePropertyName());
                    \                               \n                    }\n                    typeId
                    = _properties[i].getDefaultTypeId();\n                }\n            }
                    else if (_tokens[i] == null) {\n                SettableBeanProperty
                    prop = _properties[i].getProperty();\n                throw ctxt.mappingException(\"Missing
                    property '%s' for external type id '%s'\",\n                        prop.getName(),
                    _properties[i].getTypePropertyName());\n            }\n            _deserializeAndSet(p,
                    ctxt, bean, i, typeId);\n        }"
                children: []
                pos: 4994
                length: 1900
              - type: return_statement
                fields:
                  text: return bean;
                children: []
                pos: 6903
                length: 12
              pos: 4984
              length: 1937
          children: []
          pos: 4840
          length: 2081
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: complete
              children: []
              pos: 7088
              length: 8
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonParser jp
                children: []
                pos: 7097
                length: 13
              pos: 7074
              length: 2093
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: final int len = _properties.length;
                children: []
                pos: 7314
                length: 35
              - type: local_variable_declaration
                fields:
                  text: Object[] values = new Object[len];
                children: []
                pos: 7358
                length: 34
              - type: for_statement
                fields:
                  text: |-
                    for (int i = 0; i < len; ++i) {
                                String typeId = _typeIds[i];
                                if (typeId == null) {
                                    // let's allow missing both type and property (may already have been set, too)
                                    if (_tokens[i] == null) {
                                        continue;
                                    }
                                    // but not just one
                                    // 26-Oct-2012, tatu: As per [Issue#94], must allow use of 'defaultImpl'
                                    if (!_properties[i].hasDefaultType()) {
                                        throw ctxt.mappingException("Missing external type id property '%s'",
                                                _properties[i].getTypePropertyName());
                                    }
                                    typeId = _properties[i].getDefaultTypeId();
                                } else if (_tokens[i] == null) {
                                    SettableBeanProperty prop = _properties[i].getProperty();
                                    throw ctxt.mappingException("Missing property '%s' for external type id '%s'",
                                            prop.getName(), _properties[i].getTypePropertyName());
                                }
                                values[i] = _deserialize(jp, ctxt, i, typeId);
                            }
                children: []
                pos: 7401
                length: 1083
              - type: for_statement
                fields:
                  text: |-
                    for (int i = 0; i < len; ++i) {
                                SettableBeanProperty prop = _properties[i].getProperty();
                                if (creator.findCreatorProperty(prop.getName()) != null) {
                                    buffer.assignParameter(prop, values[i]);
                                }
                            }
                children: []
                pos: 8540
                length: 253
              - type: local_variable_declaration
                fields:
                  text: Object bean = creator.build(ctxt, buffer);
                children: []
                pos: 8802
                length: 42
              - type: for_statement
                fields:
                  text: |-
                    for (int i = 0; i < len; ++i) {
                                SettableBeanProperty prop = _properties[i].getProperty();
                                if (creator.findCreatorProperty(prop.getName()) == null) {
                                    prop.set(bean, values[i]);
                                }
                            }
                children: []
                pos: 8901
                length: 239
              - type: return_statement
                fields:
                  text: return bean;
                children: []
                pos: 9149
                length: 12
              pos: 7242
              length: 1925
          children: []
          pos: 7074
          length: 2093
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: _deserialize
              children: []
              pos: 9230
              length: 12
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonParser p
                children: []
                pos: 9243
                length: 12
              pos: 9173
              length: 755
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: JsonParser p2 = _tokens[index].asParser(p);
                children: []
                pos: 9357
                length: 43
              - type: local_variable_declaration
                fields:
                  text: JsonToken t = p2.nextToken();
                children: []
                pos: 9409
                length: 29
              - type: local_variable_declaration
                fields:
                  text: TokenBuffer merged = new TokenBuffer(p);
                children: []
                pos: 9528
                length: 40
              - type: expression_statement
                fields:
                  text: merged.writeStartArray();
                children: []
                pos: 9577
                length: 25
              - type: expression_statement
                fields:
                  text: merged.writeString(typeId);
                children: []
                pos: 9611
                length: 27
              - type: expression_statement
                fields:
                  text: merged.copyCurrentStructure(p2);
                children: []
                pos: 9647
                length: 32
              - type: expression_statement
                fields:
                  text: merged.writeEndArray();
                children: []
                pos: 9688
                length: 23
              - type: local_variable_declaration
                fields:
                  text: JsonParser mp = merged.asParser(p);
                children: []
                pos: 9792
                length: 35
              - type: expression_statement
                fields:
                  text: mp.nextToken();
                children: []
                pos: 9836
                length: 15
              - type: return_statement
                fields:
                  text: return _properties[index].getProperty().deserialize(mp, ctxt);
                children: []
                pos: 9860
                length: 62
              pos: 9347
              length: 581
          children: []
          pos: 9173
          length: 755
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: _deserializeAndSet
              children: []
              pos: 9989
              length: 18
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonParser p
                children: []
                pos: 10008
                length: 12
              pos: 9934
              length: 951
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: JsonParser p2 = _tokens[index].asParser(p);
                children: []
                pos: 10302
                length: 43
              - type: local_variable_declaration
                fields:
                  text: JsonToken t = p2.nextToken();
                children: []
                pos: 10354
                length: 29
              - type: local_variable_declaration
                fields:
                  text: TokenBuffer merged = new TokenBuffer(p);
                children: []
                pos: 10472
                length: 40
              - type: expression_statement
                fields:
                  text: merged.writeStartArray();
                children: []
                pos: 10521
                length: 25
              - type: expression_statement
                fields:
                  text: merged.writeString(typeId);
                children: []
                pos: 10555
                length: 27
              - type: expression_statement
                fields:
                  text: merged.copyCurrentStructure(p2);
                children: []
                pos: 10600
                length: 32
              - type: expression_statement
                fields:
                  text: merged.writeEndArray();
                children: []
                pos: 10641
                length: 23
              - type: local_variable_declaration
                fields:
                  text: JsonParser mp = merged.asParser(p);
                children: []
                pos: 10744
                length: 35
              - type: expression_statement
                fields:
                  text: mp.nextToken();
                children: []
                pos: 10788
                length: 15
              - type: expression_statement
                fields:
                  text: _properties[index].getProperty().deserializeAndSet(mp, ctxt,
                    bean);
                children: []
                pos: 10812
                length: 67
              pos: 10125
              length: 760
          children: []
          pos: 9934
          length: 951
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: Builder
              children: []
              pos: 11085
              length: 7
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: private final ArrayList<ExtTypedProperty> _properties = new
                    ArrayList<ExtTypedProperty>();
                children: []
                pos: 11107
                length: 90
              - type: field_declaration
                fields:
                  text: private final HashMap<String, Integer> _nameToPropertyIndex
                    = new HashMap<String, Integer>();
                children: []
                pos: 11206
                length: 93
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: addExternal
                    children: []
                    pos: 11321
                    length: 11
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: SettableBeanProperty property
                      children: []
                      pos: 11333
                      length: 29
                    pos: 11309
                    length: 361
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: Integer index = _properties.size();
                      children: []
                      pos: 11414
                      length: 35
                    - type: expression_statement
                      fields:
                        text: _properties.add(new ExtTypedProperty(property, typeDeser));
                      children: []
                      pos: 11462
                      length: 59
                    - type: expression_statement
                      fields:
                        text: _nameToPropertyIndex.put(property.getName(), index);
                      children: []
                      pos: 11534
                      length: 52
                    - type: expression_statement
                      fields:
                        text: _nameToPropertyIndex.put(typeDeser.getPropertyName(),
                          index);
                      children: []
                      pos: 11599
                      length: 61
                    pos: 11400
                    length: 270
                children: []
                pos: 11309
                length: 361
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: build
                    children: []
                    pos: 11715
                    length: 5
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 11688
                    length: 207
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: |-
                          return new ExternalTypeHandler(_properties.toArray(new ExtTypedProperty[_properties.size()]),
                                              _nameToPropertyIndex, null, null);
                      children: []
                      pos: 11737
                      length: 148
                    pos: 11723
                    length: 172
                children: []
                pos: 11688
                length: 207
              pos: 11065
              length: 836
          children: []
          pos: 11065
          length: 836
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: ExtTypedProperty
              children: []
              pos: 11934
              length: 16
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: private final SettableBeanProperty _property;
                children: []
                pos: 11965
                length: 45
              - type: field_declaration
                fields:
                  text: private final TypeDeserializer _typeDeserializer;
                children: []
                pos: 12019
                length: 49
              - type: field_declaration
                fields:
                  text: private final String _typePropertyName;
                children: []
                pos: 12077
                length: 39
              - type: constructor_declaration
                fields:
                  text: |-
                    public ExtTypedProperty(SettableBeanProperty property, TypeDeserializer typeDeser)
                            {
                                _property = property;
                                _typeDeserializer = typeDeser;
                                _typePropertyName = typeDeser.getPropertyName();
                            }
                children: []
                pos: 12134
                length: 240
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: hasTypePropertyName
                    children: []
                    pos: 12399
                    length: 19
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: String n
                      children: []
                      pos: 12419
                      length: 8
                    pos: 12384
                    length: 104
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return n.equals(_typePropertyName);
                      children: []
                      pos: 12443
                      length: 35
                    pos: 12429
                    length: 59
                children: []
                pos: 12384
                length: 104
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: hasDefaultType
                    children: []
                    pos: 12513
                    length: 14
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 12498
                    length: 106
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return _typeDeserializer.getDefaultImpl() != null;
                      children: []
                      pos: 12544
                      length: 50
                    pos: 12530
                    length: 74
                children: []
                pos: 12498
                length: 106
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: getDefaultTypeId
                    children: []
                    pos: 12628
                    length: 16
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 12614
                    length: 293
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: Class<?> defaultType = _typeDeserializer.getDefaultImpl();
                      children: []
                      pos: 12661
                      length: 58
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: equals
                              fields:
                                left:
                                  type: identifier
                                  fields:
                                    text: defaultType
                                  children: []
                                  pos: 12736
                                  length: 11
                                right:
                                  type: null_literal
                                  fields: {}
                                  children: []
                                  pos: 12751
                                  length: 4
                              children: []
                              pos: 12736
                              length: 19
                          children: []
                          pos: 12735
                          length: 21
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return null;
                          children: []
                          pos: 12775
                          length: 12
                        pos: 12757
                        length: 44
                      pos: 12732
                      length: 69
                    - type: return_statement
                      fields:
                        text: return _typeDeserializer.getTypeIdResolver().idFromValueAndType(null,
                          defaultType);
                      children: []
                      pos: 12814
                      length: 83
                    pos: 12647
                    length: 260
                children: []
                pos: 12614
                length: 293
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: getTypePropertyName
                    children: []
                    pos: 12939
                    length: 19
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 12925
                    length: 65
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return _typePropertyName;
                      children: []
                      pos: 12963
                      length: 25
                    pos: 12961
                    length: 29
                children: []
                pos: 12925
                length: 65
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: getProperty
                    children: []
                    pos: 13036
                    length: 11
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 13008
                    length: 83
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return _property;
                      children: []
                      pos: 13064
                      length: 17
                    pos: 13050
                    length: 41
                children: []
                pos: 13008
                length: 83
              pos: 11907
              length: 1190
          children: []
          pos: 11907
          length: 1190
        pos: 731
        length: 12368
    children: []
    pos: 731
    length: 12368
  pos: 0
  length: 13100
text_diff: "--- before\n+++ after\n@@ -225,9 +225,6 @@\n         JsonParser p2 = _tokens[index].asParser(p);\n
  \        JsonToken t = p2.nextToken();\n         // 29-Sep-2015, tatu: As per [databind#942],
  nulls need special support\n-        if (t == JsonToken.VALUE_NULL) {\n-            return
  null;\n-        }\n \n         TokenBuffer merged = new TokenBuffer(p);\n         merged.writeStartArray();\n@@
  -251,10 +248,6 @@\n         JsonParser p2 = _tokens[index].asParser(p);\n         JsonToken
  t = p2.nextToken();\n         // 29-Sep-2015, tatu: As per [databind#942], nulls
  need special support\n-        if (t == JsonToken.VALUE_NULL) {\n-            _properties[index].getProperty().set(bean,
  null);\n-            return;\n-        }\n         TokenBuffer merged = new TokenBuffer(p);\n
  \        merged.writeStartArray();\n         merged.writeString(typeId);\n"
tree_diff: |+
  New cluster:
  ===
  insert-node
  ---
  method_declaration [9173,9928]
  to
  class_body [731,13308]
  at 11
  ------------
  ===
  insert-node
  ---
  method_declaration [9173,9928]
  to
  class_body [731,13308]
  at 11
  ===
  insert-node
  ---
  identifier: _deserialize [9230,9242]
  to
  method_declaration [9173,9928]
  at 0

  New cluster:
  ===
  insert-node
  ---
  method_declaration [9934,10885]
  to
  class_body [731,13308]
  at 12
  ------------
  ===
  insert-node
  ---
  method_declaration [9934,10885]
  to
  class_body [731,13308]
  at 12
  ===
  insert-node
  ---
  identifier: _deserializeAndSet [9989,10007]
  to
  method_declaration [9934,10885]
  at 0

  New cluster:
  MOVE from method_declaration [9173,9928]
  ------------
  ===
  move-tree
  ---
  method_parameters [9173,10004]
      formal_parameter: JsonParser p [9243,9255]
  to
  method_declaration [9173,9928]
  at 1

  New cluster:
  Unknown cluster type
  ------------
  ===
  insert-tree
  ---
  block [9347,9928]
      local_variable_declaration: JsonParser p2 = _tokens[index].asParser(p); [9357,9400]
      local_variable_declaration: JsonToken t = p2.nextToken(); [9409,9438]
      local_variable_declaration: TokenBuffer merged = new TokenBuffer(p); [9528,9568]
      expression_statement: merged.writeStartArray(); [9577,9602]
      expression_statement: merged.writeString(typeId); [9611,9638]
      expression_statement: merged.copyCurrentStructure(p2); [9647,9679]
      expression_statement: merged.writeEndArray(); [9688,9711]
      local_variable_declaration: JsonParser mp = merged.asParser(p); [9792,9827]
      expression_statement: mp.nextToken(); [9836,9851]
      return_statement: return _properties[index].getProperty().deserialize(mp, ctxt); [9860,9922]
  to
  method_declaration [9173,9928]
  at 2

  New cluster:
  MOVE from method_declaration [9934,10885]
  ------------
  ===
  move-tree
  ---
  method_parameters [10010,11094]
      formal_parameter: JsonParser p [10084,10096]
  to
  method_declaration [9934,10885]
  at 1

  New cluster:
  Unknown cluster type
  ------------
  ===
  insert-tree
  ---
  block [10125,10885]
      local_variable_declaration: JsonParser p2 = _tokens[index].asParser(p); [10302,10345]
      local_variable_declaration: JsonToken t = p2.nextToken(); [10354,10383]
      local_variable_declaration: TokenBuffer merged = new TokenBuffer(p); [10472,10512]
      expression_statement: merged.writeStartArray(); [10521,10546]
      expression_statement: merged.writeString(typeId); [10555,10582]
      expression_statement: merged.copyCurrentStructure(p2); [10600,10632]
      expression_statement: merged.writeEndArray(); [10641,10664]
      local_variable_declaration: JsonParser mp = merged.asParser(p); [10744,10779]
      expression_statement: mp.nextToken(); [10788,10803]
      expression_statement: _properties[index].getProperty().deserializeAndSet(mp, ctxt, bean); [10812,10879]
  to
  method_declaration [9934,10885]
  at 2

  New cluster:
  ===
  delete-node
  ---
  method_declaration [9173,10004]
  ===
  ------------
  ===
  delete-node
  ---
  identifier: _deserialize [9230,9242]
  ===
  ===
  delete-node
  ---
  method_declaration [9173,10004]
  ===

  New cluster:
  Unknown cluster type
  ------------
  ===
  delete-tree
  ---
  block [9347,10004]
      local_variable_declaration: JsonParser p2 = _tokens[index].asParser(p); [9357,9400]
      local_variable_declaration: JsonToken t = p2.nextToken(); [9409,9438]
      if_statement [9527,9594]
          parenthesized_expression [9530,9557]
              equals [9531,9556]
                  identifier: t [9531,9532]
                  field_access: JsonToken.VALUE_NULL [9536,9556]
          block [9558,9594]
              return_statement: return null; [9572,9584]
      local_variable_declaration: TokenBuffer merged = new TokenBuffer(p); [9604,9644]
      expression_statement: merged.writeStartArray(); [9653,9678]
      expression_statement: merged.writeString(typeId); [9687,9714]
      expression_statement: merged.copyCurrentStructure(p2); [9723,9755]
      expression_statement: merged.writeEndArray(); [9764,9787]
      local_variable_declaration: JsonParser mp = merged.asParser(p); [9868,9903]
      expression_statement: mp.nextToken(); [9912,9927]
      return_statement: return _properties[index].getProperty().deserialize(mp, ctxt); [9936,9998]

  New cluster:
  ===
  delete-node
  ---
  method_declaration [10010,11094]
  ===
  ------------
  ===
  delete-node
  ---
  method_declaration [10010,11094]
  ===
  ===
  delete-node
  ---
  identifier: _deserializeAndSet [10065,10083]
  ===

  New cluster:
  Unknown cluster type
  ------------
  ===
  delete-tree
  ---
  block [10201,11094]
      local_variable_declaration: JsonParser p2 = _tokens[index].asParser(p); [10378,10421]
      local_variable_declaration: JsonToken t = p2.nextToken(); [10430,10459]
      if_statement [10548,10672]
          parenthesized_expression [10551,10578]
              equals [10552,10577]
                  identifier: t [10552,10553]
                  field_access: JsonToken.VALUE_NULL [10557,10577]
          block [10579,10672]
              expression_statement: _properties[index].getProperty().set(bean, null); [10593,10642]
              return_statement: return; [10655,10662]
      local_variable_declaration: TokenBuffer merged = new TokenBuffer(p); [10681,10721]
      expression_statement: merged.writeStartArray(); [10730,10755]
      expression_statement: merged.writeString(typeId); [10764,10791]
      expression_statement: merged.copyCurrentStructure(p2); [10809,10841]
      expression_statement: merged.writeEndArray(); [10850,10873]
      local_variable_declaration: JsonParser mp = merged.asParser(p); [10953,10988]
      expression_statement: mp.nextToken(); [10997,11012]
      expression_statement: _properties[index].getProperty().deserializeAndSet(mp, ctxt, bean); [11021,11088]

...
