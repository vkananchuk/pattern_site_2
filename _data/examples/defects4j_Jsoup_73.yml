---
language: java
before_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: W3CDom
        children: []
        pos: 931
        length: 6
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: protected DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
          children: []
          pos: 944
          length: 80
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: fromJsoup
              children: []
              pos: 1163
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: org.jsoup.nodes.Document in
                children: []
                pos: 1173
                length: 27
              pos: 1147
              length: 495
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: Validate.notNull(in);
                children: []
                pos: 1212
                length: 21
              - type: local_variable_declaration
                fields:
                  text: DocumentBuilder builder;
                children: []
                pos: 1242
                length: 24
              - type: try_statement
                fields:
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: expression_statement
                      fields:
                        text: factory.setNamespaceAware(true);
                      children: []
                      pos: 1339
                      length: 32
                    - type: expression_statement
                      fields:
                        text: builder = factory.newDocumentBuilder();
                      children: []
                      pos: 1384
                      length: 39
                    - type: local_variable_declaration
                      fields:
                        text: Document out = builder.newDocument();
                      children: []
                      pos: 1436
                      length: 37
                    - type: expression_statement
                      fields:
                        text: convert(in, out);
                      children: []
                      pos: 1486
                      length: 17
                    - type: return_statement
                      fields:
                        text: return out;
                      children: []
                      pos: 1516
                      length: 11
                    pos: 1279
                    length: 258
                  excepts:
                    type: excepts
                    fields: {}
                    children:
                    - type: catch_clause
                      fields:
                        text: |-
                          catch (ParserConfigurationException e) {
                                      throw new IllegalStateException(e);
                                  }
                      children: []
                      pos: 1538
                      length: 98
                    pos: 1275
                    length: 361
                children: []
                pos: 1275
                length: 361
              pos: 1202
              length: 440
          children: []
          pos: 1147
          length: 495
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: convert
              children: []
              pos: 1948
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: org.jsoup.nodes.Document in
                children: []
                pos: 1956
                length: 27
              pos: 1936
              length: 304
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: unary_expression
                        fields:
                          text: "!StringUtil.isBlank(in.location())"
                        children: []
                        pos: 2013
                        length: 34
                    children: []
                    pos: 2012
                    length: 36
                children:
                - type: expression_statement
                  fields:
                    text: out.setDocumentURI(in.location());
                  children: []
                  pos: 2061
                  length: 34
                pos: 2009
                length: 86
              - type: local_variable_declaration
                fields:
                  text: org.jsoup.nodes.Element rootEl = in.child(0);
                children: []
                pos: 2105
                length: 45
              - type: expression_statement
                fields:
                  text: NodeTraversor.traverse(new W3CBuilder(out), rootEl);
                children: []
                pos: 2182
                length: 52
              pos: 1999
              length: 241
          children: []
          pos: 1936
          length: 304
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: W3CBuilder
              children: []
              pos: 2340
              length: 10
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: private static final String xmlnsKey = "xmlns";
                children: []
                pos: 2384
                length: 47
              - type: field_declaration
                fields:
                  text: private static final String xmlnsPrefix = "xmlns:";
                children: []
                pos: 2440
                length: 51
              - type: field_declaration
                fields:
                  text: private final Document doc;
                children: []
                pos: 2501
                length: 27
              - type: field_declaration
                fields:
                  text: private final Stack<HashMap<String, String>> namespacesStack
                    = new Stack<>();
                children: []
                pos: 2537
                length: 77
              - type: field_declaration
                fields:
                  text: private Element dest;
                children: []
                pos: 2661
                length: 21
              - type: constructor_declaration
                fields:
                  text: |-
                    public W3CBuilder(Document doc) {
                                this.doc = doc;
                                this.namespacesStack.push(new HashMap<String, String>());
                            }
                children: []
                pos: 2692
                length: 141
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: head
                    children: []
                    pos: 2855
                    length: 4
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: org.jsoup.nodes.Node source
                      children: []
                      pos: 2860
                      length: 27
                    pos: 2843
                    length: 1691
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: expression_statement
                      fields:
                        text: namespacesStack.push(new HashMap<>(namespacesStack.peek()));
                      children: []
                      pos: 2914
                      length: 60
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: instanceof_expression
                              fields:
                                text: source instanceof org.jsoup.nodes.Element
                              children: []
                              pos: 3026
                              length: 41
                          children: []
                          pos: 3025
                          length: 43
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: local_variable_declaration
                          fields:
                            text: org.jsoup.nodes.Element sourceEl = (org.jsoup.nodes.Element)
                              source;
                          children: []
                          pos: 3087
                          length: 68
                        - type: local_variable_declaration
                          fields:
                            text: String prefix = updateNamespaces(sourceEl);
                          children: []
                          pos: 3173
                          length: 43
                        - type: local_variable_declaration
                          fields:
                            text: String namespace = namespacesStack.peek().get(prefix);
                          children: []
                          pos: 3233
                          length: 54
                        - type: local_variable_declaration
                          fields:
                            text: Element el = doc.createElementNS(namespace, sourceEl.tagName());
                          children: []
                          pos: 3305
                          length: 64
                        - type: expression_statement
                          fields:
                            text: copyAttributes(sourceEl, el);
                          children: []
                          pos: 3386
                          length: 29
                        - type: if_statement
                          fields:
                            condition:
                              type: parenthesized_expression
                              fields:
                                expression:
                                  type: equals
                                  fields:
                                    left:
                                      type: identifier
                                      fields:
                                        text: dest
                                      children: []
                                      pos: 3436
                                      length: 4
                                    right:
                                      type: null_literal
                                      fields: {}
                                      children: []
                                      pos: 3444
                                      length: 4
                                  children: []
                                  pos: 3436
                                  length: 12
                              children: []
                              pos: 3435
                              length: 14
                          children:
                          - type: block
                            fields: {}
                            children:
                            - type: expression_statement
                              fields:
                                text: doc.appendChild(el);
                              children: []
                              pos: 3492
                              length: 20
                            pos: 3450
                            length: 80
                          pos: 3432
                          length: 165
                        - type: expression_statement
                          fields:
                            text: dest = el;
                          children: []
                          pos: 3614
                          length: 10
                        pos: 3069
                        length: 580
                      pos: 3022
                      length: 1502
                    pos: 2900
                    length: 1634
                children: []
                pos: 2843
                length: 1691
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: tail
                    children: []
                    pos: 4556
                    length: 4
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: org.jsoup.nodes.Node source
                      children: []
                      pos: 4561
                      length: 27
                    pos: 4544
                    length: 301
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: and
                              fields:
                                left:
                                  type: instanceof_expression
                                  fields:
                                    text: source instanceof org.jsoup.nodes.Element
                                  children: []
                                  pos: 4619
                                  length: 41
                                right:
                                  type: instanceof_expression
                                  fields:
                                    text: dest.getParentNode() instanceof Element
                                  children: []
                                  pos: 4664
                                  length: 39
                              children: []
                              pos: 4619
                              length: 84
                          children: []
                          pos: 4618
                          length: 86
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: expression_statement
                          fields:
                            text: dest = (Element) dest.getParentNode();
                          children: []
                          pos: 4723
                          length: 38
                        pos: 4705
                        length: 95
                      pos: 4615
                      length: 185
                    - type: expression_statement
                      fields:
                        text: namespacesStack.pop();
                      children: []
                      pos: 4813
                      length: 22
                    pos: 4601
                    length: 244
                children: []
                pos: 4544
                length: 301
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: copyAttributes
                    children: []
                    pos: 4868
                    length: 14
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: org.jsoup.nodes.Node source
                      children: []
                      pos: 4883
                      length: 27
                    pos: 4855
                    length: 444
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: enhanced_for_statement
                      fields:
                        text: |-
                          for (Attribute attribute : source.attributes()) {
                                          // valid xml attribute names are: ^[a-zA-Z_:][-a-zA-Z0-9_:.]
                                          String key = attribute.getKey().replaceAll("[^-a-zA-Z0-9_:.]", "");
                                          if (key.matches("[a-zA-Z_:][-a-zA-Z0-9_:.]*"))
                                              el.setAttribute(key, attribute.getValue());
                                      }
                      children: []
                      pos: 4938
                      length: 351
                    pos: 4924
                    length: 375
                children: []
                pos: 4855
                length: 444
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: updateNamespaces
                    children: []
                    pos: 5429
                    length: 16
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: org.jsoup.nodes.Element el
                      children: []
                      pos: 5446
                      length: 26
                    pos: 5414
                    length: 881
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: Attributes attributes = el.attributes();
                      children: []
                      pos: 5604
                      length: 40
                    - type: enhanced_for_statement
                      fields:
                        text: |-
                          for (Attribute attr : attributes) {
                                          String key = attr.getKey();
                                          String prefix;
                                          if (key.equals(xmlnsKey)) {
                                              prefix = "";
                                          } else if (key.startsWith(xmlnsPrefix)) {
                                              prefix = key.substring(xmlnsPrefix.length());
                                          } else {
                                              continue;
                                          }
                                          namespacesStack.peek().put(prefix, attr.getValue());
                                      }
                      children: []
                      pos: 5657
                      length: 467
                    - type: local_variable_declaration
                      fields:
                        text: int pos = el.tagName().indexOf(":");
                      children: []
                      pos: 6183
                      length: 36
                    - type: return_statement
                      fields:
                        text: 'return pos > 0 ? el.tagName().substring(0, pos) : "";'
                      children: []
                      pos: 6232
                      length: 53
                    pos: 5474
                    length: 821
                children: []
                pos: 5414
                length: 881
              pos: 2317
              length: 3985
          children: []
          pos: 2317
          length: 3985
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: asString
              children: []
              pos: 6444
              length: 8
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Document doc
                children: []
                pos: 6453
                length: 12
              pos: 6430
              length: 548
            body:
              type: block
              fields: {}
              children:
              - type: try_statement
                fields:
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: DOMSource domSource = new DOMSource(doc);
                      children: []
                      pos: 6495
                      length: 41
                    - type: local_variable_declaration
                      fields:
                        text: StringWriter writer = new StringWriter();
                      children: []
                      pos: 6549
                      length: 41
                    - type: local_variable_declaration
                      fields:
                        text: StreamResult result = new StreamResult(writer);
                      children: []
                      pos: 6603
                      length: 47
                    - type: local_variable_declaration
                      fields:
                        text: TransformerFactory tf = TransformerFactory.newInstance();
                      children: []
                      pos: 6663
                      length: 57
                    - type: local_variable_declaration
                      fields:
                        text: Transformer transformer = tf.newTransformer();
                      children: []
                      pos: 6733
                      length: 46
                    - type: expression_statement
                      fields:
                        text: transformer.transform(domSource, result);
                      children: []
                      pos: 6792
                      length: 41
                    - type: return_statement
                      fields:
                        text: return writer.toString();
                      children: []
                      pos: 6846
                      length: 25
                    pos: 6481
                    length: 400
                  excepts:
                    type: excepts
                    fields: {}
                    children:
                    - type: catch_clause
                      fields:
                        text: |-
                          catch (TransformerException e) {
                                      throw new IllegalStateException(e);
                                  }
                      children: []
                      pos: 6882
                      length: 90
                    pos: 6477
                    length: 495
                children: []
                pos: 6477
                length: 495
              pos: 6467
              length: 511
          children: []
          pos: 6430
          length: 548
        pos: 918
        length: 6062
    children: []
    pos: 918
    length: 6062
  pos: 0
  length: 6981
after_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: W3CDom
        children: []
        pos: 907
        length: 6
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: protected DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
          children: []
          pos: 920
          length: 80
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: fromJsoup
              children: []
              pos: 1139
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: org.jsoup.nodes.Document in
                children: []
                pos: 1149
                length: 27
              pos: 1123
              length: 495
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: Validate.notNull(in);
                children: []
                pos: 1188
                length: 21
              - type: local_variable_declaration
                fields:
                  text: DocumentBuilder builder;
                children: []
                pos: 1218
                length: 24
              - type: try_statement
                fields:
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: expression_statement
                      fields:
                        text: factory.setNamespaceAware(true);
                      children: []
                      pos: 1315
                      length: 32
                    - type: expression_statement
                      fields:
                        text: builder = factory.newDocumentBuilder();
                      children: []
                      pos: 1360
                      length: 39
                    - type: local_variable_declaration
                      fields:
                        text: Document out = builder.newDocument();
                      children: []
                      pos: 1412
                      length: 37
                    - type: expression_statement
                      fields:
                        text: convert(in, out);
                      children: []
                      pos: 1462
                      length: 17
                    - type: return_statement
                      fields:
                        text: return out;
                      children: []
                      pos: 1492
                      length: 11
                    pos: 1255
                    length: 258
                  excepts:
                    type: excepts
                    fields: {}
                    children:
                    - type: catch_clause
                      fields:
                        text: |-
                          catch (ParserConfigurationException e) {
                                      throw new IllegalStateException(e);
                                  }
                      children: []
                      pos: 1514
                      length: 98
                    pos: 1251
                    length: 361
                children: []
                pos: 1251
                length: 361
              pos: 1178
              length: 440
          children: []
          pos: 1123
          length: 495
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: convert
              children: []
              pos: 1924
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: org.jsoup.nodes.Document in
                children: []
                pos: 1932
                length: 27
              pos: 1912
              length: 304
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: unary_expression
                        fields:
                          text: "!StringUtil.isBlank(in.location())"
                        children: []
                        pos: 1989
                        length: 34
                    children: []
                    pos: 1988
                    length: 36
                children:
                - type: expression_statement
                  fields:
                    text: out.setDocumentURI(in.location());
                  children: []
                  pos: 2037
                  length: 34
                pos: 1985
                length: 86
              - type: local_variable_declaration
                fields:
                  text: org.jsoup.nodes.Element rootEl = in.child(0);
                children: []
                pos: 2081
                length: 45
              - type: expression_statement
                fields:
                  text: NodeTraversor.traverse(new W3CBuilder(out), rootEl);
                children: []
                pos: 2158
                length: 52
              pos: 1975
              length: 241
          children: []
          pos: 1912
          length: 304
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: W3CBuilder
              children: []
              pos: 2316
              length: 10
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: private static final String xmlnsKey = "xmlns";
                children: []
                pos: 2360
                length: 47
              - type: field_declaration
                fields:
                  text: private static final String xmlnsPrefix = "xmlns:";
                children: []
                pos: 2416
                length: 51
              - type: field_declaration
                fields:
                  text: private final Document doc;
                children: []
                pos: 2477
                length: 27
              - type: field_declaration
                fields:
                  text: private final HashMap<String, String> namespaces = new HashMap<>();
                children: []
                pos: 2513
                length: 67
              - type: field_declaration
                fields:
                  text: private Element dest;
                children: []
                pos: 2589
                length: 21
              - type: constructor_declaration
                fields:
                  text: |-
                    public W3CBuilder(Document doc) {
                                this.doc = doc;
                            }
                children: []
                pos: 2620
                length: 71
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: head
                    children: []
                    pos: 2713
                    length: 4
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: org.jsoup.nodes.Node source
                      children: []
                      pos: 2718
                      length: 27
                    pos: 2701
                    length: 1571
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: instanceof_expression
                              fields:
                                text: source instanceof org.jsoup.nodes.Element
                              children: []
                              pos: 2776
                              length: 41
                          children: []
                          pos: 2775
                          length: 43
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: local_variable_declaration
                          fields:
                            text: org.jsoup.nodes.Element sourceEl = (org.jsoup.nodes.Element)
                              source;
                          children: []
                          pos: 2837
                          length: 68
                        - type: local_variable_declaration
                          fields:
                            text: String prefix = updateNamespaces(sourceEl);
                          children: []
                          pos: 2923
                          length: 43
                        - type: local_variable_declaration
                          fields:
                            text: String namespace = namespaces.get(prefix);
                          children: []
                          pos: 2983
                          length: 42
                        - type: local_variable_declaration
                          fields:
                            text: Element el = doc.createElementNS(namespace, sourceEl.tagName());
                          children: []
                          pos: 3043
                          length: 64
                        - type: expression_statement
                          fields:
                            text: copyAttributes(sourceEl, el);
                          children: []
                          pos: 3124
                          length: 29
                        - type: if_statement
                          fields:
                            condition:
                              type: parenthesized_expression
                              fields:
                                expression:
                                  type: equals
                                  fields:
                                    left:
                                      type: identifier
                                      fields:
                                        text: dest
                                      children: []
                                      pos: 3174
                                      length: 4
                                    right:
                                      type: null_literal
                                      fields: {}
                                      children: []
                                      pos: 3182
                                      length: 4
                                  children: []
                                  pos: 3174
                                  length: 12
                              children: []
                              pos: 3173
                              length: 14
                          children:
                          - type: block
                            fields: {}
                            children:
                            - type: expression_statement
                              fields:
                                text: doc.appendChild(el);
                              children: []
                              pos: 3230
                              length: 20
                            pos: 3188
                            length: 80
                          pos: 3170
                          length: 165
                        - type: expression_statement
                          fields:
                            text: dest = el;
                          children: []
                          pos: 3352
                          length: 10
                        pos: 2819
                        length: 568
                      pos: 2772
                      length: 1490
                    pos: 2758
                    length: 1514
                children: []
                pos: 2701
                length: 1571
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: tail
                    children: []
                    pos: 4294
                    length: 4
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: org.jsoup.nodes.Node source
                      children: []
                      pos: 4299
                      length: 27
                    pos: 4282
                    length: 266
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: and
                              fields:
                                left:
                                  type: instanceof_expression
                                  fields:
                                    text: source instanceof org.jsoup.nodes.Element
                                  children: []
                                  pos: 4357
                                  length: 41
                                right:
                                  type: instanceof_expression
                                  fields:
                                    text: dest.getParentNode() instanceof Element
                                  children: []
                                  pos: 4402
                                  length: 39
                              children: []
                              pos: 4357
                              length: 84
                          children: []
                          pos: 4356
                          length: 86
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: expression_statement
                          fields:
                            text: dest = (Element) dest.getParentNode();
                          children: []
                          pos: 4461
                          length: 38
                        pos: 4443
                        length: 95
                      pos: 4353
                      length: 185
                    pos: 4339
                    length: 209
                children: []
                pos: 4282
                length: 266
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: copyAttributes
                    children: []
                    pos: 4571
                    length: 14
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: org.jsoup.nodes.Node source
                      children: []
                      pos: 4586
                      length: 27
                    pos: 4558
                    length: 444
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: enhanced_for_statement
                      fields:
                        text: |-
                          for (Attribute attribute : source.attributes()) {
                                          // valid xml attribute names are: ^[a-zA-Z_:][-a-zA-Z0-9_:.]
                                          String key = attribute.getKey().replaceAll("[^-a-zA-Z0-9_:.]", "");
                                          if (key.matches("[a-zA-Z_:][-a-zA-Z0-9_:.]*"))
                                              el.setAttribute(key, attribute.getValue());
                                      }
                      children: []
                      pos: 4641
                      length: 351
                    pos: 4627
                    length: 375
                children: []
                pos: 4558
                length: 444
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: updateNamespaces
                    children: []
                    pos: 5132
                    length: 16
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: org.jsoup.nodes.Element el
                      children: []
                      pos: 5149
                      length: 26
                    pos: 5117
                    length: 869
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: Attributes attributes = el.attributes();
                      children: []
                      pos: 5307
                      length: 40
                    - type: enhanced_for_statement
                      fields:
                        text: |-
                          for (Attribute attr : attributes) {
                                          String key = attr.getKey();
                                          String prefix;
                                          if (key.equals(xmlnsKey)) {
                                              prefix = "";
                                          } else if (key.startsWith(xmlnsPrefix)) {
                                              prefix = key.substring(xmlnsPrefix.length());
                                          } else {
                                              continue;
                                          }
                                          namespaces.put(prefix, attr.getValue());
                                      }
                      children: []
                      pos: 5360
                      length: 455
                    - type: local_variable_declaration
                      fields:
                        text: int pos = el.tagName().indexOf(":");
                      children: []
                      pos: 5874
                      length: 36
                    - type: return_statement
                      fields:
                        text: 'return pos > 0 ? el.tagName().substring(0, pos) : "";'
                      children: []
                      pos: 5923
                      length: 53
                    pos: 5177
                    length: 809
                children: []
                pos: 5117
                length: 869
              pos: 2293
              length: 3700
          children: []
          pos: 2293
          length: 3700
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: asString
              children: []
              pos: 6135
              length: 8
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Document doc
                children: []
                pos: 6144
                length: 12
              pos: 6121
              length: 548
            body:
              type: block
              fields: {}
              children:
              - type: try_statement
                fields:
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: DOMSource domSource = new DOMSource(doc);
                      children: []
                      pos: 6186
                      length: 41
                    - type: local_variable_declaration
                      fields:
                        text: StringWriter writer = new StringWriter();
                      children: []
                      pos: 6240
                      length: 41
                    - type: local_variable_declaration
                      fields:
                        text: StreamResult result = new StreamResult(writer);
                      children: []
                      pos: 6294
                      length: 47
                    - type: local_variable_declaration
                      fields:
                        text: TransformerFactory tf = TransformerFactory.newInstance();
                      children: []
                      pos: 6354
                      length: 57
                    - type: local_variable_declaration
                      fields:
                        text: Transformer transformer = tf.newTransformer();
                      children: []
                      pos: 6424
                      length: 46
                    - type: expression_statement
                      fields:
                        text: transformer.transform(domSource, result);
                      children: []
                      pos: 6483
                      length: 41
                    - type: return_statement
                      fields:
                        text: return writer.toString();
                      children: []
                      pos: 6537
                      length: 25
                    pos: 6172
                    length: 400
                  excepts:
                    type: excepts
                    fields: {}
                    children:
                    - type: catch_clause
                      fields:
                        text: |-
                          catch (TransformerException e) {
                                      throw new IllegalStateException(e);
                                  }
                      children: []
                      pos: 6573
                      length: 90
                    pos: 6168
                    length: 495
                children: []
                pos: 6168
                length: 495
              pos: 6158
              length: 511
          children: []
          pos: 6121
          length: 548
        pos: 894
        length: 5777
    children: []
    pos: 894
    length: 5777
  pos: 0
  length: 6672
text_diff: "--- before\n+++ after\n@@ -19,7 +19,6 @@\n import javax.xml.transform.stream.StreamResult;\n
  import java.io.StringWriter;\n import java.util.HashMap;\n-import java.util.Stack;\n
  \n /**\n  * Helper class to transform a {@link org.jsoup.nodes.Document} to a {@link
  org.w3c.dom.Document org.w3c.dom.Document},\n@@ -71,21 +70,19 @@\n         private
  static final String xmlnsPrefix = \"xmlns:\";\n \n         private final Document
  doc;\n-        private final Stack<HashMap<String, String>> namespacesStack = new
  Stack<>(); // stack of namespaces, prefix => urn\n+        private final HashMap<String,
  String> namespaces = new HashMap<>();\n         private Element dest;\n \n         public
  W3CBuilder(Document doc) {\n             this.doc = doc;\n-            this.namespacesStack.push(new
  HashMap<String, String>());\n         }\n \n         public void head(org.jsoup.nodes.Node
  source, int depth) {\n-            namespacesStack.push(new HashMap<>(namespacesStack.peek()));
  // inherit from above on the stack\n             if (source instanceof org.jsoup.nodes.Element)
  {\n                 org.jsoup.nodes.Element sourceEl = (org.jsoup.nodes.Element)
  source;\n \n                 String prefix = updateNamespaces(sourceEl);\n-                String
  namespace = namespacesStack.peek().get(prefix);\n+                String namespace
  = namespaces.get(prefix);\n \n                 Element el = doc.createElementNS(namespace,
  sourceEl.tagName());\n                 copyAttributes(sourceEl, el);\n@@ -116,7
  +113,6 @@\n             if (source instanceof org.jsoup.nodes.Element && dest.getParentNode()
  instanceof Element) {\n                 dest = (Element) dest.getParentNode(); //
  undescend. cromulent.\n             }\n-            namespacesStack.pop();\n         }\n
  \n         private void copyAttributes(org.jsoup.nodes.Node source, Element el)
  {\n@@ -145,7 +141,7 @@\n                 } else {\n                     continue;\n
  \                }\n-                namespacesStack.peek().put(prefix, attr.getValue());\n+
  \               namespaces.put(prefix, attr.getValue());\n             }\n \n             //
  get the element prefix if any\n"
tree_diff: |+
  New cluster:
  UPDATE from private final Stack<HashMap<String, String>> namespacesStack = new Stack<>(); to private final HashMap<String, String> namespaces = new HashMap<>();
  ------------
  ===
  update-node
  ---
  field_declaration: private final Stack<HashMap<String, String>> namespacesStack = new Stack<>(); [2537,2614]
  replace private final Stack<HashMap<String, String>> namespacesStack = new Stack<>(); by private final HashMap<String, String> namespaces = new HashMap<>();

  New cluster:
  UPDATE from public W3CBuilder(Document doc) {
              this.doc = doc;
              this.namespacesStack.push(new HashMap<String, String>());
          } to public W3CBuilder(Document doc) {
              this.doc = doc;
          }
  ------------
  ===
  update-node
  ---
  constructor_declaration: public W3CBuilder(Document doc) {
              this.doc = doc;
              this.namespacesStack.push(new HashMap<String, String>());
          } [2692,2833]
  replace public W3CBuilder(Document doc) {
              this.doc = doc;
              this.namespacesStack.push(new HashMap<String, String>());
          } by public W3CBuilder(Document doc) {
              this.doc = doc;
          }

  New cluster:
  UPDATE from for (Attribute attr : attributes) {
                  String key = attr.getKey();
                  String prefix;
                  if (key.equals(xmlnsKey)) {
                      prefix = "";
                  } else if (key.startsWith(xmlnsPrefix)) {
                      prefix = key.substring(xmlnsPrefix.length());
                  } else {
                      continue;
                  }
                  namespacesStack.peek().put(prefix, attr.getValue());
              } to for (Attribute attr : attributes) {
                  String key = attr.getKey();
                  String prefix;
                  if (key.equals(xmlnsKey)) {
                      prefix = "";
                  } else if (key.startsWith(xmlnsPrefix)) {
                      prefix = key.substring(xmlnsPrefix.length());
                  } else {
                      continue;
                  }
                  namespaces.put(prefix, attr.getValue());
              }
  ------------
  ===
  update-node
  ---
  enhanced_for_statement: for (Attribute attr : attributes) {
                  String key = attr.getKey();
                  String prefix;
                  if (key.equals(xmlnsKey)) {
                      prefix = "";
                  } else if (key.startsWith(xmlnsPrefix)) {
                      prefix = key.substring(xmlnsPrefix.length());
                  } else {
                      continue;
                  }
                  namespacesStack.peek().put(prefix, attr.getValue());
              } [5657,6124]
  replace for (Attribute attr : attributes) {
                  String key = attr.getKey();
                  String prefix;
                  if (key.equals(xmlnsKey)) {
                      prefix = "";
                  } else if (key.startsWith(xmlnsPrefix)) {
                      prefix = key.substring(xmlnsPrefix.length());
                  } else {
                      continue;
                  }
                  namespacesStack.peek().put(prefix, attr.getValue());
              } by for (Attribute attr : attributes) {
                  String key = attr.getKey();
                  String prefix;
                  if (key.equals(xmlnsKey)) {
                      prefix = "";
                  } else if (key.startsWith(xmlnsPrefix)) {
                      prefix = key.substring(xmlnsPrefix.length());
                  } else {
                      continue;
                  }
                  namespaces.put(prefix, attr.getValue());
              }

  New cluster:
  UPDATE from String namespace = namespacesStack.peek().get(prefix); to String namespace = namespaces.get(prefix);
  ------------
  ===
  update-node
  ---
  local_variable_declaration: String namespace = namespacesStack.peek().get(prefix); [3233,3287]
  replace String namespace = namespacesStack.peek().get(prefix); by String namespace = namespaces.get(prefix);

  New cluster:
  ===
  delete-node
  ---
  expression_statement: namespacesStack.push(new HashMap<>(namespacesStack.peek())); [2914,2974]
  ===
  ------------
  ===
  delete-node
  ---
  expression_statement: namespacesStack.push(new HashMap<>(namespacesStack.peek())); [2914,2974]
  ===

  New cluster:
  ===
  delete-node
  ---
  expression_statement: namespacesStack.pop(); [4813,4835]
  ===
  ------------
  ===
  delete-node
  ---
  expression_statement: namespacesStack.pop(); [4813,4835]
  ===

...
