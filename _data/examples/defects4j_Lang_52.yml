---
language: java
before_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: StringEscapeUtils
        children: []
        pos: 1495
        length: 17
      body:
        type: class_body
        fields: {}
        children:
        - type: constructor_declaration
          fields:
            text: |-
              public StringEscapeUtils() {
                    super();
                  }
          children: []
          pos: 1879
          length: 49
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: escapeJava
              children: []
              pos: 2816
              length: 10
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String str
                children: []
                pos: 2827
                length: 10
              pos: 2795
              length: 101
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return escapeJavaStyleString(str, false);
                children: []
                pos: 2849
                length: 41
              pos: 2839
              length: 57
          children: []
          pos: 2795
          length: 101
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: escapeJava
              children: []
              pos: 3429
              length: 10
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Writer out
                children: []
                pos: 3440
                length: 10
              pos: 3410
              length: 128
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: escapeJavaStyleString(out, str, false);
                children: []
                pos: 3493
                length: 39
              pos: 3483
              length: 55
          children: []
          pos: 3410
          length: 128
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: escapeJavaScript
              children: []
              pos: 4388
              length: 16
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String str
                children: []
                pos: 4405
                length: 10
              pos: 4367
              length: 106
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return escapeJavaStyleString(str, true);
                children: []
                pos: 4427
                length: 40
              pos: 4417
              length: 56
          children: []
          pos: 4367
          length: 106
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: escapeJavaScript
              children: []
              pos: 5019
              length: 16
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Writer out
                children: []
                pos: 5036
                length: 10
              pos: 5000
              length: 133
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: escapeJavaStyleString(out, str, true);
                children: []
                pos: 5089
                length: 38
              pos: 5079
              length: 54
          children: []
          pos: 5000
          length: 133
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: escapeJavaStyleString
              children: []
              pos: 5431
              length: 21
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String str
                children: []
                pos: 5453
                length: 10
              pos: 5409
              length: 526
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: str
                            children: []
                            pos: 5507
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 5514
                            length: 4
                        children: []
                        pos: 5507
                        length: 11
                    children: []
                    pos: 5506
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return null;
                    children: []
                    pos: 5534
                    length: 12
                  pos: 5520
                  length: 36
                pos: 5503
                length: 53
              - type: try_statement
                fields:
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: StringWriter writer = new StringWriter(str.length()
                          * 2);
                      children: []
                      pos: 5583
                      length: 57
                    - type: expression_statement
                      fields:
                        text: escapeJavaStyleString(writer, str, escapeSingleQuotes);
                      children: []
                      pos: 5653
                      length: 55
                    - type: return_statement
                      fields:
                        text: return writer.toString();
                      children: []
                      pos: 5721
                      length: 25
                    pos: 5569
                    length: 187
                  excepts:
                    type: excepts
                    fields: {}
                    children:
                    - type: catch_clause
                      fields:
                        text: |-
                          catch (IOException ioe) {
                                      // this should never ever happen while writing to a StringWriter
                                      ioe.printStackTrace();
                                      return null;
                                  }
                      children: []
                      pos: 5757
                      length: 172
                    pos: 5565
                    length: 364
                children: []
                pos: 5565
                length: 364
              pos: 5493
              length: 442
          children: []
          pos: 5409
          length: 526
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: escapeJavaStyleString
              children: []
              pos: 6303
              length: 21
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Writer out
                children: []
                pos: 6325
                length: 10
              pos: 6283
              length: 2595
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: out
                            children: []
                            pos: 6409
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 6416
                            length: 4
                        children: []
                        pos: 6409
                        length: 11
                    children: []
                    pos: 6408
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: throw_statement
                    fields:
                      text: throw new IllegalArgumentException("The Writer must not
                        be null");
                    children: []
                    pos: 6436
                    length: 66
                  pos: 6422
                  length: 90
                pos: 6405
                length: 107
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: str
                            children: []
                            pos: 6525
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 6532
                            length: 4
                        children: []
                        pos: 6525
                        length: 11
                    children: []
                    pos: 6524
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 6552
                    length: 7
                  pos: 6538
                  length: 31
                pos: 6521
                length: 48
              - type: local_variable_declaration
                fields:
                  text: int sz;
                children: []
                pos: 6578
                length: 7
              - type: expression_statement
                fields:
                  text: sz = str.length();
                children: []
                pos: 6594
                length: 18
              - type: for_statement
                fields:
                  text: |-
                    for (int i = 0; i < sz; i++) {
                                char ch = str.charAt(i);

                                // handle unicode
                                if (ch > 0xfff) {
                                    out.write("\\u" + hex(ch));
                                } else if (ch > 0xff) {
                                    out.write("\\u0" + hex(ch));
                                } else if (ch > 0x7f) {
                                    out.write("\\u00" + hex(ch));
                                } else if (ch < 32) {
                                    switch (ch) {
                                        case '\b':
                                            out.write('\\');
                                            out.write('b');
                                            break;
                                        case '\n':
                                            out.write('\\');
                                            out.write('n');
                                            break;
                                        case '\t':
                                            out.write('\\');
                                            out.write('t');
                                            break;
                                        case '\f':
                                            out.write('\\');
                                            out.write('f');
                                            break;
                                        case '\r':
                                            out.write('\\');
                                            out.write('r');
                                            break;
                                        default :
                                            if (ch > 0xf) {
                                                out.write("\\u00" + hex(ch));
                                            } else {
                                                out.write("\\u000" + hex(ch));
                                            }
                                            break;
                                    }
                                } else {
                                    switch (ch) {
                                        case '\'':
                                            if (escapeSingleQuote) {
                                              out.write('\\');
                                            }
                                            out.write('\'');
                                            break;
                                        case '"':
                                            out.write('\\');
                                            out.write('"');
                                            break;
                                        case '\\':
                                            out.write('\\');
                                            out.write('\\');
                                            break;
                                        case '/':
                                            out.write('\\');
                                            out.write('/');
                                            break;
                                        default :
                                            out.write(ch);
                                            break;
                                    }
                                }
                            }
                children: []
                pos: 6621
                length: 2251
              pos: 6395
              length: 2483
          children: []
          pos: 6283
          length: 2595
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: hex
              children: []
              pos: 9134
              length: 3
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: char ch
                children: []
                pos: 9138
                length: 7
              pos: 9112
              length: 96
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return Integer.toHexString(ch).toUpperCase();
                children: []
                pos: 9157
                length: 45
              pos: 9147
              length: 61
          children: []
          pos: 9112
          length: 96
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: unescapeJava
              children: []
              pos: 9688
              length: 12
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String str
                children: []
                pos: 9701
                length: 10
              pos: 9667
              length: 455
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: str
                            children: []
                            pos: 9727
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 9734
                            length: 4
                        children: []
                        pos: 9727
                        length: 11
                    children: []
                    pos: 9726
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return null;
                    children: []
                    pos: 9754
                    length: 12
                  pos: 9740
                  length: 36
                pos: 9723
                length: 53
              - type: try_statement
                fields:
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: StringWriter writer = new StringWriter(str.length());
                      children: []
                      pos: 9803
                      length: 53
                    - type: expression_statement
                      fields:
                        text: unescapeJava(writer, str);
                      children: []
                      pos: 9869
                      length: 26
                    - type: return_statement
                      fields:
                        text: return writer.toString();
                      children: []
                      pos: 9908
                      length: 25
                    pos: 9789
                    length: 154
                  excepts:
                    type: excepts
                    fields: {}
                    children:
                    - type: catch_clause
                      fields:
                        text: |-
                          catch (IOException ioe) {
                                      // this should never ever happen while writing to a StringWriter
                                      ioe.printStackTrace();
                                      return null;
                                  }
                      children: []
                      pos: 9944
                      length: 172
                    pos: 9785
                    length: 331
                children: []
                pos: 9785
                length: 331
              pos: 9713
              length: 409
          children: []
          pos: 9667
          length: 455
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: unescapeJava
              children: []
              pos: 10843
              length: 12
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Writer out
                children: []
                pos: 10856
                length: 10
              pos: 10824
              length: 3002
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: out
                            children: []
                            pos: 10913
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 10920
                            length: 4
                        children: []
                        pos: 10913
                        length: 11
                    children: []
                    pos: 10912
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: throw_statement
                    fields:
                      text: throw new IllegalArgumentException("The Writer must not
                        be null");
                    children: []
                    pos: 10940
                    length: 66
                  pos: 10926
                  length: 90
                pos: 10909
                length: 107
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: str
                            children: []
                            pos: 11029
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 11036
                            length: 4
                        children: []
                        pos: 11029
                        length: 11
                    children: []
                    pos: 11028
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 11056
                    length: 7
                  pos: 11042
                  length: 31
                pos: 11025
                length: 48
              - type: local_variable_declaration
                fields:
                  text: int sz = str.length();
                children: []
                pos: 11082
                length: 22
              - type: local_variable_declaration
                fields:
                  text: StringBuffer unicode = new StringBuffer(4);
                children: []
                pos: 11113
                length: 43
              - type: local_variable_declaration
                fields:
                  text: boolean hadSlash = false;
                children: []
                pos: 11165
                length: 25
              - type: local_variable_declaration
                fields:
                  text: boolean inUnicode = false;
                children: []
                pos: 11199
                length: 26
              - type: for_statement
                fields:
                  text: |-
                    for (int i = 0; i < sz; i++) {
                                char ch = str.charAt(i);
                                if (inUnicode) {
                                    // if in unicode, then we're reading unicode
                                    // values in somehow
                                    unicode.append(ch);
                                    if (unicode.length() == 4) {
                                        // unicode now contains the four hex digits
                                        // which represents our unicode character
                                        try {
                                            int value = Integer.parseInt(unicode.toString(), 16);
                                            out.write((char) value);
                                            unicode.setLength(0);
                                            inUnicode = false;
                                            hadSlash = false;
                                        } catch (NumberFormatException nfe) {
                                            throw new NestableRuntimeException("Unable to parse unicode value: " + unicode, nfe);
                                        }
                                    }
                                    continue;
                                }
                                if (hadSlash) {
                                    // handle an escaped value
                                    hadSlash = false;
                                    switch (ch) {
                                        case '\\':
                                            out.write('\\');
                                            break;
                                        case '\'':
                                            out.write('\'');
                                            break;
                                        case '\"':
                                            out.write('"');
                                            break;
                                        case 'r':
                                            out.write('\r');
                                            break;
                                        case 'f':
                                            out.write('\f');
                                            break;
                                        case 't':
                                            out.write('\t');
                                            break;
                                        case 'n':
                                            out.write('\n');
                                            break;
                                        case 'b':
                                            out.write('\b');
                                            break;
                                        case 'u':
                                            {
                                                // uh-oh, we're in unicode country....
                                                inUnicode = true;
                                                break;
                                            }
                                        default :
                                            out.write(ch);
                                            break;
                                    }
                                    continue;
                                } else if (ch == '\\') {
                                    hadSlash = true;
                                    continue;
                                }
                                out.write(ch);
                            }
                children: []
                pos: 11234
                length: 2407
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: identifier
                        fields:
                          text: hadSlash
                        children: []
                        pos: 13654
                        length: 8
                    children: []
                    pos: 13653
                    length: 10
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: out.write('\\');
                    children: []
                    pos: 13794
                    length: 16
                  pos: 13664
                  length: 156
                pos: 13650
                length: 170
              pos: 10899
              length: 2927
          children: []
          pos: 10824
          length: 3002
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: unescapeJavaScript
              children: []
              pos: 14359
              length: 18
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String str
                children: []
                pos: 14378
                length: 10
              pos: 14338
              length: 93
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return unescapeJava(str);
                children: []
                pos: 14400
                length: 25
              pos: 14390
              length: 41
          children: []
          pos: 14338
          length: 93
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: unescapeJavaScript
              children: []
              pos: 15198
              length: 18
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Writer out
                children: []
                pos: 15217
                length: 10
              pos: 15179
              length: 120
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: unescapeJava(out, str);
                children: []
                pos: 15270
                length: 23
              pos: 15260
              length: 39
          children: []
          pos: 15179
          length: 120
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: escapeHtml
              children: []
              pos: 16706
              length: 10
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String str
                children: []
                pos: 16717
                length: 10
              pos: 16685
              length: 447
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: str
                            children: []
                            pos: 16743
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 16750
                            length: 4
                        children: []
                        pos: 16743
                        length: 11
                    children: []
                    pos: 16742
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return null;
                    children: []
                    pos: 16770
                    length: 12
                  pos: 16756
                  length: 36
                pos: 16739
                length: 53
              - type: try_statement
                fields:
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: StringWriter writer = new StringWriter ((int)(str.length()
                          * 1.5));
                      children: []
                      pos: 16819
                      length: 67
                    - type: expression_statement
                      fields:
                        text: escapeHtml(writer, str);
                      children: []
                      pos: 16899
                      length: 24
                    - type: return_statement
                      fields:
                        text: return writer.toString();
                      children: []
                      pos: 16936
                      length: 25
                    pos: 16805
                    length: 166
                  excepts:
                    type: excepts
                    fields: {}
                    children:
                    - type: catch_clause
                      fields:
                        text: |-
                          catch (IOException e) {
                                      //assert false;
                                      //should be impossible
                                      e.printStackTrace();
                                      return null;
                                  }
                      children: []
                      pos: 16972
                      length: 154
                    pos: 16801
                    length: 325
                children: []
                pos: 16801
                length: 325
              pos: 16729
              length: 403
          children: []
          pos: 16685
          length: 447
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: escapeHtml
              children: []
              pos: 18719
              length: 10
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Writer writer
                children: []
                pos: 18730
                length: 13
              pos: 18700
              length: 316
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: writer
                            children: []
                            pos: 18793
                            length: 6
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 18803
                            length: 4
                        children: []
                        pos: 18793
                        length: 14
                    children: []
                    pos: 18792
                    length: 17
                children:
                - type: block
                  fields: {}
                  children:
                  - type: throw_statement
                    fields:
                      text: throw new IllegalArgumentException ("The Writer must not
                        be null.");
                    children: []
                    pos: 18824
                    length: 68
                  pos: 18810
                  length: 92
                pos: 18789
                length: 113
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: string
                            children: []
                            pos: 18915
                            length: 6
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 18925
                            length: 4
                        children: []
                        pos: 18915
                        length: 14
                    children: []
                    pos: 18914
                    length: 16
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 18945
                    length: 7
                  pos: 18931
                  length: 31
                pos: 18911
                length: 51
              - type: expression_statement
                fields:
                  text: Entities.HTML40.escape(writer, string);
                children: []
                pos: 18971
                length: 39
              pos: 18779
              length: 237
          children: []
          pos: 18700
          length: 316
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: unescapeHtml
              children: []
              pos: 19842
              length: 12
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String str
                children: []
                pos: 19855
                length: 10
              pos: 19821
              length: 451
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: str
                            children: []
                            pos: 19881
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 19888
                            length: 4
                        children: []
                        pos: 19881
                        length: 11
                    children: []
                    pos: 19880
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return null;
                    children: []
                    pos: 19908
                    length: 12
                  pos: 19894
                  length: 36
                pos: 19877
                length: 53
              - type: try_statement
                fields:
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: StringWriter writer = new StringWriter ((int)(str.length()
                          * 1.5));
                      children: []
                      pos: 19957
                      length: 67
                    - type: expression_statement
                      fields:
                        text: unescapeHtml(writer, str);
                      children: []
                      pos: 20037
                      length: 26
                    - type: return_statement
                      fields:
                        text: return writer.toString();
                      children: []
                      pos: 20076
                      length: 25
                    pos: 19943
                    length: 168
                  excepts:
                    type: excepts
                    fields: {}
                    children:
                    - type: catch_clause
                      fields:
                        text: |-
                          catch (IOException e) {
                                      //assert false;
                                      //should be impossible
                                      e.printStackTrace();
                                      return null;
                                  }
                      children: []
                      pos: 20112
                      length: 154
                    pos: 19939
                    length: 327
                children: []
                pos: 19939
                length: 327
              pos: 19867
              length: 405
          children: []
          pos: 19821
          length: 451
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: unescapeHtml
              children: []
              pos: 21110
              length: 12
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Writer writer
                children: []
                pos: 21123
                length: 13
              pos: 21091
              length: 320
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: writer
                            children: []
                            pos: 21186
                            length: 6
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 21196
                            length: 4
                        children: []
                        pos: 21186
                        length: 14
                    children: []
                    pos: 21185
                    length: 17
                children:
                - type: block
                  fields: {}
                  children:
                  - type: throw_statement
                    fields:
                      text: throw new IllegalArgumentException ("The Writer must not
                        be null.");
                    children: []
                    pos: 21217
                    length: 68
                  pos: 21203
                  length: 92
                pos: 21182
                length: 113
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: string
                            children: []
                            pos: 21308
                            length: 6
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 21318
                            length: 4
                        children: []
                        pos: 21308
                        length: 14
                    children: []
                    pos: 21307
                    length: 16
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 21338
                    length: 7
                  pos: 21324
                  length: 31
                pos: 21304
                length: 51
              - type: expression_statement
                fields:
                  text: Entities.HTML40.unescape(writer, string);
                children: []
                pos: 21364
                length: 41
              pos: 21172
              length: 239
          children: []
          pos: 21091
          length: 320
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: escapeXml
              children: []
              pos: 22388
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Writer writer
                children: []
                pos: 22398
                length: 13
              pos: 22369
              length: 303
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: writer
                            children: []
                            pos: 22458
                            length: 6
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 22468
                            length: 4
                        children: []
                        pos: 22458
                        length: 14
                    children: []
                    pos: 22457
                    length: 17
                children:
                - type: block
                  fields: {}
                  children:
                  - type: throw_statement
                    fields:
                      text: throw new IllegalArgumentException ("The Writer must not
                        be null.");
                    children: []
                    pos: 22489
                    length: 68
                  pos: 22475
                  length: 92
                pos: 22454
                length: 113
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: str
                            children: []
                            pos: 22580
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 22587
                            length: 4
                        children: []
                        pos: 22580
                        length: 11
                    children: []
                    pos: 22579
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 22607
                    length: 7
                  pos: 22593
                  length: 31
                pos: 22576
                length: 48
              - type: expression_statement
                fields:
                  text: Entities.XML.escape(writer, str);
                children: []
                pos: 22633
                length: 33
              pos: 22444
              length: 228
          children: []
          pos: 22369
          length: 303
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: escapeXml
              children: []
              pos: 23469
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String str
                children: []
                pos: 23479
                length: 10
              pos: 23448
              length: 153
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: str
                            children: []
                            pos: 23505
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 23512
                            length: 4
                        children: []
                        pos: 23505
                        length: 11
                    children: []
                    pos: 23504
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return null;
                    children: []
                    pos: 23532
                    length: 12
                  pos: 23518
                  length: 36
                pos: 23501
                length: 53
              - type: return_statement
                fields:
                  text: return Entities.XML.escape(str);
                children: []
                pos: 23563
                length: 32
              pos: 23491
              length: 110
          children: []
          pos: 23448
          length: 153
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: unescapeXml
              children: []
              pos: 24481
              length: 11
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Writer writer
                children: []
                pos: 24493
                length: 13
              pos: 24462
              length: 307
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: writer
                            children: []
                            pos: 24553
                            length: 6
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 24563
                            length: 4
                        children: []
                        pos: 24553
                        length: 14
                    children: []
                    pos: 24552
                    length: 17
                children:
                - type: block
                  fields: {}
                  children:
                  - type: throw_statement
                    fields:
                      text: throw new IllegalArgumentException ("The Writer must not
                        be null.");
                    children: []
                    pos: 24584
                    length: 68
                  pos: 24570
                  length: 92
                pos: 24549
                length: 113
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: str
                            children: []
                            pos: 24675
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 24682
                            length: 4
                        children: []
                        pos: 24675
                        length: 11
                    children: []
                    pos: 24674
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 24702
                    length: 7
                  pos: 24688
                  length: 31
                pos: 24671
                length: 48
              - type: expression_statement
                fields:
                  text: Entities.XML.unescape(writer, str);
                children: []
                pos: 24728
                length: 35
              pos: 24539
              length: 230
          children: []
          pos: 24462
          length: 307
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: unescapeXml
              children: []
              pos: 25471
              length: 11
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String str
                children: []
                pos: 25483
                length: 10
              pos: 25450
              length: 157
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: str
                            children: []
                            pos: 25509
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 25516
                            length: 4
                        children: []
                        pos: 25509
                        length: 11
                    children: []
                    pos: 25508
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return null;
                    children: []
                    pos: 25536
                    length: 12
                  pos: 25522
                  length: 36
                pos: 25505
                length: 53
              - type: return_statement
                fields:
                  text: return Entities.XML.unescape(str);
                children: []
                pos: 25567
                length: 34
              pos: 25495
              length: 112
          children: []
          pos: 25450
          length: 157
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: escapeSql
              children: []
              pos: 26494
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String str
                children: []
                pos: 26504
                length: 10
              pos: 26473
              length: 164
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: str
                            children: []
                            pos: 26530
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 26537
                            length: 4
                        children: []
                        pos: 26530
                        length: 11
                    children: []
                    pos: 26529
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return null;
                    children: []
                    pos: 26557
                    length: 12
                  pos: 26543
                  length: 36
                pos: 26526
                length: 53
              - type: return_statement
                fields:
                  text: return StringUtils.replace(str, "'", "''");
                children: []
                pos: 26588
                length: 43
              pos: 26516
              length: 121
          children: []
          pos: 26473
          length: 164
        pos: 1482
        length: 25158
    children: []
    pos: 1482
    length: 25158
  pos: 0
  length: 26641
after_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: StringEscapeUtils
        children: []
        pos: 1495
        length: 17
      body:
        type: class_body
        fields: {}
        children:
        - type: constructor_declaration
          fields:
            text: |-
              public StringEscapeUtils() {
                    super();
                  }
          children: []
          pos: 1879
          length: 49
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: escapeJava
              children: []
              pos: 2816
              length: 10
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String str
                children: []
                pos: 2827
                length: 10
              pos: 2795
              length: 101
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return escapeJavaStyleString(str, false);
                children: []
                pos: 2849
                length: 41
              pos: 2839
              length: 57
          children: []
          pos: 2795
          length: 101
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: escapeJava
              children: []
              pos: 3429
              length: 10
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Writer out
                children: []
                pos: 3440
                length: 10
              pos: 3410
              length: 128
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: escapeJavaStyleString(out, str, false);
                children: []
                pos: 3493
                length: 39
              pos: 3483
              length: 55
          children: []
          pos: 3410
          length: 128
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: escapeJavaScript
              children: []
              pos: 4388
              length: 16
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String str
                children: []
                pos: 4405
                length: 10
              pos: 4367
              length: 106
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return escapeJavaStyleString(str, true);
                children: []
                pos: 4427
                length: 40
              pos: 4417
              length: 56
          children: []
          pos: 4367
          length: 106
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: escapeJavaScript
              children: []
              pos: 5019
              length: 16
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Writer out
                children: []
                pos: 5036
                length: 10
              pos: 5000
              length: 133
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: escapeJavaStyleString(out, str, true);
                children: []
                pos: 5089
                length: 38
              pos: 5079
              length: 54
          children: []
          pos: 5000
          length: 133
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: escapeJavaStyleString
              children: []
              pos: 5431
              length: 21
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String str
                children: []
                pos: 5453
                length: 10
              pos: 5409
              length: 526
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: str
                            children: []
                            pos: 5507
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 5514
                            length: 4
                        children: []
                        pos: 5507
                        length: 11
                    children: []
                    pos: 5506
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return null;
                    children: []
                    pos: 5534
                    length: 12
                  pos: 5520
                  length: 36
                pos: 5503
                length: 53
              - type: try_statement
                fields:
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: StringWriter writer = new StringWriter(str.length()
                          * 2);
                      children: []
                      pos: 5583
                      length: 57
                    - type: expression_statement
                      fields:
                        text: escapeJavaStyleString(writer, str, escapeSingleQuotes);
                      children: []
                      pos: 5653
                      length: 55
                    - type: return_statement
                      fields:
                        text: return writer.toString();
                      children: []
                      pos: 5721
                      length: 25
                    pos: 5569
                    length: 187
                  excepts:
                    type: excepts
                    fields: {}
                    children:
                    - type: catch_clause
                      fields:
                        text: |-
                          catch (IOException ioe) {
                                      // this should never ever happen while writing to a StringWriter
                                      ioe.printStackTrace();
                                      return null;
                                  }
                      children: []
                      pos: 5757
                      length: 172
                    pos: 5565
                    length: 364
                children: []
                pos: 5565
                length: 364
              pos: 5493
              length: 442
          children: []
          pos: 5409
          length: 526
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: escapeJavaStyleString
              children: []
              pos: 6303
              length: 21
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Writer out
                children: []
                pos: 6325
                length: 10
              pos: 6283
              length: 2453
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: out
                            children: []
                            pos: 6409
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 6416
                            length: 4
                        children: []
                        pos: 6409
                        length: 11
                    children: []
                    pos: 6408
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: throw_statement
                    fields:
                      text: throw new IllegalArgumentException("The Writer must not
                        be null");
                    children: []
                    pos: 6436
                    length: 66
                  pos: 6422
                  length: 90
                pos: 6405
                length: 107
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: str
                            children: []
                            pos: 6525
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 6532
                            length: 4
                        children: []
                        pos: 6525
                        length: 11
                    children: []
                    pos: 6524
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 6552
                    length: 7
                  pos: 6538
                  length: 31
                pos: 6521
                length: 48
              - type: local_variable_declaration
                fields:
                  text: int sz;
                children: []
                pos: 6578
                length: 7
              - type: expression_statement
                fields:
                  text: sz = str.length();
                children: []
                pos: 6594
                length: 18
              - type: for_statement
                fields:
                  text: |-
                    for (int i = 0; i < sz; i++) {
                                char ch = str.charAt(i);

                                // handle unicode
                                if (ch > 0xfff) {
                                    out.write("\\u" + hex(ch));
                                } else if (ch > 0xff) {
                                    out.write("\\u0" + hex(ch));
                                } else if (ch > 0x7f) {
                                    out.write("\\u00" + hex(ch));
                                } else if (ch < 32) {
                                    switch (ch) {
                                        case '\b':
                                            out.write('\\');
                                            out.write('b');
                                            break;
                                        case '\n':
                                            out.write('\\');
                                            out.write('n');
                                            break;
                                        case '\t':
                                            out.write('\\');
                                            out.write('t');
                                            break;
                                        case '\f':
                                            out.write('\\');
                                            out.write('f');
                                            break;
                                        case '\r':
                                            out.write('\\');
                                            out.write('r');
                                            break;
                                        default :
                                            if (ch > 0xf) {
                                                out.write("\\u00" + hex(ch));
                                            } else {
                                                out.write("\\u000" + hex(ch));
                                            }
                                            break;
                                    }
                                } else {
                                    switch (ch) {
                                        case '\'':
                                            if (escapeSingleQuote) {
                                              out.write('\\');
                                            }
                                            out.write('\'');
                                            break;
                                        case '"':
                                            out.write('\\');
                                            out.write('"');
                                            break;
                                        case '\\':
                                            out.write('\\');
                                            out.write('\\');
                                            break;
                                        default :
                                            out.write(ch);
                                            break;
                                    }
                                }
                            }
                children: []
                pos: 6621
                length: 2109
              pos: 6395
              length: 2341
          children: []
          pos: 6283
          length: 2453
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: hex
              children: []
              pos: 8992
              length: 3
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: char ch
                children: []
                pos: 8996
                length: 7
              pos: 8970
              length: 96
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return Integer.toHexString(ch).toUpperCase();
                children: []
                pos: 9015
                length: 45
              pos: 9005
              length: 61
          children: []
          pos: 8970
          length: 96
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: unescapeJava
              children: []
              pos: 9546
              length: 12
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String str
                children: []
                pos: 9559
                length: 10
              pos: 9525
              length: 455
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: str
                            children: []
                            pos: 9585
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 9592
                            length: 4
                        children: []
                        pos: 9585
                        length: 11
                    children: []
                    pos: 9584
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return null;
                    children: []
                    pos: 9612
                    length: 12
                  pos: 9598
                  length: 36
                pos: 9581
                length: 53
              - type: try_statement
                fields:
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: StringWriter writer = new StringWriter(str.length());
                      children: []
                      pos: 9661
                      length: 53
                    - type: expression_statement
                      fields:
                        text: unescapeJava(writer, str);
                      children: []
                      pos: 9727
                      length: 26
                    - type: return_statement
                      fields:
                        text: return writer.toString();
                      children: []
                      pos: 9766
                      length: 25
                    pos: 9647
                    length: 154
                  excepts:
                    type: excepts
                    fields: {}
                    children:
                    - type: catch_clause
                      fields:
                        text: |-
                          catch (IOException ioe) {
                                      // this should never ever happen while writing to a StringWriter
                                      ioe.printStackTrace();
                                      return null;
                                  }
                      children: []
                      pos: 9802
                      length: 172
                    pos: 9643
                    length: 331
                children: []
                pos: 9643
                length: 331
              pos: 9571
              length: 409
          children: []
          pos: 9525
          length: 455
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: unescapeJava
              children: []
              pos: 10701
              length: 12
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Writer out
                children: []
                pos: 10714
                length: 10
              pos: 10682
              length: 3002
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: out
                            children: []
                            pos: 10771
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 10778
                            length: 4
                        children: []
                        pos: 10771
                        length: 11
                    children: []
                    pos: 10770
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: throw_statement
                    fields:
                      text: throw new IllegalArgumentException("The Writer must not
                        be null");
                    children: []
                    pos: 10798
                    length: 66
                  pos: 10784
                  length: 90
                pos: 10767
                length: 107
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: str
                            children: []
                            pos: 10887
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 10894
                            length: 4
                        children: []
                        pos: 10887
                        length: 11
                    children: []
                    pos: 10886
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 10914
                    length: 7
                  pos: 10900
                  length: 31
                pos: 10883
                length: 48
              - type: local_variable_declaration
                fields:
                  text: int sz = str.length();
                children: []
                pos: 10940
                length: 22
              - type: local_variable_declaration
                fields:
                  text: StringBuffer unicode = new StringBuffer(4);
                children: []
                pos: 10971
                length: 43
              - type: local_variable_declaration
                fields:
                  text: boolean hadSlash = false;
                children: []
                pos: 11023
                length: 25
              - type: local_variable_declaration
                fields:
                  text: boolean inUnicode = false;
                children: []
                pos: 11057
                length: 26
              - type: for_statement
                fields:
                  text: |-
                    for (int i = 0; i < sz; i++) {
                                char ch = str.charAt(i);
                                if (inUnicode) {
                                    // if in unicode, then we're reading unicode
                                    // values in somehow
                                    unicode.append(ch);
                                    if (unicode.length() == 4) {
                                        // unicode now contains the four hex digits
                                        // which represents our unicode character
                                        try {
                                            int value = Integer.parseInt(unicode.toString(), 16);
                                            out.write((char) value);
                                            unicode.setLength(0);
                                            inUnicode = false;
                                            hadSlash = false;
                                        } catch (NumberFormatException nfe) {
                                            throw new NestableRuntimeException("Unable to parse unicode value: " + unicode, nfe);
                                        }
                                    }
                                    continue;
                                }
                                if (hadSlash) {
                                    // handle an escaped value
                                    hadSlash = false;
                                    switch (ch) {
                                        case '\\':
                                            out.write('\\');
                                            break;
                                        case '\'':
                                            out.write('\'');
                                            break;
                                        case '\"':
                                            out.write('"');
                                            break;
                                        case 'r':
                                            out.write('\r');
                                            break;
                                        case 'f':
                                            out.write('\f');
                                            break;
                                        case 't':
                                            out.write('\t');
                                            break;
                                        case 'n':
                                            out.write('\n');
                                            break;
                                        case 'b':
                                            out.write('\b');
                                            break;
                                        case 'u':
                                            {
                                                // uh-oh, we're in unicode country....
                                                inUnicode = true;
                                                break;
                                            }
                                        default :
                                            out.write(ch);
                                            break;
                                    }
                                    continue;
                                } else if (ch == '\\') {
                                    hadSlash = true;
                                    continue;
                                }
                                out.write(ch);
                            }
                children: []
                pos: 11092
                length: 2407
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: identifier
                        fields:
                          text: hadSlash
                        children: []
                        pos: 13512
                        length: 8
                    children: []
                    pos: 13511
                    length: 10
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: out.write('\\');
                    children: []
                    pos: 13652
                    length: 16
                  pos: 13522
                  length: 156
                pos: 13508
                length: 170
              pos: 10757
              length: 2927
          children: []
          pos: 10682
          length: 3002
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: unescapeJavaScript
              children: []
              pos: 14217
              length: 18
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String str
                children: []
                pos: 14236
                length: 10
              pos: 14196
              length: 93
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return unescapeJava(str);
                children: []
                pos: 14258
                length: 25
              pos: 14248
              length: 41
          children: []
          pos: 14196
          length: 93
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: unescapeJavaScript
              children: []
              pos: 15056
              length: 18
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Writer out
                children: []
                pos: 15075
                length: 10
              pos: 15037
              length: 120
            body:
              type: block
              fields: {}
              children:
              - type: expression_statement
                fields:
                  text: unescapeJava(out, str);
                children: []
                pos: 15128
                length: 23
              pos: 15118
              length: 39
          children: []
          pos: 15037
          length: 120
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: escapeHtml
              children: []
              pos: 16564
              length: 10
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String str
                children: []
                pos: 16575
                length: 10
              pos: 16543
              length: 447
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: str
                            children: []
                            pos: 16601
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 16608
                            length: 4
                        children: []
                        pos: 16601
                        length: 11
                    children: []
                    pos: 16600
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return null;
                    children: []
                    pos: 16628
                    length: 12
                  pos: 16614
                  length: 36
                pos: 16597
                length: 53
              - type: try_statement
                fields:
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: StringWriter writer = new StringWriter ((int)(str.length()
                          * 1.5));
                      children: []
                      pos: 16677
                      length: 67
                    - type: expression_statement
                      fields:
                        text: escapeHtml(writer, str);
                      children: []
                      pos: 16757
                      length: 24
                    - type: return_statement
                      fields:
                        text: return writer.toString();
                      children: []
                      pos: 16794
                      length: 25
                    pos: 16663
                    length: 166
                  excepts:
                    type: excepts
                    fields: {}
                    children:
                    - type: catch_clause
                      fields:
                        text: |-
                          catch (IOException e) {
                                      //assert false;
                                      //should be impossible
                                      e.printStackTrace();
                                      return null;
                                  }
                      children: []
                      pos: 16830
                      length: 154
                    pos: 16659
                    length: 325
                children: []
                pos: 16659
                length: 325
              pos: 16587
              length: 403
          children: []
          pos: 16543
          length: 447
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: escapeHtml
              children: []
              pos: 18577
              length: 10
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Writer writer
                children: []
                pos: 18588
                length: 13
              pos: 18558
              length: 316
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: writer
                            children: []
                            pos: 18651
                            length: 6
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 18661
                            length: 4
                        children: []
                        pos: 18651
                        length: 14
                    children: []
                    pos: 18650
                    length: 17
                children:
                - type: block
                  fields: {}
                  children:
                  - type: throw_statement
                    fields:
                      text: throw new IllegalArgumentException ("The Writer must not
                        be null.");
                    children: []
                    pos: 18682
                    length: 68
                  pos: 18668
                  length: 92
                pos: 18647
                length: 113
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: string
                            children: []
                            pos: 18773
                            length: 6
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 18783
                            length: 4
                        children: []
                        pos: 18773
                        length: 14
                    children: []
                    pos: 18772
                    length: 16
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 18803
                    length: 7
                  pos: 18789
                  length: 31
                pos: 18769
                length: 51
              - type: expression_statement
                fields:
                  text: Entities.HTML40.escape(writer, string);
                children: []
                pos: 18829
                length: 39
              pos: 18637
              length: 237
          children: []
          pos: 18558
          length: 316
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: unescapeHtml
              children: []
              pos: 19700
              length: 12
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String str
                children: []
                pos: 19713
                length: 10
              pos: 19679
              length: 451
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: str
                            children: []
                            pos: 19739
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 19746
                            length: 4
                        children: []
                        pos: 19739
                        length: 11
                    children: []
                    pos: 19738
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return null;
                    children: []
                    pos: 19766
                    length: 12
                  pos: 19752
                  length: 36
                pos: 19735
                length: 53
              - type: try_statement
                fields:
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: StringWriter writer = new StringWriter ((int)(str.length()
                          * 1.5));
                      children: []
                      pos: 19815
                      length: 67
                    - type: expression_statement
                      fields:
                        text: unescapeHtml(writer, str);
                      children: []
                      pos: 19895
                      length: 26
                    - type: return_statement
                      fields:
                        text: return writer.toString();
                      children: []
                      pos: 19934
                      length: 25
                    pos: 19801
                    length: 168
                  excepts:
                    type: excepts
                    fields: {}
                    children:
                    - type: catch_clause
                      fields:
                        text: |-
                          catch (IOException e) {
                                      //assert false;
                                      //should be impossible
                                      e.printStackTrace();
                                      return null;
                                  }
                      children: []
                      pos: 19970
                      length: 154
                    pos: 19797
                    length: 327
                children: []
                pos: 19797
                length: 327
              pos: 19725
              length: 405
          children: []
          pos: 19679
          length: 451
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: unescapeHtml
              children: []
              pos: 20968
              length: 12
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Writer writer
                children: []
                pos: 20981
                length: 13
              pos: 20949
              length: 320
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: writer
                            children: []
                            pos: 21044
                            length: 6
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 21054
                            length: 4
                        children: []
                        pos: 21044
                        length: 14
                    children: []
                    pos: 21043
                    length: 17
                children:
                - type: block
                  fields: {}
                  children:
                  - type: throw_statement
                    fields:
                      text: throw new IllegalArgumentException ("The Writer must not
                        be null.");
                    children: []
                    pos: 21075
                    length: 68
                  pos: 21061
                  length: 92
                pos: 21040
                length: 113
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: string
                            children: []
                            pos: 21166
                            length: 6
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 21176
                            length: 4
                        children: []
                        pos: 21166
                        length: 14
                    children: []
                    pos: 21165
                    length: 16
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 21196
                    length: 7
                  pos: 21182
                  length: 31
                pos: 21162
                length: 51
              - type: expression_statement
                fields:
                  text: Entities.HTML40.unescape(writer, string);
                children: []
                pos: 21222
                length: 41
              pos: 21030
              length: 239
          children: []
          pos: 20949
          length: 320
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: escapeXml
              children: []
              pos: 22246
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Writer writer
                children: []
                pos: 22256
                length: 13
              pos: 22227
              length: 303
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: writer
                            children: []
                            pos: 22316
                            length: 6
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 22326
                            length: 4
                        children: []
                        pos: 22316
                        length: 14
                    children: []
                    pos: 22315
                    length: 17
                children:
                - type: block
                  fields: {}
                  children:
                  - type: throw_statement
                    fields:
                      text: throw new IllegalArgumentException ("The Writer must not
                        be null.");
                    children: []
                    pos: 22347
                    length: 68
                  pos: 22333
                  length: 92
                pos: 22312
                length: 113
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: str
                            children: []
                            pos: 22438
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 22445
                            length: 4
                        children: []
                        pos: 22438
                        length: 11
                    children: []
                    pos: 22437
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 22465
                    length: 7
                  pos: 22451
                  length: 31
                pos: 22434
                length: 48
              - type: expression_statement
                fields:
                  text: Entities.XML.escape(writer, str);
                children: []
                pos: 22491
                length: 33
              pos: 22302
              length: 228
          children: []
          pos: 22227
          length: 303
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: escapeXml
              children: []
              pos: 23327
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String str
                children: []
                pos: 23337
                length: 10
              pos: 23306
              length: 153
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: str
                            children: []
                            pos: 23363
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 23370
                            length: 4
                        children: []
                        pos: 23363
                        length: 11
                    children: []
                    pos: 23362
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return null;
                    children: []
                    pos: 23390
                    length: 12
                  pos: 23376
                  length: 36
                pos: 23359
                length: 53
              - type: return_statement
                fields:
                  text: return Entities.XML.escape(str);
                children: []
                pos: 23421
                length: 32
              pos: 23349
              length: 110
          children: []
          pos: 23306
          length: 153
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: unescapeXml
              children: []
              pos: 24339
              length: 11
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Writer writer
                children: []
                pos: 24351
                length: 13
              pos: 24320
              length: 307
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: writer
                            children: []
                            pos: 24411
                            length: 6
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 24421
                            length: 4
                        children: []
                        pos: 24411
                        length: 14
                    children: []
                    pos: 24410
                    length: 17
                children:
                - type: block
                  fields: {}
                  children:
                  - type: throw_statement
                    fields:
                      text: throw new IllegalArgumentException ("The Writer must not
                        be null.");
                    children: []
                    pos: 24442
                    length: 68
                  pos: 24428
                  length: 92
                pos: 24407
                length: 113
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: str
                            children: []
                            pos: 24533
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 24540
                            length: 4
                        children: []
                        pos: 24533
                        length: 11
                    children: []
                    pos: 24532
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 24560
                    length: 7
                  pos: 24546
                  length: 31
                pos: 24529
                length: 48
              - type: expression_statement
                fields:
                  text: Entities.XML.unescape(writer, str);
                children: []
                pos: 24586
                length: 35
              pos: 24397
              length: 230
          children: []
          pos: 24320
          length: 307
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: unescapeXml
              children: []
              pos: 25329
              length: 11
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String str
                children: []
                pos: 25341
                length: 10
              pos: 25308
              length: 157
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: str
                            children: []
                            pos: 25367
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 25374
                            length: 4
                        children: []
                        pos: 25367
                        length: 11
                    children: []
                    pos: 25366
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return null;
                    children: []
                    pos: 25394
                    length: 12
                  pos: 25380
                  length: 36
                pos: 25363
                length: 53
              - type: return_statement
                fields:
                  text: return Entities.XML.unescape(str);
                children: []
                pos: 25425
                length: 34
              pos: 25353
              length: 112
          children: []
          pos: 25308
          length: 157
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: escapeSql
              children: []
              pos: 26352
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: String str
                children: []
                pos: 26362
                length: 10
              pos: 26331
              length: 164
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: str
                            children: []
                            pos: 26388
                            length: 3
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 26395
                            length: 4
                        children: []
                        pos: 26388
                        length: 11
                    children: []
                    pos: 26387
                    length: 13
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return null;
                    children: []
                    pos: 26415
                    length: 12
                  pos: 26401
                  length: 36
                pos: 26384
                length: 53
              - type: return_statement
                fields:
                  text: return StringUtils.replace(str, "'", "''");
                children: []
                pos: 26446
                length: 43
              pos: 26374
              length: 121
          children: []
          pos: 26331
          length: 164
        pos: 1482
        length: 25016
    children: []
    pos: 1482
    length: 25016
  pos: 0
  length: 26499
text_diff: |
  --- before
  +++ after
  @@ -233,10 +233,6 @@
                           out.write('\\');
                           out.write('\\');
                           break;
  -                    case '/':
  -                        out.write('\\');
  -                        out.write('/');
  -                        break;
                       default :
                           out.write(ch);
                           break;
tree_diff: |+
  New cluster:
  UPDATE from for (int i = 0; i < sz; i++) {
              char ch = str.charAt(i);

              // handle unicode
              if (ch > 0xfff) {
                  out.write("\\u" + hex(ch));
              } else if (ch > 0xff) {
                  out.write("\\u0" + hex(ch));
              } else if (ch > 0x7f) {
                  out.write("\\u00" + hex(ch));
              } else if (ch < 32) {
                  switch (ch) {
                      case '\b':
                          out.write('\\');
                          out.write('b');
                          break;
                      case '\n':
                          out.write('\\');
                          out.write('n');
                          break;
                      case '\t':
                          out.write('\\');
                          out.write('t');
                          break;
                      case '\f':
                          out.write('\\');
                          out.write('f');
                          break;
                      case '\r':
                          out.write('\\');
                          out.write('r');
                          break;
                      default :
                          if (ch > 0xf) {
                              out.write("\\u00" + hex(ch));
                          } else {
                              out.write("\\u000" + hex(ch));
                          }
                          break;
                  }
              } else {
                  switch (ch) {
                      case '\'':
                          if (escapeSingleQuote) {
                            out.write('\\');
                          }
                          out.write('\'');
                          break;
                      case '"':
                          out.write('\\');
                          out.write('"');
                          break;
                      case '\\':
                          out.write('\\');
                          out.write('\\');
                          break;
                      case '/':
                          out.write('\\');
                          out.write('/');
                          break;
                      default :
                          out.write(ch);
                          break;
                  }
              }
          } to for (int i = 0; i < sz; i++) {
              char ch = str.charAt(i);

              // handle unicode
              if (ch > 0xfff) {
                  out.write("\\u" + hex(ch));
              } else if (ch > 0xff) {
                  out.write("\\u0" + hex(ch));
              } else if (ch > 0x7f) {
                  out.write("\\u00" + hex(ch));
              } else if (ch < 32) {
                  switch (ch) {
                      case '\b':
                          out.write('\\');
                          out.write('b');
                          break;
                      case '\n':
                          out.write('\\');
                          out.write('n');
                          break;
                      case '\t':
                          out.write('\\');
                          out.write('t');
                          break;
                      case '\f':
                          out.write('\\');
                          out.write('f');
                          break;
                      case '\r':
                          out.write('\\');
                          out.write('r');
                          break;
                      default :
                          if (ch > 0xf) {
                              out.write("\\u00" + hex(ch));
                          } else {
                              out.write("\\u000" + hex(ch));
                          }
                          break;
                  }
              } else {
                  switch (ch) {
                      case '\'':
                          if (escapeSingleQuote) {
                            out.write('\\');
                          }
                          out.write('\'');
                          break;
                      case '"':
                          out.write('\\');
                          out.write('"');
                          break;
                      case '\\':
                          out.write('\\');
                          out.write('\\');
                          break;
                      default :
                          out.write(ch);
                          break;
                  }
              }
          }
  ------------
  ===
  update-node
  ---
  for_statement: for (int i = 0; i < sz; i++) {
              char ch = str.charAt(i);

              // handle unicode
              if (ch > 0xfff) {
                  out.write("\\u" + hex(ch));
              } else if (ch > 0xff) {
                  out.write("\\u0" + hex(ch));
              } else if (ch > 0x7f) {
                  out.write("\\u00" + hex(ch));
              } else if (ch < 32) {
                  switch (ch) {
                      case '\b':
                          out.write('\\');
                          out.write('b');
                          break;
                      case '\n':
                          out.write('\\');
                          out.write('n');
                          break;
                      case '\t':
                          out.write('\\');
                          out.write('t');
                          break;
                      case '\f':
                          out.write('\\');
                          out.write('f');
                          break;
                      case '\r':
                          out.write('\\');
                          out.write('r');
                          break;
                      default :
                          if (ch > 0xf) {
                              out.write("\\u00" + hex(ch));
                          } else {
                              out.write("\\u000" + hex(ch));
                          }
                          break;
                  }
              } else {
                  switch (ch) {
                      case '\'':
                          if (escapeSingleQuote) {
                            out.write('\\');
                          }
                          out.write('\'');
                          break;
                      case '"':
                          out.write('\\');
                          out.write('"');
                          break;
                      case '\\':
                          out.write('\\');
                          out.write('\\');
                          break;
                      case '/':
                          out.write('\\');
                          out.write('/');
                          break;
                      default :
                          out.write(ch);
                          break;
                  }
              }
          } [6621,8872]
  replace for (int i = 0; i < sz; i++) {
              char ch = str.charAt(i);

              // handle unicode
              if (ch > 0xfff) {
                  out.write("\\u" + hex(ch));
              } else if (ch > 0xff) {
                  out.write("\\u0" + hex(ch));
              } else if (ch > 0x7f) {
                  out.write("\\u00" + hex(ch));
              } else if (ch < 32) {
                  switch (ch) {
                      case '\b':
                          out.write('\\');
                          out.write('b');
                          break;
                      case '\n':
                          out.write('\\');
                          out.write('n');
                          break;
                      case '\t':
                          out.write('\\');
                          out.write('t');
                          break;
                      case '\f':
                          out.write('\\');
                          out.write('f');
                          break;
                      case '\r':
                          out.write('\\');
                          out.write('r');
                          break;
                      default :
                          if (ch > 0xf) {
                              out.write("\\u00" + hex(ch));
                          } else {
                              out.write("\\u000" + hex(ch));
                          }
                          break;
                  }
              } else {
                  switch (ch) {
                      case '\'':
                          if (escapeSingleQuote) {
                            out.write('\\');
                          }
                          out.write('\'');
                          break;
                      case '"':
                          out.write('\\');
                          out.write('"');
                          break;
                      case '\\':
                          out.write('\\');
                          out.write('\\');
                          break;
                      case '/':
                          out.write('\\');
                          out.write('/');
                          break;
                      default :
                          out.write(ch);
                          break;
                  }
              }
          } by for (int i = 0; i < sz; i++) {
              char ch = str.charAt(i);

              // handle unicode
              if (ch > 0xfff) {
                  out.write("\\u" + hex(ch));
              } else if (ch > 0xff) {
                  out.write("\\u0" + hex(ch));
              } else if (ch > 0x7f) {
                  out.write("\\u00" + hex(ch));
              } else if (ch < 32) {
                  switch (ch) {
                      case '\b':
                          out.write('\\');
                          out.write('b');
                          break;
                      case '\n':
                          out.write('\\');
                          out.write('n');
                          break;
                      case '\t':
                          out.write('\\');
                          out.write('t');
                          break;
                      case '\f':
                          out.write('\\');
                          out.write('f');
                          break;
                      case '\r':
                          out.write('\\');
                          out.write('r');
                          break;
                      default :
                          if (ch > 0xf) {
                              out.write("\\u00" + hex(ch));
                          } else {
                              out.write("\\u000" + hex(ch));
                          }
                          break;
                  }
              } else {
                  switch (ch) {
                      case '\'':
                          if (escapeSingleQuote) {
                            out.write('\\');
                          }
                          out.write('\'');
                          break;
                      case '"':
                          out.write('\\');
                          out.write('"');
                          break;
                      case '\\':
                          out.write('\\');
                          out.write('\\');
                          break;
                      default :
                          out.write(ch);
                          break;
                  }
              }
          }

...
