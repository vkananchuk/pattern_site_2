---
language: java
before_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: EnumSerializer
        children: []
        pos: 967
        length: 14
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: private static final long serialVersionUID = 1L;
          children: []
          pos: 1065
          length: 48
        - type: field_declaration
          fields:
            text: protected final EnumValues _values;
          children: []
          pos: 1287
          length: 35
        - type: field_declaration
          fields:
            text: protected final Boolean _serializeAsIndex;
          children: []
          pos: 1530
          length: 42
        - type: constructor_declaration
          fields:
            text: |-
              @Deprecated
                  public EnumSerializer(EnumValues v) {
                      this(v, null);
                  }
          children: []
          pos: 1807
          length: 82
        - type: constructor_declaration
          fields:
            text: |-
              public EnumSerializer(EnumValues v, Boolean serializeAsIndex)
                  {
                      super(v.getEnumClass(), false);
                      _values = v;
                      _serializeAsIndex = serializeAsIndex;
                  }
          children: []
          pos: 1895
          length: 180
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: construct
              children: []
              pos: 2342
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Class<?> enumClass
                children: []
                pos: 2352
                length: 18
              pos: 2278
              length: 680
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: EnumValues v = EnumValues.constructFromName(config, (Class<Enum<?>>)
                    enumClass);
                children: []
                pos: 2723
                length: 80
              - type: local_variable_declaration
                fields:
                  text: Boolean serializeAsIndex = _isShapeWrittenUsingIndex(enumClass,
                    format, true, null);
                children: []
                pos: 2812
                length: 84
              - type: return_statement
                fields:
                  text: return new EnumSerializer(v, serializeAsIndex);
                children: []
                pos: 2905
                length: 47
              pos: 2467
              length: 491
          children: []
          pos: 2278
          length: 680
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: createContextual
              children: []
              pos: 3192
              length: 16
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: SerializerProvider serializers
                children: []
                pos: 3209
                length: 30
              pos: 3153
              length: 705
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: property
                            children: []
                            pos: 3322
                            length: 8
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 3334
                            length: 4
                        children: []
                        pos: 3322
                        length: 16
                    children: []
                    pos: 3321
                    length: 18
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: |-
                        JsonFormat.Value format = findFormatOverrides(serializers,
                                            property, handledType());
                    children: []
                    pos: 3354
                    length: 104
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: not_equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: format
                                children: []
                                pos: 3475
                                length: 6
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 3485
                                length: 4
                            children: []
                            pos: 3475
                            length: 14
                        children: []
                        pos: 3474
                        length: 16
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: local_variable_declaration
                        fields:
                          text: |-
                            Boolean serializeAsIndex = _isShapeWrittenUsingIndex(property.getType().getRawClass(),
                                                    format, false, _serializeAsIndex);
                        children: []
                        pos: 3509
                        length: 145
                      - type: if_statement
                        fields:
                          condition:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: not_equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: serializeAsIndex
                                    children: []
                                    pos: 3675
                                    length: 16
                                  right:
                                    type: identifier
                                    fields:
                                      text: _serializeAsIndex
                                    children: []
                                    pos: 3695
                                    length: 17
                                children: []
                                pos: 3675
                                length: 37
                            children: []
                            pos: 3674
                            length: 39
                        children:
                        - type: block
                          fields: {}
                          children:
                          - type: return_statement
                            fields:
                              text: return new EnumSerializer(_values, serializeAsIndex);
                            children: []
                            pos: 3736
                            length: 53
                          pos: 3714
                          length: 93
                        pos: 3671
                        length: 136
                      pos: 3491
                      length: 330
                    pos: 3471
                    length: 350
                  pos: 3340
                  length: 491
                pos: 3318
                length: 513
              - type: return_statement
                fields:
                  text: return this;
                children: []
                pos: 3840
                length: 12
              pos: 3308
              length: 550
          children: []
          pos: 3153
          length: 705
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getEnumValues
              children: []
              pos: 4076
              length: 13
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 4058
              length: 53
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return _values;
                children: []
                pos: 4094
                length: 15
              pos: 4092
              length: 19
          children: []
          pos: 4058
          length: 53
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: serialize
              children: []
              pos: 4325
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Enum<?> en
                children: []
                pos: 4335
                length: 10
              pos: 4293
              length: 572
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: _serializeAsIndex(serializers)
                        children: []
                        pos: 4489
                        length: 30
                    children: []
                    pos: 4488
                    length: 32
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: gen.writeNumber(en.ordinal());
                    children: []
                    pos: 4535
                    length: 30
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 4578
                    length: 7
                  pos: 4521
                  length: 74
                pos: 4485
                length: 110
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: serializers.isEnabled(SerializationFeature.WRITE_ENUMS_USING_TO_STRING)
                        children: []
                        pos: 4654
                        length: 71
                    children: []
                    pos: 4653
                    length: 73
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: gen.writeString(en.toString());
                    children: []
                    pos: 4741
                    length: 31
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 4785
                    length: 7
                  pos: 4727
                  length: 75
                pos: 4650
                length: 152
              - type: expression_statement
                fields:
                  text: gen.writeString(_values.serializedValueFor(en));
                children: []
                pos: 4811
                length: 48
              pos: 4429
              length: 436
          children: []
          pos: 4293
          length: 572
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getSchema
              children: []
              pos: 5067
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: SerializerProvider provider
                children: []
                pos: 5077
                length: 27
              pos: 5037
              length: 654
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: _serializeAsIndex(provider)
                        children: []
                        pos: 5139
                        length: 27
                    children: []
                    pos: 5138
                    length: 29
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return createSchemaNode("integer", true);
                    children: []
                    pos: 5182
                    length: 41
                  pos: 5168
                  length: 65
                pos: 5135
                length: 98
              - type: local_variable_declaration
                fields:
                  text: ObjectNode objectNode = createSchemaNode("string", true);
                children: []
                pos: 5242
                length: 57
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: typeHint
                            children: []
                            pos: 5312
                            length: 8
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 5324
                            length: 4
                        children: []
                        pos: 5312
                        length: 16
                    children: []
                    pos: 5311
                    length: 18
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: JavaType type = provider.constructType(typeHint);
                    children: []
                    pos: 5344
                    length: 49
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: method_invocation
                            fields:
                              text: type.isEnumType()
                            children: []
                            pos: 5410
                            length: 17
                        children: []
                        pos: 5409
                        length: 19
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: local_variable_declaration
                        fields:
                          text: ArrayNode enumNode = objectNode.putArray("enum");
                        children: []
                        pos: 5447
                        length: 49
                      - type: enhanced_for_statement
                        fields:
                          text: |-
                            for (SerializableString value : _values.values()) {
                                                enumNode.add(value.getValue());
                                            }
                        children: []
                        pos: 5513
                        length: 121
                      pos: 5429
                      length: 219
                    pos: 5406
                    length: 242
                  pos: 5330
                  length: 328
                pos: 5308
                length: 350
              - type: return_statement
                fields:
                  text: return objectNode;
                children: []
                pos: 5667
                length: 18
              pos: 5125
              length: 566
          children: []
          pos: 5037
          length: 654
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: acceptJsonFormatVisitor
              children: []
              pos: 5727
              length: 23
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonFormatVisitorWrapper visitor
                children: []
                pos: 5751
                length: 32
              pos: 5701
              length: 1136
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: SerializerProvider serializers = visitor.getProvider();
                children: []
                pos: 5854
                length: 55
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: _serializeAsIndex(serializers)
                        children: []
                        pos: 5922
                        length: 30
                    children: []
                    pos: 5921
                    length: 32
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: visitIntFormat(visitor, typeHint, JsonParser.NumberType.INT);
                    children: []
                    pos: 5968
                    length: 61
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 6042
                    length: 7
                  pos: 5954
                  length: 105
                pos: 5918
                length: 141
              - type: local_variable_declaration
                fields:
                  text: JsonStringFormatVisitor stringVisitor = visitor.expectStringFormat(typeHint);
                children: []
                pos: 6068
                length: 77
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: stringVisitor
                            children: []
                            pos: 6158
                            length: 13
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 6175
                            length: 4
                        children: []
                        pos: 6158
                        length: 21
                    children: []
                    pos: 6157
                    length: 23
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: Set<String> enums = new LinkedHashSet<String>();
                    children: []
                    pos: 6195
                    length: 48
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: and
                            fields:
                              left:
                                type: parenthesized_expression
                                fields:
                                  expression:
                                    type: not_equals
                                    fields:
                                      left:
                                        type: identifier
                                        fields:
                                          text: serializers
                                        children: []
                                        pos: 6305
                                        length: 11
                                      right:
                                        type: null_literal
                                        fields: {}
                                        children: []
                                        pos: 6320
                                        length: 4
                                    children: []
                                    pos: 6305
                                    length: 19
                                children: []
                                pos: 6304
                                length: 21
                              right:
                                type: method_invocation
                                fields:
                                  text: serializers.isEnabled(SerializationFeature.WRITE_ENUMS_USING_TO_STRING)
                                children: []
                                pos: 6350
                                length: 71
                            children: []
                            pos: 6304
                            length: 117
                        children: []
                        pos: 6303
                        length: 119
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: enhanced_for_statement
                        fields:
                          text: |-
                            for (Enum<?> e : _values.enums()) {
                                                enums.add(e.toString());
                                            }
                        children: []
                        pos: 6441
                        length: 98
                      pos: 6423
                      length: 130
                    pos: 6300
                    length: 477
                  - type: expression_statement
                    fields:
                      text: stringVisitor.enumTypes(enums);
                    children: []
                    pos: 6790
                    length: 31
                  pos: 6181
                  length: 650
                pos: 6154
                length: 677
              pos: 5844
              length: 993
          children: []
          pos: 5701
          length: 1136
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: _serializeAsIndex
              children: []
              pos: 7037
              length: 17
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: SerializerProvider serializers
                children: []
                pos: 7055
                length: 30
              pos: 7013
              length: 273
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: _serializeAsIndex
                            children: []
                            pos: 7105
                            length: 17
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 7126
                            length: 4
                        children: []
                        pos: 7105
                        length: 25
                    children: []
                    pos: 7104
                    length: 27
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return _serializeAsIndex.booleanValue();
                    children: []
                    pos: 7146
                    length: 40
                  pos: 7132
                  length: 64
                pos: 7101
                length: 95
              - type: return_statement
                fields:
                  text: return serializers.isEnabled(SerializationFeature.WRITE_ENUMS_USING_INDEX);
                children: []
                pos: 7205
                length: 75
              pos: 7091
              length: 195
          children: []
          pos: 7013
          length: 273
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: _isShapeWrittenUsingIndex
              children: []
              pos: 7443
              length: 25
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Class<?> enumClass
                children: []
                pos: 7469
                length: 18
              pos: 7418
              length: 1169
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: 'JsonFormat.Shape shape = (format == null) ? null : format.getShape();'
                children: []
                pos: 7593
                length: 69
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: shape
                            children: []
                            pos: 7675
                            length: 5
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 7684
                            length: 4
                        children: []
                        pos: 7675
                        length: 13
                    children: []
                    pos: 7674
                    length: 15
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return defaultValue;
                    children: []
                    pos: 7704
                    length: 20
                  pos: 7690
                  length: 44
                pos: 7671
                length: 63
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: or
                        fields:
                          left:
                            type: equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: shape
                                children: []
                                pos: 7792
                                length: 5
                              right:
                                type: field_access
                                fields:
                                  text: Shape.ANY
                                children: []
                                pos: 7801
                                length: 9
                            children: []
                            pos: 7792
                            length: 18
                          right:
                            type: equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: shape
                                children: []
                                pos: 7814
                                length: 5
                              right:
                                type: field_access
                                fields:
                                  text: Shape.SCALAR
                                children: []
                                pos: 7823
                                length: 12
                            children: []
                            pos: 7814
                            length: 21
                        children: []
                        pos: 7792
                        length: 43
                    children: []
                    pos: 7791
                    length: 45
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return defaultValue;
                    children: []
                    pos: 7851
                    length: 20
                  pos: 7837
                  length: 44
                pos: 7788
                length: 93
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: or
                        fields:
                          left:
                            type: equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: shape
                                children: []
                                pos: 7954
                                length: 5
                              right:
                                type: field_access
                                fields:
                                  text: Shape.STRING
                                children: []
                                pos: 7963
                                length: 12
                            children: []
                            pos: 7954
                            length: 21
                          right:
                            type: equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: shape
                                children: []
                                pos: 7979
                                length: 5
                              right:
                                type: field_access
                                fields:
                                  text: Shape.NATURAL
                                children: []
                                pos: 7988
                                length: 13
                            children: []
                            pos: 7979
                            length: 22
                        children: []
                        pos: 7954
                        length: 47
                    children: []
                    pos: 7953
                    length: 49
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return Boolean.FALSE;
                    children: []
                    pos: 8017
                    length: 21
                  pos: 8003
                  length: 45
                pos: 7950
                length: 98
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: or
                        fields:
                          left:
                            type: method_invocation
                            fields:
                              text: shape.isNumeric()
                            children: []
                            pos: 8159
                            length: 17
                          right:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: shape
                                    children: []
                                    pos: 8181
                                    length: 5
                                  right:
                                    type: field_access
                                    fields:
                                      text: Shape.ARRAY
                                    children: []
                                    pos: 8190
                                    length: 11
                                children: []
                                pos: 8181
                                length: 20
                            children: []
                            pos: 8180
                            length: 22
                        children: []
                        pos: 8159
                        length: 43
                    children: []
                    pos: 8158
                    length: 45
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return Boolean.TRUE;
                    children: []
                    pos: 8218
                    length: 20
                  pos: 8204
                  length: 44
                pos: 8155
                length: 93
              - type: throw_statement
                fields:
                  text: |-
                    throw new IllegalArgumentException(String.format(
                                    "Unsupported serialization shape (%s) for Enum %s, not supported as %s annotation",
                                        shape, enumClass.getName(), (fromClass? "class" : "property")));
                children: []
                pos: 8347
                length: 234
              pos: 7583
              length: 1004
          children: []
          pos: 7418
          length: 1169
        pos: 938
        length: 7651
    children: []
    pos: 938
    length: 7651
  pos: 0
  length: 8590
after_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: EnumSerializer
        children: []
        pos: 967
        length: 14
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: private static final long serialVersionUID = 1L;
          children: []
          pos: 1065
          length: 48
        - type: field_declaration
          fields:
            text: protected final EnumValues _values;
          children: []
          pos: 1287
          length: 35
        - type: field_declaration
          fields:
            text: protected final Boolean _serializeAsIndex;
          children: []
          pos: 1530
          length: 42
        - type: constructor_declaration
          fields:
            text: |-
              @Deprecated
                  public EnumSerializer(EnumValues v) {
                      this(v, null);
                  }
          children: []
          pos: 1807
          length: 82
        - type: constructor_declaration
          fields:
            text: |-
              public EnumSerializer(EnumValues v, Boolean serializeAsIndex)
                  {
                      super(v.getEnumClass(), false);
                      _values = v;
                      _serializeAsIndex = serializeAsIndex;
                  }
          children: []
          pos: 1895
          length: 180
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: construct
              children: []
              pos: 2342
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Class<?> enumClass
                children: []
                pos: 2352
                length: 18
              pos: 2278
              length: 674
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: EnumValues v = EnumValues.constructFromName(config, (Class<Enum<?>>)
                    enumClass);
                children: []
                pos: 2723
                length: 80
              - type: local_variable_declaration
                fields:
                  text: Boolean serializeAsIndex = _isShapeWrittenUsingIndex(enumClass,
                    format, true);
                children: []
                pos: 2812
                length: 78
              - type: return_statement
                fields:
                  text: return new EnumSerializer(v, serializeAsIndex);
                children: []
                pos: 2899
                length: 47
              pos: 2467
              length: 485
          children: []
          pos: 2278
          length: 674
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: createContextual
              children: []
              pos: 3186
              length: 16
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: SerializerProvider serializers
                children: []
                pos: 3203
                length: 30
              pos: 3147
              length: 686
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: property
                            children: []
                            pos: 3316
                            length: 8
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 3328
                            length: 4
                        children: []
                        pos: 3316
                        length: 16
                    children: []
                    pos: 3315
                    length: 18
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: |-
                        JsonFormat.Value format = findFormatOverrides(serializers,
                                            property, handledType());
                    children: []
                    pos: 3348
                    length: 104
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: not_equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: format
                                children: []
                                pos: 3469
                                length: 6
                              right:
                                type: null_literal
                                fields: {}
                                children: []
                                pos: 3479
                                length: 4
                            children: []
                            pos: 3469
                            length: 14
                        children: []
                        pos: 3468
                        length: 16
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: local_variable_declaration
                        fields:
                          text: |-
                            Boolean serializeAsIndex = _isShapeWrittenUsingIndex(property.getType().getRawClass(),
                                                    format, false);
                        children: []
                        pos: 3503
                        length: 126
                      - type: if_statement
                        fields:
                          condition:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: not_equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: serializeAsIndex
                                    children: []
                                    pos: 3650
                                    length: 16
                                  right:
                                    type: identifier
                                    fields:
                                      text: _serializeAsIndex
                                    children: []
                                    pos: 3670
                                    length: 17
                                children: []
                                pos: 3650
                                length: 37
                            children: []
                            pos: 3649
                            length: 39
                        children:
                        - type: block
                          fields: {}
                          children:
                          - type: return_statement
                            fields:
                              text: return new EnumSerializer(_values, serializeAsIndex);
                            children: []
                            pos: 3711
                            length: 53
                          pos: 3689
                          length: 93
                        pos: 3646
                        length: 136
                      pos: 3485
                      length: 311
                    pos: 3465
                    length: 331
                  pos: 3334
                  length: 472
                pos: 3312
                length: 494
              - type: return_statement
                fields:
                  text: return this;
                children: []
                pos: 3815
                length: 12
              pos: 3302
              length: 531
          children: []
          pos: 3147
          length: 686
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getEnumValues
              children: []
              pos: 4051
              length: 13
            parameters:
              type: method_parameters
              fields: {}
              children: []
              pos: 4033
              length: 53
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return _values;
                children: []
                pos: 4069
                length: 15
              pos: 4067
              length: 19
          children: []
          pos: 4033
          length: 53
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: serialize
              children: []
              pos: 4300
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Enum<?> en
                children: []
                pos: 4310
                length: 10
              pos: 4268
              length: 572
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: _serializeAsIndex(serializers)
                        children: []
                        pos: 4464
                        length: 30
                    children: []
                    pos: 4463
                    length: 32
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: gen.writeNumber(en.ordinal());
                    children: []
                    pos: 4510
                    length: 30
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 4553
                    length: 7
                  pos: 4496
                  length: 74
                pos: 4460
                length: 110
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: serializers.isEnabled(SerializationFeature.WRITE_ENUMS_USING_TO_STRING)
                        children: []
                        pos: 4629
                        length: 71
                    children: []
                    pos: 4628
                    length: 73
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: gen.writeString(en.toString());
                    children: []
                    pos: 4716
                    length: 31
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 4760
                    length: 7
                  pos: 4702
                  length: 75
                pos: 4625
                length: 152
              - type: expression_statement
                fields:
                  text: gen.writeString(_values.serializedValueFor(en));
                children: []
                pos: 4786
                length: 48
              pos: 4404
              length: 436
          children: []
          pos: 4268
          length: 572
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: getSchema
              children: []
              pos: 5042
              length: 9
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: SerializerProvider provider
                children: []
                pos: 5052
                length: 27
              pos: 5012
              length: 654
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: _serializeAsIndex(provider)
                        children: []
                        pos: 5114
                        length: 27
                    children: []
                    pos: 5113
                    length: 29
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return createSchemaNode("integer", true);
                    children: []
                    pos: 5157
                    length: 41
                  pos: 5143
                  length: 65
                pos: 5110
                length: 98
              - type: local_variable_declaration
                fields:
                  text: ObjectNode objectNode = createSchemaNode("string", true);
                children: []
                pos: 5217
                length: 57
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: typeHint
                            children: []
                            pos: 5287
                            length: 8
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 5299
                            length: 4
                        children: []
                        pos: 5287
                        length: 16
                    children: []
                    pos: 5286
                    length: 18
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: JavaType type = provider.constructType(typeHint);
                    children: []
                    pos: 5319
                    length: 49
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: method_invocation
                            fields:
                              text: type.isEnumType()
                            children: []
                            pos: 5385
                            length: 17
                        children: []
                        pos: 5384
                        length: 19
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: local_variable_declaration
                        fields:
                          text: ArrayNode enumNode = objectNode.putArray("enum");
                        children: []
                        pos: 5422
                        length: 49
                      - type: enhanced_for_statement
                        fields:
                          text: |-
                            for (SerializableString value : _values.values()) {
                                                enumNode.add(value.getValue());
                                            }
                        children: []
                        pos: 5488
                        length: 121
                      pos: 5404
                      length: 219
                    pos: 5381
                    length: 242
                  pos: 5305
                  length: 328
                pos: 5283
                length: 350
              - type: return_statement
                fields:
                  text: return objectNode;
                children: []
                pos: 5642
                length: 18
              pos: 5100
              length: 566
          children: []
          pos: 5012
          length: 654
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: acceptJsonFormatVisitor
              children: []
              pos: 5702
              length: 23
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: JsonFormatVisitorWrapper visitor
                children: []
                pos: 5726
                length: 32
              pos: 5676
              length: 1136
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: SerializerProvider serializers = visitor.getProvider();
                children: []
                pos: 5829
                length: 55
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: method_invocation
                        fields:
                          text: _serializeAsIndex(serializers)
                        children: []
                        pos: 5897
                        length: 30
                    children: []
                    pos: 5896
                    length: 32
                children:
                - type: block
                  fields: {}
                  children:
                  - type: expression_statement
                    fields:
                      text: visitIntFormat(visitor, typeHint, JsonParser.NumberType.INT);
                    children: []
                    pos: 5943
                    length: 61
                  - type: return_statement
                    fields:
                      text: return;
                    children: []
                    pos: 6017
                    length: 7
                  pos: 5929
                  length: 105
                pos: 5893
                length: 141
              - type: local_variable_declaration
                fields:
                  text: JsonStringFormatVisitor stringVisitor = visitor.expectStringFormat(typeHint);
                children: []
                pos: 6043
                length: 77
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: stringVisitor
                            children: []
                            pos: 6133
                            length: 13
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 6150
                            length: 4
                        children: []
                        pos: 6133
                        length: 21
                    children: []
                    pos: 6132
                    length: 23
                children:
                - type: block
                  fields: {}
                  children:
                  - type: local_variable_declaration
                    fields:
                      text: Set<String> enums = new LinkedHashSet<String>();
                    children: []
                    pos: 6170
                    length: 48
                  - type: if_statement
                    fields:
                      condition:
                        type: parenthesized_expression
                        fields:
                          expression:
                            type: and
                            fields:
                              left:
                                type: parenthesized_expression
                                fields:
                                  expression:
                                    type: not_equals
                                    fields:
                                      left:
                                        type: identifier
                                        fields:
                                          text: serializers
                                        children: []
                                        pos: 6280
                                        length: 11
                                      right:
                                        type: null_literal
                                        fields: {}
                                        children: []
                                        pos: 6295
                                        length: 4
                                    children: []
                                    pos: 6280
                                    length: 19
                                children: []
                                pos: 6279
                                length: 21
                              right:
                                type: method_invocation
                                fields:
                                  text: serializers.isEnabled(SerializationFeature.WRITE_ENUMS_USING_TO_STRING)
                                children: []
                                pos: 6325
                                length: 71
                            children: []
                            pos: 6279
                            length: 117
                        children: []
                        pos: 6278
                        length: 119
                    children:
                    - type: block
                      fields: {}
                      children:
                      - type: enhanced_for_statement
                        fields:
                          text: |-
                            for (Enum<?> e : _values.enums()) {
                                                enums.add(e.toString());
                                            }
                        children: []
                        pos: 6416
                        length: 98
                      pos: 6398
                      length: 130
                    pos: 6275
                    length: 477
                  - type: expression_statement
                    fields:
                      text: stringVisitor.enumTypes(enums);
                    children: []
                    pos: 6765
                    length: 31
                  pos: 6156
                  length: 650
                pos: 6129
                length: 677
              pos: 5819
              length: 993
          children: []
          pos: 5676
          length: 1136
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: _serializeAsIndex
              children: []
              pos: 7012
              length: 17
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: SerializerProvider serializers
                children: []
                pos: 7030
                length: 30
              pos: 6988
              length: 273
            body:
              type: block
              fields: {}
              children:
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: not_equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: _serializeAsIndex
                            children: []
                            pos: 7080
                            length: 17
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 7101
                            length: 4
                        children: []
                        pos: 7080
                        length: 25
                    children: []
                    pos: 7079
                    length: 27
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return _serializeAsIndex.booleanValue();
                    children: []
                    pos: 7121
                    length: 40
                  pos: 7107
                  length: 64
                pos: 7076
                length: 95
              - type: return_statement
                fields:
                  text: return serializers.isEnabled(SerializationFeature.WRITE_ENUMS_USING_INDEX);
                children: []
                pos: 7180
                length: 75
              pos: 7066
              length: 195
          children: []
          pos: 6988
          length: 273
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: _isShapeWrittenUsingIndex
              children: []
              pos: 7418
              length: 25
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Class<?> enumClass
                children: []
                pos: 7444
                length: 18
              pos: 7393
              length: 1119
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: 'JsonFormat.Shape shape = (format == null) ? null : format.getShape();'
                children: []
                pos: 7534
                length: 69
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: equals
                        fields:
                          left:
                            type: identifier
                            fields:
                              text: shape
                            children: []
                            pos: 7616
                            length: 5
                          right:
                            type: null_literal
                            fields: {}
                            children: []
                            pos: 7625
                            length: 4
                        children: []
                        pos: 7616
                        length: 13
                    children: []
                    pos: 7615
                    length: 15
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return null;
                    children: []
                    pos: 7645
                    length: 12
                  pos: 7631
                  length: 36
                pos: 7612
                length: 55
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: or
                        fields:
                          left:
                            type: equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: shape
                                children: []
                                pos: 7725
                                length: 5
                              right:
                                type: field_access
                                fields:
                                  text: Shape.ANY
                                children: []
                                pos: 7734
                                length: 9
                            children: []
                            pos: 7725
                            length: 18
                          right:
                            type: equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: shape
                                children: []
                                pos: 7747
                                length: 5
                              right:
                                type: field_access
                                fields:
                                  text: Shape.SCALAR
                                children: []
                                pos: 7756
                                length: 12
                            children: []
                            pos: 7747
                            length: 21
                        children: []
                        pos: 7725
                        length: 43
                    children: []
                    pos: 7724
                    length: 45
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return null;
                    children: []
                    pos: 7784
                    length: 12
                  pos: 7770
                  length: 36
                pos: 7721
                length: 85
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: or
                        fields:
                          left:
                            type: equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: shape
                                children: []
                                pos: 7879
                                length: 5
                              right:
                                type: field_access
                                fields:
                                  text: Shape.STRING
                                children: []
                                pos: 7888
                                length: 12
                            children: []
                            pos: 7879
                            length: 21
                          right:
                            type: equals
                            fields:
                              left:
                                type: identifier
                                fields:
                                  text: shape
                                children: []
                                pos: 7904
                                length: 5
                              right:
                                type: field_access
                                fields:
                                  text: Shape.NATURAL
                                children: []
                                pos: 7913
                                length: 13
                            children: []
                            pos: 7904
                            length: 22
                        children: []
                        pos: 7879
                        length: 47
                    children: []
                    pos: 7878
                    length: 49
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return Boolean.FALSE;
                    children: []
                    pos: 7942
                    length: 21
                  pos: 7928
                  length: 45
                pos: 7875
                length: 98
              - type: if_statement
                fields:
                  condition:
                    type: parenthesized_expression
                    fields:
                      expression:
                        type: or
                        fields:
                          left:
                            type: method_invocation
                            fields:
                              text: shape.isNumeric()
                            children: []
                            pos: 8084
                            length: 17
                          right:
                            type: parenthesized_expression
                            fields:
                              expression:
                                type: equals
                                fields:
                                  left:
                                    type: identifier
                                    fields:
                                      text: shape
                                    children: []
                                    pos: 8106
                                    length: 5
                                  right:
                                    type: field_access
                                    fields:
                                      text: Shape.ARRAY
                                    children: []
                                    pos: 8115
                                    length: 11
                                children: []
                                pos: 8106
                                length: 20
                            children: []
                            pos: 8105
                            length: 22
                        children: []
                        pos: 8084
                        length: 43
                    children: []
                    pos: 8083
                    length: 45
                children:
                - type: block
                  fields: {}
                  children:
                  - type: return_statement
                    fields:
                      text: return Boolean.TRUE;
                    children: []
                    pos: 8143
                    length: 20
                  pos: 8129
                  length: 44
                pos: 8080
                length: 93
              - type: throw_statement
                fields:
                  text: |-
                    throw new IllegalArgumentException(String.format(
                                    "Unsupported serialization shape (%s) for Enum %s, not supported as %s annotation",
                                        shape, enumClass.getName(), (fromClass? "class" : "property")));
                children: []
                pos: 8272
                length: 234
              pos: 7524
              length: 988
          children: []
          pos: 7393
          length: 1119
        pos: 938
        length: 7576
    children: []
    pos: 938
    length: 7576
  pos: 0
  length: 8515
text_diff: "--- before\n+++ after\n@@ -83,7 +83,7 @@\n          *   handle toString()
  case dynamically (for example)\n          */\n         EnumValues v = EnumValues.constructFromName(config,
  (Class<Enum<?>>) enumClass);\n-        Boolean serializeAsIndex = _isShapeWrittenUsingIndex(enumClass,
  format, true, null);\n+        Boolean serializeAsIndex = _isShapeWrittenUsingIndex(enumClass,
  format, true);\n         return new EnumSerializer(v, serializeAsIndex);\n     }\n
  \n@@ -101,7 +101,7 @@\n                     property, handledType());\n             if
  (format != null) {\n                 Boolean serializeAsIndex = _isShapeWrittenUsingIndex(property.getType().getRawClass(),\n-
  \                       format, false, _serializeAsIndex);\n+                        format,
  false);\n                 if (serializeAsIndex != _serializeAsIndex) {\n                     return
  new EnumSerializer(_values, serializeAsIndex);\n                 }\n@@ -214,16 +214,15
  @@\n      * index (number) or not.\n      */\n     protected static Boolean _isShapeWrittenUsingIndex(Class<?>
  enumClass,\n-            JsonFormat.Value format, boolean fromClass,\n-            Boolean
  defaultValue)\n+            JsonFormat.Value format, boolean fromClass)\n     {\n
  \        JsonFormat.Shape shape = (format == null) ? null : format.getShape();\n
  \        if (shape == null) {\n-            return defaultValue;\n+            return
  null;\n         }\n         // i.e. \"default\", check dynamically\n         if
  (shape == Shape.ANY || shape == Shape.SCALAR) {\n-            return defaultValue;\n+
  \           return null;\n         }\n         // 19-May-2016, tatu: also consider
  \"natural\" shape\n         if (shape == Shape.STRING || shape == Shape.NATURAL)
  {\n"
tree_diff: |+
  New cluster:
  UPDATE from Boolean serializeAsIndex = _isShapeWrittenUsingIndex(enumClass, format, true, null); to Boolean serializeAsIndex = _isShapeWrittenUsingIndex(enumClass, format, true);
  ------------
  ===
  update-node
  ---
  local_variable_declaration: Boolean serializeAsIndex = _isShapeWrittenUsingIndex(enumClass, format, true, null); [2812,2896]
  replace Boolean serializeAsIndex = _isShapeWrittenUsingIndex(enumClass, format, true, null); by Boolean serializeAsIndex = _isShapeWrittenUsingIndex(enumClass, format, true);

  New cluster:
  UPDATE from return defaultValue; to return null;
  ------------
  ===
  update-node
  ---
  return_statement: return defaultValue; [7704,7724]
  replace return defaultValue; by return null;
  ===
  update-node
  ---
  return_statement: return defaultValue; [7851,7871]
  replace return defaultValue; by return null;

  New cluster:
  UPDATE from Boolean serializeAsIndex = _isShapeWrittenUsingIndex(property.getType().getRawClass(),
                          format, false, _serializeAsIndex); to Boolean serializeAsIndex = _isShapeWrittenUsingIndex(property.getType().getRawClass(),
                          format, false);
  ------------
  ===
  update-node
  ---
  local_variable_declaration: Boolean serializeAsIndex = _isShapeWrittenUsingIndex(property.getType().getRawClass(),
                          format, false, _serializeAsIndex); [3509,3654]
  replace Boolean serializeAsIndex = _isShapeWrittenUsingIndex(property.getType().getRawClass(),
                          format, false, _serializeAsIndex); by Boolean serializeAsIndex = _isShapeWrittenUsingIndex(property.getType().getRawClass(),
                          format, false);

...
