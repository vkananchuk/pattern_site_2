---
language: java
before_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: FunctionRewriter
        children: []
        pos: 1410
        length: 16
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: private final AbstractCompiler compiler;
          children: []
          pos: 1455
          length: 40
        - type: field_declaration
          fields:
            text: private static final int SAVINGS_THRESHOLD = 16;
          children: []
          pos: 1598
          length: 48
        - type: constructor_declaration
          fields:
            text: |-
              FunctionRewriter(AbstractCompiler compiler) {
                  this.compiler = compiler;
                }
          children: []
          pos: 1650
          length: 79
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: process
              children: []
              pos: 1757
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Node externs
                children: []
                pos: 1765
                length: 12
              pos: 1733
              length: 1725
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: |-
                    List<Reducer> reducers = ImmutableList.of(new ReturnConstantReducer(),
                                                                  new GetterReducer(),
                                                                  new SetterReducer(),
                                                                  new EmptyFunctionReducer(),
                                                                  new IdentityReducer());
                children: []
                pos: 1796
                length: 348
              - type: local_variable_declaration
                fields:
                  text: Multimap<Reducer, Reduction> reductionMap = HashMultimap.create();
                children: []
                pos: 2150
                length: 66
              - type: expression_statement
                fields:
                  text: |-
                    NodeTraversal.traverse(compiler, root,
                                               new ReductionGatherer(reducers, reductionMap));
                children: []
                pos: 2336
                length: 113
              - type: enhanced_for_statement
                fields:
                  text: |-
                    for (Reducer reducer : reducers) {
                          Collection<Reduction> reductions = reductionMap.get(reducer);
                          if (reductions.isEmpty()) {
                            continue;
                          }

                          Node helperCode = parseHelperCode(reducer);
                          if (helperCode == null) {
                            continue;
                          }

                          int helperCodeCost = InlineCostEstimator.getCost(helperCode);

                          // Estimate savings
                          int savings = 0;
                          for (Reduction reduction : reductions) {
                            savings += reduction.estimateSavings();
                          }

                          // Compare estimated savings against the helper cost.  Apply
                          // reductions if doing so will result in some savings.
                          if (savings > (helperCodeCost + SAVINGS_THRESHOLD)) {
                            for (Reduction reduction : reductions) {
                              reduction.apply();
                            }

                            Node addingRoot = compiler.getNodeForCodeInsertion(null);
                            addingRoot.addChildrenToFront(helperCode);
                            compiler.reportCodeChange();
                          }
                        }
                children: []
                pos: 2515
                length: 939
              pos: 1790
              length: 1668
          children: []
          pos: 1733
          length: 1725
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: parseHelperCode
              children: []
              pos: 3596
              length: 15
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Reducer reducer
                children: []
                pos: 3612
                length: 15
              pos: 3584
              length: 234
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: |-
                    Node root = compiler.parseSyntheticCode(
                            reducer.getClass().toString() + ":helper", reducer.getHelperSource());
                children: []
                pos: 3635
                length: 119
              - type: return_statement
                fields:
                  text: 'return (root != null) ? root.removeFirstChild() : null;'
                children: []
                pos: 3759
                length: 55
              pos: 3629
              length: 189
          children: []
          pos: 3584
          length: 234
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: isReduceableFunctionExpression
              children: []
              pos: 3845
              length: 30
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Node n
                children: []
                pos: 3876
                length: 6
              pos: 3822
              length: 162
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: |-
                    return NodeUtil.isFunctionExpression(n)
                            && !NodeUtil.isGetOrSetKey(n.getParent());
                children: []
                pos: 3890
                length: 90
              pos: 3884
              length: 100
          children: []
          pos: 3822
          length: 162
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: Reduction
              children: []
              pos: 4060
              length: 9
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: private final Node parent;
                children: []
                pos: 4076
                length: 26
              - type: field_declaration
                fields:
                  text: private final Node oldChild;
                children: []
                pos: 4107
                length: 28
              - type: field_declaration
                fields:
                  text: private final Node newChild;
                children: []
                pos: 4140
                length: 28
              - type: constructor_declaration
                fields:
                  text: |-
                    Reduction(Node parent, Node oldChild, Node newChild) {
                          this.parent = parent;
                          this.oldChild = oldChild;
                          this.newChild = newChild;
                        }
                children: []
                pos: 4174
                length: 152
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: apply
                    children: []
                    pos: 4427
                    length: 5
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 4422
                    length: 102
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: expression_statement
                      fields:
                        text: parent.replaceChild(oldChild, newChild);
                      children: []
                      pos: 4443
                      length: 40
                    - type: expression_statement
                      fields:
                        text: compiler.reportCodeChange();
                      children: []
                      pos: 4490
                      length: 28
                    pos: 4435
                    length: 89
                children: []
                pos: 4422
                length: 102
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: estimateSavings
                    children: []
                    pos: 4616
                    length: 15
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 4612
                    length: 131
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: |-
                          return InlineCostEstimator.getCost(oldChild) -
                                    InlineCostEstimator.getCost(newChild);
                      children: []
                      pos: 4642
                      length: 95
                    pos: 4634
                    length: 109
                children: []
                pos: 4612
                length: 131
              pos: 4046
              length: 701
          children: []
          pos: 4046
          length: 701
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: ReductionGatherer
              children: []
              pos: 4938
              length: 17
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: private final List<Reducer> reducers;
                children: []
                pos: 4982
                length: 37
              - type: field_declaration
                fields:
                  text: private final Multimap<Reducer, Reduction> reductions;
                children: []
                pos: 5024
                length: 54
              - type: constructor_declaration
                fields:
                  text: |-
                    ReductionGatherer(List<Reducer> reducers,
                                          Multimap<Reducer, Reduction> reductions) {
                          this.reducers = reducers;
                          this.reductions = reductions;
                        }
                children: []
                pos: 5276
                length: 180
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: shouldTraverse
                    children: []
                    pos: 5491
                    length: 14
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: NodeTraversal raversal
                      children: []
                      pos: 5506
                      length: 22
                    pos: 5462
                    length: 430
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: enhanced_for_statement
                      fields:
                        text: |-
                          for (Reducer reducer : reducers) {
                                  Node replacement = reducer.reduce(node);
                                  if (replacement != node) {
                                    reductions.put(reducer, new Reduction(parent, node, replacement));
                                    return false;
                                  }
                                }
                      children: []
                      pos: 5630
                      length: 237
                    - type: return_statement
                      fields:
                        text: return true;
                      children: []
                      pos: 5874
                      length: 12
                    pos: 5622
                    length: 270
                children: []
                pos: 5462
                length: 430
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: visit
                    children: []
                    pos: 5925
                    length: 5
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: NodeTraversal traversal
                      children: []
                      pos: 5931
                      length: 23
                    pos: 5899
                    length: 88
                  body:
                    type: block
                    fields: {}
                    children: []
                    pos: 5980
                    length: 7
                children: []
                pos: 5899
                length: 88
              pos: 4924
              length: 1067
          children: []
          pos: 4924
          length: 1067
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: Reducer
              children: []
              pos: 6100
              length: 7
            body:
              type: class_body
              fields: {}
              children:
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: getHelperSource
                    children: []
                    pos: 6214
                    length: 15
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 6198
                    length: 34
                children: []
                pos: 6198
                length: 34
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: reduce
                    children: []
                    pos: 6391
                    length: 6
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node node
                      children: []
                      pos: 6398
                      length: 9
                    pos: 6377
                    length: 32
                children: []
                pos: 6377
                length: 32
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: buildCallNode
                    children: []
                    pos: 6746
                    length: 13
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: String methodName
                      children: []
                      pos: 6760
                      length: 17
                    pos: 6725
                    length: 431
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: Node call = new Node(Token.CALL, lineno, charno);
                      children: []
                      pos: 6869
                      length: 49
                    - type: expression_statement
                      fields:
                        text: call.putBooleanProp(Node.FREE_CALL, true);
                      children: []
                      pos: 6925
                      length: 42
                    - type: expression_statement
                      fields:
                        text: call.addChildToBack(Node.newString(Token.NAME, methodName));
                      children: []
                      pos: 6974
                      length: 60
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: not_equals
                              fields:
                                left:
                                  type: identifier
                                  fields:
                                    text: argumentNode
                                  children: []
                                  pos: 7045
                                  length: 12
                                right:
                                  type: null_literal
                                  fields: {}
                                  children: []
                                  pos: 7061
                                  length: 4
                              children: []
                              pos: 7045
                              length: 20
                          children: []
                          pos: 7044
                          length: 22
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: expression_statement
                          fields:
                            text: call.addChildToBack(argumentNode.cloneTree());
                          children: []
                          pos: 7077
                          length: 46
                        pos: 7067
                        length: 64
                      pos: 7041
                      length: 90
                    - type: return_statement
                      fields:
                        text: return call;
                      children: []
                      pos: 7138
                      length: 12
                    pos: 6861
                    length: 295
                children: []
                pos: 6725
                length: 431
              pos: 6078
              length: 1082
          children: []
          pos: 6078
          length: 1082
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: EmptyFunctionReducer
              children: []
              pos: 7428
              length: 20
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: static final String FACTORY_METHOD_NAME = "JSCompiler_emptyFn";
                children: []
                pos: 7471
                length: 63
              - type: field_declaration
                fields:
                  text: |-
                    static final String HELPER_SOURCE =
                            "function " + FACTORY_METHOD_NAME + "() {" +
                            "  return function() {}" +
                            "}";
                children: []
                pos: 7539
                length: 136
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: getHelperSource
                    children: []
                    pos: 7709
                    length: 15
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 7681
                    length: 81
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return HELPER_SOURCE;
                      children: []
                      pos: 7735
                      length: 21
                    pos: 7727
                    length: 35
                children: []
                pos: 7681
                length: 81
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: reduce
                    children: []
                    pos: 7794
                    length: 6
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node node
                      children: []
                      pos: 7801
                      length: 9
                    pos: 7768
                    length: 271
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: method_invocation
                              fields:
                                text: NodeUtil.isEmptyFunctionExpression(node)
                              children: []
                              pos: 7824
                              length: 40
                          children: []
                          pos: 7823
                          length: 42
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: |-
                              return buildCallNode(FACTORY_METHOD_NAME, null,
                                                           node.getLineno(), node.getCharno());
                          children: []
                          pos: 7876
                          length: 113
                        pos: 7866
                        length: 131
                      pos: 7820
                      length: 213
                    pos: 7812
                    length: 227
                children: []
                pos: 7768
                length: 271
              pos: 7407
              length: 636
          children: []
          pos: 7407
          length: 636
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: SingleReturnStatementReducer
              children: []
              pos: 8176
              length: 28
            body:
              type: class_body
              fields: {}
              children:
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: maybeGetSingleReturnRValue
                    children: []
                    pos: 8385
                    length: 26
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node functionNode
                      children: []
                      pos: 8412
                      length: 17
                    pos: 8364
                    length: 347
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: Node body = functionNode.getLastChild();
                      children: []
                      pos: 8439
                      length: 40
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: unary_expression
                              fields:
                                text: "!body.hasOneChild()"
                              children: []
                              pos: 8490
                              length: 19
                          children: []
                          pos: 8489
                          length: 21
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return null;
                          children: []
                          pos: 8521
                          length: 12
                        pos: 8511
                        length: 30
                      pos: 8486
                      length: 55
                    - type: local_variable_declaration
                      fields:
                        text: Node statement = body.getFirstChild();
                      children: []
                      pos: 8549
                      length: 38
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: equals
                              fields:
                                left:
                                  type: method_invocation
                                  fields:
                                    text: statement.getType()
                                  children: []
                                  pos: 8598
                                  length: 19
                                right:
                                  type: field_access
                                  fields:
                                    text: Token.RETURN
                                  children: []
                                  pos: 8621
                                  length: 12
                              children: []
                              pos: 8598
                              length: 35
                          children: []
                          pos: 8597
                          length: 37
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return statement.getFirstChild();
                          children: []
                          pos: 8645
                          length: 33
                        pos: 8635
                        length: 51
                      pos: 8594
                      length: 92
                    - type: return_statement
                      fields:
                        text: return null;
                      children: []
                      pos: 8693
                      length: 12
                    pos: 8431
                    length: 280
                children: []
                pos: 8364
                length: 347
              pos: 8154
              length: 561
          children: []
          pos: 8154
          length: 561
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: IdentityReducer
              children: []
              pos: 8964
              length: 15
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: static final String FACTORY_METHOD_NAME = "JSCompiler_identityFn";
                children: []
                pos: 9023
                length: 66
              - type: field_declaration
                fields:
                  text: |-
                    static final String HELPER_SOURCE =
                            "function " + FACTORY_METHOD_NAME + "() {" +
                            "  return function(" + FACTORY_METHOD_NAME + "_value) {" +
                                 "return " + FACTORY_METHOD_NAME + "_value}" +
                            "}";
                children: []
                pos: 9094
                length: 227
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: getHelperSource
                    children: []
                    pos: 9355
                    length: 15
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 9327
                    length: 81
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return HELPER_SOURCE;
                      children: []
                      pos: 9381
                      length: 21
                    pos: 9373
                    length: 35
                children: []
                pos: 9327
                length: 81
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: reduce
                    children: []
                    pos: 9440
                    length: 6
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node node
                      children: []
                      pos: 9447
                      length: 9
                    pos: 9414
                    length: 336
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: unary_expression
                              fields:
                                text: "!isReduceableFunctionExpression(node)"
                              children: []
                              pos: 9470
                              length: 37
                          children: []
                          pos: 9469
                          length: 39
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return node;
                          children: []
                          pos: 9519
                          length: 12
                        pos: 9509
                        length: 30
                      pos: 9466
                      length: 73
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: method_invocation
                              fields:
                                text: isIdentityFunction(node)
                              children: []
                              pos: 9551
                              length: 24
                          children: []
                          pos: 9550
                          length: 26
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: |-
                              return buildCallNode(FACTORY_METHOD_NAME, null,
                                                           node.getLineno(), node.getCharno());
                          children: []
                          pos: 9587
                          length: 113
                        pos: 9577
                        length: 131
                      pos: 9547
                      length: 197
                    pos: 9458
                    length: 292
                children: []
                pos: 9414
                length: 336
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: isIdentityFunction
                    children: []
                    pos: 9955
                    length: 18
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node functionNode
                      children: []
                      pos: 9974
                      length: 17
                    pos: 9939
                    length: 466
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: Node argList = functionNode.getFirstChild().getNext();
                      children: []
                      pos: 10001
                      length: 54
                    - type: local_variable_declaration
                      fields:
                        text: Node paramNode = argList.getFirstChild();
                      children: []
                      pos: 10062
                      length: 41
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: equals
                              fields:
                                left:
                                  type: identifier
                                  fields:
                                    text: paramNode
                                  children: []
                                  pos: 10114
                                  length: 9
                                right:
                                  type: null_literal
                                  fields: {}
                                  children: []
                                  pos: 10127
                                  length: 4
                              children: []
                              pos: 10114
                              length: 17
                          children: []
                          pos: 10113
                          length: 19
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return false;
                          children: []
                          pos: 10143
                          length: 13
                        pos: 10133
                        length: 31
                      pos: 10110
                      length: 54
                    - type: local_variable_declaration
                      fields:
                        text: Node value = maybeGetSingleReturnRValue(functionNode);
                      children: []
                      pos: 10172
                      length: 54
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: and
                              fields:
                                left:
                                  type: and
                                  fields:
                                    left:
                                      type: not_equals
                                      fields:
                                        left:
                                          type: identifier
                                          fields:
                                            text: value
                                          children: []
                                          pos: 10237
                                          length: 5
                                        right:
                                          type: null_literal
                                          fields: {}
                                          children: []
                                          pos: 10246
                                          length: 4
                                      children: []
                                      pos: 10237
                                      length: 13
                                    right:
                                      type: method_invocation
                                      fields:
                                        text: NodeUtil.isName(value)
                                      children: []
                                      pos: 10264
                                      length: 22
                                  children: []
                                  pos: 10237
                                  length: 49
                                right:
                                  type: method_invocation
                                  fields:
                                    text: value.getString().equals(paramNode.getString())
                                  children: []
                                  pos: 10300
                                  length: 47
                              children: []
                              pos: 10237
                              length: 110
                          children: []
                          pos: 10236
                          length: 112
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return true;
                          children: []
                          pos: 10359
                          length: 12
                        pos: 10349
                        length: 30
                      pos: 10233
                      length: 146
                    - type: return_statement
                      fields:
                        text: return false;
                      children: []
                      pos: 10386
                      length: 13
                    pos: 9993
                    length: 412
                children: []
                pos: 9939
                length: 466
              pos: 8943
              length: 1466
          children: []
          pos: 8943
          length: 1466
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: ReturnConstantReducer
              children: []
              pos: 10692
              length: 21
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: static final String FACTORY_METHOD_NAME = "JSCompiler_returnArg";
                children: []
                pos: 10763
                length: 65
              - type: field_declaration
                fields:
                  text: |-
                    static final String HELPER_SOURCE =
                            "function " + FACTORY_METHOD_NAME +
                            "(" + FACTORY_METHOD_NAME + "_value) {" +
                            "  return function() {return " + FACTORY_METHOD_NAME + "_value}" +
                            "}";
                children: []
                pos: 10833
                length: 217
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: getHelperSource
                    children: []
                    pos: 11084
                    length: 15
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 11056
                    length: 81
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return HELPER_SOURCE;
                      children: []
                      pos: 11110
                      length: 21
                    pos: 11102
                    length: 35
                children: []
                pos: 11056
                length: 81
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: reduce
                    children: []
                    pos: 11169
                    length: 6
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node node
                      children: []
                      pos: 11176
                      length: 9
                    pos: 11143
                    length: 377
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: unary_expression
                              fields:
                                text: "!isReduceableFunctionExpression(node)"
                              children: []
                              pos: 11199
                              length: 37
                          children: []
                          pos: 11198
                          length: 39
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return node;
                          children: []
                          pos: 11248
                          length: 12
                        pos: 11238
                        length: 30
                      pos: 11195
                      length: 73
                    - type: local_variable_declaration
                      fields:
                        text: Node valueNode = getValueNode(node);
                      children: []
                      pos: 11276
                      length: 36
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: not_equals
                              fields:
                                left:
                                  type: identifier
                                  fields:
                                    text: valueNode
                                  children: []
                                  pos: 11323
                                  length: 9
                                right:
                                  type: null_literal
                                  fields: {}
                                  children: []
                                  pos: 11336
                                  length: 4
                              children: []
                              pos: 11323
                              length: 17
                          children: []
                          pos: 11322
                          length: 19
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: |-
                              return buildCallNode(FACTORY_METHOD_NAME, valueNode,
                                                           node.getLineno(), node.getCharno());
                          children: []
                          pos: 11352
                          length: 118
                        pos: 11342
                        length: 136
                      pos: 11319
                      length: 195
                    pos: 11187
                    length: 333
                children: []
                pos: 11143
                length: 377
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: getValueNode
                    children: []
                    pos: 11774
                    length: 12
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node functionNode
                      children: []
                      pos: 11787
                      length: 17
                    pos: 11761
                    length: 235
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: Node value = maybeGetSingleReturnRValue(functionNode);
                      children: []
                      pos: 11814
                      length: 54
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: and
                              fields:
                                left:
                                  type: not_equals
                                  fields:
                                    left:
                                      type: identifier
                                      fields:
                                        text: value
                                      children: []
                                      pos: 11879
                                      length: 5
                                    right:
                                      type: null_literal
                                      fields: {}
                                      children: []
                                      pos: 11888
                                      length: 4
                                  children: []
                                  pos: 11879
                                  length: 13
                                right:
                                  type: method_invocation
                                  fields:
                                    text: NodeUtil.isImmutableValue(value)
                                  children: []
                                  pos: 11906
                                  length: 32
                              children: []
                              pos: 11879
                              length: 59
                          children: []
                          pos: 11878
                          length: 61
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return value;
                          children: []
                          pos: 11950
                          length: 13
                        pos: 11940
                        length: 31
                      pos: 11875
                      length: 96
                    - type: return_statement
                      fields:
                        text: return null;
                      children: []
                      pos: 11978
                      length: 12
                    pos: 11806
                    length: 190
                children: []
                pos: 11761
                length: 235
              pos: 10671
              length: 1329
          children: []
          pos: 10671
          length: 1329
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: GetterReducer
              children: []
              pos: 12257
              length: 13
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: static final String FACTORY_METHOD_NAME = "JSCompiler_get";
                children: []
                pos: 12314
                length: 59
              - type: field_declaration
                fields:
                  text: |-
                    static final String HELPER_SOURCE =
                            "function " + FACTORY_METHOD_NAME + "(" +
                            FACTORY_METHOD_NAME + "_name) {" +
                            "  return function() {return this[" + FACTORY_METHOD_NAME + "_name]}" +
                            "}";
                children: []
                pos: 12378
                length: 221
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: getHelperSource
                    children: []
                    pos: 12633
                    length: 15
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 12605
                    length: 81
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return HELPER_SOURCE;
                      children: []
                      pos: 12659
                      length: 21
                    pos: 12651
                    length: 35
                children: []
                pos: 12605
                length: 81
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: reduce
                    children: []
                    pos: 12718
                    length: 6
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node node
                      children: []
                      pos: 12725
                      length: 9
                    pos: 12692
                    length: 557
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: unary_expression
                              fields:
                                text: "!isReduceableFunctionExpression(node)"
                              children: []
                              pos: 12748
                              length: 37
                          children: []
                          pos: 12747
                          length: 39
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return node;
                          children: []
                          pos: 12797
                          length: 12
                        pos: 12787
                        length: 30
                      pos: 12744
                      length: 73
                    - type: local_variable_declaration
                      fields:
                        text: Node propName = getGetPropertyName(node);
                      children: []
                      pos: 12825
                      length: 41
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: not_equals
                              fields:
                                left:
                                  type: identifier
                                  fields:
                                    text: propName
                                  children: []
                                  pos: 12877
                                  length: 8
                                right:
                                  type: null_literal
                                  fields: {}
                                  children: []
                                  pos: 12889
                                  length: 4
                              children: []
                              pos: 12877
                              length: 16
                          children: []
                          pos: 12876
                          length: 18
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: if_statement
                          fields:
                            condition:
                              type: parenthesized_expression
                              fields:
                                expression:
                                  type: not_equals
                                  fields:
                                    left:
                                      type: method_invocation
                                      fields:
                                        text: propName.getType()
                                      children: []
                                      pos: 12909
                                      length: 18
                                    right:
                                      type: field_access
                                      fields:
                                        text: Token.STRING
                                      children: []
                                      pos: 12931
                                      length: 12
                                  children: []
                                  pos: 12909
                                  length: 34
                              children: []
                              pos: 12908
                              length: 36
                          children:
                          - type: block
                            fields: {}
                            children:
                            - type: throw_statement
                              fields:
                                text: |-
                                  throw new IllegalStateException(
                                                "Expected STRING, got " + Token.name(propName.getType()));
                              children: []
                              pos: 12957
                              length: 105
                            pos: 12945
                            length: 127
                          pos: 12905
                          length: 167
                        - type: return_statement
                          fields:
                            text: |-
                              return buildCallNode(FACTORY_METHOD_NAME, propName,
                                                           node.getLineno(), node.getCharno());
                          children: []
                          pos: 13082
                          length: 117
                        pos: 12895
                        length: 312
                      pos: 12873
                      length: 370
                    pos: 12736
                    length: 513
                children: []
                pos: 12692
                length: 557
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: getGetPropertyName
                    children: []
                    pos: 13512
                    length: 18
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node functionNode
                      children: []
                      pos: 13531
                      length: 17
                    pos: 13499
                    length: 301
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: Node value = maybeGetSingleReturnRValue(functionNode);
                      children: []
                      pos: 13558
                      length: 54
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: and
                              fields:
                                left:
                                  type: and
                                  fields:
                                    left:
                                      type: not_equals
                                      fields:
                                        left:
                                          type: identifier
                                          fields:
                                            text: value
                                          children: []
                                          pos: 13623
                                          length: 5
                                        right:
                                          type: null_literal
                                          fields: {}
                                          children: []
                                          pos: 13632
                                          length: 4
                                      children: []
                                      pos: 13623
                                      length: 13
                                    right:
                                      type: method_invocation
                                      fields:
                                        text: NodeUtil.isGetProp(value)
                                      children: []
                                      pos: 13650
                                      length: 25
                                  children: []
                                  pos: 13623
                                  length: 52
                                right:
                                  type: method_invocation
                                  fields:
                                    text: NodeUtil.isThis(value.getFirstChild())
                                  children: []
                                  pos: 13689
                                  length: 38
                              children: []
                              pos: 13623
                              length: 104
                          children: []
                          pos: 13622
                          length: 106
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return value.getLastChild();
                          children: []
                          pos: 13739
                          length: 28
                        pos: 13729
                        length: 46
                      pos: 13619
                      length: 156
                    - type: return_statement
                      fields:
                        text: return null;
                      children: []
                      pos: 13782
                      length: 12
                    pos: 13550
                    length: 250
                children: []
                pos: 13499
                length: 301
              pos: 12236
              length: 1568
          children: []
          pos: 12236
          length: 1568
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: SetterReducer
              children: []
              pos: 14070
              length: 13
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: static final String FACTORY_METHOD_NAME = "JSCompiler_set";
                children: []
                pos: 14106
                length: 59
              - type: field_declaration
                fields:
                  text: |-
                    static final String HELPER_SOURCE =
                            "function " + FACTORY_METHOD_NAME + "(" +
                            FACTORY_METHOD_NAME + "_name) {" +
                            "  return function(" + FACTORY_METHOD_NAME + "_value) {" +
                            "this[" + FACTORY_METHOD_NAME + "_name] = " +
                            FACTORY_METHOD_NAME + "_value}" +
                            "}";
                children: []
                pos: 14170
                length: 304
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: getHelperSource
                    children: []
                    pos: 14508
                    length: 15
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 14480
                    length: 81
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return HELPER_SOURCE;
                      children: []
                      pos: 14534
                      length: 21
                    pos: 14526
                    length: 35
                children: []
                pos: 14480
                length: 81
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: reduce
                    children: []
                    pos: 14593
                    length: 6
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node node
                      children: []
                      pos: 14600
                      length: 9
                    pos: 14567
                    length: 557
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: unary_expression
                              fields:
                                text: "!isReduceableFunctionExpression(node)"
                              children: []
                              pos: 14623
                              length: 37
                          children: []
                          pos: 14622
                          length: 39
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return node;
                          children: []
                          pos: 14672
                          length: 12
                        pos: 14662
                        length: 30
                      pos: 14619
                      length: 73
                    - type: local_variable_declaration
                      fields:
                        text: Node propName = getSetPropertyName(node);
                      children: []
                      pos: 14700
                      length: 41
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: not_equals
                              fields:
                                left:
                                  type: identifier
                                  fields:
                                    text: propName
                                  children: []
                                  pos: 14752
                                  length: 8
                                right:
                                  type: null_literal
                                  fields: {}
                                  children: []
                                  pos: 14764
                                  length: 4
                              children: []
                              pos: 14752
                              length: 16
                          children: []
                          pos: 14751
                          length: 18
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: if_statement
                          fields:
                            condition:
                              type: parenthesized_expression
                              fields:
                                expression:
                                  type: not_equals
                                  fields:
                                    left:
                                      type: method_invocation
                                      fields:
                                        text: propName.getType()
                                      children: []
                                      pos: 14784
                                      length: 18
                                    right:
                                      type: field_access
                                      fields:
                                        text: Token.STRING
                                      children: []
                                      pos: 14806
                                      length: 12
                                  children: []
                                  pos: 14784
                                  length: 34
                              children: []
                              pos: 14783
                              length: 36
                          children:
                          - type: block
                            fields: {}
                            children:
                            - type: throw_statement
                              fields:
                                text: |-
                                  throw new IllegalStateException(
                                                "Expected STRING, got " + Token.name(propName.getType()));
                              children: []
                              pos: 14832
                              length: 105
                            pos: 14820
                            length: 127
                          pos: 14780
                          length: 167
                        - type: return_statement
                          fields:
                            text: |-
                              return buildCallNode(FACTORY_METHOD_NAME, propName,
                                                           node.getLineno(), node.getCharno());
                          children: []
                          pos: 14957
                          length: 117
                        pos: 14770
                        length: 312
                      pos: 14748
                      length: 370
                    pos: 14611
                    length: 513
                children: []
                pos: 14567
                length: 557
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: getSetPropertyName
                    children: []
                    pos: 15399
                    length: 18
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node functionNode
                      children: []
                      pos: 15418
                      length: 17
                    pos: 15386
                    length: 882
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: Node body = functionNode.getLastChild();
                      children: []
                      pos: 15445
                      length: 40
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: unary_expression
                              fields:
                                text: "!body.hasOneChild()"
                              children: []
                              pos: 15496
                              length: 19
                          children: []
                          pos: 15495
                          length: 21
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return null;
                          children: []
                          pos: 15527
                          length: 12
                        pos: 15517
                        length: 30
                      pos: 15492
                      length: 55
                    - type: local_variable_declaration
                      fields:
                        text: Node argList = functionNode.getFirstChild().getNext();
                      children: []
                      pos: 15555
                      length: 54
                    - type: local_variable_declaration
                      fields:
                        text: Node paramNode = argList.getFirstChild();
                      children: []
                      pos: 15616
                      length: 41
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: equals
                              fields:
                                left:
                                  type: identifier
                                  fields:
                                    text: paramNode
                                  children: []
                                  pos: 15668
                                  length: 9
                                right:
                                  type: null_literal
                                  fields: {}
                                  children: []
                                  pos: 15681
                                  length: 4
                              children: []
                              pos: 15668
                              length: 17
                          children: []
                          pos: 15667
                          length: 19
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return null;
                          children: []
                          pos: 15697
                          length: 12
                        pos: 15687
                        length: 30
                      pos: 15664
                      length: 53
                    - type: local_variable_declaration
                      fields:
                        text: Node statement = body.getFirstChild();
                      children: []
                      pos: 15725
                      length: 38
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: unary_expression
                              fields:
                                text: "!NodeUtil.isExprAssign(statement)"
                              children: []
                              pos: 15774
                              length: 33
                          children: []
                          pos: 15773
                          length: 35
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return null;
                          children: []
                          pos: 15819
                          length: 12
                        pos: 15809
                        length: 30
                      pos: 15770
                      length: 69
                    - type: local_variable_declaration
                      fields:
                        text: Node assign = statement.getFirstChild();
                      children: []
                      pos: 15847
                      length: 40
                    - type: local_variable_declaration
                      fields:
                        text: Node lhs = assign.getFirstChild();
                      children: []
                      pos: 15894
                      length: 34
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: and
                              fields:
                                left:
                                  type: method_invocation
                                  fields:
                                    text: NodeUtil.isGetProp(lhs)
                                  children: []
                                  pos: 15939
                                  length: 23
                                right:
                                  type: method_invocation
                                  fields:
                                    text: NodeUtil.isThis(lhs.getFirstChild())
                                  children: []
                                  pos: 15966
                                  length: 36
                              children: []
                              pos: 15939
                              length: 63
                          children: []
                          pos: 15938
                          length: 65
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: local_variable_declaration
                          fields:
                            text: Node rhs = assign.getLastChild();
                          children: []
                          pos: 16014
                          length: 33
                        - type: if_statement
                          fields:
                            condition:
                              type: parenthesized_expression
                              fields:
                                expression:
                                  type: and
                                  fields:
                                    left:
                                      type: method_invocation
                                      fields:
                                        text: NodeUtil.isName(rhs)
                                      children: []
                                      pos: 16060
                                      length: 20
                                    right:
                                      type: method_invocation
                                      fields:
                                        text: rhs.getString().equals(paramNode.getString())
                                      children: []
                                      pos: 16096
                                      length: 45
                                  children: []
                                  pos: 16060
                                  length: 81
                              children: []
                              pos: 16059
                              length: 83
                          children:
                          - type: block
                            fields: {}
                            children:
                            - type: local_variable_declaration
                              fields:
                                text: Node propertyName = lhs.getLastChild();
                              children: []
                              pos: 16155
                              length: 39
                            - type: return_statement
                              fields:
                                text: return propertyName;
                              children: []
                              pos: 16205
                              length: 20
                            pos: 16143
                            length: 92
                          pos: 16056
                          length: 179
                        pos: 16004
                        length: 239
                      pos: 15935
                      length: 308
                    - type: return_statement
                      fields:
                        text: return null;
                      children: []
                      pos: 16250
                      length: 12
                    pos: 15437
                    length: 831
                children: []
                pos: 15386
                length: 882
              pos: 14049
              length: 2223
          children: []
          pos: 14049
          length: 2223
        pos: 1404
        length: 14870
    children: []
    pos: 1404
    length: 14870
  pos: 0
  length: 16275
after_tree:
  type: program
  fields: {}
  children:
  - type: class_declaration
    fields:
      name:
        type: identifier
        fields:
          text: FunctionRewriter
        children: []
        pos: 1410
        length: 16
      body:
        type: class_body
        fields: {}
        children:
        - type: field_declaration
          fields:
            text: private final AbstractCompiler compiler;
          children: []
          pos: 1455
          length: 40
        - type: field_declaration
          fields:
            text: private static final int SAVINGS_THRESHOLD = 16;
          children: []
          pos: 1598
          length: 48
        - type: constructor_declaration
          fields:
            text: |-
              FunctionRewriter(AbstractCompiler compiler) {
                  this.compiler = compiler;
                }
          children: []
          pos: 1650
          length: 79
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: process
              children: []
              pos: 1757
              length: 7
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Node externs
                children: []
                pos: 1765
                length: 12
              pos: 1733
              length: 1725
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: |-
                    List<Reducer> reducers = ImmutableList.of(new ReturnConstantReducer(),
                                                                  new GetterReducer(),
                                                                  new SetterReducer(),
                                                                  new EmptyFunctionReducer(),
                                                                  new IdentityReducer());
                children: []
                pos: 1796
                length: 348
              - type: local_variable_declaration
                fields:
                  text: Multimap<Reducer, Reduction> reductionMap = HashMultimap.create();
                children: []
                pos: 2150
                length: 66
              - type: expression_statement
                fields:
                  text: |-
                    NodeTraversal.traverse(compiler, root,
                                               new ReductionGatherer(reducers, reductionMap));
                children: []
                pos: 2336
                length: 113
              - type: enhanced_for_statement
                fields:
                  text: |-
                    for (Reducer reducer : reducers) {
                          Collection<Reduction> reductions = reductionMap.get(reducer);
                          if (reductions.isEmpty()) {
                            continue;
                          }

                          Node helperCode = parseHelperCode(reducer);
                          if (helperCode == null) {
                            continue;
                          }

                          int helperCodeCost = InlineCostEstimator.getCost(helperCode);

                          // Estimate savings
                          int savings = 0;
                          for (Reduction reduction : reductions) {
                            savings += reduction.estimateSavings();
                          }

                          // Compare estimated savings against the helper cost.  Apply
                          // reductions if doing so will result in some savings.
                          if (savings > (helperCodeCost + SAVINGS_THRESHOLD)) {
                            for (Reduction reduction : reductions) {
                              reduction.apply();
                            }

                            Node addingRoot = compiler.getNodeForCodeInsertion(null);
                            addingRoot.addChildrenToFront(helperCode);
                            compiler.reportCodeChange();
                          }
                        }
                children: []
                pos: 2515
                length: 939
              pos: 1790
              length: 1668
          children: []
          pos: 1733
          length: 1725
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: parseHelperCode
              children: []
              pos: 3596
              length: 15
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Reducer reducer
                children: []
                pos: 3612
                length: 15
              pos: 3584
              length: 234
            body:
              type: block
              fields: {}
              children:
              - type: local_variable_declaration
                fields:
                  text: |-
                    Node root = compiler.parseSyntheticCode(
                            reducer.getClass().toString() + ":helper", reducer.getHelperSource());
                children: []
                pos: 3635
                length: 119
              - type: return_statement
                fields:
                  text: 'return (root != null) ? root.removeFirstChild() : null;'
                children: []
                pos: 3759
                length: 55
              pos: 3629
              length: 189
          children: []
          pos: 3584
          length: 234
        - type: method_declaration
          fields:
            name:
              type: identifier
              fields:
                text: isReduceableFunctionExpression
              children: []
              pos: 3845
              length: 30
            parameters:
              type: method_parameters
              fields: {}
              children:
              - type: formal_parameter
                fields:
                  text: Node n
                children: []
                pos: 3876
                length: 6
              pos: 3822
              length: 112
            body:
              type: block
              fields: {}
              children:
              - type: return_statement
                fields:
                  text: return NodeUtil.isFunctionExpression(n);
                children: []
                pos: 3890
                length: 40
              pos: 3884
              length: 50
          children: []
          pos: 3822
          length: 112
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: Reduction
              children: []
              pos: 4010
              length: 9
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: private final Node parent;
                children: []
                pos: 4026
                length: 26
              - type: field_declaration
                fields:
                  text: private final Node oldChild;
                children: []
                pos: 4057
                length: 28
              - type: field_declaration
                fields:
                  text: private final Node newChild;
                children: []
                pos: 4090
                length: 28
              - type: constructor_declaration
                fields:
                  text: |-
                    Reduction(Node parent, Node oldChild, Node newChild) {
                          this.parent = parent;
                          this.oldChild = oldChild;
                          this.newChild = newChild;
                        }
                children: []
                pos: 4124
                length: 152
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: apply
                    children: []
                    pos: 4377
                    length: 5
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 4372
                    length: 102
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: expression_statement
                      fields:
                        text: parent.replaceChild(oldChild, newChild);
                      children: []
                      pos: 4393
                      length: 40
                    - type: expression_statement
                      fields:
                        text: compiler.reportCodeChange();
                      children: []
                      pos: 4440
                      length: 28
                    pos: 4385
                    length: 89
                children: []
                pos: 4372
                length: 102
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: estimateSavings
                    children: []
                    pos: 4566
                    length: 15
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 4562
                    length: 131
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: |-
                          return InlineCostEstimator.getCost(oldChild) -
                                    InlineCostEstimator.getCost(newChild);
                      children: []
                      pos: 4592
                      length: 95
                    pos: 4584
                    length: 109
                children: []
                pos: 4562
                length: 131
              pos: 3996
              length: 701
          children: []
          pos: 3996
          length: 701
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: ReductionGatherer
              children: []
              pos: 4888
              length: 17
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: private final List<Reducer> reducers;
                children: []
                pos: 4932
                length: 37
              - type: field_declaration
                fields:
                  text: private final Multimap<Reducer, Reduction> reductions;
                children: []
                pos: 4974
                length: 54
              - type: constructor_declaration
                fields:
                  text: |-
                    ReductionGatherer(List<Reducer> reducers,
                                          Multimap<Reducer, Reduction> reductions) {
                          this.reducers = reducers;
                          this.reductions = reductions;
                        }
                children: []
                pos: 5226
                length: 180
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: shouldTraverse
                    children: []
                    pos: 5441
                    length: 14
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: NodeTraversal raversal
                      children: []
                      pos: 5456
                      length: 22
                    pos: 5412
                    length: 430
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: enhanced_for_statement
                      fields:
                        text: |-
                          for (Reducer reducer : reducers) {
                                  Node replacement = reducer.reduce(node);
                                  if (replacement != node) {
                                    reductions.put(reducer, new Reduction(parent, node, replacement));
                                    return false;
                                  }
                                }
                      children: []
                      pos: 5580
                      length: 237
                    - type: return_statement
                      fields:
                        text: return true;
                      children: []
                      pos: 5824
                      length: 12
                    pos: 5572
                    length: 270
                children: []
                pos: 5412
                length: 430
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: visit
                    children: []
                    pos: 5875
                    length: 5
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: NodeTraversal traversal
                      children: []
                      pos: 5881
                      length: 23
                    pos: 5849
                    length: 88
                  body:
                    type: block
                    fields: {}
                    children: []
                    pos: 5930
                    length: 7
                children: []
                pos: 5849
                length: 88
              pos: 4874
              length: 1067
          children: []
          pos: 4874
          length: 1067
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: Reducer
              children: []
              pos: 6050
              length: 7
            body:
              type: class_body
              fields: {}
              children:
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: getHelperSource
                    children: []
                    pos: 6164
                    length: 15
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 6148
                    length: 34
                children: []
                pos: 6148
                length: 34
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: reduce
                    children: []
                    pos: 6341
                    length: 6
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node node
                      children: []
                      pos: 6348
                      length: 9
                    pos: 6327
                    length: 32
                children: []
                pos: 6327
                length: 32
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: buildCallNode
                    children: []
                    pos: 6696
                    length: 13
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: String methodName
                      children: []
                      pos: 6710
                      length: 17
                    pos: 6675
                    length: 431
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: Node call = new Node(Token.CALL, lineno, charno);
                      children: []
                      pos: 6819
                      length: 49
                    - type: expression_statement
                      fields:
                        text: call.putBooleanProp(Node.FREE_CALL, true);
                      children: []
                      pos: 6875
                      length: 42
                    - type: expression_statement
                      fields:
                        text: call.addChildToBack(Node.newString(Token.NAME, methodName));
                      children: []
                      pos: 6924
                      length: 60
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: not_equals
                              fields:
                                left:
                                  type: identifier
                                  fields:
                                    text: argumentNode
                                  children: []
                                  pos: 6995
                                  length: 12
                                right:
                                  type: null_literal
                                  fields: {}
                                  children: []
                                  pos: 7011
                                  length: 4
                              children: []
                              pos: 6995
                              length: 20
                          children: []
                          pos: 6994
                          length: 22
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: expression_statement
                          fields:
                            text: call.addChildToBack(argumentNode.cloneTree());
                          children: []
                          pos: 7027
                          length: 46
                        pos: 7017
                        length: 64
                      pos: 6991
                      length: 90
                    - type: return_statement
                      fields:
                        text: return call;
                      children: []
                      pos: 7088
                      length: 12
                    pos: 6811
                    length: 295
                children: []
                pos: 6675
                length: 431
              pos: 6028
              length: 1082
          children: []
          pos: 6028
          length: 1082
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: EmptyFunctionReducer
              children: []
              pos: 7378
              length: 20
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: static final String FACTORY_METHOD_NAME = "JSCompiler_emptyFn";
                children: []
                pos: 7421
                length: 63
              - type: field_declaration
                fields:
                  text: |-
                    static final String HELPER_SOURCE =
                            "function " + FACTORY_METHOD_NAME + "() {" +
                            "  return function() {}" +
                            "}";
                children: []
                pos: 7489
                length: 136
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: getHelperSource
                    children: []
                    pos: 7659
                    length: 15
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 7631
                    length: 81
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return HELPER_SOURCE;
                      children: []
                      pos: 7685
                      length: 21
                    pos: 7677
                    length: 35
                children: []
                pos: 7631
                length: 81
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: reduce
                    children: []
                    pos: 7744
                    length: 6
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node node
                      children: []
                      pos: 7751
                      length: 9
                    pos: 7718
                    length: 271
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: method_invocation
                              fields:
                                text: NodeUtil.isEmptyFunctionExpression(node)
                              children: []
                              pos: 7774
                              length: 40
                          children: []
                          pos: 7773
                          length: 42
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: |-
                              return buildCallNode(FACTORY_METHOD_NAME, null,
                                                           node.getLineno(), node.getCharno());
                          children: []
                          pos: 7826
                          length: 113
                        pos: 7816
                        length: 131
                      pos: 7770
                      length: 213
                    pos: 7762
                    length: 227
                children: []
                pos: 7718
                length: 271
              pos: 7357
              length: 636
          children: []
          pos: 7357
          length: 636
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: SingleReturnStatementReducer
              children: []
              pos: 8126
              length: 28
            body:
              type: class_body
              fields: {}
              children:
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: maybeGetSingleReturnRValue
                    children: []
                    pos: 8335
                    length: 26
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node functionNode
                      children: []
                      pos: 8362
                      length: 17
                    pos: 8314
                    length: 347
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: Node body = functionNode.getLastChild();
                      children: []
                      pos: 8389
                      length: 40
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: unary_expression
                              fields:
                                text: "!body.hasOneChild()"
                              children: []
                              pos: 8440
                              length: 19
                          children: []
                          pos: 8439
                          length: 21
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return null;
                          children: []
                          pos: 8471
                          length: 12
                        pos: 8461
                        length: 30
                      pos: 8436
                      length: 55
                    - type: local_variable_declaration
                      fields:
                        text: Node statement = body.getFirstChild();
                      children: []
                      pos: 8499
                      length: 38
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: equals
                              fields:
                                left:
                                  type: method_invocation
                                  fields:
                                    text: statement.getType()
                                  children: []
                                  pos: 8548
                                  length: 19
                                right:
                                  type: field_access
                                  fields:
                                    text: Token.RETURN
                                  children: []
                                  pos: 8571
                                  length: 12
                              children: []
                              pos: 8548
                              length: 35
                          children: []
                          pos: 8547
                          length: 37
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return statement.getFirstChild();
                          children: []
                          pos: 8595
                          length: 33
                        pos: 8585
                        length: 51
                      pos: 8544
                      length: 92
                    - type: return_statement
                      fields:
                        text: return null;
                      children: []
                      pos: 8643
                      length: 12
                    pos: 8381
                    length: 280
                children: []
                pos: 8314
                length: 347
              pos: 8104
              length: 561
          children: []
          pos: 8104
          length: 561
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: IdentityReducer
              children: []
              pos: 8914
              length: 15
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: static final String FACTORY_METHOD_NAME = "JSCompiler_identityFn";
                children: []
                pos: 8973
                length: 66
              - type: field_declaration
                fields:
                  text: |-
                    static final String HELPER_SOURCE =
                            "function " + FACTORY_METHOD_NAME + "() {" +
                            "  return function(" + FACTORY_METHOD_NAME + "_value) {" +
                                 "return " + FACTORY_METHOD_NAME + "_value}" +
                            "}";
                children: []
                pos: 9044
                length: 227
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: getHelperSource
                    children: []
                    pos: 9305
                    length: 15
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 9277
                    length: 81
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return HELPER_SOURCE;
                      children: []
                      pos: 9331
                      length: 21
                    pos: 9323
                    length: 35
                children: []
                pos: 9277
                length: 81
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: reduce
                    children: []
                    pos: 9390
                    length: 6
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node node
                      children: []
                      pos: 9397
                      length: 9
                    pos: 9364
                    length: 336
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: unary_expression
                              fields:
                                text: "!isReduceableFunctionExpression(node)"
                              children: []
                              pos: 9420
                              length: 37
                          children: []
                          pos: 9419
                          length: 39
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return node;
                          children: []
                          pos: 9469
                          length: 12
                        pos: 9459
                        length: 30
                      pos: 9416
                      length: 73
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: method_invocation
                              fields:
                                text: isIdentityFunction(node)
                              children: []
                              pos: 9501
                              length: 24
                          children: []
                          pos: 9500
                          length: 26
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: |-
                              return buildCallNode(FACTORY_METHOD_NAME, null,
                                                           node.getLineno(), node.getCharno());
                          children: []
                          pos: 9537
                          length: 113
                        pos: 9527
                        length: 131
                      pos: 9497
                      length: 197
                    pos: 9408
                    length: 292
                children: []
                pos: 9364
                length: 336
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: isIdentityFunction
                    children: []
                    pos: 9905
                    length: 18
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node functionNode
                      children: []
                      pos: 9924
                      length: 17
                    pos: 9889
                    length: 466
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: Node argList = functionNode.getFirstChild().getNext();
                      children: []
                      pos: 9951
                      length: 54
                    - type: local_variable_declaration
                      fields:
                        text: Node paramNode = argList.getFirstChild();
                      children: []
                      pos: 10012
                      length: 41
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: equals
                              fields:
                                left:
                                  type: identifier
                                  fields:
                                    text: paramNode
                                  children: []
                                  pos: 10064
                                  length: 9
                                right:
                                  type: null_literal
                                  fields: {}
                                  children: []
                                  pos: 10077
                                  length: 4
                              children: []
                              pos: 10064
                              length: 17
                          children: []
                          pos: 10063
                          length: 19
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return false;
                          children: []
                          pos: 10093
                          length: 13
                        pos: 10083
                        length: 31
                      pos: 10060
                      length: 54
                    - type: local_variable_declaration
                      fields:
                        text: Node value = maybeGetSingleReturnRValue(functionNode);
                      children: []
                      pos: 10122
                      length: 54
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: and
                              fields:
                                left:
                                  type: and
                                  fields:
                                    left:
                                      type: not_equals
                                      fields:
                                        left:
                                          type: identifier
                                          fields:
                                            text: value
                                          children: []
                                          pos: 10187
                                          length: 5
                                        right:
                                          type: null_literal
                                          fields: {}
                                          children: []
                                          pos: 10196
                                          length: 4
                                      children: []
                                      pos: 10187
                                      length: 13
                                    right:
                                      type: method_invocation
                                      fields:
                                        text: NodeUtil.isName(value)
                                      children: []
                                      pos: 10214
                                      length: 22
                                  children: []
                                  pos: 10187
                                  length: 49
                                right:
                                  type: method_invocation
                                  fields:
                                    text: value.getString().equals(paramNode.getString())
                                  children: []
                                  pos: 10250
                                  length: 47
                              children: []
                              pos: 10187
                              length: 110
                          children: []
                          pos: 10186
                          length: 112
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return true;
                          children: []
                          pos: 10309
                          length: 12
                        pos: 10299
                        length: 30
                      pos: 10183
                      length: 146
                    - type: return_statement
                      fields:
                        text: return false;
                      children: []
                      pos: 10336
                      length: 13
                    pos: 9943
                    length: 412
                children: []
                pos: 9889
                length: 466
              pos: 8893
              length: 1466
          children: []
          pos: 8893
          length: 1466
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: ReturnConstantReducer
              children: []
              pos: 10642
              length: 21
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: static final String FACTORY_METHOD_NAME = "JSCompiler_returnArg";
                children: []
                pos: 10713
                length: 65
              - type: field_declaration
                fields:
                  text: |-
                    static final String HELPER_SOURCE =
                            "function " + FACTORY_METHOD_NAME +
                            "(" + FACTORY_METHOD_NAME + "_value) {" +
                            "  return function() {return " + FACTORY_METHOD_NAME + "_value}" +
                            "}";
                children: []
                pos: 10783
                length: 217
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: getHelperSource
                    children: []
                    pos: 11034
                    length: 15
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 11006
                    length: 81
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return HELPER_SOURCE;
                      children: []
                      pos: 11060
                      length: 21
                    pos: 11052
                    length: 35
                children: []
                pos: 11006
                length: 81
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: reduce
                    children: []
                    pos: 11119
                    length: 6
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node node
                      children: []
                      pos: 11126
                      length: 9
                    pos: 11093
                    length: 377
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: unary_expression
                              fields:
                                text: "!isReduceableFunctionExpression(node)"
                              children: []
                              pos: 11149
                              length: 37
                          children: []
                          pos: 11148
                          length: 39
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return node;
                          children: []
                          pos: 11198
                          length: 12
                        pos: 11188
                        length: 30
                      pos: 11145
                      length: 73
                    - type: local_variable_declaration
                      fields:
                        text: Node valueNode = getValueNode(node);
                      children: []
                      pos: 11226
                      length: 36
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: not_equals
                              fields:
                                left:
                                  type: identifier
                                  fields:
                                    text: valueNode
                                  children: []
                                  pos: 11273
                                  length: 9
                                right:
                                  type: null_literal
                                  fields: {}
                                  children: []
                                  pos: 11286
                                  length: 4
                              children: []
                              pos: 11273
                              length: 17
                          children: []
                          pos: 11272
                          length: 19
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: |-
                              return buildCallNode(FACTORY_METHOD_NAME, valueNode,
                                                           node.getLineno(), node.getCharno());
                          children: []
                          pos: 11302
                          length: 118
                        pos: 11292
                        length: 136
                      pos: 11269
                      length: 195
                    pos: 11137
                    length: 333
                children: []
                pos: 11093
                length: 377
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: getValueNode
                    children: []
                    pos: 11724
                    length: 12
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node functionNode
                      children: []
                      pos: 11737
                      length: 17
                    pos: 11711
                    length: 235
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: Node value = maybeGetSingleReturnRValue(functionNode);
                      children: []
                      pos: 11764
                      length: 54
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: and
                              fields:
                                left:
                                  type: not_equals
                                  fields:
                                    left:
                                      type: identifier
                                      fields:
                                        text: value
                                      children: []
                                      pos: 11829
                                      length: 5
                                    right:
                                      type: null_literal
                                      fields: {}
                                      children: []
                                      pos: 11838
                                      length: 4
                                  children: []
                                  pos: 11829
                                  length: 13
                                right:
                                  type: method_invocation
                                  fields:
                                    text: NodeUtil.isImmutableValue(value)
                                  children: []
                                  pos: 11856
                                  length: 32
                              children: []
                              pos: 11829
                              length: 59
                          children: []
                          pos: 11828
                          length: 61
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return value;
                          children: []
                          pos: 11900
                          length: 13
                        pos: 11890
                        length: 31
                      pos: 11825
                      length: 96
                    - type: return_statement
                      fields:
                        text: return null;
                      children: []
                      pos: 11928
                      length: 12
                    pos: 11756
                    length: 190
                children: []
                pos: 11711
                length: 235
              pos: 10621
              length: 1329
          children: []
          pos: 10621
          length: 1329
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: GetterReducer
              children: []
              pos: 12207
              length: 13
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: static final String FACTORY_METHOD_NAME = "JSCompiler_get";
                children: []
                pos: 12264
                length: 59
              - type: field_declaration
                fields:
                  text: |-
                    static final String HELPER_SOURCE =
                            "function " + FACTORY_METHOD_NAME + "(" +
                            FACTORY_METHOD_NAME + "_name) {" +
                            "  return function() {return this[" + FACTORY_METHOD_NAME + "_name]}" +
                            "}";
                children: []
                pos: 12328
                length: 221
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: getHelperSource
                    children: []
                    pos: 12583
                    length: 15
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 12555
                    length: 81
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return HELPER_SOURCE;
                      children: []
                      pos: 12609
                      length: 21
                    pos: 12601
                    length: 35
                children: []
                pos: 12555
                length: 81
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: reduce
                    children: []
                    pos: 12668
                    length: 6
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node node
                      children: []
                      pos: 12675
                      length: 9
                    pos: 12642
                    length: 557
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: unary_expression
                              fields:
                                text: "!isReduceableFunctionExpression(node)"
                              children: []
                              pos: 12698
                              length: 37
                          children: []
                          pos: 12697
                          length: 39
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return node;
                          children: []
                          pos: 12747
                          length: 12
                        pos: 12737
                        length: 30
                      pos: 12694
                      length: 73
                    - type: local_variable_declaration
                      fields:
                        text: Node propName = getGetPropertyName(node);
                      children: []
                      pos: 12775
                      length: 41
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: not_equals
                              fields:
                                left:
                                  type: identifier
                                  fields:
                                    text: propName
                                  children: []
                                  pos: 12827
                                  length: 8
                                right:
                                  type: null_literal
                                  fields: {}
                                  children: []
                                  pos: 12839
                                  length: 4
                              children: []
                              pos: 12827
                              length: 16
                          children: []
                          pos: 12826
                          length: 18
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: if_statement
                          fields:
                            condition:
                              type: parenthesized_expression
                              fields:
                                expression:
                                  type: not_equals
                                  fields:
                                    left:
                                      type: method_invocation
                                      fields:
                                        text: propName.getType()
                                      children: []
                                      pos: 12859
                                      length: 18
                                    right:
                                      type: field_access
                                      fields:
                                        text: Token.STRING
                                      children: []
                                      pos: 12881
                                      length: 12
                                  children: []
                                  pos: 12859
                                  length: 34
                              children: []
                              pos: 12858
                              length: 36
                          children:
                          - type: block
                            fields: {}
                            children:
                            - type: throw_statement
                              fields:
                                text: |-
                                  throw new IllegalStateException(
                                                "Expected STRING, got " + Token.name(propName.getType()));
                              children: []
                              pos: 12907
                              length: 105
                            pos: 12895
                            length: 127
                          pos: 12855
                          length: 167
                        - type: return_statement
                          fields:
                            text: |-
                              return buildCallNode(FACTORY_METHOD_NAME, propName,
                                                           node.getLineno(), node.getCharno());
                          children: []
                          pos: 13032
                          length: 117
                        pos: 12845
                        length: 312
                      pos: 12823
                      length: 370
                    pos: 12686
                    length: 513
                children: []
                pos: 12642
                length: 557
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: getGetPropertyName
                    children: []
                    pos: 13462
                    length: 18
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node functionNode
                      children: []
                      pos: 13481
                      length: 17
                    pos: 13449
                    length: 301
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: Node value = maybeGetSingleReturnRValue(functionNode);
                      children: []
                      pos: 13508
                      length: 54
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: and
                              fields:
                                left:
                                  type: and
                                  fields:
                                    left:
                                      type: not_equals
                                      fields:
                                        left:
                                          type: identifier
                                          fields:
                                            text: value
                                          children: []
                                          pos: 13573
                                          length: 5
                                        right:
                                          type: null_literal
                                          fields: {}
                                          children: []
                                          pos: 13582
                                          length: 4
                                      children: []
                                      pos: 13573
                                      length: 13
                                    right:
                                      type: method_invocation
                                      fields:
                                        text: NodeUtil.isGetProp(value)
                                      children: []
                                      pos: 13600
                                      length: 25
                                  children: []
                                  pos: 13573
                                  length: 52
                                right:
                                  type: method_invocation
                                  fields:
                                    text: NodeUtil.isThis(value.getFirstChild())
                                  children: []
                                  pos: 13639
                                  length: 38
                              children: []
                              pos: 13573
                              length: 104
                          children: []
                          pos: 13572
                          length: 106
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return value.getLastChild();
                          children: []
                          pos: 13689
                          length: 28
                        pos: 13679
                        length: 46
                      pos: 13569
                      length: 156
                    - type: return_statement
                      fields:
                        text: return null;
                      children: []
                      pos: 13732
                      length: 12
                    pos: 13500
                    length: 250
                children: []
                pos: 13449
                length: 301
              pos: 12186
              length: 1568
          children: []
          pos: 12186
          length: 1568
        - type: class_declaration
          fields:
            name:
              type: identifier
              fields:
                text: SetterReducer
              children: []
              pos: 14020
              length: 13
            body:
              type: class_body
              fields: {}
              children:
              - type: field_declaration
                fields:
                  text: static final String FACTORY_METHOD_NAME = "JSCompiler_set";
                children: []
                pos: 14056
                length: 59
              - type: field_declaration
                fields:
                  text: |-
                    static final String HELPER_SOURCE =
                            "function " + FACTORY_METHOD_NAME + "(" +
                            FACTORY_METHOD_NAME + "_name) {" +
                            "  return function(" + FACTORY_METHOD_NAME + "_value) {" +
                            "this[" + FACTORY_METHOD_NAME + "_name] = " +
                            FACTORY_METHOD_NAME + "_value}" +
                            "}";
                children: []
                pos: 14120
                length: 304
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: getHelperSource
                    children: []
                    pos: 14458
                    length: 15
                  parameters:
                    type: method_parameters
                    fields: {}
                    children: []
                    pos: 14430
                    length: 81
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: return_statement
                      fields:
                        text: return HELPER_SOURCE;
                      children: []
                      pos: 14484
                      length: 21
                    pos: 14476
                    length: 35
                children: []
                pos: 14430
                length: 81
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: reduce
                    children: []
                    pos: 14543
                    length: 6
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node node
                      children: []
                      pos: 14550
                      length: 9
                    pos: 14517
                    length: 557
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: unary_expression
                              fields:
                                text: "!isReduceableFunctionExpression(node)"
                              children: []
                              pos: 14573
                              length: 37
                          children: []
                          pos: 14572
                          length: 39
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return node;
                          children: []
                          pos: 14622
                          length: 12
                        pos: 14612
                        length: 30
                      pos: 14569
                      length: 73
                    - type: local_variable_declaration
                      fields:
                        text: Node propName = getSetPropertyName(node);
                      children: []
                      pos: 14650
                      length: 41
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: not_equals
                              fields:
                                left:
                                  type: identifier
                                  fields:
                                    text: propName
                                  children: []
                                  pos: 14702
                                  length: 8
                                right:
                                  type: null_literal
                                  fields: {}
                                  children: []
                                  pos: 14714
                                  length: 4
                              children: []
                              pos: 14702
                              length: 16
                          children: []
                          pos: 14701
                          length: 18
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: if_statement
                          fields:
                            condition:
                              type: parenthesized_expression
                              fields:
                                expression:
                                  type: not_equals
                                  fields:
                                    left:
                                      type: method_invocation
                                      fields:
                                        text: propName.getType()
                                      children: []
                                      pos: 14734
                                      length: 18
                                    right:
                                      type: field_access
                                      fields:
                                        text: Token.STRING
                                      children: []
                                      pos: 14756
                                      length: 12
                                  children: []
                                  pos: 14734
                                  length: 34
                              children: []
                              pos: 14733
                              length: 36
                          children:
                          - type: block
                            fields: {}
                            children:
                            - type: throw_statement
                              fields:
                                text: |-
                                  throw new IllegalStateException(
                                                "Expected STRING, got " + Token.name(propName.getType()));
                              children: []
                              pos: 14782
                              length: 105
                            pos: 14770
                            length: 127
                          pos: 14730
                          length: 167
                        - type: return_statement
                          fields:
                            text: |-
                              return buildCallNode(FACTORY_METHOD_NAME, propName,
                                                           node.getLineno(), node.getCharno());
                          children: []
                          pos: 14907
                          length: 117
                        pos: 14720
                        length: 312
                      pos: 14698
                      length: 370
                    pos: 14561
                    length: 513
                children: []
                pos: 14517
                length: 557
              - type: method_declaration
                fields:
                  name:
                    type: identifier
                    fields:
                      text: getSetPropertyName
                    children: []
                    pos: 15349
                    length: 18
                  parameters:
                    type: method_parameters
                    fields: {}
                    children:
                    - type: formal_parameter
                      fields:
                        text: Node functionNode
                      children: []
                      pos: 15368
                      length: 17
                    pos: 15336
                    length: 882
                  body:
                    type: block
                    fields: {}
                    children:
                    - type: local_variable_declaration
                      fields:
                        text: Node body = functionNode.getLastChild();
                      children: []
                      pos: 15395
                      length: 40
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: unary_expression
                              fields:
                                text: "!body.hasOneChild()"
                              children: []
                              pos: 15446
                              length: 19
                          children: []
                          pos: 15445
                          length: 21
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return null;
                          children: []
                          pos: 15477
                          length: 12
                        pos: 15467
                        length: 30
                      pos: 15442
                      length: 55
                    - type: local_variable_declaration
                      fields:
                        text: Node argList = functionNode.getFirstChild().getNext();
                      children: []
                      pos: 15505
                      length: 54
                    - type: local_variable_declaration
                      fields:
                        text: Node paramNode = argList.getFirstChild();
                      children: []
                      pos: 15566
                      length: 41
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: equals
                              fields:
                                left:
                                  type: identifier
                                  fields:
                                    text: paramNode
                                  children: []
                                  pos: 15618
                                  length: 9
                                right:
                                  type: null_literal
                                  fields: {}
                                  children: []
                                  pos: 15631
                                  length: 4
                              children: []
                              pos: 15618
                              length: 17
                          children: []
                          pos: 15617
                          length: 19
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return null;
                          children: []
                          pos: 15647
                          length: 12
                        pos: 15637
                        length: 30
                      pos: 15614
                      length: 53
                    - type: local_variable_declaration
                      fields:
                        text: Node statement = body.getFirstChild();
                      children: []
                      pos: 15675
                      length: 38
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: unary_expression
                              fields:
                                text: "!NodeUtil.isExprAssign(statement)"
                              children: []
                              pos: 15724
                              length: 33
                          children: []
                          pos: 15723
                          length: 35
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: return_statement
                          fields:
                            text: return null;
                          children: []
                          pos: 15769
                          length: 12
                        pos: 15759
                        length: 30
                      pos: 15720
                      length: 69
                    - type: local_variable_declaration
                      fields:
                        text: Node assign = statement.getFirstChild();
                      children: []
                      pos: 15797
                      length: 40
                    - type: local_variable_declaration
                      fields:
                        text: Node lhs = assign.getFirstChild();
                      children: []
                      pos: 15844
                      length: 34
                    - type: if_statement
                      fields:
                        condition:
                          type: parenthesized_expression
                          fields:
                            expression:
                              type: and
                              fields:
                                left:
                                  type: method_invocation
                                  fields:
                                    text: NodeUtil.isGetProp(lhs)
                                  children: []
                                  pos: 15889
                                  length: 23
                                right:
                                  type: method_invocation
                                  fields:
                                    text: NodeUtil.isThis(lhs.getFirstChild())
                                  children: []
                                  pos: 15916
                                  length: 36
                              children: []
                              pos: 15889
                              length: 63
                          children: []
                          pos: 15888
                          length: 65
                      children:
                      - type: block
                        fields: {}
                        children:
                        - type: local_variable_declaration
                          fields:
                            text: Node rhs = assign.getLastChild();
                          children: []
                          pos: 15964
                          length: 33
                        - type: if_statement
                          fields:
                            condition:
                              type: parenthesized_expression
                              fields:
                                expression:
                                  type: and
                                  fields:
                                    left:
                                      type: method_invocation
                                      fields:
                                        text: NodeUtil.isName(rhs)
                                      children: []
                                      pos: 16010
                                      length: 20
                                    right:
                                      type: method_invocation
                                      fields:
                                        text: rhs.getString().equals(paramNode.getString())
                                      children: []
                                      pos: 16046
                                      length: 45
                                  children: []
                                  pos: 16010
                                  length: 81
                              children: []
                              pos: 16009
                              length: 83
                          children:
                          - type: block
                            fields: {}
                            children:
                            - type: local_variable_declaration
                              fields:
                                text: Node propertyName = lhs.getLastChild();
                              children: []
                              pos: 16105
                              length: 39
                            - type: return_statement
                              fields:
                                text: return propertyName;
                              children: []
                              pos: 16155
                              length: 20
                            pos: 16093
                            length: 92
                          pos: 16006
                          length: 179
                        pos: 15954
                        length: 239
                      pos: 15885
                      length: 308
                    - type: return_statement
                      fields:
                        text: return null;
                      children: []
                      pos: 16200
                      length: 12
                    pos: 15387
                    length: 831
                children: []
                pos: 15336
                length: 882
              pos: 13999
              length: 2223
          children: []
          pos: 13999
          length: 2223
        pos: 1404
        length: 14820
    children: []
    pos: 1404
    length: 14820
  pos: 0
  length: 16225
text_diff: "--- before\n+++ after\n@@ -114,8 +114,7 @@\n   }\n \n   private static
  boolean isReduceableFunctionExpression(Node n) {\n-    return NodeUtil.isFunctionExpression(n)\n-
  \       && !NodeUtil.isGetOrSetKey(n.getParent());\n+    return NodeUtil.isFunctionExpression(n);\n
  \  }\n \n   /**\n"
tree_diff: |+
  New cluster:
  UPDATE from return NodeUtil.isFunctionExpression(n)
          && !NodeUtil.isGetOrSetKey(n.getParent()); to return NodeUtil.isFunctionExpression(n);
  ------------
  ===
  update-node
  ---
  return_statement: return NodeUtil.isFunctionExpression(n)
          && !NodeUtil.isGetOrSetKey(n.getParent()); [3890,3980]
  replace return NodeUtil.isFunctionExpression(n)
          && !NodeUtil.isGetOrSetKey(n.getParent()); by return NodeUtil.isFunctionExpression(n);

...
